{
  "markdown": "\nbody#cma-body { font-family: Franklin Gothic Medium, Franklin Gothic, ITC Franklin Gothic, Arial, sans-serif; font-size: 15px; } table#cma-table { width: 900px; margin: 2px; table-layout: fixed; border-collapse: collapse; } div#cma-exercise { width: 900px; height: 30px; text-align: center; line-height: 30px; font-weight: bold; font-size: 18px; } div.cma-header { text-align: center; margin-bottom: 40px; } div.cma-footer { text-align: center; margin-top: 20px; } h2.cma-tlp { background-color: #000; color: #ffffff; width: 180px; height: 30px; text-align: center; line-height: 30px; font-weight: bold; font-size: 18px; float: right; } span.cma-fouo { line-height: 30px; font-weight: bold; font-size: 16px; } h3.cma-section-title { font-size: 18px; font-weight: bold; padding: 0 10px; margin-top: 10px; } h4.cma-object-title { font-size: 16px; font-weight: bold; margin-left: 20px; } h5.cma-data-title { padding: 3px 0 3px 10px; margin: 10px 0 0 20px; background-color: #e7eef4; font-size: 15px; } p.cma-text { margin: 5px 0 0 25px !important; word-wrap: break-word !important; } div.cma-section { border-bottom: 5px solid #aaa; margin: 5px 0; padding-bottom: 10px; } div.cma-avoid-page-break { page-break-inside: avoid; } div#cma-summary { page-break-after: always; } div#cma-faq { page-break-after: always; } table.cma-content { border-collapse: collapse; margin-left: 20px; } table.cma-hashes { table-layout: fixed; width: 880px; } table.cma-hashes td{ width: 780px; word-wrap: break-word; } .cma-left th { text-align: right; vertical-align: top; padding: 3px 8px 3px 20px; background-color: #f0f0f0; border-right: 1px solid #aaa; } .cma-left td { padding-left: 8px; } .cma-color-title th, .cma-color-list th, .cma-color-title-only th { text-align: left; padding: 3px 0 3px 20px; background-color: #f0f0f0; } .cma-color-title td, .cma-color-list td, .cma-color-title-only td { padding: 3px 20px; } .cma-color-title tr:nth-child(odd) { background-color: #f0f0f0; } .cma-color-list tr:nth-child(even) { background-color: #f0f0f0; } td.cma-relationship { max-width: 310px; word-wrap: break-word; } ul.cma-ul { margin: 5px 0 10px 0; } ul.cma-ul li { line-height: 20px; margin-bottom: 5px; word-wrap: break-word; } #cma-survey { font-weight: bold; font-style: italic; } div.cma-banner-container { position: relative; text-align: center; color: white; } img.cma-banner { max-width: 900px; height: auto; } img.cma-nccic-logo { max-height: 60px; width: auto; float: left; margin-top: -15px; } div.cma-report-name { position: absolute; bottom: 32px; left: 12px; font-size: 20px; } div.cma-report-number { position: absolute; bottom: 70px; right: 100px; font-size: 18px; } div.cma-report-date { position: absolute; bottom: 32px; right: 100px; font-size: 18px; } img.cma-thumbnail { max-height: 100px; width: auto; vertical-align: top; } img.cma-screenshot { margin: 10px 0 0 25px; max-width: 800px; height: auto; vertical-align: top; border: 1px solid #000; } div.cma-screenshot-text { margin: 10px 0 0 25px; } .cma-break-word { word-wrap: break-word; } .cma-tag { border-radius: 5px; padding: 1px 10px; margin-right: 10px; } .cma-tag-info { background: #f0f0f0; } .cma-tag-warning { background: #ffdead; }\n\n\n\n\n\n\n\u00a0\nMalware Analysis Report\n10322463.r4.v1\n2021-04-08\n\nNotification\n\nThis report is provided \"as is\" for informational purposes only. The Department of Homeland Security (DHS) does not provide any warranties of any kind regarding any information contained herein. The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.\nThis document is marked TLP:WHITE--Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.\n\nSummary\n\nDescription\nThis Malware Analysis Report (MAR) is the result of analytic efforts among the Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Treasury (Treasury) to highlight the cyber threat to cryptocurrency posed by North Korea, formally known as the Democratic People\u2019s Republic of Korea (DPRK), and provide mitigation recommendations. Working with U.S. government partners, FBI, CISA, and Treasury assess that Lazarus Group\u2014which these agencies attribute to North Korean state-sponsored advanced persistent threat (APT) actors\u2014is targeting individuals and companies, including cryptocurrency exchanges and financial service companies, through the dissemination of cryptocurrency trading applications that have been modified to include malware that facilitates theft of cryptocurrency.\n\n\t\t\tThis MAR highlights this cyber threat posed by North Korea and provides detailed indicators of compromise (IOCs) used by the North Korean government. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on other versions of AppleJeus and recommended steps to mitigate this threat, see Joint Cybersecurity Advisory AA21-048A: AppleJeus: Analysis of Lazarus Group Cryptocurrency Malware at https://www.us-cert.cisa.gov/ncas/alerts/AA21-048A.\n\n\t\t\tThere have been multiple versions of AppleJeus malware discovered since its initial discovery in August 2018. In most versions, the malware appears to be from a legitimate-looking cryptocurrency trading company and website, whereby an unsuspecting individual downloads a third-party application from a website that appears legitimate.\n\n\t\t\tThe U.S. Government has identified AppleJeus malware version\u2014Kupay Wallet\u2014and associated IOCs used by the North Korean government in AppleJeus operations.\n\n\t\t\tKupay Wallet, discovered in March 2020, is a legitimate-looking cryptocurrency trading software that is marketed and distributed by a company and website\u2014Kupay Service and kupaywallet[.]com, respectively\u2014that appear legitimate. Some information has been redacted from this report to preserve victim anonymity.\nFor a downloadable copy of IOCs, see:\u00a0MAR-10322463-4.v1.stix.\nSubmitted Files (7)\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba (kupay_upgrade)\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6 (Kupay.exe)\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9 (Kupay.dmg)\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8 (Kupay.msi)\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd (kupayupdate_stage2)\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492 (kupay)\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d (KupayUpgrade.exe)\nDomains (2)\nkupaywallet.com\nlevelframeblog.com\n\nFindings\n\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\nTags\ndropper\nDetails\n\n\n\nName\nKupay.msi\n\n\nSize\n143568384 bytes\n\n\nType\nComposite Document File V2 Document, Little Endian, Os: Windows, Version 10.0, MSI Installer, Last Printed: Fri Dec 11 11:47:44 2009, Create Time/Date: Fri Dec 11 11:47:44 2009, Last Saved Time/Date: Fri Dec 11 11:47:44 2009, Security: 0, Code page: 1252, Revision Number: {9DCFF3DB-C353-460A-B325-AF38D7F3E338}, Number of Words: 2, Subject: Kupay, Author: Kupay Service, Name of Creating Application: Advanced Installer 14.5.2 build 83143, Template: ;1033, Comments: This installer database contains the logic and data required to install Kupay., Title: Installation Database, Keywords: Installer, MSI, Database, Number of Pages: 200\n\n\nMD5\nafdf3dd62dafd401be4bbeca65b42635\n\n\nSHA1\n8b45d12ed8c058ea0ce3122da9a82b9fb045d6a3\n\n\nSHA256\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\nSHA512\nbdc7a8904ad154046ade472442810c0007e5494665b429d847eef74b05567422600dd543bd8ae632128cd8def853926f2a86eab0e7d91a1d4451489ea2262b55\n\n\nssdeep\n3145728:M8yVXZLQX6rw3cJRGmMEuwRNiPTdy68L04oIRHndNQGOx:9yVXZfrw3CGtw3iPTdytmIRHdlw\n\n\nEntropy\n7.997013\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nRelationships\n\n\n\n6b945159b4...\nContains\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n\n6b945159b4...\nContains\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n\n6b945159b4...\nDownloaded_By\nkupaywallet.com\n\n\n\nDescription\nThis Windows program from the Kupay Service site is a Windows MSI Installer with the file name Kupay[GUID].msi. The installer was hosted at hxxps[:]kupaywallet.com/product/[GUID]. The [GUID] is a unique file that is crated for a specific victim and is being withheld to preserve the identity of the intended recipient.\n\n\t\t\tThe installer looks legitimate and will install the \"Kupay.exe\" (1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6) file in the \u201cC:\\Program Files (x86)\\Kupay\u201d folder. It also installs \"KupayUpgrade.exe\" (fc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d) in the \u201cC:\\Users\\<username>\\AppData\\Roaming\\KupaySupport\u201d folder. Immediately after installation, the installer launches the \"KupayUpgrade.exe\" binary.\nScreenshots\n \n\nFigure 1 - Screenshot of \"Kupay.msi\" installation.\n\n\n\nkupaywallet.com\nTags\ncommand-and-control\nURLs\n\nkupaywallet.com/kupay_update.php\nkupaywallet.com/product/\n\nWhois\nWhois for kupaywallet.com had the following information:\n\t\t\tRegistrar: NAMECHEAP INC\n\t\t\tCreation Date: 2020-02-21\n\t\t\tRegistrar Registration Expiration Date: 2021-02-21\nRelationships\n\n\n\nkupaywallet.com\nDownloaded\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\nkupaywallet.com\nDownloaded\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\nkupaywallet.com\nConnected_From\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\n\nDescription\nThe domain kupaywallet.com had a legitimately signed Sectigo Secure Sockets Layer (SSL) certificate, which was \u201cDomain Control Validated\u201d just as all previous AppleJeus domain certificates. Investigation revealed the point of contact listed for verification was admin[@]kupaywallet.com. No other contact information was available as the administrative or technical contact for the kupaywallet.com domain.\n\n\t\t\tThe domain is registered with NameCheap at the IP address 104.200.67.96 with ASN 8100.\n\n\t\t\tIn addition to the site kupaywallet.com, a Twitter account @kupayservice is associated with the company. This account tweets out general cryptocurrency articles and information and replies to various related tweets. The first tweet was on May 23, 2019, while the last was on July 11, 2019. Twitter lists the joined date for @kupayservice to be October 2018.\nScreenshots\n \n\nFigure 2 - Screenshot of KupayService Twitter account.\n\n\n\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\nTags\ntrojan\nDetails\n\n\n\nName\nKupay.exe\n\n\nSize\n97686016 bytes\n\n\nType\nPE32+ executable (GUI) x86-64, for MS Windows\n\n\nMD5\n668d696582f9c00029e2e8253470e9db\n\n\nSHA1\ne83ebe43da7bbfb9c95d34163383d1b3926e663f\n\n\nSHA256\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n\nSHA512\n0b370636ea2b7211d691a3bfcfc9017cb12df6874becb9b6334ca735bc325f59c50e99fc3b57c8db2d265e0c631651c7280109ffdbb3b48b7d3709d908228de6\n\n\nssdeep\n1572864:MdJvugr82jf19dUM/1T8+1VJRukUhkmG:Mdhg6Pm\n\n\nEntropy\n6.674838\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\n\n\n\n97\n78b56a1385f2a92f3c9404f71731088646aac6c2c84cc19a449976272dab418f\n\n\n\nPE Metadata\n\n\n\nCompile Date\n2019-12-16 00:00:00-05:00\n\n\nImport Hash\nbb1d46df79ee2045d0bc2529cf6c7458\n\n\nCompany Name\nBitPay\n\n\nFile Description\nKupay\n\n\nInternal Name\nKupay\n\n\nLegal Copyright\nCopyright \u00a9 2020 BitPay\n\n\nProduct Name\nKupay\n\n\nProduct Version\n9.1.0.0\n\n\n\nPE Sections\n\n\n\nMD5\nName\nRaw Size\nEntropy\n\n\n32b731864b0ff3d1c427c97d582e7897\nheader\n1024\n2.990247\n\n\n36430f041d87935dcb34adde2e7d625d\n.text\n78234112\n6.471421\n\n\nee7e02e8e2958ff79f25c8fd8b7d33e5\n.rdata\n15596032\n6.376243\n\n\n65c59271f5c2bab26a7d0838e9f04bcf\n.data\n262144\n3.484705\n\n\n00406f1d9355757d80cbf48242fdf344\n.pdata\n2768896\n6.805097\n\n\n6a6a225bfe091e65d3f82654179fbc50\n.00cfg\n512\n0.195869\n\n\n786f587a97128c401be15c90fe059b72\n.rodata\n6144\n4.219562\n\n\n9efa43af7b1faae15ffbd428d0485819\n.tls\n512\n0.136464\n\n\n60d3ea61d541c9be2e845d2787fb9574\nCPADinfo\n512\n0.122276\n\n\nbf619eac0cdf3f68d496ea9344137e8b\nprot\n512\n0.000000\n\n\n85237257867935c227d2f2f39316b12a\n.rsrc\n106496\n4.912524\n\n\nfb3216031225fdb1902888e247009d0c\n.reloc\n709120\n5.476445\n\n\n\nPackers/Compilers/Cryptors\n\n\n\nMicrosoft Visual C++ 8.0 (DLL)\n\n\n\nRelationships\n\n\n\n1b60a6d35c...\nContained_Within\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\n\nDescription\nThis file is a 64-bit Windows executable contained within the Windows MSI Installer \"Kupay.msi.\" When executed, \"Kupay.exe\" loads a legitimate looking cryptocurrency wallet application with no signs of malicious activity. This application appears to be a modification of the open source cryptocurrency wallet Copay, which is distributed by Atlanta based company BitPay. According to their website bitpay.com, \u201cBitPay builds powerful, enterprise-grade tools for crypto acceptance and spending.\"\n\n\t\t\tIn addition to application appearance being similar, a DNS request for \"bitpay.com\" is always sent out immediately after a DNS request for \"kupaywallet.com\" and the company listed in the version information for Kupay is Bitpay.\n\n\t\t\tLastly, the GitHub \u201cCommit Hash\u201d listed in the Dorusio application \u201c638b2b1\u201d is to a branch of Copay found at hxxps[:]//github.com/flean/copay-1 (Figure 5).\nScreenshots\n \n\nFigure 3 - Screenshot of the Kupay Wallet application.\n\n \n\nFigure 4 - Screenshot of the Bitpay site displaying the application.\n\n \n\nFigure 5 - Copay GitHub branch matching Dorusio.\n\n\n\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\nTags\ntrojan\nDetails\n\n\n\nName\nKupayUpgrade.exe\n\n\nSize\n115712 bytes\n\n\nType\nPE32+ executable (GUI) x86-64, for MS Windows\n\n\nMD5\n60c2efdafbffc5bd6709c8e461f7b77d\n\n\nSHA1\ndbddccba18422eea5d7bb1bdfe66ceee90446a45\n\n\nSHA256\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n\nSHA512\n5543d4e5872ef5b0f12ba180425d2ab94131c03f4fec7195f3a74d051d5a867ad580ea794a1af6c6bd16e4bc27337cc138fe71aab9600792bfd5da1a1d262162\n\n\nssdeep\n3072:oHAqeXaeHx9pdpqw6IQIsMF6s3yvPxdOBU:kWXaeHxrvB6X9M33\n\n\nEntropy\n6.128091\n\n\n\nAntivirus\n\n\n\nAhnlab\nTrojan/Win64.FakeCoinTrader\n\n\nESET\na variant of Win64/NukeSped.DE trojan\n\n\nK7\nTrojan ( 00569b451 )\n\n\nZillya!\nTrojan.Generic.Win32.1058845\n\n\n\nYARA Rules\nNo matches found.\nssdeep Matches\n\n\n\n94\n572a124f5665be68eaa472590f3ba75bf34b0ea2942b5fcbfd3e74654202dd09\n\n\n\nPE Metadata\n\n\n\nCompile Date\n2020-02-25 03:46:13-05:00\n\n\nImport Hash\n565005404f00b7def4499142ade5e3dd\n\n\n\nPE Sections\n\n\n\nMD5\nName\nRaw Size\nEntropy\n\n\n695567cdbccfbe54b19634abe3bb1e5b\nheader\n1024\n2.723717\n\n\ne35b1061d665602ed7e1c2d9de87f059\n.text\n65536\n6.456115\n\n\n1578510ae509e46d8f3201edb3349d54\n.rdata\n39936\n5.084900\n\n\ndbf3b39f579f6cafbdf3960f0a87f5f9\n.data\n2560\n1.851526\n\n\ncb3735cf6fde4690ee7a6cd2026eb4de\n.pdata\n4096\n4.957030\n\n\n90e2eb1b90616d039eca5e2627ea1134\n.gfids\n512\n1.320519\n\n\n3f1861d2a0b1dc2d1329c9d2b3353924\n.reloc\n2048\n4.762609\n\n\n\nPackers/Compilers/Cryptors\n\n\n\nMicrosoft Visual C++ 8.0 (DLL)\n\n\n\nRelationships\n\n\n\nfc1aafd2ed...\nContained_Within\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\n\nDescription\nThis file is a 64-bit Windows executable contained within the Windows MSI Installer \"Kupay.msi.\" When executed, \"KupayUpgrade.exe\" first installs itself as a service, which will automatically start when any user logs on. The service is installed with a description stating \u201cAutomatic Kupay Upgrade.\"\n\n\t\t\tOn startup, \"KupayUpgrade.exe\" allocates memory in order to later write a file. After allocating the memory and storing the hard-coded string \u201cLatest\u201d in a variable, the program attempts to open a network connection. The connection is named \u201cKupay Wallet 9.0.1 (Check Update Windows)\u201d, likely to avoid suspicion from a user.\n\n\t\t\tSimilarly to previous AppleJeus variants, \"KupayUpgrade.exe \"collects some basic information from the system as well as a timestamp, and places them in hard coded format strings. Specifically, the timestamp is placed into a format string \u201cver=%d&timestamp=%lu\u201d where ver is set as the 90001, possibly referring to the Kupay Wallet version previously mentioned (Figure 7).\n\n\t\t\tThis basic information and hard-coded strings are sent via a POST to the C2 kupaywallet.com/kupay_update.php. If the POST is successful (i.e. returns an HTTP response status code of 200) but fails any of multiple different checks, \"KupayUpgrade.exe\" will sleep for two minutes and then regenerate the timestamp and contact the C2 again.\n\n\t\t\tAfter receiving the payload from the C2, the program writes the payload to memory and executes the payload.\n\n\t\t\tThe payload for the Windows malware could not be downloaded, as the C2 server \"kupaywallet.com/kupay_update.php\" was no longer accessible. In addition, the sample was not identified in open source reporting for this sample.\nScreenshots\n \n\nFigure 6 - Screenshot of Kupay service.\n\n \n\nFigure 7 - Screenshot of the format string.\n\n\n\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\nTags\ndropper\nDetails\n\n\n\nName\nKupay.dmg\n\n\nSize\n132870749 bytes\n\n\nType\nzlib compressed data\n\n\nMD5\n2f6573b3ae4262f04227468aab353387\n\n\nSHA1\ndd9058e3a6c791b18bf561a3177788cf60cd6e91\n\n\nSHA256\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\nSHA512\na26f1e0673563fea0d134f3238fe36b12dcd4567c6ae7e962113e9531e1847e9195b010a2b10ee087382163a973164c795052788ab450785f9c9164a971dfb1d\n\n\nssdeep\n3145728:ttCQsiN4OYPdJvjr78vjHPZBs3CI0s9KVzcGesHiYhR7SsH:ttCQsiNmPjLXqvsgS/AusH\n\n\nEntropy\n7.993885\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nRelationships\n\n\n\n55eacc25e9...\nContains\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n\n55eacc25e9...\nDownloaded_By\nkupaywallet.com\n\n\n55eacc25e9...\nContains\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\n\nDescription\nIn March 2020, a download link for the OSX version of Kupay Wallet was found to be hosted at hxxps[:]//kupaywallet.com/[GUID]. The OSX program from the Kupay Wallet download link is an Apple DMG installer. The [GUID] is a unique file that is crafted for a specific victim and is being withheld to preserve the identity of the intended recipient. The OSX program uses a DMG installer with the file name Kupay[GUID].dmg.\n\n\t\t\tThe OSX program does not have digital signature, and will warn of that before installation. Just as JMTTrader, CelasTradePro, and UnionCrypto, the Kupay installer appears to be legitimate, and installs both \u201cKupay\u201d in the \u201c/Applications/Kupay.app/Contents/MacOS/\u201d folder and a program named kupay_upgrade also in the \u201c/Applications/Kupay.app/Contents/MacOS/\u201d folder. The installer contains a postinstall script (Figure 8).\n\n\t\t\tThe postinstall script is identical in functionality to the postinstall scripts from previous AppleJeus variants, though accomplishes the same functions in a different way than previously done. The postinstall script creates a \u201cKupayDaemon\u201d folder in the OSX \u201c/Library/Application Support\u201d folder, and moves kupay_upgrade to it. The \u201cApplication Support\u201d folder contains both system and third-party support files which are necessary for program operation. Typically, the subfolders have names matching those of the actual applications. At installation, Kupay placed the plist file (com.kupay.pkg.wallet.plist) in \u201c/Library/LaunchDaemons/\u201d.\n\n\t\t\tWhile previous versions of AppleJeus simply moved the plist file to the LaunchDaemons folder and waited for a restart for it to be loaded, the Kupay postinstall runs the command \u201claunchctl load\u201d to load the plist without a restart. The postinstall then launches the kupay_upgrade program in the background.\nScreenshots\n \n\nFigure 8 - Screenshot of the postinstall script.\n\n \n\nFigure 9 - Screenshot of \"com.kupay.pkg.wallet.plist.\"\n\n\n\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\nDetails\n\n\n\nName\nkupay\n\n\nSize\n186044 bytes\n\n\nType\nMach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n\nMD5\n4a43bafb4af0a038a7f430417bcc1b6e\n\n\nSHA1\n438243575764a5e856951126674f72f20b2a0d6f\n\n\nSHA256\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n\nSHA512\n51d37b27f390bc7f124f2cb8efb2b9c940d7a0c21b0912d06634f7f6af46a35e3221d25945bcad4b39748699ba8a33b17c350a480560e5c5cc09dffa84c54df0\n\n\nssdeep\n3072:RiD/8kxClwjnLFycZ+xzknUapR+Nghc1VeY1HhNGKBqzoJGUNKFsJuMuixQdf:RiDUSyQnLFycZ+a8yhUVeY1LngzofKFF\n\n\nEntropy\n6.083001\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nRelationships\n\n\n\na0c461c94b...\nContained_Within\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\n\nDescription\nThis OSX sample was contained within Apple DMG \"Kupay.dmg.\" Kupay is likely a copy of an open source cryptocurrency wallet application. When ran it loads a legitimate looking wallet program, which is fully functional, and is identical to the Windows Kupay.exe program. Although this executable is not inherently malicious, organizations who identify the hash and a \"kupay[GUID].dmg\" present on a system should assume they are compromised if it is present with other files or activity described in this report.\n\n\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\nTags\ntrojan\nDetails\n\n\n\nName\nkupay_upgrade\n\n\nSize\n33248 bytes\n\n\nType\nMach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n\nMD5\nf00bde07d9f8b7af1da425c23cc47e47\n\n\nSHA1\nc0670e18e1e3fbde58a25cbb94ba11558c02e7d3\n\n\nSHA256\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\nSHA512\n266746da74bda3aed3af13d0b51adaee0e2e56d13ff8b1f68e1766b96b12dd2d5dadca143b7f5fc8693bd24aaa008c3a24161e69625c6b053c1d45a1636b91e9\n\n\nssdeep\n192:AShk5sZUIyfKaTuy+YZ+qyepkfLYrs4eL:AShmxfKaTuQr\n\n\nEntropy\n1.652634\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nRelationships\n\n\n\n0bc7517aa2...\nContained_Within\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\n0bc7517aa2...\nConnected_To\nkupaywallet.com\n\n\n0bc7517aa2...\nDownloaded\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n\n\nDescription\nThis OSX sample was contained within Apple DMG \"Kupay.dmg.\" When executed, \"kupay_upgrade\" immediately sleeps for five seconds and then tests to see if the hard-coded value stored in \u201cisReady\u201d is a 0 or a 1. If it is a 0, the program sleeps again, and if it is a 1, the function \u201cCheckUpdate\u201d is called. This function contains most of the logic functionality of the malware. \"CheckUpdate\" sends a POST to the C2 hxxps[:]//kupaywallet.com/kupay_update.php with a connection named \u201cKupay Wallet 9.0.1 (Check Update Osx).\"\n\n\t\t\tJust as the Windows malware, the timestamp is placed into a format string \u201cver=%d&timestamp=%ld\u201d where ver is set as the 90001, possibly referring to the AppleJeus version 4 Kupay Wallet (Figure 11).\n\n\t\t\tIf the C2 server returns a file, it is decoded and written to \u201c/private/tmp/kupay_update\u201d, with permissions by the command chmod 700 (only the user can read, write, and execute). The stage2 (/private/tmp/kupay_update) is then launched, and the malware kupay_upgrade returns to sleeping and checking in with the C2 server.\nScreenshots\n \n\nFigure 10 - Screenshot of the C2 loaded into variable.\n\n \n\nFigure 11 - Screenshot of the format string.\n\n\n\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\nTags\ntrojan\nDetails\n\n\n\nName\nkupayupdate_stage2\n\n\nSize\n40176 bytes\n\n\nType\nMach-O 64-bit x86_64 executable, flags:<NOUNDEFS|DYLDLINK|TWOLEVEL|PIE>\n\n\nMD5\n17ab2927a235a0b98480945285767bcf\n\n\nSHA1\nd4b96e9d966b0f1e9ff1ef61a8d09c9020254652\n\n\nSHA256\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n\nSHA512\n51a5279db7b0074c83aac19f7f426b8a1dadd939e3ee660f71be3e5da110f0af8ae5bb781ad0b57c6ded19ae74aa95dbc2a8887443f63837f616e2fdf6bf5857\n\n\nssdeep\n192:HZpt4Xnd+9EQbpvhyN1pQhO9de0II+pldd6gH1h8h/XbARs8xpDOL3ySoAk8+4uT:5pMUq6DaxaI+rddNH16VXbXDP4\n\n\nEntropy\n3.266343\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nRelationships\n\n\n\n91eaf215be...\nConnected_To\nlevelframeblog.com\n\n\n91eaf215be...\nDownloaded_By\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\n\nDescription\nThis file is the stage 2 payload for the OSX KupayWallet. The stage 2 payload for the OSX KupayWallet was decoded and analyzed, and file properties are related to the decoded file. The stage 2 kupay_update has a variety of functionalities. Most importantly, kupay_update checks in with the C2 levelframeblog.com/felix.php. After connecting to the C2, kupay_update can send or receive a payload, read and write files, execute commands via the terminal, etc.\n\n\t\t\tIf a payload is received or is going to be sent, kupay_update will base64 encode/decode and XOR encode/decode the data before sending or after receiving. The functions which base64 encode and decode are named b64_encode and b64_decode.\n\n\t\t\tThe functions which XOR encodes and decodes is XEncoding, and it uses a 32-byte XOR key which is hardcoded into kupay_update. The key is \u201cwLqfM]%wTx`~tUTbw>R^0x18#yG5R(30x7FC:;\u201d where all values are in ASCII except for 0x18 and 0x7F as those are non-readable characters in ASCII. This key is also used in the DecryptPayload and CryptPayload functions. These two functions implement the XOR encode or decode without calling XEncoding, and also call the b64_decode and b64_encode functions.\n\n\t\t\tKupay_update checks in with the C2 frequently, in order to execute or preform whatever commands and requests the server sends. There are multiple \u201csleep\u201d calls throughout the function to dictate when the contact with the C2 is made.\nScreenshots\n \n\nFigure 12 - Screenshot of the portion of b64_encode.\n\n \n\nFigure 13 - Screenshot of XOR Loop in function XEncoding\n\n\n\nlevelframeblog.com\nTags\ncommand-and-control\nURLs\n\nlevelframeblog.com/felix.php\n\nWhois\nWhois for levelframeblog.com had the following information:\n\t\t\tRegistrar: NAMECHEAP INC\n\t\t\tCreated: 2019-11-14\n\t\t\tExpires: 2020-11-14\nRelationships\n\n\n\nlevelframeblog.com\nConnected_From\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n\n\nDescription\nThis domain is the C2 for 2nd stage malware. The domain is registered with NameCheap at the IP address 23.152.0.101 with ASN 8100.\n\nRelationship Summary\n\n\n\n\n6b945159b4...\nContains\n1b60a6d35c872102f535ae6a3d7669fb7d55c43dc7e73354423fdcca01a955d6\n\n\n6b945159b4...\nContains\nfc1aafd2ed190fa523e60c3d22b6f7ca049d97fc41c9a2fe987576d6b5e81d6d\n\n\n6b945159b4...\nDownloaded_By\nkupaywallet.com\n\n\nkupaywallet.com\nDownloaded\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\nkupaywallet.com\nDownloaded\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\nkupaywallet.com\nConnected_From\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\n1b60a6d35c...\nContained_Within\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\nfc1aafd2ed...\nContained_Within\n6b945159b4c816ec5e212ba125eb01938234205d8d3e57fca46de7c064c628f8\n\n\n55eacc25e9...\nContains\na0c461c94ba9f1573c7253666d218b3343d24bfa5d8ef270ee9bc74b7856e492\n\n\n55eacc25e9...\nDownloaded_By\nkupaywallet.com\n\n\n55eacc25e9...\nContains\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\na0c461c94b...\nContained_Within\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\n0bc7517aa2...\nContained_Within\n55eacc25e9eaba5d3f04b6cbcac2e16879b83d967596d645e5ec4b8f42656ef9\n\n\n0bc7517aa2...\nConnected_To\nkupaywallet.com\n\n\n0bc7517aa2...\nDownloaded\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n\n91eaf215be...\nConnected_To\nlevelframeblog.com\n\n\n91eaf215be...\nDownloaded_By\n0bc7517aa2f0c1820ced399bfd66b993f10ad77e8d72727b0f3dc1ca35cad7ba\n\n\nlevelframeblog.com\nConnected_From\n91eaf215be336eae983d069de16630cc3580e222c427f785e0da312d0692d0fd\n\n\n\n\nRecommendations\n\nCISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems. Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.\n\nMaintain up-to-date antivirus signatures and engines.\nKeep operating system patches up-to-date.\nDisable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.\nRestrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators group unless required.\nEnforce a strong password policy and implement regular password changes.\nExercise caution when opening e-mail attachments even if the attachment is expected and the sender appears to be known.\nEnable a personal firewall on agency workstations, configured to deny unsolicited connection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for and remove suspicious e-mail attachments; ensure the scanned attachment is its \"true file type\" (i.e., the extension matches the file header).\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external drives, CDs, etc.).\nScan all software downloaded from the Internet prior to executing.\nMaintain situational awareness of the latest threats and implement appropriate Access Control Lists (ACLs).\n\nAdditional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Special Publication 800-83, \"Guide to Malware Incident Prevention & Handling for Desktops and Laptops\".\n\nContact Information\n\n\n1-888-282-0870\nCISA Central\u00a0(UNCLASS)\nCISA SIPR (SIPRNET)\nCISA IC (JWICS)\n\nCISA continuously strives to improve its products and services. You can help by answering a very short series of questions about this product at the following URL: https://us-cert.cisa.gov/forms/feedback/\n\nDocument FAQ\n\nWhat is a MIFR? A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner. In most instances this report will provide initial indicators for computer and network defense. To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.\nWhat is a MAR? A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manual reverse engineering. To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.\nCan I edit this document? This document is not to be edited in any way by recipients. All comments or questions related to this document should be directed to the CISA at 1-888-282-0870 or CISA Central.\nCan I submit malware to CISA? Malware samples can be submitted via three methods:\n\nWeb: https://malware.us-cert.gov\nE-Mail: submit@malware.us-cert.gov\nFTP: ftp.malware.us-cert.gov (anonymous)\n\nCISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams. Reporting forms can be found on CISA's homepage at www.cisa.gov.\n\n\n\n\n\n\n\n\nRevisions\n\nFebruary 17, 2021: Initial Version|April 15, 2021: AppleJeus: Kupay Wallet, clarified that a malware sample contained within Apple DMG \"Kupay.dmg\" is not inherently malicious and provided guidance on what organizations should look for to determine compromise\n",
  "cves": [
    "CVE-2022-42475",
    "CVE-2022-47966"
  ],
  "techniques": [],
  "advisory": "ar21-048d",
  "title": "MAR-10322463-4.v1 - AppleJeus: Kupay Wallet | CISA",
  "source": "analysis-reports",
  "id": "6f232a90be6dfaa73f329b8fab85552efc8bc050bce1ea63ffce68875f0b30e4"
}