{
  "markdown": "\n\nSummary\n\nUpdated July 19, 2021: The U.S. Government attributes this activity to malicious cyber actors affiliated with the People's Republic\u00a0of China (PRC) Ministry of State Security (MSS). Additional information may be found in a statement from the White House. For more information on Chinese malicious cyber activity, refer to us-cert.cisa.gov/China.\nNote: This Alert was updated April 13, 2021, to provide further guidance.\u00a0\nCybersecurity and Infrastructure Security Agency (CISA) partners have observed active exploitation of vulnerabilities in Microsoft Exchange Server products. Successful exploitation of these vulnerabilities allows an unauthenticated attacker to execute arbitrary code on vulnerable Exchange Servers, enabling the attacker to gain persistent system access, as well as access to files and mailboxes on the server and to credentials stored on that system. Successful exploitation may additionally enable the attacker to compromise trust and identity in a vulnerable network. Microsoft released out-of-band patches to address vulnerabilities in Microsoft Exchange Server. The vulnerabilities impact on-premises Microsoft Exchange Servers and are not known to impact Exchange Online or Microsoft 365 (formerly O365) cloud email services.\nThis Alert includes both tactics, techniques and procedures (TTPs) and the indicators of compromise (IOCs) associated with this malicious activity. To secure against this threat, CISA recommends organizations examine their systems for the TTPs and use the IOCs to detect any malicious activity. If an organization discovers exploitation activity, they should assume network identity compromise and follow incident response procedures. If an organization finds no activity, they should apply available patches immediately and implement the mitigations in this Alert.\nClick here for IOCs in STIX format.\n\nTechnical Details\n\n(Updated April 14, 2021): Microsoft's April 2021 Security Update newly discloses and mitigates significant vulnerabilities affecting on-premises Exchange Server 2013, 2016, and 2019.\nMicrosoft has released out-of-band security updates to address four vulnerabilities in Exchange Server:\n\nCVE-2021-26855 allows an unauthenticated attacker to send arbitrary HTTP requests and authenticate as the Exchange Server. The vulnerability exploits the Exchange Control Panel (ECP) via a Server-Side Request Forgery (SSRF). This would also allow the attacker to gain access to mailboxes and read sensitive information.\nCVE-2021-26857, CVE-2021-26858, and CVE-2021-27065 allow for remote code execution. \u00a0\n\n\nCVE-2021-26858 and CVE-2021-27065 are similar post-authentication arbitrary write file vulnerabilities in Exchange. An attacker, authenticated either by using CVE-2021-26855 or via stolen admin credentials, could write a file to any path on the server.\n\n\nCVE-2021-26857 is an insecure deserialization vulnerability in the Unified Messaging service. An attacker, authenticated either by using CVE-2021-26855 or via stolen admin credentials, could execute arbitrary code as SYSTEM on the Exchange Server.\n\n\n\n\nTo locate a possible compromise of these CVEs, CISA encourages organizations\u00a0read the Microsoft Advisory.\n\n\nIt is possible for an attacker, once authenticated to the Exchange server, to gain access to the Active Directory environment and download the Active Directory Database.\n(Updated March 12, 2021): Microsoft Security Intelligence has released a tweet on DearCry ransomware being used to exploit compromised on-premises Exchange Servers. Ransomware infections can have negative consequences to an affected organization, including:\n\ntemporary or permanent loss of sensitive or proprietary information,\ndisruption to regular operations,\nfinancial losses incurred to restore systems and files, and\npotential harm to an organization\u2019s reputation.\n\n(Updated April 12, 2021): CISA recommends organizations review Malware Analysis Report (MAR) MAR-10330097-1.v1 \u2013 DearCry Ransomware for detailed analysis, along with TTPs and IOCs.\n(Updated March 12, 2021): CISA encourages organizations to review CISA\u2019s Ransomware web page for guidance and resources. Victims of ransomware should report it immediately to CISA at www.us-cert.gov/report, a local FBI Field Office, or Secret Service Field Office.\nTactics, Techniques and Procedures\n(Updated March 10, 2021): Microsoft has released a script that scans Exchange log files for IOCs. CISA strongly encourages organizations to run the Test-ProxyLogon.ps1 script\u2014as soon as possible\u2014to help determine whether their systems are compromised.\n(Updated March 16, 2021): Note: Microsoft has released the Exchange On-premises Mitigation Tool (EOMT.ps1) that can automate portions of both the detection and patching process. Microsoft stated the following along with the release: \"[the tool is intended] to help customers who do not have dedicated security or IT teams to apply these security updates. We have tested this tool across Exchange Server 2013, 2016, and 2019 deployments. This new tool is designed as an interim mitigation for customers who are unfamiliar with the patch/update process or who have not yet applied the on-premises Exchange security update.\u201d Review the EOMT.ps1 blog post for directions on using the tool.\n(Updated March 10, 2021): CISA recommends investigating for signs of a compromise from at least January 1, 2021\u00a0through present.\n(Updated April 12, 2021): CISA has identified 10\u00a0webshells associated with this activity. This is not an all-inclusive list of webshells that are being leveraged by actors. CISA recommends organizations review the following MARs\u00a0for detailed analysis of the 10\u00a0webshells, along with TTPs and IOCs. These MARs include\u00a0CISA-developed YARA rules to help network defenders detect associated malware.\n\nAR21-072A: MAR-10328877.r1.v1: China Chopper Webshell\nAR21-072B: MAR-10328923.r1.v1: China Chopper Webshell\nAR21-072C: MAR-10329107.r1.v1: China Chopper Webshell\nAR21-072D: MAR-10329297.r1.v1: China Chopper Webshell\nAR21-072E: MAR-10329298.r1.v1: China Chopper Webshell\nAR21-072F: MAR-10329301.r1.v1: China Chopper Webshell\nAR21-072G: MAR-10329494.r1.v1: China Chopper Webshell\nAR21-084A: MAR-10329496-1.v1: China Chopper Webshell\nAR21-084B: MAR-10329499-1.v1: China Chopper Webshell \nAR21-102A: MAR-10331466-1.v1: China Chopper Webshell\n\n(Updated March 13, 2021): A webshell is a script that can be uploaded to a compromised Microsoft Exchange Server to enable remote administration of the machine. Webshells are utilized for the following purposes:\n\nTo harvest and exfiltrate sensitive data and credentials;\nTo upload additional malware for the potential of creating, for example, a watering hole for infection and scanning of further victims;\nTo use as a relay point to issue commands to hosts inside the network without direct internet access;\nTo use as command-and-control infrastructure, potentially in the form of a bot in a botnet or in support of compromises to additional external networks. This could occur if the adversary intends to maintain long-term persistence.\n\n(Updated March 13, 2021): For more information, see TA15-314A Compromised Web Servers and Web Shells - Threat Awareness and Guidance.\nThe majority of the TTPs in this section are sourced from a blog post from Volexity, a third-party cybersecurity firm. Note: the United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.\nVolexity has observed the following files as targets of HTTP POST requests:\n\n/owa/auth/Current/themes/resources/logon.css\n/owa/auth/Current/themes/resources/owafont_ja.css\n/owa/auth/Current/themes/resources/lgnbotl.gif\n/owa/auth/Current/themes/resources/owafont_ko.css\n/owa/auth/Current/themes/resources/SegoeUI-SemiBold.eot\n/owa/auth/Current/themes/resources/SegoeUI-SemiLight.ttf\n/owa/auth/Current/themes/resources/lgnbotl.gif\n\nAdministrators should search the ECP server logs for the following string (or something similar):\nS:CMD=Set-OabVirtualDirectory.ExternalUrl='\nThe logs can be found at <exchange install path>\\Logging\\ECP\\Server\\.\nTo determine possible webshell activity, administrators should search for aspx files in the following paths:\n\n\\inetpub\\wwwroot\\aspnet_client\\ (any .aspx file under this folder or sub folders)\n\\<exchange install path>\\FrontEnd\\HttpProxy\\ecp\\auth\\ (any file besides TimeoutLogoff.aspx)\n\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\ (any file or modified file that is not part of a standard install)\n\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\ (any aspx file in this folder or subfolders)\n\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\<folder with version number>\\ (any aspx file in this folder or subfolders)\n\nAdministrators should search in the /owa/auth/Current directory for the following non-standard web log user-agents. These agents may be useful for incident responders to look at to determine if further investigation is necessary.\nThese should not be taken as definitive IOCs:\n\nDuckDuckBot/1.0;+(+http://duckduckgo.com/duckduckbot.html)\nfacebookexternalhit/1.1+(+http://www.facebook.com/externalhit_uatext.php)\nMozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)\nMozilla/5.0+(compatible;+Bingbot/2.0;++http://www.bing.com/bingbot.htm)\nMozilla/5.0+(compatible;+Googlebot/2.1;++http://www.google.com/bot.html\nMozilla/5.0+(compatible;+Konqueror/3.5;+Linux)+KHTML/3.5.5+(like+Gecko)+(Exabot-Thumbnails)\nMozilla/5.0+(compatible;+Yahoo!+Slurp;+http://help.yahoo.com/help/us/ysearch/slurp)\nMozilla/5.0+(compatible;+YandexBot/3.0;++http://yandex.com/bots)\nMozilla/5.0+(X11;+Linux+x86_64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36\n\nVolexity observed these user-agents in conjunction with exploitation to /ecp/ URLs:\n\nExchangeServicesClient/0.0.0.0\npython-requests/2.19.1\npython-requests/2.25.1\n\nThese user-agents were also observed having connections to post-exploitation web-shell access:\n\nantSword/v2.1\nGooglebot/2.1+(+http://www.googlebot.com/bot.html)\nMozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)\n\nAs with the non-standard user-agents, responders can examine internet information services (IIS) logs from Exchange Servers to identify possible historical activity. Also, as with the non-standard user agents, these should not be taken as definitive IOCs:\n\nPOST /owa/auth/Current/\nPOST /ecp/default.flt\nPOST /ecp/main.css\nPOST /ecp/<single char>.js\n\nVolexity has seen attackers leverage the following IP addresses. Although these are tied to virtual private servers (VPSs) servers and virtual private networks (VPNs), responders should investigate these IP addresses on their networks and act accordingly:\n\n103.77.192[.]219\n104.140.114[.]110\n104.250.191[.]110\n108.61.246[.]56\n149.28.14[.]163\n157.230.221[.]198\n167.99.168[.]251\n185.250.151[.]72\n192.81.208[.]169\n203.160.69[.]66\n211.56.98[.]146\n5.254.43[.]18\n5.2.69[.]14\n80.92.205[.]81\n91.192.103[.]43\n\nVolexity has also provided the following YARA signatures that can be run within your network to assist in finding signs of a compromise.\n\nrule webshell_aspx_simpleseesharp : Webshell Unclassified\n{\n\u00a0\u00a0\u00a0 meta:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 author = \"threatintel@volexity.com\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 date = \"2021-03-01\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 description = \"A simple ASPX Webshell that allows an attacker to write further files to disk.\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hash = \"893cd3583b49cb706b3e55ecb2ed0757b977a21f5c72e041392d1256f31166e2\"\n\u00a0\n\u00a0\u00a0\u00a0 strings:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $header = \"<%@ Page Language=\\\"C#\\\" %>\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $body = \"<% HttpPostedFile thisFile = Request.Files[0];thisFile.SaveAs(Path.Combine\"\n\u00a0\n\u00a0\u00a0\u00a0 condition:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $header at 0 and\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $body and\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 filesize < 1KB\n}\n\u00a0\nrule webshell_aspx_reGeorgTunnel : Webshell Commodity\n{\n\u00a0\u00a0\u00a0 meta:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 author = \"threatintel@volexity.com\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 date = \"2021-03-01\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 description = \"A variation on the reGeorg tunnel webshell\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hash = \"406b680edc9a1bb0e2c7c451c56904857848b5f15570401450b73b232ff38928\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 reference = \"https://github.com/sensepost/reGeorg/blob/master/tunnel.aspx\"\n\u00a0\n\u00a0\u00a0\u00a0 strings:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $s1 = \"System.Net.Sockets\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $s2 = \"System.Text.Encoding.Default.GetString(Convert.FromBase64String(StrTr(Request.Headers.Get\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 // a bit more experimental\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $t1 = \".Split(\u2018|\u2019)\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $t2 = \"Request.Headers.Get\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $t3 = \".Substring(\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $t4 = \"new Socket(\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $t5 = \"IPAddress ip;\"\n\u00a0\n\u00a0\u00a0\u00a0 condition:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 all of ($s*) or\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 all of ($t*)\n}\n\u00a0\nrule webshell_aspx_sportsball : Webshell Unclassified\n{\n\u00a0\u00a0\u00a0 meta:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 author = \"threatintel@volexity.com\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 date = \"2021-03-01\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 description = \"The SPORTSBALL webshell allows attackers to upload files or execute commands on the system.\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hash = \"2fa06333188795110bba14a482020699a96f76fb1ceb80cbfa2df9d3008b5b0a\"\n\u00a0\n\u00a0\u00a0\u00a0 strings:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $uniq1 = \"HttpCookie newcook = new HttpCookie(\\\"fqrspt\\\", HttpContext.Current.Request.Form\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $uniq2 = \"ZN2aDAB4rXsszEvCLrzgcvQ4oi5J1TuiRULlQbYwldE=\"\n\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var1 = \"Result.InnerText = string.Empty;\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var2 = \"newcook.Expires = DateTime.Now.AddDays(\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var3 = \"System.Diagnostics.Process process = new System.Diagnostics.Process();\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var4 = \"process.StandardInput.WriteLine(HttpContext.Current.Request.Form[\\\"\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var5 = \"else if (!string.IsNullOrEmpty(HttpContext.Current.Request.Form[\\\"\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 $var6 = \"<input type=\\\"submit\\\" value=\\\"Upload\\\" />\"\n\u00a0\n\u00a0\u00a0\u00a0 condition:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 any of ($uniq*) or\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 all of ($var*)\n}\n\nA list of webshell hashes have also been provided by Microsoft:\n\nb75f163ca9b9240bf4b37ad92bc7556b40a17e27c2b8ed5c8991385fe07d17d0\n097549cf7d0f76f0d99edf8b2d91c60977fd6a96e4b8c3c94b0b1733dc026d3e\n2b6f1ebb2208e93ade4a6424555d6a8341fd6d9f60c25e44afe11008f5c1aad1\n65149e036fff06026d80ac9ad4d156332822dc93142cf1a122b1841ec8de34b5\n511df0e2df9bfa5521b588cc4bb5f8c5a321801b803394ebc493db1ef3c78fa1\n4edc7770464a14f54d17f36dc9d0fe854f68b346b27b35a6f5839adf1f13f8ea\n811157f9c7003ba8d17b45eb3cf09bef2cecd2701cedb675274949296a6a183d\n1631a90eb5395c4e19c7dbcbf611bbe6444ff312eb7937e286e4637cb9e72944\n\nNote: this is not an all-inclusive list of indicators of compromise and threat actors have been known to use short-term leased IP addresses that change very frequently. Organizations that do not locate any of the IOCs in this Alert within your network traffic, may nevertheless have been compromised. CISA recommends following the guidance located in the Microsoft Advisory to check your servers for any signs of a compromise. \u00a0\nConduct Forensic Analysis\nShould your organization see evidence of compromise, your incident response should begin with conducting forensic analysis to collect artifacts and perform triage. Please see the following list of recommendations on how to conduct forensic analysis using various tools.\nAlthough the following free tools are not endorsed by the Federal Government, incident responders commonly use them to perform forensics.\nWhile collecting artifacts to perform triage, use processes and tools that minimize the alteration of the data being collected and that minimize impact to the operating system itself.\nIdeally, during data collection, store the data on removable/external media and, when possible, run the artifact collection tools from the same media.\nKey artifacts for triage that should be collected:\n\nMemory\nAll registry hives\nAll windows event logs\nAll web logs\n\nMemory can be collected with a variety of open source tools (e.g., FTK Imager by AccessData, Ram Capture by Belkasoft).\nRegistry and Windows Event logs can be collected with a variety of open source tools as well (e.g., FTK_Imager, Kroll Artifact Parser And Extractor [KAPE]).\nWeb logs can also be collected with a variety of open source tools (e.g., FTK Imager).\nWindows Artifact Collection Guide\nExecute the following steps in order.\n1) Download the latest FTK Imager from\u00a0https://accessdata.com/product-download/.\n\nNote: Ensure your review of and compliance with the applicable license associated with the product referenced, which can be found in the product\u2019s User Guide. The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.\n\n2) Collect memory from live system using FTK Imager. See Memory Capture with FTK Imager.pdf for instructions. Note: Download and copy \u201cFTK Imager\u201d folder to an external drive. Run FTK Imager.exe from the FTK Imager folder from external drive. Wait until memory collect is complete before proceeding to step 2.\n3) Collect important system artifacts using KAPE. See KAPE Collection Procedure. Note: Download KAPE from a separate system; do not download KAPE to the target system. Run KAPE from external drive.\n4) Collect disk image using FTK Imager. See Live Image with FTK Imager.pdf for instructions. Note: Run FTK Imager.exe from the \u201cFTK Imager\u201d folder from external drive.\nMemory Capture with FTK Imager\n1) Open FTK Imager. Log into the system with Administrator privileges and launch \u201cFTK Imager.\u201d\n\nNote: Ensure your review of and compliance with the applicable license associated with the product referenced. The United States Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the United States Government.\n\n2) Open \u201cCapture Memory.\" Select \u201cCapture Memory\u2026\u201d from the File menu.\n\nFigure 1: FTK Imager \u2013 Capture Memory Command\n3) Select Path and Filenames. On the window that appears, use the \u201cBrowse\u201d button to identify the destination of the memory capture. Save the memory capture to an external device and not the main hard drive of the system. Doing so will prevent the saved file from overwriting any dataspace on the system.\n\nName the destination file with a descriptive name (i.e., hostname of the system).\nSelect the box \u201cInclude pagefile\u201d and provide a name of the pagefile that is descriptive of the system.\nDo not select \u201cCreate AD1 file.\u201d\n\n\nFigure 2: FTK Imager \u2013 Memory Capture \n4) Capture Memory. Click on \u201cCapture Memory\u201d to begin the capture process. The process will take several minutes depending on the size of the pagefile and the amount of memory on the system.\n\nFigure 3: FTK Imager \u2013 Capture Process\nKAPE Collection Procedure [1]\n1) Download KAPE from https://www.kroll.com/en/services/cyber-risk/investigate-and-respond/kroll-artifact-parser-extractor-kape.\n2) Disable any antivirus or host protection mechanisms that prevent execution from removable media, or data loss prevention (DLP) mechanisms that restrict utilization of removable media.\n\nEnable antivirus and host protection once this process is completed.\n\n3) Unzip Kape.zip and run gkape.exe as admin from your removable media\n4) Target source should be the drive on which the OS resides, typically C:.\n5) Target destination should be an external drive folder, not the same drive as the Target source. If available, use an external hard drive or flash drive.\n\nA KAPE execution with these parameters will typically produce output artifacts with a total size of 1-25 GB.\nIf you are going to be running KAPE on different machines and want to save to the same drive, ensure the Target destination folder is unique for each execution of KAPE.\n\n6) Uncheck Flush checkbox (it is checked natively).\n7) Check Add %d and Add %m checkboxes.\n8) Select ALL checkboxes to ensure KAPE will target all available data that it is capable of targeting. This takes some time; use the down arrow and space bar to move through the list quickly.\n9) Check Process VSCs checkbox.\n10) Select Zip radio button and add Base name TargetOutput.\n11) Ensure Deduplicate checkbox is checked (it is checked natively).\n\nAt the bottom you should now see a large Current command line, similar to:\n\n.\\kape.exe --tsource C: --tdest E:\\%d%m --tflush --target !BasicCollection,!SANS_Triage,Avast,AviraAVLogs,Bitdefender,ComboFix,ESET,FSecure,HitmanPro,Malwarebytes, McAfee,McAfee_ePO,RogueKiller,SentinelOne,Sophos,SUPERAntiSpyware,Symantec_AV_Logs,TrendMicro,VIPRE, Webroot,WindowsDefender,Ammyy,AsperaConnect,BoxDrive,CiscoJabber,CloudStorage,ConfluenceLogs,Discord, Dropbox, Exchange,ExchangeClientAccess,ExchangeTransport,FileZilla,GoogleDrive,iTunesBackup,JavaWebCache,Kaseya,LogMeIn,Notepad++, OneDrive,OutlookPSTOST,ScreenConnect,Skype,TeamViewerLogs,TeraCopy,VNCLogs, Chrome,ChromeExtensions,Edge,Firefox,InternetExplorer,WebBrowsers,ApacheAccessLog,IISLogFiles,ManageEngineLogs, MSSQLErrorLog,NGINXLogs,PowerShellConsole,KapeTriage,MiniTimelineCollection,RemoteAdmin, VirtualDisks, Gigatribe,TorrentClients,Torrents,$Boot,$J,$LogFile,$MFT,$SDS,$T,Amcache,ApplicationEvents,BCD,CombinedLogs, EncapsulationLogging,EventLogs,EventLogs-RDP,EventTraceLogs, EvidenceOfExecution,FileSystem,GroupPolicy,LinuxOnWindowsProfileFiles,LnkFilesAndJumpLists,LogFiles,MemoryFiles, MOF,OfficeAutosave,OfficeDocumentCache,Prefetch,RDPCache,RDPLogs,RecentFileCache,Recycle, RecycleBin, RecycleBinContent,RecycleBinMetadata,RegistryHives,RegistryHivesSystem,RegistryHivesUser,ScheduledTasks,SDB, SignatureCatalog,SRUM,StartupInfo,Syscache,ThumbCache,USBDevicesLogs,WBEM,WER,WindowsFirewall,\u00a0 WindowsIndexSearch,WindowsNotifcationsDB,WindowsTimeline,XPRestorePoints --vss --zip TargetOutput \u2013gui\n\nIn the bottom right corner hit the Execute! Button.\nScreenshot below shows gkape.exe during execution, you will also see a command window execute. Note: KAPE usually takes less than 20 minutes to complete on a workstation; if it is taking significantly longer there may be an issue.\n\n\nFigure 4: gkape.exe screenshot\n\nMitigations\n\nCISA strongly recommends organizations read Microsoft\u2019s advisory and security blog post for more information on how to look for this malicious activity and to apply critical patches as soon as possible.\n(Updated March 4, 2021): CISA is aware of threat actors using open source tools to search for vulnerable Microsoft Exchange Servers. This particular type of attack is scriptable, allowing attackers to easily exploit vulnerabilities through automated mechanisms. CISA advises all entities to patch as soon as possible to avoid being compromised. \u00a0\n(Updated March 4, 2021): From Microsoft's patch release, the security updates are available for the following operating systems:\n\nExchange Server 2010 (update requires SP 3 or any SP 3 RU \u2013 this is a Defense in Depth update)\nExchange Server 2013 (update requires CU 23)\nExchange Server 2016 (update requires CU 19 or CU 18)\nExchange Server 2019 (update requires CU 8 or CU 7)\n\n(Updated March 4, 2021): If you are running an older CU then what the patch will accept, you must upgrade to at least the required CU as stated above then apply the patch.\u00a0\n(Updated March 4, 2021): All patches must be applied using administrator privileges.\n\u00a0\n(Updated March 5, 2021): If patching is not an immediate option, CISA strongly recommends following alternative mitigations found in Microsoft\u2019s blog on Exchange Server Vulnerabilities Mitigations. However, these options should only be used as a temporary solution, not a replacement for patching. Additionally, there are other mitigation options available. CISA recommends limiting or blocking external access to internet-facing Exchange Servers via the following:\n\nRestrict untrusted connections to port 443, or set up a VPN to separate the Exchange Server from external access; note that this will not prevent an adversary from exploiting the vulnerability if the attacker is already in your network.\nBlock external access to on-premises Exchange:\n\nRestrict external access to OWA URL: /owa/.\u00a0\n\nRestrict external access to Exchange Admin Center (EAC) aka Exchange Control Panel (ECP) URL:\u00a0/ecp/.\n\n\n\n\n(Updated March 4, 2021): Disconnect vulnerable Exchange servers from the internet until a patch can be applied.\n\n\nCISA would like to thank Microsoft and Volexity for their contributions to this Alert.\nResources\n\n(Updated April 14, 2021) Microsoft's April 2021 Security Update that mitigates significant vulnerabilities affecting on-premises Exchange Server 2013, 2016, and 2019.\n(Updated March 12, 2021) Check my OWA tool for checking if a system has been affected. Disclaimer: this tool does not check against an exhaustive list of compromised domains. It is meant for informational purposes only. The United States Government does not provide any warranties of any kind regarding this information and cannot assure its accuracy or completeness; therefore, entities should not rely solely on this information to justify foregoing CISA\u2019s recommendations for action described on this webpage.\nMicrosoft Advisory: https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/\nMicrosoft Security Blog - Hafnium targeting Exchange Servers: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/\nVolexity Blog: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/\nMicrosoft\u2019s blog on Exchange Server Vulnerabilities Mitigations: https://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/\n\n\nReferences\n\nEric Zimmerman: KAPE Documentation\nEmergency Directive 21-02: Mitigate Microsoft Exchange On-Premises Product Vulnerabilities\nSupplemental Direction V1 to Emergency Directive 21-02: Mitigate Microsoft Exchange On-Premises Product Vulnerabilities \nSupplemental Direction V2 to Emergency Directive 21-02: Mitigate Microsoft Exchange On-Premises Product Vulnerabilities\n\nRevisions\n\nMarch 3, 2021: Initial Version|March 4, 2020: Updated Mitigations and Technical Details sections|March 5, 2021: Updated Mitigations Guidance from Microsoft|March 10, 2021: Updated TTP Section|March 12, 2021: Updated Resources Section|March 12, 2021: Added information on DearCry Ransomware |March 13, 2021: Added seven China Chopper Webshell MARs|March 14, 2021: Updated information on DearCry Ransomware|March 16, 2021: Added information on EOMT tool|March 25, 2021: Added two China Chopper Webshell MARs|March 25, 2021: Updated MARs to include YARA Rules|March 31, 2021: Added links to ED 21-02 and ED 21-02 Supplemental Direction|April 12, 2021: Added one China Chopper Webshell MAR and one DearCry Ransomware MAR|April 13, 2021: Added links to Microsoft's April 2021 Security Update  and ED 21-02 Supplemental Direction V2|April 14, 2021: Added Exchange Server 2013 to list of on-premises Exchange Servers affected by the vulnerabilities dislcosed on April 13, 2021. |July 19, 2021: Added attribution note\n",
  "cves": [
    "CVE-2021-26858",
    "CVE-2021-27065",
    "CVE-2021-26857",
    "CVE-2021-26855"
  ],
  "techniques": [],
  "advisory": "aa21-062a",
  "title": "Mitigate Microsoft Exchange Server Vulnerabilities | CISA",
  "source": "cybersecurity-advisories",
  "id": "dd09c953ce1f146b0e50dced75a38c93ef0bf948d2d2068243f019ff10abe308"
}