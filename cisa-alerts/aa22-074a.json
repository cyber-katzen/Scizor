{
  "markdown": "\n\nSummary\n\nMultifactor Authentication (MFA): A Cybersecurity Essential\u2022 MFA is one of the most important cybersecurity practices to reduce the risk of intrusions\u2014according to industry research, users who enable MFA are up to 99 percent less likely to have an account compromised.\u2022 Every organization should enforce MFA for all employees and customers, and every user should sign up for MFA when available.\u2022 Organizations that implement MFA should review default configurations and modify as necessary, to reduce the likelihood that a sophisticated adversary can circumvent this control.\nThe Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) to warn organizations that Russian state-sponsored cyber actors have gained network access through exploitation of default MFA protocols and a known vulnerability. As early as May 2021, Russian state-sponsored cyber actors took advantage of a misconfigured account set to default MFA protocols at a non-governmental organization (NGO), allowing them to enroll a new device for MFA and access the victim network. The actors then exploited a critical Windows Print Spooler vulnerability, \u201cPrintNightmare\u201d (CVE-2021-34527) to run arbitrary code with system privileges.\u00a0Russian state-sponsored cyber actors successfully exploited the vulnerability while targeting an NGO using Cisco\u2019s Duo MFA, enabling access to cloud and email accounts for document exfiltration.\nThis advisory provides observed tactics, techniques, and procedures, indicators of compromise (IOCs), and recommendations to protect against Russian state-sponsored malicious cyber activity. FBI and CISA urge all organizations to apply the recommendations in the Mitigations section of this advisory, including the following:\n\nEnforce MFA and review configuration policies to protect against \u201cfail open\u201d and re-enrollment scenarios.\nEnsure inactive accounts are disabled uniformly across the Active Directory and MFA systems.\u00a0\nPatch all systems. Prioritize patching for known exploited vulnerabilities.\n\nFor more general information on Russian state-sponsored malicious cyber activity, see CISA's Russia Cyber Threat Overview and Advisories webpage. For more information on the threat of Russian state-sponsored malicious cyber actors to U.S. critical infrastructure as well as additional mitigation recommendations, see joint CSA Understanding and Mitigating Russian State-Sponsored Cyber Threats to U.S. Critical Infrastructure and CISA's Shields Up Technical Guidance webpage.\nClick here for a PDF version of this report.\nFor a downloadable copy of IOCs, see AA22-074A.stix.\n\u00a0\n\nTechnical Details\n\nThreat Actor Activity\nNote: This advisory uses the MITRE ATT&CK\u00ae for Enterprise framework, version 10. See Appendix A for a table of the threat actors\u2019 activity mapped to MITRE ATT&CK tactics and techniques.\nAs early as May 2021, the FBI observed Russian state-sponsored cyber actors gain access to an NGO, exploit a flaw in default MFA protocols, and move laterally to the NGO\u2019s cloud environment.\nRussian state-sponsored cyber actors gained initial access [TA0001] to the victim organization via compromised credentials [T1078] and enrolling a new device in the organization\u2019s Duo MFA. The actors gained the credentials [TA0006] via brute-force password guessing attack [T1110.001], allowing them access to a victim account with a simple, predictable password. The victim account had been un-enrolled from Duo due to a long period of inactivity but was not disabled in the Active Directory. As Duo\u2019s default configuration settings allow for the re-enrollment of a new device for dormant accounts, the actors were able to enroll a new device for this account, complete the authentication requirements, and obtain access to the victim network. \u00a0\nUsing the compromised account, Russian state-sponsored cyber actors performed privilege escalation [TA0004] via exploitation of the \u201cPrintNightmare\u201d vulnerability (CVE-2021-34527) [T1068] to obtain administrator privileges. The actors also modified a domain controller file, c:\\windows\\system32\\drivers\\etc\\hosts, redirecting Duo MFA calls to localhost instead of the Duo server [T1556]. This change prevented the MFA service from contacting its server to validate MFA login\u2014this effectively disabled MFA for active domain accounts because the default policy of Duo for Windows is to \u201cFail open\u201d if the MFA server is unreachable. Note: \u201cfail open\u201d can happen to any MFA implementation and is not exclusive to Duo.\nAfter effectively disabling MFA, Russian state-sponsored cyber actors were able to successfully authenticate to the victim\u2019s virtual private network (VPN) as non-administrator users and make Remote Desktop Protocol (RDP) connections to Windows domain controllers [T1133]. The actors ran commands to obtain credentials for additional domain accounts; then using the method described in the previous paragraph, changed the MFA configuration file and bypassed MFA for these newly compromised accounts. The actors leveraged mostly internal Windows utilities already present within the victim network to perform this activity. \u00a0\nUsing these compromised accounts without MFA enforced, Russian state-sponsored cyber actors were able to move laterally [TA0008] to the victim\u2019s cloud storage and email accounts and access desired content.\u00a0\nIndicators of Compromise\nRussian state-sponsored cyber actors executed the following processes:\n\nping.exe - A core Windows Operating System process used to perform the Transmission Control Protocol (TCP)/IP Ping command; used to test network connectivity to a remote host [T1018] and is frequently used by actors for network discovery [TA0007].\nregedit.exe - A standard Windows executable file that opens the built-in registry editor [T1112].\nrar.exe - A data compression, encryption, and archiving tool [T1560.001]. Malicious cyber actors have traditionally sought to compromise MFA security protocols as doing so would provide access to accounts or information of interest.\u00a0\nntdsutil.exe - A command-line tool that provides management facilities for Active Directory Domain Services. It is possible this tool was used to enumerate Active Directory user accounts [T1003.003].\n\nActors modified the c:\\windows\\system32\\drivers\\etc\\hosts file to prevent communication with the Duo MFA server:\n\n127.0.0.1 api-<redacted>.duosecurity.com\u00a0\n\nThe following access device IP addresses used by the actors have been identified to date:\n\n45.32.137[.]94\n191.96.121[.]162\n173.239.198[.]46\n157.230.81[.]39\u00a0\n\n\nMitigations\n\nThe FBI and CISA recommend organizations remain cognizant of the threat of state-sponsored cyber actors exploiting default MFA protocols and exfiltrating sensitive information. Organizations should:\n\nEnforce MFA for all users, without exception. Before implementing, organizations should review configuration policies to protect against \u201cfail open\u201d and re-enrollment scenarios.\nImplement time-out and lock-out features in response to repeated failed login attempts.\nEnsure inactive accounts are disabled uniformly across the Active Directory, MFA systems etc.\nUpdate software, including operating systems, applications, and firmware on IT network assets in a timely manner. Prioritize patching known exploited vulnerabilities, especially critical and high vulnerabilities that allow for remote code execution or denial-of-service on internet-facing equipment.\nRequire all accounts with password logins (e.g., service account, admin accounts, and domain admin accounts) to have strong, unique passwords. Passwords should not be reused across multiple accounts or stored on the system where an adversary may have access.\nContinuously monitor network logs for suspicious activity and unauthorized or unusual login attempts.\nImplement security alerting policies for all changes to security-enabled accounts/groups, and alert on suspicious process creation events (ntdsutil, rar, regedit, etc.).\n\nNote: If a domain controller compromise is suspected, a domain-wide password reset\u2014including service accounts, Microsoft 365 (M365) synchronization accounts, and krbtgt\u2014will be necessary to remove the actors\u2019 access. (For more information, see https://docs.microsoft.com/en-us/answers/questions/87978/reset-krbtgt-password.html). Consider soliciting support from a third-party IT organization to provide subject matter expertise, ensure the actor is eradicated from the network, and avoid residual issues that could enable follow-on exploitation. \u00a0\nFBI and CISA also recommend organizations implement the recommendations listed below to further reduce the risk of malicious cyber activity.\nSecurity Best Practices\n\nDeploy Local Administrator Password Solution (LAPS), enforce Server Message Block (SMB) Signing, restrict Administrative privileges (local admin users, groups, etc.), and review sensitive materials on domain controller\u2019s SYSVOL share.\nEnable increased logging policies, enforce PowerShell logging, and ensure antivirus/endpoint detection and response (EDR) are deployed to all endpoints and enabled.\nRoutinely verify no unauthorized system modifications, such as additional accounts and Secure Shell (SSH) keys, have occurred to help detect a compromise. To detect these modifications, administrators can use file integrity monitoring software that alerts an administrator or blocks unauthorized changes on the system.\u00a0\n\nNetwork Best Practices\n\nMonitor remote access/ RDP logs and disable unused remote access/RDP ports.\nDeny atypical inbound activity from known anonymization services, to include commercial VPN services and The Onion Router (TOR).\nImplement listing policies for applications and remote access that only allow systems to execute known and permitted programs under an established security policy.\nRegularly audit administrative user accounts and configure access control under the concept of least privilege.\u00a0\nRegularly audit logs to ensure new accounts are legitimate users.\nScan networks for open and listening ports and mediate those that are unnecessary.\nMaintain historical network activity logs for at least 180 days, in case of a suspected compromise.\nIdentify and create offline backups for critical assets.\nImplement network segmentation.\nAutomatically update anti-virus and anti-malware solutions and conduct regular virus and malware scans.\n\nRemote Work Environment Best Practices\nWith an increase in remote work environments and the use of VPN services, the FBI and CISA encourage organizations to implement the following best practices to improve network security:\n\nRegularly update VPNs, network infrastructure devices, and devices used for remote work environments with the latest software patches and security configurations.\nWhen possible, implement multi-factor authentication on all VPN connections. Physical security tokens are the most secure form of MFA, followed by authenticator applications. When MFA is unavailable, require employees engaging in remote work to use strong passwords.\nMonitor network traffic for unapproved and unexpected protocols.\nReduce potential attack surfaces by discontinuing unused VPN servers that may be used as a point of entry for attackers.\n\nUser Awareness Best Practices\nCyber actors frequently use unsophisticated methods to gain initial access, which can often be mitigated by stronger employee awareness of indicators of malicious activity. The FBI and CISA recommend the following best practices to improve employee operations security when conducting business:\n\nProvide end-user awareness and training. To help prevent targeted social engineering and spearphishing scams, ensure that employees and stakeholders are aware of potential cyber threats and delivery methods. Also, provide users with training on information security principles and techniques.\u00a0\nInform employees of the risks associated with posting detailed career information to social or professional networking sites.\nEnsure that employees are aware of what to do and whom to contact when they see suspicious activity or suspect a cyberattack, to help quickly and efficiently identify threats and employ mitigation strategies.\n\nInformation Requested\nAll organizations should report incidents and anomalous activity to the FBI via your local FBI field office or the FBI\u2019s 24/7 CyWatch at (855) 292-3937 or CyWatch@fbi.gov and report@cisa.gov\u00a0or by calling 1-844-Say-CISA (1-844-729-2472).\nAPPENDIX A: Threat Actor Tactics and Techniques\nSee table 1 for the threat actors\u2019 tactics and techniques identified in this CSA. See the ATT&CK for Enterprise for all referenced threat actor tactics and techniques.\nTable 1: Threat Actor MITRE ATT&CK Tactics and Techniques\n\n\n\nTactic\nTechnique\n\n\n\n\nInitial Access [TA0001]\nValid Accounts [T1078]\n\n\nPersistence [TA0003]\nExternal Remote Services [T1133]\n\n\nModify Authentication Process [T1556]\n\n\nPrivilege Escalation [TA0004]\nExploitation for Privilege Escalation[T1068]\n\n\nDefense Evasion [TA0005]\nModify Registry [T1112]\n\n\nCredential Access [TA0006]\nBrute Force: Password Guessing [T1110.001]\n\n\nOS Credential Dumping: NTDS [T1003.003]\n\n\nDiscovery [TA0007]\nRemote System Discovery [T1018]\n\n\nLateral Movement [TA0008]\u00a0\n\u00a0\n\n\nCollection [TA0009]\nArchive Collected Data: Archive via Utility [T1560.001]\n\n\n\n\nRevisions\n\nMarch 15, 2022: Initial Version\n",
  "cves": [
    "CVE-2021-34527"
  ],
  "techniques": [
    "T1110.001",
    "T1560.001",
    "T1003.003"
  ],
  "advisory": "aa22-074a",
  "title": "Russian State-Sponsored Cyber Actors Gain Network Access by Exploiting Default Multifactor Authentication Protocols and \u201cPrintNightmare\u201d Vulnerability | CISA",
  "source": "cybersecurity-advisories",
  "id": "188a7bd31e81e597894cabf5fc03b80aaf3c695cefa7d3f20cffe5030081a015"
}