{
  "markdown": "\n\nSummary\n\nThis Joint Cybersecurity Advisory uses the MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK\u00ae) framework, Version 8. See the ATT&CK for Enterprise for\u00a0 referenced threat actor tactics and for techniques.\nThis joint advisory is the result of analytic efforts between the Federal Bureau of Investigation (FBI), United States Coast Guard Cyber Command (CGCYBER), and the Cybersecurity and Infrastructure Security Agency (CISA) to highlight the cyber threat associated with active exploitation of a newly identified vulnerability (CVE-2021-40539) in ManageEngine ADSelfService Plus\u2014a self-service password management and single sign-on solution.\nCVE-2021-40539, rated critical by the Common Vulnerability Scoring System (CVSS), is an authentication bypass vulnerability affecting representational state transfer (REST) application programming interface (API) URLs that could enable remote code execution. The FBI, CISA, and CGCYBER assess that advanced persistent threat (APT) cyber actors are likely among those exploiting the vulnerability. The exploitation of ManageEngine ADSelfService Plus poses a serious risk to critical infrastructure companies, U.S.-cleared defense contractors, academic institutions, and other entities that use the software. Successful exploitation of the vulnerability allows an attacker to place webshells, which enable the adversary to conduct post-exploitation activities, such as compromising administrator credentials, conducting lateral movement, and exfiltrating registry hives and Active Directory files.\nZoho ManageEngine ADSelfService Plus build 6114, which Zoho released on September 6, 2021, fixes CVE-2021-40539. FBI, CISA, and CGCYBER strongly urge users and administrators to update to ADSelfService Plus build 6114. Additionally, FBI, CISA, and CGCYBER strongly urge organizations ensure ADSelfService Plus is not directly accessible from the internet.\nThe FBI, CISA, and CGCYBER have reports of malicious cyber actors using exploits against CVE-2021-40539 to gain access [T1190] to ManageEngine ADSelfService Plus, as early as August 2021. The actors have been observed using various tactics, techniques, and procedures (TTPs), including:\n\nFrequently writing webshells [T1505.003] to disk for initial persistence\nObfuscating and Deobfuscating/Decoding Files or Information\u00a0 [T1027 and T1140]\nConducting further operations to dump user credentials [T1003]\nLiving off the land by only using signed Windows binaries for follow-on actions [T1218]\nAdding/deleting user accounts as needed [T1136]\nStealing copies of the Active Directory database (NTDS.dit) [T1003.003] or registry hives\nUsing Windows Management Instrumentation (WMI) for remote execution [T1047]\nDeleting files to remove indicators from the host [T1070.004]\nDiscovering domain accounts with the net Windows command [1087.002]\nUsing Windows utilities to collect and archive files for exfiltration [T1560.001]\nUsing custom symmetric encryption for command and control (C2) [T1573.001]\n\nThe FBI, CISA, and CGCYBER are proactively investigating and responding to this malicious cyber activity.\n\nFBI is leveraging specially trained cyber squads in each of its 56 field offices and CyWatch, the FBI\u2019s 24/7 operations center and watch floor, which provides around-the-clock support to track incidents and communicate with field offices across the country and partner agencies.\nCISA offers a range of no-cost cyber hygiene services to help organizations assess, identify, and reduce their exposure to threats. By requesting these services, organizations of any size could find ways to reduce their risk and mitigate attack vectors.\nCGCYBER has deployable elements that provide cyber capability to marine transportation system critical infrastructure in proactive defense or response to incidents.\n\nSharing technical and/or qualitative information with the FBI, CISA, and CGCYBER helps empower and amplify our capabilities as federal partners to collect and share intelligence and engage with victims while working to unmask and hold accountable, those conducting malicious cyber activities. See the Contact section below for details.\nClick here for a PDF version of this report.\nClick here for indicators of compromise (IOCs) in STIX format.\n\nTechnical Details\n\nSuccessful compromise of ManageEngine ADSelfService Plus, via exploitation of CVE-2021-40539, allows the attacker to upload a .zip file containing a JavaServer Pages (JSP) webshell masquerading as an x509 certificate: service.cer. Subsequent requests are then made to different API endpoints to further exploit the victim's system.\nAfter the initial exploitation, the JSP webshell is accessible at /help/admin-guide/Reports/ReportGenerate.jsp. The attacker then attempts to move laterally using Windows Management Instrumentation (WMI), gain access to a domain controller, dump NTDS.dit and SECURITY/SYSTEM registry hives, and then, from there, continues the compromised access.\nConfirming a successful compromise of ManageEngine ADSelfService Plus may be difficult\u2014the attackers run clean-up scripts designed to remove traces of the initial point of compromise and hide any relationship between exploitation of the vulnerability and the webshell.\n(Updated November 19, 2021): APT actors are using the following suite of tools to enable this campaign:\n\nDropper \u2013 a dropper trojan that drops Godzilla webshell on a system.\nGodzilla \u2013 a Chinese language webshell.\nNGLite \u2013 a backdoor trojan written in Go.\nKdcSponge \u2013 a credential-stealing tool that targets undocumented APIs in Microsoft\u2019s implementation of Kerberos.\n\nThe FBI, CISA, and CGCYBER cannot confirm the CVE-2021-40539 is the only vulnerability APT actors are leveraging as part of this activity, so it is key that network defenders focus on detecting the tools listed above in addition to initial access vector. For more information, see:\n\nPalo Alto Networks blog post: KdcSponge, NGLite, Godzilla Webshell Used in Targeted Attack Campaign.\nMicrosoft Security blog post: Threat actor DEV-0322 exploiting ZOHO ManageEngine ADSelfService Plus.\nIBM Security Intelligence blog post: Call to Patch: Zero Day Discovered in Enterprise Help Desk Platform.\n\nNote: The FBI, CISA, and CGCYBER do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the FBI, CISA, and CGCYBER. This document does not change any legal requirements or impose new requirements on the public.\nTargeted Sectors\nAPT cyber actors have targeted entities across the 16 critical infrastructure sectors, including\u00a0academic institutions, defense contractors as well as transportation, information technology, manufacturing, communications, and finance. Illicitly obtained access and information may disrupt company operations/logistics and subvert U.S. research across critical infrastructure sectors.\nIndicators of Compromise\nHashes:\n068d1b3813489e41116867729504c40019ff2b1fe32aab4716d429780e666324\n49a6f77d380512b274baff4f78783f54cb962e2a8a5e238a453058a351fcfbba\nFile paths:\nC:\\ManageEngine\\ADSelfService Plus\\webapps\\adssp\\help\\admin-guide\\reports\\ReportGenerate.jsp\nC:\\ManageEngine\\ADSelfService Plus\\webapps\\adssp\\html\\promotion\\adap.jsp\nC:\\ManageEngine\\ADSelfService Plus\\work\\Catalina\\localhost\\ROOT\\org\\apache\\jsp\\help\nC:\\ManageEngine\\ADSelfService Plus\\jre\\bin\\SelfSe~1.key (filename varies with an epoch timestamp of creation, extension may vary as well)\nC:\\ManageEngine\\ADSelfService Plus\\webapps\\adssp\\Certificates\\SelfService.csr\nC:\\ManageEngine\\ADSelfService Plus\\bin\\service.cer\nC:\\Users\\Public\\custom.txt\nC:\\Users\\Public\\custom.bat\nC:\\ManageEngine\\ADSelfService Plus\\work\\Catalina\\localhost\\ROOT\\org\\apache\\jsp\\help (including subdirectories and contained files)\nWebshell URL Paths:\n/help/admin-guide/Reports/ReportGenerate.jsp\n/html/promotion/adap.jsp\nCheck log files located at C:\\ManageEngine\\ADSelfService Plus\\logs for evidence of successful exploitation of the ADSelfService Plus vulnerability:\n\nIn access* logs:\n\n/help/admin-guide/Reports/ReportGenerate.jsp\n/ServletApi/../RestApi/LogonCustomization\n/ServletApi/../RestAPI/Connection\n\n\nIn serverOut_* logs:\n\nKeystore will be created for \"admin\"\nThe status of keystore creation is Upload!\n\n\nIn adslog* logs:\n\nJava traceback errors that include references to NullPointerException in addSmartCardConfig or getSmartCardConfig\n\n\n\nTTPs:\n\nWMI for lateral movement and remote code execution (wmic.exe)\nUsing plaintext credentials acquired from compromised ADSelfService Plus host\nUsing pg_dump.exe to dump ManageEngine databases\nDumping NTDS.dit and SECURITY/SYSTEM/NTUSER registry hives\nExfiltration through webshells\nPost-exploitation activity conducted with compromised U.S. infrastructure\nDeleting specific, filtered log lines\n\nYara Rules:\nrule ReportGenerate_jsp {\n\u00a0\u00a0 strings:\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s1 = \"decrypt(fpath)\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s2 = \"decrypt(fcontext)\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s3 = \"decrypt(commandEnc)\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s4 = \"upload failed!\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s5 = \"sevck\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s6 = \"newid\"\n\u00a0\u00a0 condition:\n\u00a0\u00a0\u00a0\u00a0\u00a0 filesize < 15KB and 4 of them\n}\n\u00a0\nrule EncryptJSP {\n\u00a0\u00a0 strings:\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s1 = \"AEScrypt\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s2 = \"AES/CBC/PKCS5Padding\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s3 = \"SecretKeySpec\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s4 = \"FileOutputStream\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s5 = \"getParameter\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s6 = \"new ProcessBuilder\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s7 = \"new BufferedReader\"\n\u00a0\u00a0\u00a0\u00a0\u00a0 $s8 = \"readLine()\"\n\u00a0\u00a0 condition:\n\u00a0\u00a0\u00a0\u00a0\u00a0 filesize < 15KB and 6 of them\n}\n\nMitigations\n\nOrganizations that identify any activity related to ManageEngine ADSelfService Plus indicators of compromise within their networks should take action immediately.\nZoho ManageEngine ADSelfService Plus build 6114, which Zoho released on September 6, 2021, fixes CVE-2021-40539. FBI, CISA, and CGCYBER strongly urge users and administrators to update to ADSelfService Plus build 6114. Additionally, FBI, CISA, and CGCYBER strongly urge organizations ensure ADSelfService Plus is not directly accessible from the internet.\nAdditionally, FBI, CISA, and CGCYBER strongly recommend domain-wide password resets and double Kerberos Ticket Granting Ticket (TGT) password resets if any indication is found that the NTDS.dit file was compromised.\nActions for Affected Organizations\nImmediately report as an incident to CISA or the FBI (refer to Contact Information section below) the existence of any of the following:\n\nIdentification of indicators of compromise as outlined above.\nPresence of webshell code on compromised ManageEngine ADSelfService Plus servers.\nUnauthorized access to or use of accounts.\nEvidence of lateral movement by malicious actors with access to compromised systems.\nOther indicators of unauthorized access or compromise.\n\n\nContact Information\n\nRecipients of this report are encouraged to contribute any additional information that they may have related to this threat.\nFor any questions related to this report or to report an intrusion and request resources for incident response or technical assistance, please contact:\n\nTo report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at https://www.fbi.gov/contact-us/field-offices, or the FBI\u2019s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.\nTo request incident response resources or technical assistance related to these threats, contact CISA at Central@cisa.gov.\nTo report cyber incidents to the Coast Guard pursuant to 33 CFR Subchapter H, Part 101.305 please contact the USCG National Response Center (NRC) Phone: 1-800-424-8802, email: NRC@uscg.mil.\n\n\nRevisions\n\nSeptember 16, 2021: Initial Version|November 19, 2021: Updated to include tools used to enable attack campaign|November 22, 2021: Updated Palo Alto reference to Palo Alto Networks\n",
  "cves": [
    "CVE-2021-40539"
  ],
  "techniques": [
    "T1573.001",
    "T1505.003",
    "T1070.004",
    "T1560.001",
    "T1003.003"
  ],
  "advisory": "aa21-259a",
  "title": "APT Actors Exploiting Newly Identified Vulnerability in ManageEngine ADSelfService Plus | CISA",
  "source": "cybersecurity-advisories",
  "id": "1a3f49c70bebea1024c558c7e03881a8e94add8d0340567ec03a74153f7b153f"
}