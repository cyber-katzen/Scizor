{"markdown": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise \\| CISA\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Skip to main content](#main) \n\n\n\n\n\n\n\n\n\n\n\n\n![U.S. flag](/profiles/cisad8_gov/themes/custom/gesso/dist/images/us_flag_small.png)\n\n\n\n An official website of the United States government\n \n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n\n![Dot gov](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-dot-gov.svg)\n\n\n**Official websites use .gov** \n  \n\n A\n **.gov** \n website belongs to an official government organization in the United States.\n \n\n\n\n\n\n![HTTPS](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-https.svg)\n\n\n**Secure .gov websites use HTTPS** \n  \n\n A\n **lock** \n (\n \n\n\n Lock\n \n\n A locked padlock\n \n\n\n\n\n ) or\n **https://** \n means you\u2019ve safely connected to the .gov website. Share sensitive information only on official, secure websites.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo Americas Cyber Defense Agency](/sites/default/files/images/SVG/header_logo_tagline_update.svg)](/)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo](/sites/default/files/images/SVG/mobile_logo_wordmark.svg)](/)\n\n\n\n\n\n\n\n\n\n\n Search\n \n\n\n\n\n\n\n\n\n\n Menu\n \n\n\n\n\n\n\n\n\n\n\n\n\n![America's Cyber Defense Agency](/sites/default/files/images/SVG/header_tagline_mobile_update.svg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Close\n \n\n\n\n\n* Topics\n \n\n\n\n[Topics](/topics) \n\n\n\n\n[Cybersecurity Best Practices](/topics/cybersecurity-best-practices)\n\n\n\n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories)\n\n\n\n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience)\n\n\n\n\n[Election Security](/topics/election-security)\n\n\n\n\n[Emergency Communications](/topics/emergency-communications)\n\n\n\n\n[Industrial Control Systems](/topics/industrial-control-systems)\n\n\n\n\n[Information and Communications Technology Supply Chain Security](/topics/information-communications-technology-supply-chain-security)\n\n\n\n\n[Partnerships and Collaboration](/topics/partnerships-and-collaboration)\n\n\n\n\n[Physical Security](/topics/physical-security)\n\n\n\n\n[Risk Management](/topics/risk-management)\n\n\n\n\n\n[How can we help?](/audiences) \n\n\n[Government](/topics/government) \n[Educational Institutions](/topics/educational-institutions) \n[Industry](/topics/industry) \n[State, Local, Tribal, and Territorial](/topics/state-local-tribal-and-territorial) \n[Individuals and Families](/topics/individuals-and-families) \n[Small and Medium Businesses](/topics/small-and-medium-businesses) \n[Find Help Locally](/audiences/find-help-locally) \n[Faith\\-Based Community](/audiences/faith-based-community) \n[Executives](/audiences/executives) \n[High\\-Risk Communities](/audiences/high-risk-communities)\n* [Spotlight](/spotlight)\n* Resources \\& Tools\n \n\n\n\n[Resources \\& Tools](/resources-tools) \n\n\n\n\n[All Resources \\& Tools](/resources-tools/all-resources-tools)\n\n\n\n\n[Services](/resources-tools/services)\n\n\n\n\n[Programs](/resources-tools/programs)\n\n\n\n\n[Resources](/resources-tools/resources)\n\n\n\n\n[Training](/resources-tools/training)\n\n\n\n\n[Groups](/resources-tools/groups)\n* News \\& Events\n \n\n\n\n[News \\& Events](/news-events) \n\n\n\n\n[News](/news-events/news)\n\n\n\n\n[Events](/news-events/events)\n\n\n\n\n[Cybersecurity Alerts \\& Advisories](/news-events/cybersecurity-advisories)\n\n\n\n\n[Directives](/news-events/directives)\n\n\n\n\n[Request a CISA Speaker](/news-events/request-speaker)\n\n\n\n\n[Congressional Testimony](/news-events/congressional-testimony)\n\n\n\n\n[CISA Conferences](/cisa-conferences)\n\n\n\n\n[CISA Live!](/cisa-live)\n* Careers\n \n\n\n\n[Careers](/careers) \n\n\n\n\n[Benefits \\& Perks](/careers/benefits-perks)\n\n\n\n\n[HireVue Applicant Reasonable Accommodations Process](/careers/hirevue-applicant-reasonable-accommodations-process)\n\n\n\n\n[Hiring](/general-recruitment-and-hiring-faqs)\n\n\n\n\n[Resume \\& Application Tips](/careers/resume-application-tips)\n\n\n\n\n[Students \\& Recent Graduates](/students-recent-graduates-employment-opportunities)\n\n\n\n\n[Veteran and Military Spouses](/careers/veteran-and-military-spouse-employment-opportunities)\n\n\n\n\n[Work @ CISA](/careers/work-cisa)\n* About\n \n\n\n\n[About](/about) \n\n\n\n\n[Culture](/about/culture)\n\n\n\n\n[Divisions \\& Offices](/about/divisions-offices)\n\n\n\n\n[Regions](/about/regions)\n\n\n\n\n[Leadership](/about/leadership)\n\n\n\n\n[Doing Business with CISA](/doing-business-cisa)\n\n\n\n\n[Site Links](/site-links)\n\n\n\n\n[Reporting Employee and Contractor Misconduct](/reporting-employee-and-contractor-misconduct)\n\n\n\n\n[CISA GitHub](/cisa-github)\n\n\n\n\n[CISA Central](/cisa-central)\n\n\n\n\n[2023 Year In Review](/about/2023YIR)\n\n\n\n\n[Contact Us](/about/contact-us)\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Breadcrumb\n \n1. [Home](/)\n2. [News \\& Events](/news-events)\n3. [Cybersecurity Advisories](/news-events/cybersecurity-advisories)\n4. [Analysis Report](/news-events/cybersecurity-advisories?f%5B0%5D=advisory_type%3A65)\n\n\n\n\n\n\n\n\n Share:\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Analysis Report\n \nEviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise\n==============================================================================================\n\n\n\n\n\n Last Revised\n \n\n\n May 21, 2021\n \n\n\n\n\n Alert Code\n \n\n AR21\\-134A\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Important: Category 3 organizations should use out\\-of\\-band communications for all mitigation and remediation communications and documentation, i.e., do not use any compromised systems to internally or externally communicate remediation plans or actions.\n \n\n Remediation plans for dealing with malicious compromises are necessarily unique to every organization, and success requires careful consideration. There are three phases for evicting the actor:\n \n\n\n* **Phase 1: Pre\\-Eviction** \n . Actions to detect and identify APT activity and prepare the network for eviction.\n **Note:** \n for the purposes of this guidance, a network is defined as any computer network with hosts that share either a logical trust or any account credentials with affected versions of SolarWinds Orion.\n* **Phase 2: Eviction** \n . Actions to remove the APT actor from on\\-premises and cloud environments. This phase includes rebuilding devices and systems.\n* **Phase 3: Post\\-Eviction** \n . Actions to ensure eviction was successful and the network has good cyber posture.\n\n\n\n Conducting each step in this guidance is necessary to fully evict the adversary from Category 3 networks. Failure to perform comprehensive and thorough remediation activity will expose enterprise networks and cloud environments to substantial risk for long\\-term undetected APT activity, and compromised organizations will risk further loss of sensitive data and erosion of public trust in their networks.\n \n\n\n\n Although this guidance provides a level of detail that describes actions to be completed, it does not describe how these actions should be completed. To successfully evict the threat actor, these actions need to be conducted in the order specified. Additionally, this guidance clearly notes caveats and provides references to help agencies develop their plan.\n \n\n\n### Pre\\-Eviction Phase\n\n\n1. **Define the true scope** \n by identifying trust boundaries (including between Active Directory \\[AD] forests and domains) and determining the enterprise assets to which this guidance applies (i.e., determine what assets are within the trust boundary).\n   \n\n\t1. For example, the organization needs to determine the identity provider (IdP) sources (such as Okta, Microsoft Active Directory Federation Services \\[ADFS], Duo) that it uses to issue single\\-sign on (SSO) credentials and it needs to identify assets that rely on the SSO credentials to allow access (i.e., what controlled data sources are accessible via that credential).\n2. **Investigate suspicious account activity** \n associated with your SolarWinds servers, especially service accounts used by SolarWinds Orion. Additionally, enumerate and investigate any credentials stored or used on the SolarWinds server, including network administration and device credentials. This can be conducted, for example, using a transitive mapping of all potentially compromised credentials to the systems that those credentials accessed. If\u2014as a Category 3 agency\u2014you cannot confirm that all your credential activity is benign, you should proceed as if the highest administrative level of credentials on your affected SolarWinds server has been compromised. In many cases, the adversary may have had this access for months. Refer to the following resources for more information.\n   \n\n\t1. FireEye:\n\t [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html)\n\t2. CISA Alert\n\t [AA20\\-352A: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organization](https://us-cert.cisa.gov/ncas/alerts/aa20-352a)\n3. **Investigate potential Security Assertion Markup Language (SAML) abuse** \n in your environment. Refer to the following resources.\n   \n\n\t1. CISA\n\t [Alert AA21\\-008A: Detecting Post\\-Compromise Threat Activity in Microsoft Cloud Environments](https://us-cert.cisa.gov/ncas/alerts/aa21-008a)\n\t2. National Security Agency:\n\t [Detecting Abuse of Authentication Mechanisms](https://media.defense.gov/2020/Dec/17/2002554125/-1/-1/0/AUTHENTICATION_MECHANISMS_CSA_U_OO_198854_20.PDF)\n\t3. FireEye:\n\t [Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452](https://www.fireeye.com/content/dam/collateral/en/wp-m-unc2452.pdf)\n\t4. Microsoft:\n\t [Understanding \"Solorigate\"'s Identity IOCs \\- for Identity Vendors and their customers](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/understanding-quot-solorigate-quot-s-identity-iocs-for-identity/ba-p/2007610)\n4. **Scope the intrusion.** \n  \n\n\t1. Look for the artifacts from known TTPs associated with this activity. Refer to\n\t [SolarWinds and Active Directory/M365 Compromise: Detecting Advanced Persistent Threat Activity from Known Tactics, Techniques, and Procedures](https://us-cert.cisa.gov/sites/default/files/publications/Supply_Chain_Compromise_Detecting_APT_Activity_from_known_TTPs.pdf) \n\t for TTPs and corresponding detection artifacts. Prioritize these by biggest value for the investment (e.g., prioritize these by techniques or technologies that cover multiple tactics or that provide visibility into shared data sources). After identifying the TTPs for which your organization has security controls to detect/stop/mitigate, you can make risk\\-based decisions on how to address visibility and protection strategies for the remaining MITRE Adversarial Tactics, Techniques, and Common Knowledge (ATT\\&CK)\\-based paths.\n\t2. Audit all network device configurations stored or managed on the SolarWinds monitoring server for signs of unauthorized or malicious configuration changes. Organizations should audit the current network device running configuration and any local configurations that could be loaded at boot time.\n\t3. Assess the current endpoint telemetry collection level and configure endpoint forensics and detection solutions for aggressive collection; prioritize this by value of asset and account.\n5. **Harden the enterprise attack surface.** \n  \n\n\t1. Review and validate perimeter firewall rulesets. Remove all allow rules for which the organization does not have a clearly defined, understood, and documented need. \u201cDeny all\u201d statements that identify necessary connections and allow them as exceptions are the standard for perimeter devices.\n\t \n\t  \n\t\n\t\t1. Reduce the number of systems that are able to access the internet directly.\n\t\t **Note:** \n\t\t this action may require analysis by network engineers with fundamental knowledge of (1\\) how network data communicates through agency trust boundaries and (2\\) the IP routing in the enterprise.\n\t\t\t* For example, domain controllers should never be used for\u2014or capable of\u2014 browsing the internet. (Microsoft\u2019s\n\t\t\t [analysis](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/securing-domain-controllers-against-attack) \n\t\t\t of domain controllers identified that privileged users often use Internet Explorer to browse the intranet or internet.\n\t\t\t* For more information on designing networks where critical or security\\-related appliances and servers do not have access to the internet, refer to the United Kingdom\u2019s National Cyber Security Centre (NCSC):\n\t\t\t [Security Architecture Anti\\-Patterns](https://www.ncsc.gov.uk/whitepaper/security-architecture-anti-patterns) \n\t\t\t .\n\t\t2. Reduce the number of egress ports at the enterprise perimeter. This requires a review of all perimeter firewall rulesets (rulesets may differ among firewalls).\n\t2. Implement host\\-based firewalls to make the work of moving laterally more challenging for the adversary, disrupting the ability to move from compromised workstations to domain resources. Consider blocking or closely monitoring workstation\\-to\\-workstation communications as much as possible, using Privileged Access Workstations (PAWs) and servers for administrative functions. Firewalls and endpoint detection and response functions may have similar capability, but both need to feature (1\\) filtering of allowed connections and (2\\) visibility/detection for connections.\n\t3. Close and/or monitor high\\-risk ports (e.g., Remote Desktop Protocol \\[RDP], Server Message Block \\[SMB], File Transfer Protocol \\[FTP], Trivial File Transfer Protocol \\[TFTP], Secure Shell \\[SSH], and WebDAV).\n\t4. Carefully employ application execution control (allowlisting), especially for systems providing remote access to the enterprise.\n\t5. Enforce enterprise Domain Name System (DNS) resolution for all systems. Do not allow internal systems to directly access internet DNS servers.\n\t6. Ensure that all endpoints that will need to be updated are powered on for as long as possible during the eviction phase.\n\t **Note:** \n\t this action is necessary for all vital changes to AD to be pushed to all systems in the environment prior to reconnection and also to verify that all systems are rebooted. This action is especially tricky given that many user endpoints are not connected 24/7 due to remote work. Organizations may want to look at \u201cjailing\u201d systems that connect in this way into minimal virtual local area networks (VLANs) until they can be verified to have received and implemented updates and any other mitigations (endpoint detection and response \\[EDR] agents, patches, antivirus definitions, specific scans, etc.) decided on by the organization.\n\t7. Agencies using Microsoft Defender for Endpoint or Microsoft 365 Defender should refer to Microsoft:\n\t [Use attack surface reduction rules to prevent malware infection](https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction?view=o365-worldwide) \n\t for more information on hardening the enterprise attack surface.\n6. **Identify federation model for on\\-premises resources to cloud trust relationship and identify adversary activity in Microsoft 365 (M365\\)/Azure environment.** \n  \n\n\t1. Identify the Source Anchor for Azure AD Connect in the current Azure Tenant, if used. (This is required in order to sever the connection and restore later).\n\t2. Run Sparrow or similar tools to identify permission and credential changes to applications and service principals. Identify overly permissive applications, unusual credentials in applications, or modifications to federation trust settings. Refer to CISA Alert\n\t [AA21\\-008A: Detecting Post\\-Compromise Threat Activity in Microsoft Cloud Environments](https://us-cert.cisa.gov/ncas/alerts/aa21-008a) \n\t for more information.\n\t3. Review M365 tenant configuration and perform a cloud security assessment for administrative accounts and applications. Specifically, review all accounts with privileged access and each application to determine if the rights and credentials are as intended and still necessary. This assessment should include shared trusts or identity relationships with third\\-party cloud service providers (CSPs) in which the identity is a resident on the CSP\u2019s tenant but is also capable of performing actions in the organization\u2019s M365 environment.\n\n\n### Eviction Phase\n\n\n\n**Note:** \n to effectively the APT actor, the following steps should be completed fully and in the order listed. These steps may affect operations of critical business functions. CISA recommends agencies conduct a thorough risk assessment prior to starting eviction so that potential impacts on critical business functions are documented and understood. Given that these steps are complex, CISA also encourages agencies to use third\\-party help to support eviction efforts if needed.\n \n\n\n1. **Sever the enterprise network from the internet.** \n\n\n\n\n**Note:** \n this step requires the agency to understand its internal and external connections. When making the decision to sever internet access, knowledge of connections must be combined with care to avoid disrupting critical functions.\n2. **Reset the Kerberos Ticket Granting Ticket account (krbtgt).** \n\n\n\n\n**Note:** \n krbtgt must be reset twice; the second time after the first has finished. The resets may take a long time to propagate fully on large AD environments. For more information, refer to Microsoft guidance: AD Forest Recovery \\- Resetting the krbtgt password.\n3. **Eradicate known malware/backdoors/implants discovered during pre\\-eviction steps.** \n\n\n\n\n**Note:** \n this can be done while waiting for the krbtgt resets to complete.\n4. **Apply network device mitigations** \n identified in CISA Alert\n [AA20\\-352A: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organization](https://us-cert.cisa.gov/ncas/alerts/aa20-352a) \n .\n \n\n\n\n For network devices managed by the SolarWinds monitoring server, the running firmware/software should be checked against known good hash values from the network vendor. CISA recommends that, if possible, organizations re\\-upload known good firmware/software to managed network devices and perform a reboot.\n \n\n\n\n**Note:** \n be sure to wait until krbtgt reset completes to avoid interrupting the reset.\n5. **Unenroll any suspicious MFA Tokens.** \n Audit all MFA tokens configured in your environment, especially those used for remote access. Unenroll any tokens that\u00a0cannot be accounted for or are suspicious.\n6. **Rebuild and reimage systems.** \n\n\n\n\n**Note:** \n agencies should do an impact assessment for endpoints to determine if they need to be reimaged. An agency should identify (1\\) credentials observed on compromised machines as at risk and (2\\) any subsequent system accessed from the corresponding accounts as compromised. Consider:\n \n\n\n\t1. Was the endpoint altered by a known malicious actor action? If yes, reimage the system.\n\t2. Was data on the endpoint accessed but the endpoint shows no sign of being altered? If yes, you may not need to reimage the system.\n7. **Regain control of the AD and ADFS** \n , by instituting Local Administrator Password Solution (LAPS), PAWs, and modified administrative accounts.\n   \n\n\t1. Re\\-establish control of the ecosystem items that were most easily manipulated by the attacker. Start with the \u201clowest hanging fruit,\u201d i.e., items that are low risk to operations, low administrative overhead, that do not require new skill sets to control. These actions block the most frequently used attack methods on a network. Refer to the Microsoft and Center for Internet Security joint presentation\n\t [Critical Hygiene for Preventing Major Breaches](https://published-prd.lanyonevents.com/published/rsaus17/sessionsFiles/3774/CXO-F02-Critical-Hygiene-for-Preventing-Major-Breaches.pdf) \n\t for more information on prioritizing controls with the largest return on investment.\n\t   \n\t\n\t\t1. Audit the privilege levels of accounts that were utilized on affected SolarWinds Orion servers. Consider only granting the minimal rights and accounts needed to function, following Just Enough Administration (JEA) principles. (Refer to Microsoft:\n\t\t [Just Enough Administration](https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview?view=powershell-7.1) \n\t\t for more information.)\n\t\t2. Ensure there are unique and distinct administrative accounts for each set of administrative tasks. Enforce the principle of least privilege. Remove all accounts that are unnecessary; remove privileges not expressly required by an account\u2019s function or role. Institute a group policy that disables remote interactive logins, and use Domain Protected Users Group.Ensure there are unique and distinct administrative accounts for each set of administrative tasks. Enforce the principle of least privilege. Remove all accounts that are unnecessary; remove privileges not expressly required by an account\u2019s function or role. Institute a group policy that disables remote interactive logins, and use Domain Protected Users Group.\n\t\t3. Enforce MFA for all administrative accounts and functions.\n\t\t4. Create and establish PAWs for administrative accounts and mandate use for administrative functions (AD Administrators first, at minimum).\n\t\t5. Enable unique local administrative accounts (e.g., LAPS) and a management function for those accounts.\n\t\t **Note** \n\t\t : for LAPS, if the endpoints are cloned, each individual endpoint\u2019s local administrative account password needs to be changed afterward to enforce uniqueness.\n8. **Rotate all the Secrets.** \n  \n\n\t1. Rotate secrets associated with remote access MFA token generation.\n\t2. Reset passwords for:\n\t   \n\t\n\t\t1. All AD accounts with elevated privileges (such as administrators)\n\t\t2. All AD service accounts\n\t\t3. Directory Services Restore Mode (DSRM) account on domain controllers\n\t\t4. All AD accounts\n\t\t5. Accounts with suspicious activity or whose credentials existed on compromised systems, such as affected SolarWinds servers\n\t\t6. Any account where Smartcard/Personal Identity Verification (PIV) is not enforced (which are on an exception or similar exemption)\n\t\t \n\t\t\n\t\t\n\t\t\n\t\t**Note:** \n\t\t the New Technology LAN Manager (NTLM) hashes of smartcard/PIV\\-enabled accounts can be used in pass\\-the\\-hash attacks and should be refreshed regularly. For more information, including guidance and scripts on rolling over these hashes, refer to the National Security Agency (NSA) Information Assurance Advisory:\n\t\t [Long\\-Lived Hashes for AD Smartcard Required Accounts](https://apps.nsa.gov/iad/library/ia-advisories-alerts/long-lived-hashes-for-ad-smartcard-required-accounts.cfm) \n\t\t , NSA Cyber\u2019s GitHub page on\n\t\t [Pass the\\-Hash Guidance](https://github.com/nsacyber/Pass-the-Hash-Guidance) \n\t\t , and Microsoft:\n\t\t [Passwordless Strategy](https://docs.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/passwordless-strategy#configure-user-accounts-to-disallow-password-authentication) \n\t\t .\n\t\t7. All AD user accounts\n\t\t8. All Windows local administrative accounts (including those that are renamed, especially those not managed by LAPS in environment)\n\t\t9. Non\\-AD application privileged accounts (e.g., elevated accounts on systems that are not joined to AD; some high value assets (HVAs) may fall into this category)\n\t\t10. Network device administrative accounts\n\t\t11. Non\\-AD HVA user accounts\n\t3. Change all credentials being used to manage network devices, including keys and strings used to secure network device functions (Simple Network Management Protocol \\[SNMP] strings/user credentials, IPsec/IKE preshared keys, routing secrets, TACACS/RADIUS secrets, RSA keys/certificates, etc.). Monitor for failed logins resulting from these resets.\n9. **Sever Azure environment from on\\-premises, and conduct M365/Azure remediation.** \n  \n\n\t1. Evaluate IdP sources. Harden SSO features. (See FireEye\u2019s white paper,\n\t [Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452](https://www.fireeye.com/blog/threat-research/2021/01/remediation-and-hardening-strategies-for-microsoft-365-to-defend-against-unc2452.html) \n\t ). Turn on advanced logging and establish a privileged access management (PAM) baseline (expected privileged account state) for cloud environments.\n\t2. Harden the Azure AD Connect Service. (See Trimarc Security\u2019s post,\n\t [Securing Microsoft Azure AD Connect](https://www.hub.trimarcsecurity.com/post/securing-microsoft-azure-ad-connect) \n\t ).\n\t3. Review and adjust federation trust relationships.\n\t **Note:** \n\t Microsoft recommends severing federation trusts between on\\-premises networks and the cloud; organizations should migrate to an external IdP or use Azure AD to manage users and, if the latter, users should be \u201cmastered\u201d from Azure AD. Revoke unauthorized or unnecessary federation trusts if maintaining a federated identity solution. (CISA recommends avoiding federated enterprise environments whenever possible.) For more information review the following resources.\n\t\t* Microsoft:\n\t\t [Protecting Microsoft 365 from on\\-premises attacks](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/protect-m365-from-on-premises-attacks)\n\t\t* CrowdStrike:\n\t\t [CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory](https://www.crowdstrike.com/blog/crowdstrike-launches-free-tool-to-identify-and-help-mitigate-risks-in-azure-active-directory/)\n\t4. Fully isolate your M365 admin accounts. Activities in this step include, but are not limited to (1\\) creating cloud\\-only administrators, controlled appropriately with role based access control (RBAC) and MFA, and (2\\) monitoring, in an automated fashion, any changes to the established baseline or unusual use. See the following resources for more information (Note: CISA will be releasing guidance on cloud remediation and hardening following dissemination of this guidance).\n\t\t* Microsoft:\n\t\t [Advice for incident responders on recovery from systemic identity compromises](https://www.microsoft.com/security/blog/2020/12/21/advice-for-incident-responders-on-recovery-from-systemic-identity-compromises/)\n\t\t* Microsoft:\n\t\t [Protecting Microsoft 365 from on\\-premises attacks](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/protect-m365-from-on-premises-attacks)\n\t5. After remediating privileged identities (step d), revoke all existing M365 tokens.\n\t6. Double check to ensure no on\\-premises accounts have administrative privileges in M365\\.\n\t7. Review and sanitize (i.e., remove unwelcome actions) compromised mailboxes using industry standard tooling and service portal manual review.\n\t8. Review, and adjust accordingly, Tenant settings and configurations. Use publicly available or open\\-source tools such as\n\t [CrowdStrike Reporting Tool for Azure (CRT)](https://github.com/CrowdStrike/CRT) \n\t and Hawk to review Tenant settings. Refer to CISA Alert\n\t [AA21\\-008A: Detecting Post\\-Compromise Threat Activity in Microsoft Cloud Environments](https://us-cert.cisa.gov/ncas/alerts/aa21-008a) \n\t .\n\t9. Use tools\u2014such as Sparrow or Azure AD Investigator\u2014to review existing Azure applications. Remediate applications that have been compromised. Refer to CISA Alert\n\t [AA21\\-008A: Detecting Post\\-Compromise Threat Activity in Microsoft Cloud Environments](https://us-cert.cisa.gov/ncas/alerts/aa21-008a) \n\t .\n\t10. Perform IdP review and eviction.\n10. **Clear DNS cache on all servers, workstations, and non\\-Windows systems.** \n  \n\n\t1. Reduce the \u201cDomain member: Maximum machine account password age\u201d in Group Policy to 2\u20133 days during eviction; it can be set back to the default 30 days after eviction is complete. This will hasten the resetting of the Computer object passwords. For more information, refer to Microsoft:\n\t [Machine Account Password Process](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/machine-account-password-process/ba-p/396026) \n\t .\n\t2. Reboot all servers and workstations, especially those joined to the AD.\n11. **Verify eviction steps have been properly completed.** \n  \n\n\t1. Have all the tasks above been completed on all applicable systems and accounts?\n\t **Note:** \n\t CISA highly recommends implementing a process to verify you have completed each task.\n\t2. Have the endpoints that were not completely mitigated been removed from network communication, pending their completion?\n\t3. Have you applied all critical and high patches to the endpoints that lack them, especially any that needed re\\-imaging?\n\t4. Have you added enhanced visibility and monitoring capabilities for cloud environments\u2014such as telemetry for cloud environments\u2014into existing agency security information and event management (SIEM) technology?\n\t5. Have you implemented monitoring capability for highly privileged cloud identities and Service Principals?\n\n\n### Post Eviction\n\n\n1. **Report to your senior leadership completed pre\\-eviction and eviction actions** \n as well as those remaining to be completed; provide leadership an assessment of the risk remaining, including assumed residual risk.\n2. **Reconnect to the internet. Note** \n : the decision to reconnect to the internet depends on senior leadership\u2019s confidence in the actions taken. It is possible\u2014depending on the environment\u2014that new information discovered during pre\\-eviction and eviction steps could add additional eviction tasks.\n3. **Create an actionable and accountable plan for integrating the next 60 days of Active Directory privilege credential baselining guidance** \n (i.e., completing the next step).\n **Note:** \n this next step has high overhead and will likely disrupt business operations; agencies must have a plan for testing breaks associated with the changes to administrative control schemes and will need to alter their policies and procedures to accommodate these disruptions.\n4. **Establish and control baseline mechanisms for administrators** \n .\n **Note:** \n this step should be completed over the next 60 days. While completing this task, agencies should move on to the next step.\n   \n\n\t1. Implement PAWs for remaining administrative accounts.\n\t2. Perform additional hardening of administrative accounts.\n\t   \n\t\n\t\t1. Implement Credential Guard. (Refer to Microsoft:\n\t\t [Manage Windows Defender Credential Guard for more information](https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage) \n\t\t ). Introducing Credential Guard as an endpoint tool can be challenging for organizations due to hardware restrictions, but the impact on privileged identity credential management is significant. Chief information security officers (CISOs) should prioritize identity\\-focused solutions for immediate action.\n\t\t2. Restrict RDP usage to an exclusive list of necessary administrators and from only dedicated administrative workstations (such as PAWs) and identified necessary alternative locations. RDP access should be judiciously and carefully scoped and monitored.\n\t\t3. Establish time bound and temporal escalated Domain Privileges (require second factor for elevation and that access expires).\n\t3. Implement JEA for domain controller access and maintenance.\n\t4. Harden/reduce attack surface of domain controllers. Remove connection to the internet whenever possible, and remove all unnecessary protocols, services, and accounts (in accordance with the principle of least functionality). Consider implementing Windows Server Core for all domain controllers.\n5. **Integrate detection mechanisms** \n that focus on endpoints and changes to privileged identity sources. Solutions include pervasive use of endpoint security (such as the Microsoft Defender Suite of services, including Endpoint and Identity) as well as high value identity monitoring solutions. The view of user behavior should be unified across all platforms and behavioral analytics should be enabled.\n **Note:** \n behavioral analytics (with an understanding of what traditional administrative activity consists of, and what tools are used for it) combined with frequency analysis of activity is often the only avenue for network defenders to detect anomalous activity.\n6. **Report to CISA** \n . Post\\-eviction, all Category 3 agencies should report to CISA actions taken, any actions left incomplete, and their assessments of the residual risk. Following dissemination of this guidance, CISA will release a checklist to the Homeland Security Information Network (HSIN) for agencies to use to complete the steps in this guidance. Agencies should fill out and submit the checklist to CISA.\n7. **Maintain vigilance.** \n In the hours, days, and weeks after the network\u2019s internet connection is restored, the agency\u2019s detection capability will be important in verifying that all threat actor activity within the enterprise has stopped. Extended vigilance is necessary because this threat actor has demonstrated extreme patience with follow\\-on activity.\n   \n\n\t1. Agencies should ensure their security operations center (SOC) has capabilities for enhanced visibility and monitoring of enterprise network and cloud environments. Refer to\n\t [SolarWinds and Active Directory/M365 Compromise: Detecting APT Activity from Known Tactics, Techniques, and Procedures](https://us-cert.cisa.gov/sites/default/files/publications/Supply_Chain_Compromise_Detecting_APT_Activity_from_known_TTPs.pdf) \n\t for known TTPs that agencies should look out for as part of network and environment monitoring.\n\t2. Configure endpoint forensics and detection solutions for aggressive collection; prioritize this by value of asset and account.\n\n\n### Frequently Asked Questions\n\n\n\n**Does my organization have to complete all the steps in this eviction guidance?** \n\n\n\n\n In accordance with\n [ED 21\\-01: Supplemental Direction Version 4](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4) \n , agencies with networks that used affected versions of SolarWinds Orion and have evidence of follow\\-on threat actor activity, such as binary beaconing to\n `avsvmcloud[.]com` \n and secondary command and control (C2\\) activity to a separate domain or IP address, must execute and complete the pre\\-eviction phase of this guidance. Agencies that find additional adversarial activities must execute and complete the eviction and post eviction phases of this guidance. Conducting all of the steps in this guidance is necessary to fully evict the adversary from applicable networks. Failure to perform comprehensive and thorough remediation activity will expose enterprise networks and cloud environments to substantial risk for long\\-term undetected APT activity.\n \n\n\n\n**Is there a time limit to completing the eviction activities?** \n\n\n\n\n In accordance with\n [ED 21\\-01: Supplemental Direction Version 4](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4) \n , agencies subject to the requirements must complete the applicable phases in this eviction guidance by July 16, 2021, or within 90 days of discovery of follow\\-on threat activity after issuance of ED 21\\-01 Supplemental Direction Version 4\\.\n \n\n\n\n**Given that severing the enterprise network from the internet will have significant operational impact, does the organization need to take all its endpoints offline?** \n\n\n\n\n If the affected organization can authoritatively and comprehensively identify compromised internet\\-connected endpoints, identities, and systems and is able to take those offline without affecting uncompromised or non\\-internet connected systems, then the agency does not need to disconnect non\\-compromised endpoints or non\\-internet\\-connected systems. This will still disrupt C2 activities while allowing the agency to keep as much of the system up as possible. Note: access to environments with pervasively compromised credentials will frequently appear to be standard user activity, as it will use \u201cnative\u201d services and identities.\n \n\n\n\n**Will CISA provide agencies new TTPs in the event of a reinfection?** \n\n\n\n\n Refer to\n [SolarWinds and Active Directory/M365 Compromise: Detecting Advanced Persistent Threat Activity from Known Tactics, Techniques, and Procedures](https://us-cert.cisa.gov/sites/default/files/publications/Supply_Chain_Compromise_Detecting_APT_Activity_from_known_TTPs.pdf) \n for reinfection TTPs and corresponding detection artifacts.\n \n\n\n\n**Will CISA provide architectural recommendations for future rebuilds?** \n\n\n\n\n This current guidance is tailored to provide short\\-term remediation steps for agencies to evict this adversary from compromised on\\-premises and cloud environments and protect networks against additional compromise. CISA will be releasing long\\-term enterprise architecture and security operations guidance that incorporates updated credential/access management, monitoring, and detection guidance for a more secure, resilient federal enterprise.\n \n\n\n\n### Summary\n\n\n\n\n Since December 2020, the Cybersecurity and Infrastructure Security Agency (CISA) has been responding to a significant cyber incident. An advanced persistent threat (APT) actor added malicious code to multiple versions of SolarWinds Orion and, in some instances, leveraged it for initial access to enterprise networks of multiple U.S. government agencies, critical infrastructure entities, and private sector organizations. Once inside the network, the threat actor bypassed multi\\-factor authentication (MFA) and moved laterally to Microsoft Cloud systems by compromising federated identity solutions.\n **Note:** \n on April 15, 2021, the U.S. Government attributed this activity to the Russian Foreign Intelligence Service (SVR). See the\n [statement from the White House](https://www.whitehouse.gov/briefing-room/statements-releases/2021/04/15/fact-sheet-imposing-costs-for-harmful-foreign-activities-by-the-russian-government/) \n for additional details.\n \n\n\n\n For more information and resources on this activity, refer to\n [us\\-cert.cisa.gov/remediating\\-apt\\-](https://us-cert.cisa.gov/remediating-apt-compromised-networks) \n  \n\n[compromised\\-networks](https://us-cert.cisa.gov/remediating-apt-compromised-networks) \n .\n \n\n\n\n For more information on CISA\u2019s response to this activity, refer to\n [cisa.gov/supply\\-chain\\-compromise](https://cisa.gov/supply-chain-compromise) \n .\n \n\n\n\n CISA has provided this guidance to federal agencies with networks that used affected versions of SolarWinds Orion and have evidence of follow\\-on threat actor activity\u2014CISA Alert\n [AA20\\-352A: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations](https://us-cert.cisa.gov/ncas/alerts/aa20-352a) \n labels these as Category 3 agencies. This guidance is intended to support Category 3 agencies in crafting their eviction plans in accordance with\n [ED 21\\-01: Supplemental Direction Version 4](https://cyber.dhs.gov/ed/21-01/#supplemental-direction-v4) \n .\n **Note** \n : agencies should refer to CISA Alert\n [AA20\\-352A](https://us-cert.cisa.gov/ncas/alerts/aa20-352a) \n for guidance on determining if they are Category 3\\. CISA is aware of other initial access vectors; agencies should not assume they are not compromised by this APT actor solely because they have never used affected versions of SolarWinds Orion.\n \n\n\n\n Those agencies should investigate to confirm they have not observed related threat actor tactics, techniques, and procedures (TTPs). CISA recommends any agency that detects related activity review this guidance as well as CISA Alert\n [AA20\\-352A](https://us-cert.cisa.gov/ncas/alerts/aa20-352a) \n , and contact CISA for further assistance.\n \n\n\n\n Although this guidance is tailored to federal agencies, CISA encourages critical infrastructure entities; state, local, territorial, and tribal government organizations; and private sector organizations to review and apply it, as appropriate.\n \n\n\n\n The steps provided in this guidance are resource\\-intensive and highly complex and will require the enterprise network to be disconnected from the internet for 3\u20135 days. In order to have fully informed senior\\-level support, CISA recommends that agency senior leadership conduct planning sessions throughout this process to understand the resources needed and any potential disruption in business operations. CISA encourages agency leadership to review\n [CISA Insights: SolarWinds and AD/M365 Compromise Risk Decisions for Leaders](https://www.cisa.gov/publication/solarwinds-and-ad-m365-compromise-risk-decisions-leaders) \n for more information.\n \n\n\n\n By taking steps to evict this adversary from compromised on\\-premises and cloud environments, agencies will position themselves for long\\-term actions to build more secure, resilient networks.\n \n\n\n\n For a PDF copy of this report,\n [click here](/sites/default/files/publications/AR21-134A_Remediating_Networks_Affected_by_the_SolarWinds_and_Active_Directory_M365_Compromise.pdf) \n .\n \n\n\n\n### Contact Information\n\n\n\n\n Recipients of this report are encouraged to contribute any additional information that they may have related to this threat. For any questions related to this report, please contact CISA at:\n \n\n\n* Phone: 1\\-844\\-Say\\-CISA (1\\-844\\-729\\-2472\\)\n* Email:\n [central@cisa.gov](mailto:central@cisa.gov)\n\n\n\n### Revisions\n\n\n\n\n May 14, 2021: Initial Version\n \n\n\n\n\n\n\n\n\n\n\n This product is provided subject to this\n [Notification](/notification \"Follow link\") \n and this\n [Privacy \\& Use](/privacy-policy \"Follow link\") \n policy.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlease share your thoughts\n--------------------------\n\n\n\n We recently updated our anonymous\n [product survey](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://www.cisa.gov/news-events/analysis-reports/ar21-134a) \n ; we\u2019d welcome your feedback.\n \n\n\n\n\n\n\n\n\n\n\n\n\nRelated Advisories\n------------------\n\n\n\n\n\n\n\n\n\n\n Feb 07, 2024\n \n\n\n Analysis Report \\| AR24\\-038A\n \n\n### [MAR\\-10448362\\-1\\.v1 Volt Typhoon](/news-events/analysis-reports/ar24-038a)\n\n\n\n\n\n\n\n\n\n\n\n Nov 21, 2023\n \n\n\n Analysis Report \\| AR23\\-325A\n \n\n### [MAR\\-10478915\\-1\\.v1 Citrix Bleed](/news-events/analysis-reports/ar23-325a)\n\n\n\n\n\n\n\n\n\n\n\n Sep 07, 2023\n \n\n\n Analysis Report \\| AR23\\-250A\n \n\n### [MAR\\-10430311\\-1\\.v1 Multiple Nation\\-State Threat Actors Exploit CVE\\-2022\\-47966 and CVE\\-2022\\-42475](/news-events/analysis-reports/ar23-250a)\n\n\n\n\n\n\n\n\n\n\n\n Sep 07, 2023\n \n\n\n Analysis Report \\| AR23\\-250A\n \n\n### [MAR\\-10454006\\.r5\\.v1 SUBMARINE, SKIPJACK, SEASPRAY, WHIRLPOOL, and SALTWATER Backdoors](/news-events/analysis-reports/ar23-250a-0)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Return to top](#) \n\n\n\n\n* [Topics](/topics)\n* [Spotlight](/spotlight)\n* [Resources \\& Tools](/resources-tools)\n* [News \\& Events](/news-events)\n* [Careers](/careers)\n* [About](/about)\n\n\n\n\n\n\n\n\n[Cybersecurity \\& Infrastructure Security Agency](/ \"Go to the Cybersecurity & Infrastructure Security Agency homepage\")\n\n\n* [Facebook](https://www.facebook.com/CISA)\n* [Twitter](https://twitter.com/CISAgov)\n* [LinkedIn](https://www.linkedin.com/company/cybersecurity-and-infrastructure-security-agency)\n* [YouTube](https://www.youtube.com/@cisagov)\n* [Instagram](https://www.instagram.com/cisagov)\n* [RSS](/subscribe-updates-cisa)\n\n\n\n\n CISA Central\n \n[1\\-844\\-Say\\-CISA](tel:1-844-Say-CISA) \n[SayCISA@cisa.gov](mailto:SayCISA@cisa.gov) \n\n\n\n\n\n\n\n\n\n\n\n DHS Seal\n \n\n\n CISA.gov\n \n\n An official website of the U.S. Department of Homeland Security\n \n\n\n* [About CISA](/about \"About CISA\")\n* [Budget and Performance](https://www.dhs.gov/performance-financial-reports \"Budget and Performance\")\n* [DHS.gov](https://www.dhs.gov \"Department of Homeland Security\")\n* [Equal Opportunity \\& Accessibility](/oedia \"Equal Opportunity & Accessibility\")\n* [FOIA Requests](https://www.dhs.gov/foia \"FOIA Requests\")\n* [No FEAR Act](/no-fear-act \"No FEAR Act Reporting\")\n* [Office of Inspector General](https://www.oig.dhs.gov/ \"Office of Inspector General\")\n* [Privacy Policy](/privacy-policy \"Privacy Policy\")\n* [Subscribe](https://public.govdelivery.com/accounts/USDHSCISA/subscriber/new?topic_id=USDHSCISA_138 \"Subscribe to Email Updates\")\n* [The White House](https://www.whitehouse.gov/ \"The White House\")\n* [USA.gov](https://www.usa.gov/ \"USA.gov\")\n* [Website Feedback](/forms/feedback \"Website Feedback\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "cves": ["CVE-2022-47966", "CVE-2022-42475"], "techniques": [], "advisory": "ar21-134a", "title": "Eviction Guidance for Networks Affected by the SolarWinds and Active Directory/M365 Compromise | CISA", "source": "analysis-reports", "id": "0d9614c80de6f048dca12d4b6ff354ae24ad412e2de7edacc5fdbc51adc50686"}