{
  "markdown": "\nSummary\nThe United States and international cybersecurity authorities are issuing this joint Cybersecurity Advisory (CSA) to highlight a recently discovered cluster of activity of interest associated with a People\u2019s Republic of China (PRC) state-sponsored cyber actor, also known as Volt Typhoon. Private sector partners have identified that this activity affects networks across U.S. critical infrastructure sectors, and the authoring agencies believe the actor could apply the same techniques against these and other sectors worldwide.\nThis advisory from the United States National Security Agency (NSA), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Federal Bureau of Investigation (FBI), the Australian Signals Directorate\u2019s Australian Cyber Security Centre (ACSC), the Communications Security Establishment\u2019s Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC-NZ), and the United Kingdom National Cyber Security Centre (NCSC-UK) (hereafter referred to as the \u201cauthoring agencies\u201d) provides an overview of hunting guidance and associated best practices to detect this activity.\nOne of the actor\u2019s primary tactics, techniques, and procedures (TTPs) is living off the land, which uses built-in network administration tools to perform their objectives. This TTP allows the actor to evade detection by blending in with normal Windows system and network activities, avoid endpoint detection and response (EDR) products that would alert on the introduction of third-party applications to the host, and\u00a0limit the amount of activity that is captured in default logging configurations. Some of the built-in tools this actor uses are: wmic, ntdsutil, netsh, and PowerShell. The advisory provides examples of the actor\u2019s commands along with detection signatures to aid network defenders in hunting for this activity. Many of the behavioral indicators included can also be legitimate system administration commands that appear in benign activity. Care should be taken not to assume that findings are malicious without further investigation or other indications of compromise.\nDownload the PDF version of this report (723 KB).\nDownload the Spanish version of this report (479.18 KB).\nFor a downloadable copy of IOCs, see\n\n\nPeople's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection\n(XML,       34.57 KB\n  )\n\n\n\n\nPeople's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection - Spanish\n(PDF,       479.18 KB\n  )\n\n\nFor a downloadable copy of IOCs in JSON format, see AA23-144A.stix.json.\nTechnical Details\nThis advisory uses the MITRE ATT&CK for Enterprise framework, version 13. See the Appendix: MITRE ATT&CK Techniques for all referenced tactics and techniques.\nBackground\nThe authoring agencies are aware of recent People\u2019s Republic of China (PRC) state-sponsored cyber activity and have identified potential indicators associated with these techniques. This advisory will help net defenders hunt for this activity on their systems. It provides many network and host artifacts associated with the activity occurring after the network has been initially compromised, with a focus on command lines used by the cyber actor. An Indicators of compromise (IOCs) summary is included at the end of this advisory.\nEspecially for living off the land techniques, it is possible that some command lines might appear on a system as the result of benign activity and would be false positive indicators of malicious activity. Defenders must evaluate matches to determine their significance, applying their knowledge of the system and baseline behavior. Additionally, if creating detection logic based on these commands, network defenders should account for variability in command string arguments, as items such as ports used may differ across environments.\nArtifacts\nNetwork Artifacts\nThe actor has leveraged compromised small office/home office (SOHO) network devices as intermediate infrastructure to obscure their activity by having much of the command and control (C2) traffic emanate from local ISPs in the geographic area of the victim. Owners of SOHO devices should ensure that network management interfaces are not exposed to the Internet to avoid them being re-purposed as redirectors by malicious actors. If they must be exposed to the Internet, device owners and operators should ensure they follow zero trust principles and maintain the highest level of authentication and access controls possible.\nThe actor has used Earthworm and a custom Fast Reverse Proxy (FRP) client with hardcoded C2 callbacks [T1090] to ports 8080, 8443, 8043, 8000, and 10443 with various filenames including, but not limited to: cisco_up.exe, cl64.exe, vm3dservice.exe, watchdogd.exe, Win.exe, WmiPreSV.exe, and WmiPrvSE.exe.\nHost Artifacts\nWindows Management Instrumentation (WMI/WMIC)\nThe actor has executed the following command to gather information about local drives [T1082]:\ncmd.exe /C \"wmic path win32_logicaldisk get caption,filesystem,freespace,size,volumename\"\nThis command does not require administrative credentials to return results. The command uses a command prompt [T1059.003] to execute a Windows Management Instrumentation Command Line (WMIC) query, collecting information about the storage devices on the local host, including drive letter, file system (e.g., new technology file system [NTFS]), free space and drive size in bytes, and an optional volume name. Windows Management Instrumentation (WMI) is a built-in Windows tool that allows a user to access management information from hosts in an enterprise environment. The command line version of WMI is called WMIC.\nBy default, WMI Tracing is not enabled, so the WMI commands being executed and the associated user might not be available. Additional information on WMI events and tracing can be found in the References section of the advisory.\nNtds.dit Active Directory Database\nThe actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive from Windows domain controllers (DCs) out of the network to perform password cracking [T1003.003]. (The ntds.dit file is the main Active Directory (AD) database file and, by default, is stored at %SystemRoot%\\NTDS\\ntds.dit. This file contains information about users, groups, group memberships, and password hashes for all users in the domain; the SYSTEM registry hive contains the boot key that is used to encrypt information in the ntds.dit file.) Although the ntds.dit file is locked while in use by AD, a copy can be made by creating a Volume Shadow Copy and extracting the ntds.dit file from the Shadow Copy. The SYSTEM registry hive may also be obtained from the Shadow Copy. The following example commands show the actor creating a Shadow Copy and then extracting a copy of the ntds.dit file from it.\ncmd /c vssadmin create shadow /for=C: > C:\\Windows\\Temp\\<filename>.tmp cmd /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy3\\Windows\\NTDS\\ntds.dit C:\\Windows\\Temp > C:\\Windows\\Temp\\<filename>.tmp\nThe built-in Ntdsutil.exe tool performs all these actions using a single command. There are several ways to execute Ntdsutil.exe, including running from an elevated command prompt (cmd.exe), using WMI/WMIC, or PowerShell. Defenders should look for the execution of Ntdsutil.exe commands using long, short, or a combination of the notations. For example, the long notation command activate instance ntds ifm can also be executed using the short notation ac i ntds i. Table 1 provides the long and short forms of the arguments used in the sample Ntdsutil.exe command, along with a brief description of the arguments.\n\nTable 1: Ntdsutil.exe command syntax\n\n\nLong form\nShort form\nDescription\n\n\n\n\nactivate instance %\nac i %\nSets variable % as the active instance for ntdsutil to use\n\n\nifm\ni\nInstall from media (ifm). Creates installation media to be used with DCPromo so the server will not need to copy data from another Domain Controller on the network\n\n\n\nThe actor has executed WMIC commands [T1047] to create a copy of the ntds.dit file and SYSTEM registry hive using ntdsutil.exe. Each of the following actor commands is a standalone example; multiple examples are provided to show how syntax and file paths may differ per environment.\nwmic process call create \"ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\pro\nwmic process call create \"cmd.exe /c ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\Pro\"\nwmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\"\n\"cmd.exe\" /c wmic process call create \"cmd.exe /c mkdir C:\\windows\\Temp\\McAfee_Logs & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\McAfee_Logs\\\"\ncmd.exe /Q /c wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\" 1> \\\\127.0.0.1\\ADMIN$\\ 2>&1\nNote: The <timestamp value> would be an epoch timestamp following the format like \u201c__1684956600.123456\u201d.\nEach actor command above creates a copy of the ntds.dit database and the SYSTEM and SECURITY registry hives in the C:\\Windows\\Temp\\<folder> directory, where <folder> is replaced with the path specified in the command (e.g., pro, tmp, or McAfee_Logs). By default, the hidden ADMIN$ share is mapped to C:\\Windows\\, so the last command will direct standard output and error messages from the command to a file within the folder specified.\nThe actor has also saved the files directly to the C:\\Windows\\Temp and C:\\Users\\Public directories, so the entirety of those directory structures should be analyzed. Ntdsutil.exe creates two subfolders in the directory specified in the command: an Active Directory folder that contains the ntds.dit and ntds.jfm files, and a registry folder that contains the SYSTEM and SECURITY hives. Defenders should look for this folder structure across their network:\n<path specified in command>\\Active Directory\\ntds.dit\n<path specified in command>\\Active Directory\\ntds.jfm\n<path specified in command>\\registry\\SECURITY\n<path specified in command>\\registry\\SYSTEM\nWhen one of the example commands is executed, several successive log entries are created in the Application log, under the ESENT Source. Associated events can be viewed in Windows Event Viewer by navigating to: Windows Logs | Application. To narrow results to relevant events, select Filter Current Log from the Actions menu on the right side of the screen. In the Event sources dropdown, check the box next to ESENT, then limit the logs to ID numbers 216, 325, 326, and 327. Clicking the OK box will apply the filters to the results.\nSince ESENT logging is used extensively throughout Windows, defenders should focus on events that reference ntds.dit. If such events are present, the events\u2019 details should contain the file path where the file copies were created. Since these files can be deleted, or enhanced logging may not be configured on hosts, the file path can greatly aid in a hunt operation. Identifying the user associated with this activity is also a critical step in a hunt operation as other actions by the compromised\u2014or actor-created\u2014user account can be helpful to understand additional actor TTPs, as well as the breadth of the actor's actions.\nNote: If an actor can exfiltrate the ntds.dit and SYSTEM registry hive, the entire domain should be considered compromised, as the actor will generally be able to crack the password hashes for domain user accounts, create their own accounts, and/or join unauthorized systems to the domain. If this occurs, defenders should follow guidance for removing malicious actors from victim networks, such as CISA's Eviction Guidance for Network Affected by the SolarWinds and Active Directory/M365 Compromise.\nIn addition to the above TTPs used by the actor to copy the ntds.dit file, the following tools could be used by an actor to obtain the same information:\n\nSecretsdump.py\n\nNote: This script is a component of Impacket, which the actor has been known to use\n\n\nInvoke-NinjaCopy (PowerShell)\nDSInternals (PowerShell)\nFgDump\nMetasploit\n\nBest practices for securing ntds.dit include hardening Domain Controllers and monitoring event logs for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.\nPortProxy\nThe actor has used the following commands to enable port forwarding [T1090] on the host:\n\"cmd.exe /c \"netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress= connectport=8443 protocol=tcp\"\"\n\"cmd.exe /c netsh interface portproxy add v4tov4 listenport=50100 listenaddress=0.0.0.0 connectport=1433 connectaddress=\"\nwhere <rfc1918 internal ip address> is replaced with an IPv4 address internal to the network, omitting the < >\u2019s.\nNetsh is a built-in Windows command line scripting utility that can display or modify the network settings of a host, including the Windows Firewall. The portproxy add command is used to create a host:port proxy that will forward incoming connections on the provided listenaddress and listenport to the connectaddress and connectport. Administrative privileges are required to execute the portproxy command. Each portproxy command above will create a registry key in the HKLM\\SYSTEM\\CurrentControlSet\\Services\\PortProxy\\v4tov4\\tcp\\ path. Defenders should look for the presences of keys in this path and investigate any anomalous entries.\nNote: Using port proxies is not common for legitimate system administration since they can constitute a backdoor into the network that bypasses firewall policies. Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required.\nDefenders should also use unusual IP addresses and ports in the command lines or registry entries to identify other hosts that are potentially included in actor actions. All hosts on the network should be examined for new and unusual firewall and port forwarding rules, as well as IP addresses and ports specified by the actor. If network traffic or logging is available, defenders should attempt to identify what traffic was forwarded though the port proxies to aid in the hunt operation. As previously mentioned, identifying the associated user account that made the networking changes can also aid in the hunt operation.\nFirewall rule additions and changes can be viewed in Windows Event Viewer by navigating to: Applications and Service Logs | Microsoft | Windows | Windows Firewall With Advanced Security | Firewall.\nIn addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts. The actor is known to target perimeter devices in their operations. Firewall logs should be reviewed for any connections to systems on the ports listed in any portproxy commands discovered.\nPowerShell\nThe actor has used the following PowerShell [T1059.001] command to identify successful logons to the host [T1033]:\nGet-EventLog security -instanceid 4624\nNote: Event ID 4624 is logged when a user successfully logs on to a host and contains useful information such as the logon type (e.g., interactive or networking), associated user and computer account names, and the logon time. Event ID 4624 entries can be viewed in Windows Event Viewer by navigating to: Windows Logs | Security. PowerShell logs can be viewed in Event Viewer: Applications and Service Logs | Windows PowerShell.\nThis command identifies what user account they are currently leveraging to access the network, identify other users logged on to the host, or identify how their actions are being logged. If the actor is using a password spray technique [T1110.003], there may be several failed logon (Event ID 4625) events for several different user accounts, followed by one or more successful logons (Event ID 4624) within a short period of time. This period may vary by actor but can range from a few seconds to a few minutes.\nIf the actor is using brute force password attempts [T1110] against a single user account, there may be several Event ID 4625 entries for that account, followed by a successful logon Event ID 4624. Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).\nImpacket\nThe actor regularly employs the use of Impacket\u2019s wmiexec, which redirects output to a file within the victim host's ADMIN$ share (C:\\Windows\\) containing an epoch timestamp in its name. The following is an example of the \"dir\" command being executed by wmiexec.py:\ncmd.exe /Q /c *dir 1> \\\\127.0.0.1\\ADMIN$\\__1684956600.123456 2>&1\nNote: Discovery of an entry similar to the example above in the Windows Event Log and/or a file with a name in a similar format may be evidence of malicious activity and should be investigated further. In the event that only a filename is discovered, the epoch timestamp within the filename reflects the time of execution by default and can be used to help scope threat hunting activities.\nEnumeration of the Environment\nThe following commands were used by the actor to enumerate the network topology [T1016], the active directory structure [T1069.002], and other information about the target environment [T1069.001], [T1082]:\narp -acurl www.ip-api[.]comdnscmd . /enumrecords /zone {REDACTED}dnscmd . /enumzonesdnscmd /enumrecords {REDACTED} . /additionalipconfig /allldifde.exe -f c:\\windows\\temp\\<filename>.txt -p subtreenet localgroup administratorsnet group /dom net group \"Domain Admins\" /domnetsh interface firewall show allnetsh interface portproxy show allnetsh interface portproxy show v4tov4netsh firewall show allnetsh portproxy show v4tov4netstat -anoreg query hklm\\software\\systeminfotasklist /vwhoamiwmic volume list briefwmic service briefwmic product list briefwmic baseboard list fullwevtutil qe security /rd:true /f:text /q:*[System[(EventID=4624) and TimeCreated[@SystemTime>='{REDACTED}']] and EventData[Data='{REDACTED}']]\nAdditional Credential Theft\nThe actor also used the following commands to identify additional opportunities for obtaining credentials in the environment [T1555], [T1003]:\ndir C:\\Users\\{REDACTED}\\.ssh\\known_hostsdir C:\\users\\{REDACTED}\\appdata\\roaming\\Mozilla\\firefox\\profilesmimikatz.exereg query hklm\\software\\OpenSSHreg query hklm\\software\\OpenSSH\\Agentreg query hklm\\software\\realvncreg query hklm\\software\\realvnc\\vncserverreg query hklm\\software\\realvnc\\Allusersreg query hklm\\software\\realvnc\\Allusers\\vncserverreg query hkcu\\software\\{REDACTED}\\putty\\sessionreg save hklm\\sam ss.datreg save hklm\\system sy.dat\nAdditional Commands\nThe actor executed the following additional commands:\n7z.exe a -p {REDACTED} c:\\windows\\temp\\{REDACTED}.7zC:\\Windows\\system32\\pcwrun.exeC:\\Users\\Administrator\\Desktop\\Win.exeC:\\Windows\\System32\\cmdbak.exe /c ping -n 1 127.0.0.1 > C:\\Windows\\temp\\putty.log C:\\Windows\\Temp\\tmp.log\"cmd.exe\" /c dir \\\\127.0.0.1\\C$ /od\"cmd.exe\" /c ping \u2013a \u2013n 1 <IP address>\"cmd.exe\" /c wmic /user:<username> /password:<password> process call create \"net stop \\\"<service name>\\\" > C:\\Windows\\Temp\\tmp.log\"cmd.exe /Q /c cd 1> \\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1net use \\\\127.0.0.1\\IPC$ /y /dpowershell start-process -filepath c:\\windows\\temp\\<filename>.bat -windowstyle Hiddenrar.exe a \u2013{REDACTED} c:\\Windows\\temp\\{REDACTED} D:\\{REDACTED}\\wmic /node:{REDACTED} /user:{REDACTED} /password:{REDACTED} cmd /c whoamixcopy C:\\windows\\temp\\hp d:\\{REDACTED}\nMitigations\nThe authoring agencies recommend organizations implement the mitigations below to improve your organization\u2019s cybersecurity posture on the basis of the threat actor\u2019s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity Frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA\u2019s Cross-Sector Cybersecurity Performance Goals for more information on the CPGs, including additional recommended baseline protections.\n\nDefenders should harden domain controllers and monitor event logs [2.T] for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.\nAdministrators should limit port proxy usage within environments and only enable them for the period of time in which they are required [2.X].\nDefenders should investigate unusual IP addresses and ports in command lines, registry entries, and firewall logs to identify other hosts that are potentially involved in actor actions.\nIn addition to host-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts.\nDefenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time-and-distance logons (e.g., a user logging on from two geographically separated locations at the same time).\nDefenders should forward log files to a hardened centralized logging server, preferably on a segmented network [2.F].\n\nLogging Recommendations\nTo be able to detect the activity described in this CSA, defenders should set the audit policy for Windows security logs to include \u201caudit process creation\u201d and \u201cinclude command line in process creation events\u201d in addition to accessing the logs. Otherwise, the default logging configurations may not contain the necessary information.\nEnabling these options will create Event ID 4688 entries in the Windows Security log to view command line processes. Given the cost and difficulty of logging and analyzing this kind of activity, if an organization must limit the requirements, they should focus on enabling this kind of logging on systems that are externally facing or perform authentication or authorization, especially including domain controllers.\nTo hunt for the malicious WMI and PowerShell activity, defenders should also log WMI and PowerShell events. By default, WMI Tracing and deep PowerShell logging are not enabled, but they can be enabled by following the configuration instructions linked in the References section.\nThe actor takes measures to hide their tracks, such as clearing logs [T1070.001]. To ensure log integrity and availability, defenders should forward log files to a hardened centralized logging server, preferably on a segmented network. Such an architecture makes it harder for an actor to cover their tracks as evidence of their actions will be captured in multiple locations.\nDefenders should also monitor logs for Event ID 1102, which is generated when the audit log is cleared. All Event ID 1102 entries should be investigated as logs are generally not cleared and this is a known actor tactic to cover their tracks. Even if an event log is cleared on a host, if the logs are also stored on a logging server, the copy of the log will be preserved.\nThis activity is often linked to malicious exploitation of edge devices and network management devices. Defenders should enable logging on their edge devices, to include system logs, to be able to identify potential exploitation and lateral movement. They should also enable network-level logging, such as sysmon, webserver, middleware, and network device logs.\nIndicators of Compromise (IOCs) Summary\nIndicators of Compromise (IOCs) Summary\nTTPs\n\nExploiting vulnerabilities [T1190] in widely used software including, but not limited to:\n\nCVE-2021-40539\u2014ManageEngine ADSelfService Plus.\n\nAPT Actors Exploiting Newly Identified Vulnerability in ManageEngine ADSelfService Plus.\n\n\nCVE-2021-27860\u2014FatPipe WARP, IPVPN, MPVPN.\n\nAn APT Group Exploiting a 0-day in FatPipe WARP,MPVPN, and IPVPN Software.\n\n\n\n\nUsing webshells for persistence and exfiltration [T1505.003], with at least some of the webshells derived from the Awen webshell.\nUsing compromised Small-Office Home-Office (SOHO) devices (e.g. routers) to obfuscate the source of the activity [T1090.002].\n\nMost common types include ASUS, Cisco RV, Draytek Vigor, FatPipe IPVPN/MPVPN/WARP, Fortinet Fortigate, Netgear Prosafe, and Zyxel USG devices.\nCommon CVEs for these devices and mitigation guidance can be found in the joint Cybersecurity Advisory, Top CVEs Actively Exploited by People\u2019s Republic of China State-Sponsored Cyber Actors.\n\n\nUsing living off the land tools for discovery, lateral movement, and collection activities, to include:\n\ncertutil\ndnscmd\nldifde\nmakecab\nnet user/group/use\nnetsh\nnltest\nntdsutil\nPowerShell\nreq query/save\nsysteminfo\ntasklist\nwevtutil\nwmic\nxcopy\n\n\nSelective clearing of Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity [T1070].\nUsing open source \u201chacktools\u201d tools, such as:\n\nFast Reverse Proxy (frp)\n\nProbably derived from the publicly-available fatedier and EarthWorm variants.\n\n\nImpacket\n\nTo detect Impacket usage, see the joint Cybersecurity Advisory: Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.\n\n\nMimikatz.exe\nRemote administration tools\n\nDefenders should consult the joint Cybersecurity Advisory: Protecting Against Malicious Use of Remote Monitoring and Management Software.\n\n\n\n\n\nCommand Execution\nFile names and directory paths used in these commands are only meant to serve as examples. Actual names and paths may differ depending on environment and activity, so defenders should account for variants when performing queries.\nNote: Many of the commands are derivatives of common system administration commands that could generate false positives when used alone without additional indicators.\n7z.exe a -p {REDACTED} c:\\windows\\temp\\{REDACTED}.7z c:\\windows\\temp\\*\"C:\\pstools\\psexec.exe\" \\\\{REDACTED} -s cmd /c \"cmd.exe /c \"netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999\"\"C:\\Windows\\system32\\pcwrun.exe C:\\Users\\Administrator\\Desktop\\Win.execmd.exe /C dir /S \\\\{REDACTED}\\c$\\Users\\{REDACTED} >> c:\\windows\\temp\\{REDACTED}.tmp\"cmd.exe\" /c wmic process call create \"cmd.exe /c mkdir C:\\windows\\Temp\\McAfee_Logs & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\McAfee_Logs\\\"cmd.exe /Q /c *cd 1> \\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1cmd.exe /Q /c cd 1> \\\\127.0.0.1\\ADMIN$\\__1652470932.9400265 2>&1cmd.exe /Q /c net group \"domain admins\" /dom 1>\\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1 cmd.exe /Q /c wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\" \u00a01> \\\\127.0.0.1\\ADMIN$\\<timestamp value> \u00a02>&1D:\\{REDACTED}\\xcopy C:\\windows\\temp\\hp d:\\{REDACTED} Get-EventLog security -instanceid 4624ldifde.exe -f c:\\windows\\temp\\cisco_up.txt -p subtreemakecab ..\\backup\\210829-020000.zip ..\\webapps\\adssp\\html\\Lock.licmove \"\\\\<redacted>\\c$\\users\\public\\Appfile\\registry\\SYSTEM\" ..\\backup\\210829-020000.zipnetsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress={REDACTED} connectport=8443 protocol=tcpnetsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999Rar.exe a \u2013{REDACTED} c:\\Windows\\temp\\DMBC2C61.tmpstart-process -filepath c:\\windows\\temp\\<filename>.bat -windowstyle hidden 1\nNote: The batch file in question (<filename>.bat) could use any name, and no discernable pattern has been determined at this time.\nwmic process call create \"cmd.exe /c mkdir C:\\users\\public\\Appfile & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\users\\public\\Appfile\\\" q qwmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\"wmic process call create \"cmd.exe /c ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\Pro\"wmic process call create \"ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\\"\nCommand Line Patterns\nCertain patterns in commands (with asterisks for wildcards) can be used to identify potentially malicious commands:\n\ncmd.exe /C dir /S \\\\* >> *\ncmd.exe /Q /c * 1> \\\\127.0.0.1\\ADMIN$\\__*.*>&1\npowershell start-process -filepath c:\\windows\\temp\\*.exe -windowstyle hidden\n\nFile Paths\nThe most common paths where files and executables used by the actor have been found include:\n\nC:\\Users\\Public\\Appfile (including subdirectories)\nC:\\Perflogs (including subdirectories)\nC:\\Windows\\Temp (including subdirectories)\n\nFile Names\nThe file names the actor has previously used for such things as malware, scripts, and tools include:\n\n\n\nbackup.bat\ncl64.exe\nupdate.bat\nWin.exe\n\n\nbillagent.exe\nnc.exe\nupdate.exe\nWmiPrvSE.exe\n\n\nbillaudit.exe\nrar.exe\nvm3dservice.exe\nWmiPreSV.exe\n\n\ncisco_up.exe\nSMSvcService.exe\nwatchdogd.exe\n\u00a0\n\n\n\nIn addition to the file names and paths above, malicious files names, believed to be randomly created, in the following format have also been discovered: C:\\Windows\\[a-zA-Z]{8}.exe\nSHA-256 File Hashes\n\nf4dd44bc19c19056794d29151a5b1bb76afd502388622e24c863a8494af147dd\nef09b8ff86c276e9b475a6ae6b54f08ed77e09e169f7fc0872eb1d427ee27d31\nd6ebde42457fe4b2a927ce53fc36f465f0000da931cfab9b79a36083e914ceca\n472ccfb865c81704562ea95870f60c08ef00bcd2ca1d7f09352398c05be5d05d\n66a19f7d2547a8a85cee7a62d0b6114fd31afdee090bd43f36b89470238393d7\n3c2fe308c0a563e06263bbacf793bbe9b2259d795fcc36b953793a7e499e7f71\n41e5181b9553bbe33d91ee204fe1d2ca321ac123f9147bb475c0ed32f9488597\nc7fee7a3ffaf0732f42d89c4399cbff219459ae04a81fc6eff7050d53bd69b99\n3a9d8bb85fbcfe92bae79d5ab18e4bca9eaf36cea70086e8d1ab85336c83945f\nfe95a382b4f879830e2666473d662a24b34fccf34b6b3505ee1b62b32adafa15\nee8df354503a56c62719656fae71b3502acf9f87951c55ffd955feec90a11484\n\nUser-agent\nIn some cases, the following user-agent string (including the extra spacing) was identified performing reconnaissance activities by this actor:\nMozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Gecko/20100101 Firefox/68.0\nNote: The spacing between \u201c)\u201d and \u201cGecko\u201d is 3 tabs followed by 4 spaces.\nYara rules\n\n\n\nrule ShellJSP {strings:$s1 = \"decrypt(fpath)\"$s2 = \"decrypt(fcontext)\"$s3 = \"decrypt(commandEnc)\"$s4 = \"upload failed!\"$s5 = \"aes.encrypt(allStr)\"$s6 = \"newid\"condition:filesize < 50KB and 4 of them}\n\n\n\n\n\n\nrule EncryptJSP {strings:$s1 = \"AEScrypt\"$s2 = \"AES/CBC/PKCS5Padding\"$s3 = \"SecretKeySpec\"$s4 = \"FileOutputStream\"$s5 = \"getParameter\"$s6 = \"new ProcessBuilder\"$s7 = \"new BufferedReader\"$s8 = \"readLine()\"condition:filesize < 50KB and 6 of them}\n\n\n\n\n\n\nrule CustomFRPClient {meta:description=\u201dIdentify instances of the actor's custom FRP tool basedon unique strings chosen by the actor and included in the tool\u201dstrings:$s1 = \"%!PS-Adobe-\" nocase ascii wide$s2 = \"github.com/fatedier/frp/cmd/frpc\" nocase ascii wide$s3 = \"github.com/fatedier/frp/cmd/frpc/sub.startService\" nocaseascii wide$s4 = \"MAGA2024!!!\" nocase ascii wide$s5 = \"HTTP_PROXYHost: %s\" nocase ascii widecondition:all of them}\n\n\n\n\n\n\nrule HACKTOOL_FRPClient {meta:description=\u201dIdentify instances of FRP tool (Note: This tool isknown to be used by multiple actors, so hits would not necessarily implyactivity by the specific actor described in this report)\u201dstrings:$s1 = \"%!PS-Adobe-\" nocase ascii wide$s2 = \"github.com/fatedier/frp/cmd/frpc\" nocase ascii wide$s3 = \"github.com/fatedier/frp/cmd/frpc/sub.startService\" nocaseascii wide$s4 = \"HTTP_PROXYHost: %s\" nocase ascii widecondition:3 of them}\n\n\n\nReferences\nActive Directory and domain controller hardening:\n\nBest practices: Best Practices for Securing Active Directory | Microsoft Learn.\n\nCISA regional cyber threats:\n\nPRC state-sponsored activity: China Cyber Threat Overview and Advisories.\n\nMicrosoft Threat Intelligence blog:\n\nVolt Typhoon activity: Volt Typhoon targets US critical infrastructure with living-off-the-land techniques | Microsoft Security Blog.\n\nNtdsutil.exe:\n\nOverview: Ntdsutil | Microsoft Learn.\n\nPowerShell:\n\nBest practices: Keeping PowerShell: Security Measures to Use and Embrace.\nLogging configuration: Greater Visibility Through PowerShell Logging | Mandiant | Google Cloud Blog.\n\nWindows command line process auditing:\n\nOverview: Command line process auditing | Microsoft Learn.\n\nWindows Defender Firewall:\n\nBest practices: Configure firewall rules with group policy - Windows Security | Microsoft Learn.\nLogging configuration: Configure Windows Firewall logging - Windows Security | Microsoft Learn.\n\nWindows management instrumentation:\n\nEvents: Tracing WMI Activity - Win32 apps | Microsoft Learn.\nTracing activity: Tracing WMI Activity - Win32 apps | Microsoft Learn\n\nWindows password spraying:\n\nLogging and playbook configuration: Password spray investigation | Microsoft Learn.\n\nAcknowledgements\nThe NSA Cybersecurity Collaboration Center, along with the authoring agencies, acknowledge Amazon Web Services (AWS) Security, Broadcom, Cisco Talos, Google's Threat Analysis Group, Lumen Technologies, Mandiant, Microsoft Threat Intelligence (MSTI), Palo Alto Networks, SecureWorks, SentinelOne, Trellix, and additional industry partners for their collaboration on this advisory.\nDisclaimer of Endorsement\nThe information and opinions contained in this document are provided \"as is\" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise does not constitute or imply its endorsement, recommendation, or favoring by the authoring agencies' governments, and this guidance shall not be used for advertising or product endorsement purposes.\nTrademark Recognition\nActive Directory\u00ae, Microsoft\u00ae, PowerShell\u00ae, and Windows\u00ae are registered trademarks of Microsoft Corporation.\u00a0MITRE\u00ae and ATT&CK\u00ae are registered trademarks of The MITRE Corporation.\nPurpose\nThis document was developed in furtherance of the authoring agencies\u2019 cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.\nContact\nU.S. organizations: Urgently report any anomalous activity or incidents, including based upon technical information associated with this Cybersecurity Advisory, to CISA at Report@cisa.dhs.gov or cisa.gov/report or to the FBI via your local FBI field office listed at https://www.fbi.gov/contact-us/field-offices. \u00a0\nNSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov\nNSA Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov\nNSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov\nAustralian organizations: Visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and to access alerts and advisories.\nCanadian organizations: Report incidents by emailing CCCS at contact@cyber.gc.ca.\nNew Zealand organizations: Report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.\nUnited Kingdom organizations: Report a significant cyber security incident at ncsc.gov.uk/report-an-incident (monitored 24 hours) or, for urgent assistance, call 03000 200 973.\nAppendix: MITRE ATT&CK Techniques\nThe below tables capture all referenced threat actor tactics and techniques in this advisory.\n\n\n\nInitial Access\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nExploit Public-facing Application\nT1190\nActor used public-facing applications to gain initial access to systems; in this case, Earthworm and PortProxy.\n\n\n\n\n\n\nExecution\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nWindows Management Instrumentation\nT1047\nThe actor executed WMIC commands to create a copy of the SYSTEM registry.\n\n\nCommand and Scripting Interpreter: PowerShell\nT1059.001\nThe actor used a PowerShell command to identify successful logons to the host.\n\n\nCommand and Scripting Interpreter: Windows Command Shell\nT1059.003\nThe actor used this primary command prompt to execute a query that collected information about the storage devices on the local host.\n\n\n\n\n\n\nPersistence\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nServer Software Component: Web Shell\nT1505.003\nThe actor used backdoor web servers with web shells to establish persistence to systems, including some of the webshells being derived from Awen webshell.\n\n\n\n\n\n\nDefense Evasion\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nIndicator Removal\nT1070\nThe actor selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity.\n\n\nIndicator Removal: Clear Windows Event Logs\nT1070.001\nThe actor cleared system event logs to hide activity of an intrusion.\n\n\n\n\n\n\nCredential Access\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nOS Credential Dumping: NTDS\nT1003.003\nThe actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive out of the network to perform password cracking.\n\n\nBrute Force\nT1110\nThe actor attempted to gain access to accounts with multiple password attempts.\n\n\nBrute Force: Password Spraying\nT1110.003\nThe actor used commonly used passwords against accounts to attempt to acquire valid credentials.\n\n\nOS Credential Dumping\nT1003\nThe actor used additional commands to obtain credentials in the environment.\n\n\nCredentials from Password Stores\nT1555\nThe actors searched for common password storage locations.\n\n\n\n\n\n\nDiscovery\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nSystem Information Discovery\nT1082\nThe actors executed commands to gather information about local drives.\n\n\nSystem Owner/User Discovery\nT1033\nThe actors gathered information about successful logons to the host using a PowerShell command.\n\n\nPermission Groups Discovery: Local Groups\nT1069.001\nThe actors attempt to find local system groups and permission settings.\n\n\nPermission Groups Discovery: Doman Groups\nT1069.002\nThe actors used commands to enumerate the active directory structure.\n\n\nSystem Network Configuration Discovery\nT1016\nThe actors used commands to enumerate the network topology.\n\n\n\n\n\n\nCommand and Control\n\u00a0\n\u00a0\n\n\nTechnique Title\nID\nUse\n\n\n\n\nProxy\nT1090\nThe actors used commands to enable port forwarding on the host.\n\n\nProxy: External Proxy\nT1090.002\nThe actors used compromised SOHO devices (e.g. routers) to obfuscate the source of their activity.\n\n\n\n\u00a0\n\u00a0\n",
  "cves": [
    "CVE-2021-40539",
    "CVE-2021-27860"
  ],
  "techniques": [
    "T1546",
    "T1033",
    "T1505",
    "T1505.003",
    "T1016",
    "T1059.001",
    "T1090.002",
    "T1110",
    "T1069.001",
    "T1110.003",
    "T1059",
    "T1069.002",
    "T1003",
    "T1070.001",
    "T1082",
    "T1090",
    "T1047",
    "T1190",
    "T1070",
    "T1003.003",
    "T1059.003",
    "T1069",
    "T1555"
  ],
  "advisory": "aa23-144a",
  "title": "People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection | CISA",
  "source": "cybersecurity-advisories",
  "id": "cdddfe8fca6de57b23a63e66436bf6d885452c5cdec6f746e00d58a561337cd5"
}