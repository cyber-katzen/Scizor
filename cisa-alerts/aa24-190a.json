{
  "markdown": " People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action \\| CISA A A ( Lock ) or[\\#protect2024](/protect2024)  Search Menu Close[Faith\\-Based Community](/audiences/faith-based-community) [High\\-Risk Communities](/audiences/high-risk-communities)* Resources \\& Tools[Resources \\& Tools](/resources-tools) [All Resources \\& Tools](/resources-tools/all-resources-tools)* News \\& Events[News \\& Events](/news-events) [Cybersecurity Alerts \\& Advisories](/news-events/cybersecurity-advisories)[Benefits \\& Perks](/careers/benefits-perks)[Resume \\& Application Tips](/careers/resume-application-tips)[Students \\& Recent Graduates](/students-recent-graduates-employment-opportunities)[Divisions \\& Offices](/about/divisions-offices)[\\#protect2024](/protect2024) 2. [News \\& Events](/news-events)4. [Cybersecurity Advisory](/news-events/cybersecurity-advisories?f%5B0%5D=advisory_type%3A94) Cybersecurity AdvisoryPeople\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action====================================================================================== Release Date July 08, 2024 Alert Code AA24\\-190A Related topics: , [Nation\\-State Cyber Actors](/topics/cyber-threats-and-advisories/nation-state-cyber-actors)  , [Organizations and Cyber Safety](/topics/cybersecurity-best-practices/organizations-and-cyber-safety) **Overview**------------### Background This advisory, authored by the Australian Signals Directorate\u2019s Australian Cyber Security Centre (ASD\u2019s ACSC), the United States Cybersecurity and Infrastructure Security Agency (CISA), the United States National Security Agency (NSA), the United States Federal Bureau of Investigation (FBI), the United Kingdom National Cyber Security Centre (NCSC\\-UK), the Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC\\-NZ), the German Federal Intelligence Service (BND) and Federal Office for the Protection of the Constitution (BfV), the Republic of Korea\u2019s National Intelligence Service (NIS) and NIS\u2019 National Cyber Security Center, and Japan\u2019s National Center of Incident Readiness and Strategy for Cybersecurity (NISC) and National Police Agency (NPA)\u2014hereafter referred to as the \u201cauthoring agencies\u201d\u2014outlines a People\u2019s Republic of China (PRC) state\\-sponsored cyber group and their current threat to Australian networks. The advisory draws on the authoring agencies\u2019 shared understanding of the threat as well as ASD\u2019s ACSC incident response investigations. The PRC state\\-sponsored cyber group has previously targeted organizations in various countries, including Australia and the United States, and the techniques highlighted below are regularly used by other PRC state\\-sponsored actors globally. Therefore, the authoring agencies believe the group, and similar techniques remain a threat to their countries\u2019 networks as well. The authoring agencies assess that this group conduct malicious cyber operations for the PRC Ministry of State Security (MSS). The activity and techniques overlap with the groups tracked as Advanced Persistent Threat (APT) 40 (also known as Kryptonite Panda, GINGHAM TYPHOON, Leviathan and Bronze Mohawk in industry reporting). This group has previously been reported as being based in Haikou, Hainan Province, PRC and receiving tasking from the PRC MSS, Hainan State Security Department.\\[1] The following Advisory provides a sample of significant case studies of this adversary\u2019s techniques in action against two victim networks. The case studies are consequential for cybersecurity practitioners to identify, prevent and remediate APT40 intrusions against their own networks. The selected case studies are those where appropriate remediation has been undertaken reducing the risk of re\\-exploitation by this threat actor, or others. As such, the case studies are naturally older in nature, to ensure organizations were given the necessary time to remediate. To download the PDF version of this report, visit the following link, [APT40 Advisory](https://www.cyber.gov.au/about-us/view-all-content/alerts-and-advisories/apt40-advisory-prc-mss-tradecraft-in-action)  .### Activity Summary APT40 has repeatedly targeted Australian networks as well as government and private sector networks in the region, and the threat they pose to our networks is ongoing. The tradecraft described in this advisory is regularly observed against Australian networks. Notably, APT40 possesses the capability to rapidly transform and adapt exploit proof\\-of\\-concept(s) (POCs) of new vulnerabilities and immediately utilize them against target networks possessing the infrastructure of the associated vulnerability. APT40 regularly conducts reconnaissance against networks of interest, including networks in the authoring agencies\u2019 countries, looking for opportunities to compromise its targets. This regular reconnaissance postures the group to identify vulnerable, end\\-of\\-life or no longer maintained devices on networks of interest, and to rapidly deploy exploits. APT40 continues to find success exploiting vulnerabilities from as early as 2017\\. APT40 rapidly exploits newly public vulnerabilities in widely used software such as Log4J ( [CVE\\-2021\\-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228 \"CVE-2021-44228\")  ), Atlassian Confluence ( [CVE\\-2021\\-31207](https://nvd.nist.gov/vuln/detail/CVE-2021-31207 \"CVE-2021-31207\")  , [CVE\\-2021\\-26084](https://nvd.nist.gov/vuln/detail/CVE-2021-26084 \"CVE-2021-26084\")  ) and Microsoft Exchange ( [CVE\\-2021\\-31207](https://nvd.nist.gov/vuln/detail/CVE-2021-31207 \"CVE-2021-31207\")  , [CVE\\-2021\\-34523](https://nvd.nist.gov/vuln/detail/CVE-2021-34523 \"CVE-2021-34523\")  , [CVE\\-2021\\-34473](https://nvd.nist.gov/vuln/detail/CVE-2021-34473 \"CVE-2021-34473\")  ). ASD\u2019s ACSC and the authoring agencies expect the group to continue using POCs for new high\\-profile vulnerabilities within hours or days of public release.![Figure 1: TTP Flowchart for APT40 Activity](/sites/default/files/styles/large/public/2024-07/AA24-190A-apt40-figure-1_0.png?itok=a7YAYqy0) Figure 1: TTP Flowchart for APT40 activity This group appears to prefer exploiting vulnerable, public\\-facing infrastructure over techniques that require user interaction, such as phishing campaigns, and places a high priority on obtaining valid credentials to enable a range of follow\\-on activities. APT40 regularly uses web shells \\[ [T1505\\.003](https://attack.mitre.org/techniques/T1505/003/ \"Server Software Component: Web Shell\")  ] for persistence, particularly early in the life cycle of an intrusion. Typically, after successful initial access APT40 focuses on establishing persistence to maintain access on the victim\u2019s environment. However, as persistence occurs early in an intrusion, it is more likely to be observed in all intrusions\u2014regardless of the extent of compromise or further actions taken.### Notable Tradecraft Although APT40 has previously used compromised Australian websites as command and control (C2\\) hosts for its operations, the group have evolved this technique \\[ [T1594](https://attack.mitre.org/techniques/T1594/ \"Search Victim-Owned Websites\")  ]. APT40 has embraced the global trend of using compromised devices, including small\\-office/home\\-office (SOHO) devices, as operational infrastructure and last\\-hop redirectors \\[ [T1584\\.008](https://attack.mitre.org/techniques/T1584/008/ \"Compromise Infrastructure: Network Devices\")  ] for its operations in Australia. This has enabled the authoring agencies to better characterize and track this group\u2019s movements. Many of these SOHO devices are end\\-of\\-life or unpatched and offer a soft target for N\\-day exploitation. Once compromised, SOHO devices offer a launching point for attacks that is designed to blend in with legitimate traffic and challenge network defenders \\[ [T1001\\.003](https://attack.mitre.org/techniques/T1001/003/ \"Data Obfuscation: Protocol Impersonation\")  ]. This technique is also regularly used by other PRC state\\-sponsored actors worldwide, and the authoring agencies consider this to be a shared threat. For additional information, see joint advisories [People\u2019s Republic of China State\\-Sponsored Cyber Actors Exploit Network Providers and Devices](https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-158a \"People\u2019s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices\")  and [PRC State\\-Sponsored Actors Compromise and Maintain Persistent Access to U.S. Critical Infrastructure](https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-038a \"PRC State-Sponsored Actors Compromise and Maintain Persistent Access to U.S. Critical Infrastructure\")  . APT40 does occasionally use procured or leased infrastructure as victim\\-facing C2 infrastructure in its operations; however, this tradecraft appears to be in relative decline.### Tooling ASD\u2019s ACSC are sharing some of the malicious files identified during the investigations outlined below. These files have been uploaded to VirusTotal to enable the wider network defense and cyber security communities to better understand the threats they need to defend against.| MD5 | Filename | Additional information || --- | --- | --- || 26a5a7e71a601be991073c78d513dee3 | [horizon.jsp](https://www.virustotal.com/gui/file/44369783a819a38909e89449495fb98c3f9ba07dd0d2fa55a24a560a89f21a86/details \"horizon.jsp\") | 1 kB \\| Java Source || 87c88f06a7464db2534bc78ec2b915de | [Index\\_jsp$ProxyEndpoint$Attach.class](https://www.virustotal.com/gui/file/b1cca678dbd6bd51e6e8e797b95dc3050a74f5fa8147603473d6229023f1eb1a/details \"Index_jsp$ProxyEndpoint$Attach.class\") | 597 B \\| Java Bytecode || 6a9bc68c9bc5cefaf1880ae6ffb1d0ca | [Index\\_jsp.class](https://www.virustotal.com/gui/file/71f6b36bfddda2d3a506574991a44636f84df28f9350e7856d1cc8af07cdd821/details \"Index_jsp.class\") | 5 kB \\| Java Bytecode || 64454645a9a21510226ab29e01e76d39 | [Index\\_jsp.java](https://www.virustotal.com/gui/file/97daa26c59e0e151f66872147ccd30dd1815bc6e63ec40c288130c6e8a6ea992/details \"Index_jsp.java\") | 5 kB \\| Java Source || e2175f91ce3da2e8d46b0639e941e13f | [Index\\_jsp$ProxyEndpoint.class](https://www.virustotal.com/gui/file/1a2282cc4c13bd24b2ca20c494cacbd283fbdcc4864d9cde26ea55db800f4dda/details \"Index_jsp$ProxyEndpoint.class\") | 4 kB \\| Java Bytecode || 9f89f069466b8b5c9bf25c9374a4daf8 | [Index\\_jsp$ProxyEndpoint$1\\.class](https://www.virustotal.com/gui/file/0e3324587a07df499e97b58076a94e86bf5598cc6d9606c2dcee3941175ff043/details \"Index_jsp$ProxyEndpoint$1.class\") | 3 kB \\| Java Bytecode || 187d6f2ed2c80f805461d9119a5878ac | [Index\\_jsp$ProxyEndpoint$2\\.class](https://www.virustotal.com/gui/file/2aad0f8b439c3824d51871a0744c0e2f578277e0ec73effe5a24c49d8048bc74/details \"Index_jsp$ProxyEndpoint$2.class\") | 1 kB \\| Java Bytecode || ed7178cec90ed21644e669378b3a97ec | [Nova\\_jsp.class](https://www.virustotal.com/gui/file/882f39945974aa5fc6005bf646ee3ab21bf69de12985d6ad8cc497dbfe520728/details \"Nova_jsp.class\") | 7 kB \\| Java Bytecode || 5bf7560d0a638e34035f85cd3788e258 | [Nova\\_jsp$TomcatListenerMemShellFromThread.class](https://www.virustotal.com/gui/file/b271e74ed44c3c405da858f29b6dfd4a99658dcac7bc83938079ad0dbbdf1b66/details \"Nova_jsp$TomcatListenerMemShellFromThread.class\") | 8 kB \\| Java Bytecode || e02be0dc614523ddd7a28c9e9d500cff | [Nova\\_jsp.java](https://www.virustotal.com/gui/file/7c7acd87b47d405da4d6efa2c43599148e12c094970ba198905f0a165d79a78f/details \"Nova_jsp.java\") | 15 kB \\| Java Source |### Case Studies ASD\u2019s ACSC are sharing two anonymized investigative reports to provide awareness of how the actors employ their tools and tradecraft.**Case Study 1**----------------##### This report has been anonymized to enable wider dissemination. The impacted organization is hereafter referred to as \u201cthe organization.\u201d Some specific details have been removed to protect the identity of the victim and incident response methods of ASD\u2019s ACSC.### Executive Summary This report details the findings of the ASD\u2019s ACSC investigation into the successful compromise of the organization\u2019s network between July and September 2022\\. This investigative report was provided to the organization to summarize observed malicious activity and frame remediation recommendations. The findings indicate the compromise was undertaken by APT40\\. In mid\\-August, the ASD\u2019s ACSC notified the organization of malicious interactions with their network from a likely compromised device being used by the group in late August and, with the organization\u2019s consent, the ASD\u2019s ACSC deployed host\\-based sensors to likely affected hosts on the organization\u2019s network. These sensors allowed ASD\u2019s ACSC incident response analysts to undertake a thorough digital forensics investigation. Using available sensor data, the ASD\u2019s ACSC analysts successfully mapped the group\u2019s activity and created a detailed timeline of observed events. From July to August, key actor activity observed by the ASD\u2019s ACSC included:* Host enumeration, which enables an actor to build their own map of the network;* Web shell use, giving the actor an initial foothold on the network and a capability to execute commands; and* Deployment of other tooling leveraged by the actor for malicious purposes. The investigation uncovered evidence of large amounts of sensitive data being accessed and evidence that the actors moved laterally through the network \\[ [T1021\\.002](https://attack.mitre.org/techniques/T1021/002/ \"Remote Services: SMB/Windows Admin Shares\")  ]. Much of the compromise was facilitated by the group\u2019s establishment of multiple access vectors into the network, the network having a flat structure, and the use of insecure internally developed software that could be used to arbitrarily upload files. Exfiltrated data included privileged authentication credentials that enabled the group to log in, as well as network information that would allow the actors to regain unauthorized access if the original access vector was blocked. No additional malicious tooling was discovered beyond those on the initially exploited machine; however, a group\u2019s access to legitimate and privileged credentials would negate the need for additional tooling. Findings from the investigation indicate the organization was likely deliberately targeted by APT40, as opposed to falling victim opportunistically to a publicly known vulnerability.**Investigation Findings**-------------------------- In mid\\-August 2022, the ASD\u2019s ACSC notified the organization that a confirmed malicious IP believed to be affiliated with a state\\-sponsored cyber group had interacted with the organization\u2019s computer networks between at least July and August. The compromised device probably belonged to a small business or home user. In late August, the ASD\u2019s ACSC deployed a host\\-based agent to hosts on the organization\u2019s network which showed evidence of having been impacted by the compromise. Some artefacts which could have supported investigation efforts were not available due to the configuration of logging or network design. Despite this, the organization\u2019s readiness to provide all available data enabled ASD\u2019s ACSC incident responders to conduct comprehensive analysis and to form an understanding of likely APT40 activity on the network. In September, after consultation with the ASD\u2019s ACSC, the organization decided to denylist the IP identified in the initial notification. In October, the organization commenced remediation.### Details Beginning in July, actors were able to test and exploit a custom web application \\[ [T1190](https://attack.mitre.org/techniques/T1190/ \"Exploit Public-Facing Application\")  ] running on `<webapp>2-ext`  , which enables the group to establish a foothold in the network demilitarized zone (DMZ). This was leveraged to enumerate both the network as well as all visible domains. Compromised credentials \\[ [T1078\\.002](https://attack.mitre.org/techniques/T1078/002/ \"Valid Accounts: Domain Accounts\")  ] were used to query the Active Directory \\[ [T1018](https://attack.mitre.org/techniques/T1018/ \"Remote System Discovery\")  ] and exfiltrate data by mounting file shares \\[ [T1039](https://attack.mitre.org/techniques/T1039/ \"Data from Network Shared Drive\")  ] from multiple machines within the DMZ. The actor carried out a Kerberoasting attack in order to obtain valid network credentials from a server \\[ [T1558\\.003](https://attack.mitre.org/techniques/T1558/003/ \"Steal or Forge Kerberos Tickets: Kerberoasting\")  ]. The group were not observed gaining any additional points of presence in either the DMZ or the internal network.### Visual Timeline The below timeline provides a broad overview of the key phases of malicious actor activity observed on the organization\u2019s network.![Figure 2: APT40 Advisory Visual Timeline](/sites/default/files/styles/large/public/2024-07/AA24-190A-apt40-advisory-visual-timeline-figure2.png?itok=lfBPL26D)### Detailed Timeline**July:**  The actors established an initial connection to the front page of a custom web application \\[ [T1190](https://attack.mitre.org/techniques/T1190/ \"Exploit Public-Facing Application\")  ] built for the organization (hereafter referred to as the \u201cweb application\u201d or \u201c `webapp` \u201d) via a transport layer security (TLS) connection \\[ [T1102](https://attack.mitre.org/techniques/T1102/ \"Web Service\")  ]. No other noteworthy activity was observed.**July:**  The actors begin enumerating the web application\u2019s website looking for endpoints\\[2] to further investigate.**July:**  The actors concentrate on attempts to exploit a specific endpoint.**July:**  The actors are able to successfully\u00a0POST\u00a0to the web server, probably via a web shell placed on another page. A second IP, likely employed by the same actors, also begins posting to the same URL. The actors created and tested a number of likely web shells. The exact method of exploitation is unknown, but it is clear that the specific endpoint was targeted to create files on `<webapp>2 -ext`  . ASD's ACSC believes that the two IP address connections were part of the same intrusion due to their shared interest and initial connections occurring minutes apart.**July:**  The group continue to conduct host enumeration, looking for privilege escalation opportunities, and deploying a different web shell. The actors log into the web application using compromised credentials for `<firstname.surname> @ <organisation domain>` . The actors\u2019 activity does not appear to have successfully achieved privilege escalation on `<webapp>2 -ext`  . Instead, the actors pivoted to network\\-based activity.**July:**  The actor tests the compromised credentials for a service account\\[3] which it likely found hardcoded in internally accessible binaries.**July:**  The actors deploy the open\\-source tool Secure Socket Funnelling, which was used to connect out to the malicious infrastructure. This connection is employed to tunnel traffic from the actor's attack machines into the organization\u2019s internal networks, whose machine names are exposed in event logs as they attempt to use the credentials for the service account.**August:**  The actors are seen conducting a limited amount of activity, including failing to establish connections involving the service account.**August:**  The actors perform significant network and Active Directory enumeration. A different compromised account is subsequently employed to mount shares\\[4] on Windows machines within the DMZ, enabling successful data exfiltration. This seems to be opportunistic usage of a stolen credential on mountable machines in the DMZ. Firewalls blocked the actor from targeting the internal network with similar activity.**August \u2013 September:**  The SSF tool re\\-established a connection to a malicious IP. The group are not observed performing any additional activities until their access is blocked.**September:**  The organization blocks the malicious IP by denylisting it on their firewalls.**Actor Tactics and Techniques**-------------------------------- The MITRE ATT\\&CK framework is a documented collection of tactics and techniques employed by threat actors in cyberspace. The framework was created by U.S. not\\-for\\-profit The MITRE Corporation and functions as a common global language around threat actor behavior. The ASD\u2019s ACSC assesses the following techniques and tactics to be relevant to the actor\u2019s malicious activity:### Reconnaissance[T1594](https://attack.mitre.org/techniques/T1594/ \"Search Victim-Owned Websites\")  \u2013 Search Victim\\-Owned Websites The actor enumerated the custom web application\u2019s website to identify opportunities for accessing the network.### Initial Access[T1190](https://attack.mitre.org/techniques/T1190 \"Exploit Public-Facing Application\")  \u2013 Exploit Public\\-Facing Application (regarding exploiting the custom web application)[T1078\\.002](https://attack.mitre.org/techniques/T1078/002/ \"Valid Accounts: Domain Accounts\")  \u2013 Valid Accounts: Domain Accounts (regarding logging on with comprised credentials) Exploiting internet\\-exposed custom web applications provided an initial point of access for the actor. The actor was later able to use credentials they had compromised to further their access to the network.### Execution[T1059](https://attack.mitre.org/techniques/T1059 \"Command and Scripting Interpreter\")  \u2013 Command and Scripting Interpreter (regarding command execution through the web shell)[T1072](https://attack.mitre.org/techniques/T1072/ \"Software Deployment Tools\")  \u2013 Software Deployment Tools (regarding the actor using open\\-source tool Secure Socket Funnelling (SSF) to connect to an IP)### Persistence[T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")  \u2013 Server Software Component: Web Shell (regarding use of a web shell and SSF to establish access)### Credential Access[T1552\\.001](https://attack.mitre.org/techniques/T1552/001/ \"Credentials from Password Stores\")  \u2013 Credentials from Password Stores (regarding password files relating to building management system \\[BMS])[T1558\\.003](https://attack.mitre.org/techniques/T1558/003/ \"Steal or Forge Kerberos Tickets: Kerberoasting\")  \u2013 Steal or Forge Kerberos Tickets: Kerberoasting (regarding attack to gain network credentials)### Lateral movement[T1021\\.002](https://attack.mitre.org/techniques/T1021/002/ \"Remote Services: SMB Shares\")  \u2013 Remote Services: SMB Shares (regarding the actor mounting SMB shares from multiple devices)### Collection[T1213](https://attack.mitre.org/techniques/T1213/ \"Data from Information Repositories\")  \u2013 Data from Information Repositories (regarding manuals/documentation found on the BMS server)### Exfiltration[T1041](https://attack.mitre.org/techniques/T1041/ \"Exfiltration Over C2 Channel\")  \u2013 Exfiltration Over C2 Channel (regarding the actor\u2019s data exfiltration from Active Directory and mounting shares)**Case Study 2**----------------##### This report has been anonymized to enable wider dissemination. The impacted organization is hereafter referred to as \u201cthe organization.\u201d Some specific details have been removed to protect the identity of the victim and incident response methods of ASD\u2019s ACSC.### Executive Summary This report details the findings of ASD\u2019s ACSC investigation into the successful compromise of the organization\u2019s network in April 2022\\. This investigation report was provided to the organization to summarize observed malicious activity and frame remediation recommendations. The findings indicate the compromise was undertaken by APT40\\. In May 2022, ASD\u2019s ACSC notified an organization of suspected malicious activity impacting the organization\u2019s network since April 2022\\. Subsequently, the organization informed ASD's ACSC that they had discovered malicious software on an internet\u2011facing server which provided the login portal for the organization\u2019s corporate remote access solution. This server used a remote access login and identity management product and will be referred to in this report as 'the compromised appliance'. This report details the investigation findings and remediation advice developed for the organization in response to the investigation conducted by the ASD\u2019s ACSC. Evidence indicated that part of the organization\u2019s network had been compromised by malicious cyber actor(s) via the organization\u2019s remote access login portal since at least April 2022\\. This server may have been compromised by multiple actors, and was likely affected by a remote code execution (RCE) vulnerability that was widely publicized around the time of the compromise. Key actor activity observed by the ASD\u2019s ACSC included:* Host enumeration, which enables an actor to build their own map of the network;* Exploitation of internet\\-facing applications and web shell use, giving the actor an initial foothold on the network and a capability to execute commands;* Exploitation of software vulnerabilities to escalate privileges; and* Credential collection to enable lateral movement. The ASD\u2019s ACSC discovered that a malicious actor had exfiltrated several hundred unique username and password pairs on the compromised appliance in April 2022, as well as a number of multi\\-factor authentication codes and technical artefacts related to remote access sessions. Upon a review by the organization, the passwords were found to be legitimate. The ASD\u2019s ACSC assesses that the actor may have collected these technical artefacts to hijack or create a remote login session as a legitimate user, and access the organization\u2019s internal corporate network using a legitimate user account.### Investigation Summary The ASD\u2019s ACSC determined that the actor compromised appliance(s) which provide remote login sessions for organization staff and used this compromise to attempt to conduct further activity. These appliances consist of three load\\-balanced hosts where the earliest evidence of compromise was detected. The organization shut down two of the three load\\-balanced hosts shortly after the initial compromise. As a result, all subsequent activity occurred on a single host. The other servers associated with the compromised appliance were also load\\-balanced in a similar manner. For legibility, all compromised appliances are referred to in most of this report as a \u201csingle appliance.\u201d The actor is believed to have used publicly known vulnerabilities to deploy web shells to the compromised appliance from April 2022 onwards. Threat actors from the group are assessed to have attained escalated privileges on the appliance. The ASD\u2019s ACSC could not determine the full extent of the activity due to lack of logging availability. However, evidence on the device indicates that an actor achieved the following:* The collection of several hundred genuine username and password pairs; and* The collection of technical artefacts which may have allowed a malicious actor to access a virtual desktop infrastructure (VDI) session as a legitimate user. The ASD\u2019s ACSC assesses that the actor would have sought to further the compromise of the organisation network. The artefacts exfiltrated by the actor may have allowed them to hijack or initiate virtual desktop sessions as a legitimate user, possibly as a user of their choice, including administrators. The actor may have used this access vector to further compromise organization services to achieve persistence and other goals. Other organization appliances within the hosting provider managed environment did not show evidence of compromise.### Access The host with the compromised appliance provided authentication via Active Directory and a webserver, for users connecting to VDI sessions \\[ [T1021\\.001](https://attack.mitre.org/techniques/T1021/001/ \"Remote Services: Remote Desktop Protocol\")  ].| **Location** | Compromised appliance hostnames (load\\-balanced) || --- | --- || **Datacentre 1** | HOST1, HOST2, HOST3 | The appliance infrastructure also included access gateway hosts that provide a tunnel to the VDI for the user, once they possess an authentication token generated and downloaded from the appliance. There was no evidence of compromise of any of these hosts. However, the access gateway hosts logs showed evidence of significant interactions with known malicious IP addresses. It is likely that this reflected activity that occurred on this host, or network connections with threat actor infrastructure that reached this host. The nature of this activity could not be determined using available evidence but indicates that the group sought to move laterally in the organization\u2019s network \\[ [TA0008](https://attack.mitre.org/tactics/TA0008/ \"Lateral Movement\")  ]. Internal Hosts The ASD\u2019s ACSC investigated limited data from the internal organization\u2019s network segment. Attempted or successful malicious activity known to have impacted the internal organization\u2019s network segment includes actor access to VDI\\-related artefacts, the scraping of an internal SQL server \\[ [T1505\\.001](https://attack.mitre.org/techniques/T1505/001/ \"Server Software Component: SQL Stored Procedures\")  ], and unexplained traffic observed going from known malicious IP addresses through the access gateway appliances \\[ [TA0011](https://attack.mitre.org/tactics/TA0011/ \"Command and Control\")  ]. Using their access to the compromised appliance, the group collected genuine usernames, passwords \\[ [T1003](https://attack.mitre.org/techniques/T1003/ \"OS Credential Dumping\")  ], and MFA token values \\[ [T1111](https://attack.mitre.org/techniques/T1111/ \"Multi-Factor Authentication Interception\")  ]. The group also collected JSON Web Tokens (JWTs) \\[ [T1528](https://attack.mitre.org/techniques/T1528/ \"Steal Application Access Token\")  ], which is an authentication artefact used to create virtual desktop login sessions. The actor may have been able to use these to create or hijack virtual desktop sessions \\[ [T1563\\.002](https://attack.mitre.org/techniques/T1563/002/ \"Remote Service Session Hijacking: RDP Hijacking\")  ] and access the internal organization network segment as a legitimate user \\[ [T1078](https://attack.mitre.org/techniques/T1078/ \"Valid Accounts\")  ]. The actor also used access to the compromised appliance to scrape an SQL server \\[ [T1505\\.001](https://attack.mitre.org/techniques/T1505/001/ \"Server Software Component: SQL Stored Procedures\")  ], which resided in the organization\u2019s internal network. It is likely that the actor had access to this data. Evidence available from the access gateway appliance revealed that network traffic occurred through or to this device from known malicious IP addresses. As described above, this may indicate that malicious cyber actors impacted or utilized this device, potentially to pivot into the internal network.### Investigation Timeline The below list provides a timeline of key activities discovered during the investigation.| **Time** | **Event** || --- | --- || **April\u00a02022** | Known\u00a0malicious\u00a0IP\u00a0addresses\u00a0interact\u00a0with\u00a0access\u00a0gateway host\u00a0HOST7\\.\u00a0The\u00a0nature\u00a0of\u00a0the interactions\u00a0could\u00a0not\u00a0be\u00a0determined. || **April\u00a02022** | All\u00a0hosts,\u00a0HOST1, HOST2\u00a0and\u00a0HOST3, were\u00a0compromised\u00a0by\u00a0a\u00a0malicious\u00a0actor\u00a0or\u00a0actors, and\u00a0web\u00a0shells\u00a0were\u00a0placed\u00a0on\u00a0the\u00a0hosts.     A\u00a0log\u00a0file\u00a0was created\u00a0or\u00a0modified\u00a0on HOST2\\.\u00a0This\u00a0file contains\u00a0credential\u00a0material\u00a0likely captured\u00a0by\u00a0a\u00a0malicious\u00a0actor.     The\u00a0/etc/security/opasswd\u00a0and\u00a0/etc/shadow\u00a0files were\u00a0modified\u00a0on\u00a0HOST1\u00a0and\u00a0HOST3, indicating\u00a0that\u00a0passwords\u00a0were\u00a0changed.\u00a0Evidence\u00a0available\u00a0on\u00a0HOST1 suggests\u00a0that\u00a0the password for user \u2018sshuser\u2019 was changed. || **April\u00a02022** | HOST2\u00a0was\u00a0shut\u00a0down by\u00a0the\u00a0organization.     Additional\u00a0web\u00a0shells\u00a0(  [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")   )\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0and\u00a0HOST3\\.\u00a0HOST1experienced SSH brute force attempts from HOST3\\.     A\u00a0log\u00a0file\u00a0was\u00a0modified\u00a0(  [T1070](https://attack.mitre.org/techniques/T1070/ \"Indicator Removal\")   )\u00a0on\u00a0HOST3\\.\u00a0This file\u00a0contains\u00a0credential\u00a0material\u00a0(  [T1078](https://attack.mitre.org/techniques/T1078/ \"Valid Accounts\")   ) likely captured by a malicious actor.     JWTs\u00a0were\u00a0captured\u00a0(  [T1528](https://attack.mitre.org/techniques/T1528/ \"Steal Application Access Token\")   )\u00a0and\u00a0output\u00a0to\u00a0a\u00a0file\u00a0on\u00a0HOST3\\.     HOST3\u00a0was\u00a0shut\u00a0down\u00a0by\u00a0the\u00a0organization.\u00a0All\u00a0activity\u00a0after\u00a0this\u00a0time\u00a0occurs\u00a0on\u00a0HOST1\\. || **April\u00a02022** | Additional\u00a0web\u00a0shells\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0(  [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")   ).\u00a0JWTs\u00a0were\u00a0captured\u00a0and\u00a0output to\u00a0a\u00a0file\u00a0on\u00a0HOST1\\. || **April\u00a02022** | Additional\u00a0web\u00a0shells are\u00a0created\u00a0on\u00a0HOST1\u00a0(  [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")   ),\u00a0and a\u00a0known\u00a0malicious\u00a0IP\u00a0address interacts\u00a0with\u00a0the\u00a0host\u00a0(  [TA0011](https://attack.mitre.org/tactics/TA0011/ \"Command and Control\")   ).     A\u00a0known\u00a0malicious\u00a0IP\u00a0address\u00a0interacts\u00a0with\u00a0access\u00a0gateway\u00a0host\u00a0HOST7\\. || **May\u00a02022** | A known\u00a0malicious\u00a0IP\u00a0address\u00a0interacted\u00a0with\u00a0access\u00a0gateway host\u00a0HOST7\u00a0(  [TA0011](https://attack.mitre.org/tactics/TA0011/)   ).     An\u00a0authentication\u00a0event\u00a0for\u00a0a\u00a0user\u00a0is\u00a0linked\u00a0to\u00a0a\u00a0known\u00a0malicious\u00a0IP\u00a0address\u00a0in\u00a0logs on HOST1\\.\u00a0An\u00a0additional\u00a0web\u00a0shell\u00a0is\u00a0created\u00a0on\u00a0this\u00a0host\u00a0(  [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")   ). || **May\u00a02022** | A\u00a0script on\u00a0HOST1\u00a0was modified\u00a0by\u00a0an\u00a0actor\u00a0(  [T1543](https://attack.mitre.org/techniques/T1543/ \"Create or Modify System Process\")   ).\u00a0This script\u00a0contains\u00a0functionality which would have scraped data from an internal SQL server. || **May\u00a02022** | An\u00a0additional\u00a0log\u00a0file\u00a0on\u00a0HOST1\u00a0was\u00a0last\u00a0modified\u00a0(  [T1070](https://attack.mitre.org/techniques/T1070/ \"Indicator Removal\")   ).\u00a0This\u00a0file\u00a0contains\u00a0username\u00a0and password\u00a0pairs\u00a0for the\u00a0organization\u00a0network,\u00a0which\u00a0are\u00a0believed\u00a0to\u00a0be\u00a0legitimate\u00a0(  [T1078](https://attack.mitre.org/techniques/T1078/ \"Valid Accounts\")   ). || **May\u00a02022** | An\u00a0additional log\u00a0file\u00a0was\u00a0last\u00a0modified\u00a0(  [T1070](https://attack.mitre.org/techniques/T1070/ \"Indicator Removal\")   ).\u00a0This\u00a0file\u00a0contains\u00a0JWTs\u00a0collected\u00a0from HOST1\\. || **May\u00a02022** | Additional\u00a0web\u00a0shells\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0(  [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")   ).\u00a0On\u00a0this\u00a0date, the\u00a0organization reported\u00a0the\u00a0discovery\u00a0of\u00a0a\u00a0web\u00a0shell\u00a0with\u00a0creation\u00a0date\u00a0in\u00a0April 2022\u00a0to\u00a0ASD\u2019s ACSC || **May\u00a02022** | A\u00a0number\u00a0of\u00a0scripts were\u00a0created\u00a0on HOST1,\u00a0including\u00a0one named\u00a0Log4jHotPatch.jar. || **May\u00a02022** | The\u00a0iptables\\-save\u00a0command was\u00a0used\u00a0to\u00a0add\u00a0two\u00a0open\u00a0ports to\u00a0the\u00a0access gateway\u00a0host. The\u00a0ports\u00a0were\u00a09998\u00a0and\u00a09999\u00a0(  [T1572](https://attack.mitre.org/techniques/T1572/ \"Protocol Tunneling\")   ). |**Actor Tactics and Techniques**-------------------------------- Highlighted below are several tactics and techniques identified during the investigation.### Initial\u00a0access[T1190](https://attack.mitre.org/techniques/T1190 \"Exploit Public-Facing Application\")  Exploit\u00a0public\u00a0facing\u00a0application The group likely exploited RCE, privilege escalation, and\u00a0authentication\u00a0bypass\u00a0vulnerabilities\u00a0in\u00a0the\u00a0remote\u00a0access\u00a0login\u00a0and\u00a0identity\u00a0management\u00a0product\u00a0to\u00a0gain initial access to the network. This\u00a0initial\u00a0access\u00a0method\u00a0is considered\u00a0the most\u00a0likely\u00a0due to the following:* The\u00a0server\u00a0was\u00a0vulnerable\u00a0to\u00a0these\u00a0CVEs\u00a0at\u00a0the time;* Attempts\u00a0to\u00a0exploit\u00a0these\u00a0vulnerabilities\u00a0from\u00a0known actor infrastructure; and* The first known internal malicious activity occurred\u00a0shortly\u00a0after\u00a0attempted\u00a0exploitation attempts were made.### Execution[T1059\\.004](https://attack.mitre.org/techniques/T1059/004 \"Command and Scripting Interpreter: Unix Shell\")  Command\u00a0and Scripting\u00a0Interpreter:\u00a0Unix Shell The group successfully exploited the above vulnerabilities\u00a0may\u00a0have\u00a0been\u00a0able\u00a0to\u00a0run\u00a0commands in a Unix shell available on the affected appliance. Complete details of the commands run by actors cannot\u00a0be\u00a0provided\u00a0as\u00a0they\u00a0were\u00a0not\u00a0logged\u00a0by\u00a0the appliance.### Persistence[T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")  Server\u00a0Software\u00a0Component:\u00a0Web Shell Actors deployed several web shells on the affected appliance. It is possible that multiple distinct actors deployed\u00a0web\u00a0shells,\u00a0but\u00a0that\u00a0only\u00a0a\u00a0smaller\u00a0number\u00a0of\u00a0actors conducted activity using these web shells. Web\u00a0shells\u00a0would\u00a0have\u00a0allowed\u00a0for\u00a0arbitrary\u00a0command\u00a0execution by the actor on the compromised appliances.### Privilege\u00a0escalation[T1068](https://attack.mitre.org/techniques/T1068 \"Exploitation for Privilege Escalation\")  Exploitation\u00a0for Privilege\u00a0Escalation Available evidence does not describe the level of privilege attained by actors. However, using web shells, the actors would have achieved a level of privilege\u00a0comparable\u00a0to\u00a0that\u00a0of\u00a0the\u00a0web\u00a0server\u00a0on\u00a0the\u00a0compromised appliance. Vulnerabilities believed to have been present on the compromised appliance would\u00a0have\u00a0allowed\u00a0the\u00a0actors\u00a0to\u00a0attain\u00a0root\u00a0privileges.### Credential\u00a0access[T1056\\.003](https://attack.mitre.org/techniques/T1056/003 \"Input Capture: Web Portal Capture\")  Input\u00a0Capture:\u00a0Web\u00a0Portal\u00a0Capture Evidence on the compromised appliance showed that the actor had captured several hundred username\\-password\u00a0pairs,\u00a0in\u00a0clear\u00a0text,\u00a0which\u00a0are believed\u00a0to\u00a0be\u00a0legitimate.\u00a0It\u00a0is\u00a0likely\u00a0that\u00a0these\u00a0were\u00a0captured\u00a0using\u00a0some\u00a0modification\u00a0to\u00a0the\u00a0genuine authentication\u00a0process\u00a0which\u00a0output\u00a0the credentials\u00a0to a\u00a0file.[T1111](https://attack.mitre.org/techniques/T1111 \"Multi-Factor Authentication Interception\")  Multi\\-Factor\u00a0Authentication\u00a0Interception The\u00a0actor\u00a0also\u00a0captured\u00a0the\u00a0value\u00a0of\u00a0MFA\u00a0tokens corresponding to legitimate logins. These were likely captured by modifying the genuine authentication process to output these values to a file. There is no evidence of compromise of the \u201csecret server\u2019 which stores\u00a0the\u00a0unique\u00a0values\u00a0that\u00a0provide\u00a0for\u00a0the\u00a0security\u00a0of\u00a0MFA\u00a0tokens.[T1040](https://attack.mitre.org/techniques/T1040 \"Network Sniffing\")  Network\u00a0Sniffing The actor is believed to have captured JWTs by capturing HTTP traffic on the compromised appliance. There\u00a0is\u00a0evidence\u00a0that\u00a0the\u00a0utility\u00a0tcpdump\u00a0was\u00a0executed on the compromised appliance, which may have been how the actor captured these JWTs.[T1539](https://attack.mitre.org/techniques/T1539 \"Steal Web Session Cookie\")  Steal\u00a0Web Session\u00a0Cookie As\u00a0described\u00a0above,\u00a0the\u00a0actor\u00a0captured\u00a0JWTs,\u00a0which\u00a0are\u00a0analogous to web session cookies. These could have been reused by the actor to establish further access.### Discovery[T1046](https://attack.mitre.org/techniques/T1046 \"Network Service Discovery\")  Network Service\u00a0Discovery There\u00a0is\u00a0evidence\u00a0that\u00a0network\u00a0scanning\u00a0utility nmap was executed on the compromised appliance to\u00a0scan other appliances in the same network segment. This was likely used by the actor to discover other reachable network services which might present opportunities for lateral movement.### Collection Available evidence does not reveal how actors collected data or exactly what was collected from the\u00a0compromised\u00a0appliance\u00a0or\u00a0from\u00a0other\u00a0systems. However,\u00a0it\u00a0is\u00a0likely\u00a0that\u00a0actors\u00a0had\u00a0access\u00a0to\u00a0all\u00a0files\u00a0on the compromised appliance, including the captured\u00a0credentials\u00a0\\[ [T1003](https://attack.mitre.org/techniques/T1003/ \"OS Credential Dumping\")  ],\u00a0MFA\u00a0token\u00a0values\u00a0\\[ [T1111](https://attack.mitre.org/techniques/T1111/ \"Multi-Factor Authentication Interception\")  ],\u00a0and\u00a0JWTs described above.### Command\u00a0and\u00a0Control[T1071\\.001](https://attack.mitre.org/techniques/T1071/001 \"Application Layer Protocol: Web Protocols\")  Application\u00a0Layer\u00a0Protocol:\u00a0Web\u00a0Protocols Actors\u00a0used\u00a0web\u00a0shells\u00a0for\u00a0command\u00a0and\u00a0control.\u00a0Web\u00a0shell commands would have been passed over HTTPS\u00a0using\u00a0the\u00a0existing\u00a0web\u00a0server\u00a0on\u00a0the appliance\u00a0\\[ [T1572](https://attack.mitre.org/techniques/T1572/ \"Protocol Tunneling\")  ].[T1001\\.003](https://attack.mitre.org/versions/v15/techniques/T1001/003/ \"Data Obfuscation: Protocol Impersonation\")  Data\u00a0Obfuscation:\u00a0Protocol\u00a0Impersonation Actors\u00a0used\u00a0compromised\u00a0devices\u00a0as\u00a0a\u00a0launching\u00a0point for\u00a0attacks\u00a0that\u00a0are\u00a0designed\u00a0to\u00a0blend\u00a0in\u00a0with\u00a0legitimate\u00a0traffic.**Detection\u00a0and\u00a0mitigation recommendations**-------------------------------------------- The\u00a0ASD\u2019s\u00a0ACSC\u00a0strongly\u00a0recommends\u00a0implementing\u00a0the\u00a0ASD [Essential\u00a0Eight](https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/essential-eight \"Essential Eight\")  Controls\u00a0and\u00a0associated [Strategies\u00a0to\u00a0Mitigate\u00a0Cyber\u00a0Security\u00a0Incidents](https://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/strategies-mitigate-cyber-security-incidents/strategies-mitigate-cyber-security-incidents-mitigation-details \"Strategies\u00a0to\u00a0Mitigate\u00a0Cyber\u00a0Security\u00a0Incidents\")  .\u00a0Below are recommendations for network security actions that\u00a0should\u00a0be\u00a0taken\u00a0to\u00a0detect\u00a0and\u00a0prevent\u00a0intrusions by\u00a0APT40,\u00a0followed\u00a0by\u00a0specific\u00a0mitigations\u00a0for\u00a0four\u00a0key\u00a0TTPs\u00a0summarized\u00a0in\u00a0Table\u00a01\\.### Detection Some of the files identified above were dropped in locations such as C:\\\\Users\\\\Public\\\\\\* and C:\\\\Windows\\\\ Temp\\\\\\*.\u00a0These locations can be convenient spots for writing data as they are usually world writable, that is, all user accounts registered in Windows have access to these directories and their subdirectories. Often, any\u00a0user\u00a0can\u00a0subsequently\u00a0access\u00a0these\u00a0files,\u00a0allowing opportunities for lateral movement, defense evasion, low\\-privilege execution and staging for exfiltration. The\u00a0following\u00a0Sigma\u00a0rules\u00a0look\u00a0for\u00a0execution\u00a0from suspicious locations as an indicator of anomalous activity.\u00a0In\u00a0all\u00a0instances,\u00a0subsequent\u00a0investigation\u00a0is required\u00a0to\u00a0confirm\u00a0malicious\u00a0activity\u00a0and\u00a0attribution.| Title:\u00a0World\u00a0Writable\u00a0Execution\u00a0\\-\u00a0Temp    **ID:**   d2fa2d71\\-fbd0\\-4778\\-9449\\-e13ca7d7505c    **Description:**   Detect process execution from C:\\\\ Windows\\\\Temp.    **Background:**   This\u00a0rule\u00a0looks\u00a0specifically\u00a0for\u00a0execution\u00a0out\u00a0of\u00a0C:\\\\ Windows\\\\Temp\\\\\\*.\u00a0Temp\u00a0is\u00a0more\u00a0broadly\u00a0used\u00a0by benign applications and thus a lower confidence malicious\u00a0indicator\u00a0than\u00a0execution\u00a0out\u00a0of\u00a0other\u00a0world\u00a0writable subdirectories in C:\\\\Windows.     Removing applications executed by the SYSTEM or NETWORK SERVICE users substantially reduces the quantity of benign activity selected by this rule.     This\u00a0means\u00a0that\u00a0the\u00a0rule\u00a0may\u00a0miss\u00a0malicious\u00a0executions\u00a0at\u00a0a\u00a0higher\u00a0privilege\u00a0level\u00a0but\u00a0it\u00a0is\u00a0recommended\u00a0to use\u00a0other\u00a0rules\u00a0to\u00a0determine\u00a0if\u00a0a\u00a0user\u00a0is\u00a0attempting\u00a0to elevate privileges to SYSTEM.    **Investigation:**  1. Examine information directly associated with this file execution, such\u00a0as\u00a0the user\u00a0context,\u00a0execution integrity level, immediate follow\\-on activity and images loaded by the file. 2. Investigate\u00a0contextual\u00a0process,\u00a0network,\u00a0file and other supporting data on the host to help\u00a0make\u00a0an\u00a0assessment\u00a0as\u00a0to\u00a0whether\u00a0the\u00a0activity\u00a0is\u00a0malicious. 3. If\u00a0necessary\u00a0attempt\u00a0to\u00a0collect\u00a0a\u00a0copy\u00a0of\u00a0the\u00a0file\u00a0for\u00a0reverse\u00a0engineering\u00a0to\u00a0determine\u00a0whether\u00a0it\u00a0is\u00a0legitimate.   **References:**    [Process Execution from an Unusual Directory](https://www.elastic.co/guide/en/security/current/process-execution-from-an-unusual-directory.html \"Process Execution from an Unusual Directory\")    **Author:**   ASD\u2019s ACSC    **Date:**   2024/06/19    **Status:**   experimental    **Tags:**  * tlp.green * classification.au.official * attack.execution   **Log\u00a0Source:**     category:\u00a0process\\_creation    product:\u00a0windows    **Detection:**     temp:    Image\\|startswith:\u00a0'C:\\\\\\\\Windows\\\\\\\\Temp\\\\\\\\'     common\\_temp\\_path:    Image\\|re\\|ignorecase:\u00a0'C:\\\\\\\\Windows\\\\\\\\Temp\\\\\\\\\\\\{\\[a\\-fA\\-F0\\-9]{8}\\-(\\[a\\-fA\\-F0\\-9]{4}\\-){3}\\[a\\-fA\\-F0\\-9]{12}\\\\}\\\\\\\\'     system\\_user:    User:  * 'SYSTEM' * 'NETWORK\u00a0SERVICE'    dismhost:  * Image\\|endswith: 'dismhost.exe'    known\\_parent:  * ParentImage\\|endswith: * '\\\\\\\\esif\\_uf.exe' * '\\\\\\\\vmtoolsd.exe' * '\\\\\\\\cwainstaller.exe' * '\\\\\\\\trolleyexpress.exe'    condition: temp and not (common\\_temp\\_path or system\\_user or dismhost or known\\_parent)    **False positives:**  * Allowlist auditing applications have been observed running executables from Temp. * Temp will legitimately contain an array of setup applications and launchers, so it will be worth considering how prevalent this behavior is on a monitored network (and whether or not it can be allowlisted) before deploying this rule.   **Level:**   low || --- || Title:\u00a0World Writable Execution \\- Non\\-Temp System Subdirectory    **ID:**   5b187157\\-e892\\-4fc9\\-84fc\\-aa48aff9f997    **Description:**   Detect process execution from a world writable location in a subdirectory of the Windows OS install location.    **Background:**     This rule looks specifically for execution out of world writable directories within C:\\\\ and particularly C:\\\\Windows\\\\\\*, with the exception of C:\\\\Windows\\\\Temp (which is more broadly used by benign applications and thus a lower confidence malicious indicator).     AppData folders are excluded if a file is run as SYSTEM \\- this is a benign way in which many temporary application files are executed.     After completing an initial network baseline and identifying known benign executions from these locations, this rule should rarely fire.    **Investigation:**  1. Examine information directly associated with this file execution, such as the user context, execution integrity level, immediate follow\\-on activity and images loaded by the file. 2. Investigate contextual process, network, file and other supporting data on the host to help make an assessment as to whether the activity is malicious. 3. If necessary attempt to collect a copy of the file for reverse engineering to determine whether it is legitimate.   **References:**    [mattifestation / WorldWritableDirs.txt](https://gist.github.com/mattifestation/5f9de750470c9e0e1f9c9c33f0ec3e56 \"mattifestation / WorldWritableDirs.txt\")   [Process Execution from an Unusual Directory](https://www.elastic.co/guide/en/security/current/process-execution-from-an-unusual-directory.html \"Process Execution from an Unusual Directory\")    **Author:**   ASD\u2019s ACSC    **Date:**   2024/06/19    **Status:**   experimental    **Tags:**  * tlp.green * classification.au.official * attack.execution   **Log source:**     category: process\\_creation    product: windows    **Detection:**     writable\\_path:    Image\\|contains:  * ':\\\\\\\\$Recycle.Bin\\\\\\\\' * ':\\\\\\\\AMD\\\\\\\\Temp\\\\\\\\' * ':\\\\\\\\Intel\\\\\\\\' * ':\\\\\\\\PerfLogs\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\addins\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\appcompat\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\apppatch\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\AppReadiness\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\bcastdvr\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Boot\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Branding\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\CbsTemp\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Containers\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\csc\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Cursors\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\debug\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\diagnostics\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\DigitalLocker\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\dot3svc\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\en\\-US\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Fonts\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Globalization\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Help\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\IdentityCRL\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\IME\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ImmersiveControlPanel\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\INF\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\intel\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\L2Schemas\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\LiveKernelReports\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Logs\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\media\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Migration\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ModemLogs\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ms\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\OCR\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\panther\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Performance\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\PLA\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\PolicyDefinitions\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Prefetch\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\PrintDialog\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Provisioning\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Registration\\\\\\\\CRMLog\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\RemotePackages\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\rescache\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Resources\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\SchCache\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\schemas\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\security\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ServiceState\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\servicing\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Setup\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ShellComponents\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\ShellExperiences\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\SKB\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\TAPI\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Tasks\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\TextInput\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\tracing\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Vss\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\WaaS\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\Web\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\wlansvc\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\Com\\\\\\\\dmp\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\FxsTmp\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\Microsoft\\\\\\\\Crypto\\\\\\\\RSA\\\\\\\\MachineKeys\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\Speech\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\spool\\\\\\\\drivers\\\\\\\\color\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\spool\\\\\\\\PRINTERS\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\spool\\\\\\\\SERVERS\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\Tasks\\_Migrated\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\PLA\\\\\\\\System\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\Tasks\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\SysWOW64\\\\\\\\Com\\\\\\\\dmp\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\SysWOW64\\\\\\\\FxsTmp\\\\\\\\' * ':\\\\\\\\Windows\\\\\\\\SysWOW64\\\\\\\\Tasks\\\\\\\\'    appdata:    Image\\|contains:\u00a0'\\\\\\\\AppData\\\\\\\\'    User:\u00a0'SYSTEM'    condition:\u00a0writable\\_path\u00a0and\u00a0not\u00a0appdata    **False positives:**     Allowlist auditing applications have been observed running executables from these directories.     It is plausible that scripts and administrative tools used in the monitored environment(s) may be located in one of these directories and should be addressed on a case\\-by\\-case basis.    **Level:**   high || --- || Title:\u00a0World Writable Execution \\- Users    **ID:**   6dda3843\\-182a\\-4214\\-9263\\-925a80b4c634    **Description:**   Detect process execution from C:\\\\Users\\\\Public\\\\\\* and other world writable folders within Users.    **Background:**     AppData folders are excluded if a file is run as SYSTEM \\- this is a benign way in which many temporary application files are executed.    **Investigation:**  1. Examine information directly associated with this file execution, such as the user context, execution integrity level, immediate follow\\-on activity and images loaded by the file. 2. Investigate contextual process, network, file and other supporting data on the host to help make an assessment as to whether the activity is malicious. 3. If necessary attempt to collect a copy of the file for reverse engineering to determine whether it is legitimate.   **References:**    [Process Execution from an Unusual Directory](https://www.elastic.co/guide/en/security/current/process-execution-from-an-unusual-directory.html \"Process Execution from an Unusual Directory\")    **Author:**   ASD\u2019s ACSC    **Date:**   2024/06/19    **Status:**   experimental    **Tags:**  * tlp.green * classification.au.official * attack.execution   **Log source:**     category: process\\_creation    product: windows    **Detection:**    users:    Image\\|contains:  * ':\\\\\\\\Users\\\\\\\\All Users\\\\\\\\' * ':\\\\\\\\Users\\\\\\\\Contacts\\\\\\\\' * ':\\\\\\\\Users\\\\\\\\Default\\\\\\\\' * ':\\\\\\\\Users\\\\\\\\Public\\\\\\\\' * ':\\\\\\\\Users\\\\\\\\Searches\\\\\\\\'    appdata:    Image\\|contains: '\\\\\\\\AppData\\\\\\\\'    User: 'SYSTEM'    condition: users and not appdata    **False positives:**     It is plausible that scripts and administrative tools used in the monitored environment(s) may be located in Public or a subdirectory and should be addressed on a case\\-by\\-case basis.    **Level:**   medium || --- |### Mitigations##### Logging During ASD\u2019s ACSC investigations, a common issue that\u00a0reduces the effectiveness and speed of investigative efforts\u00a0is\u00a0a\u00a0lack\u00a0of\u00a0comprehensive\u00a0and\u00a0historical\u00a0logging\u00a0information\u00a0across\u00a0a\u00a0number\u00a0of\u00a0areas\u00a0including web server request logs, Windows event logs\u00a0and internet proxy logs. ASD\u2019s\u00a0ACSC\u00a0recommends\u00a0reviewing\u00a0and\u00a0implementing their\u00a0guidance\u00a0on [Windows\u00a0Event\u00a0Logging\u00a0and\u00a0Forwarding](https://www.cyber.gov.au/resources-business-and-government/maintaining-devices-and-systems/system-hardening-and-administration/system-monitoring/windows-event-logging-and-forwarding \"Windows\u00a0Event\u00a0Logging\u00a0and\u00a0Forwarding\")  including the configuration files and scripts\u00a0in the [Windows Event Logging Repository](http://www.github.com/Australiancybersecuritycentre/windows_event_logging/ \"Windows Event Logging Repository\")  and the Information\u00a0Security\u00a0Manual\u2019s [Guidelines\u00a0for\u00a0System\u00a0Monitoring](http://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/ism/cyber-security-guidelines/guidelines-system-monitoring \"Guidelines\u00a0for\u00a0System\u00a0Monitoring\")  , to include centralizing logs and retaining\u00a0logs for a suitable period.##### Patch\u00a0Management Promptly patch all internet exposed devices and\u00a0services,\u00a0including\u00a0web\u00a0servers,\u00a0web\u00a0applications,\u00a0and\u00a0remote access gateways. Consider implementing a centralized patch management system to automate and expedite the process. ASD\u2019s ACSC recommend implementation\u00a0of\u00a0the\u00a0ISM\u2019s [Guidelines\u00a0for\u00a0System Management](http://www.cyber.gov.au/resources-business-and-government/essential-cyber-security/ism/cyber-security-guidelines/guidelines-system-management \"Guidelines\u00a0for\u00a0System\u00a0Management\")  , specifically, the System Patching\u00a0controls where applicable. Most exploits utilized by the actor were publicly known and had patches or mitigations available. Organizations should ensure that security patches or mitigations\u00a0are\u00a0applied\u00a0to\u00a0internet\u00a0facing\u00a0infrastructure within 48 hours, and where possible, use the latest\u00a0versions\u00a0of\u00a0software\u00a0and\u00a0operating\u00a0systems.##### Network\u00a0Segmentation Network segmentation can make it significantly more difficult for adversaries to locate and gain access to an organizations sensitive data. Segment networks to limit or block lateral movement by denying traffic between computers unless required. Important servers such as Active Directory and other authentication servers should only be able to be administered from a limited\u00a0number of intermediary servers or \u201cjump servers.\u201d These servers should be closely monitored, be well secured\u00a0and limit which users and devices are able to connect to\u00a0them. Regardless of instances identified where lateral movement is prevented, additional network\u00a0segmentation\u00a0could\u00a0have\u00a0further\u00a0limited\u00a0the amount\u00a0of\u00a0data\u00a0the\u00a0actors\u00a0were\u00a0able\u00a0to\u00a0access\u00a0and\u00a0extract.##### Additional Mitigations The\u00a0authoring\u00a0agencies\u00a0also\u00a0recommend\u00a0the\u00a0following mitigations to combat APT40 and others\u2019 use of the\u00a0TTPs\u00a0below.* Disable\u00a0unused\u00a0or\u00a0unnecessary\u00a0network\u00a0services, ports\u00a0and\u00a0protocols.* Use\u00a0well\\-tuned\u00a0Web\u00a0application\u00a0firewalls\u00a0(WAFs) to protect\u00a0webservers\u00a0and applications.* Enforce\u00a0least privilege\u00a0to limit\u00a0access to\u00a0servers,\u00a0file shares, and other resources.* Use multi\\-factor authentication (MFA) and managed service accounts to\u00a0make\u00a0credentials harder to crack and reuse. MFA should be applied to\u00a0all\u00a0internet\u00a0accessible\u00a0remote\u00a0access\u00a0services,\u00a0including:\t+ Web\u00a0and\u00a0cloud\\-based\u00a0email;\t+ Collaboration\u00a0platforms;\t+ Virtual\u00a0private\u00a0network\u00a0connections; and\t+ Remote\u00a0desktop\u00a0services.* Replace\u00a0end\\-of\\-life\u00a0equipment. Mitigation Strategies/Techniques| **TTP** | **Essential\u00a0Eight\u00a0Mitigation\u00a0Strategies** | **ISM\u00a0Controls** || --- | --- | --- || Initial\u00a0Access    [T1190](https://attack.mitre.org/techniques/T1190 \"Exploit Public-Facing Application\")     Exploitation of Public\\-Facing Application | * Patch\u00a0applications * Patch\u00a0operating\u00a0systems * Multi\\-factor\u00a0authentication * Application\u00a0control | ISM\\-0140     ISM\\-1698     ISM\\-1701     ISM\\-1921     ISM\\-1876     ISM\\-1877     ISM\\-1905 || Execution    [T1059](https://attack.mitre.org/techniques/T1059 \"Command and Scripting Interpreter\")     Command\u00a0and\u00a0Scripting Interpreter | * Application\u00a0control * Restrict\u00a0Microsoft\u00a0Office\u00a0macros * Restrict\u00a0administrative\u00a0privileges | ISM\\-0140     ISM\\-1490     ISM\\-1622     ISM\\-1623     ISM\\-1657     ISM\\-1890 || Persistence    [T1505\\.003](https://attack.mitre.org/techniques/T1505/003 \"Server Software Component: Web Shell\")     Server\u00a0Software Component:\u00a0Web\u00a0Shell | * Application\u00a0Control * Restrict\u00a0administrative\u00a0privileges | ISM\\-0140     ISM\\-1246     ISM\\-1746     ISM\\-1249     ISM\\-1250     ISM\\-1490     ISM\\-1657     ISM\\-1871 || Initial\u00a0Access /\u00a0Privilege Escalation\u00a0/\u00a0Persistence    [T1078](https://attack.mitre.org/techniques/T1078/ \"Valid Accounts\")     Valid\u00a0Accounts | * Patch\u00a0operating\u00a0systems * Multi\\-factor\u00a0authentication * Restrict\u00a0administrative\u00a0privileges * Application\u00a0control * User\u00a0application\u00a0hardening | ISM\\-0140     ISM\\-0859     ISM\\-1546     ISM\\-1504     ISM\\-1679 | For additional general detection and mitigation advice, please consult the Mitigations and Detection sections on the MITRE ATT\\&CK technique web page for each of the techniques identified in the MITRE ATT\\&CK summary at the end of this advisory.**Reporting**-------------**Australian organizations:**  visit [cyber.gov.au](https://www.cyber.gov.au/ \"Australian Signals Directorate\u2019s Australian Cyber Security Centre\")  or call 1300 292 371 (1300 CYBER 1\\) to report cybersecurity incidents and to access alerts and advisories.**Canadian organizations:**  report incidents by emailing CCCS at [contact@cyber.gc.ca](mailto:contact@cyber.gc.ca \"Canadian Reporting\")  .**New Zealand organizations:**  report cyber security incidents to [incidents@ncsc.govt.nz](mailto:incidents@ncsc.govt.nz \"New Zealand Reporting\")  or call 04 498 7654\\.**United Kingdom organizations:**  report a significant cyber security incident at [National Cyber Security Centre](https://www.ncsc.gov.uk/section/about-this-website/contact-us \"United Kingdom Reporting\")  (monitored 24 hours) or, for urgent assistance, call 03000 200 973\\.**U.S. organizations:**  report incidents and anomalous activity to CISA 24/7 Operations Center at [report@cisa.gov](mailto:report@cisa.gov \"Report to CISA\")  or (888\\) 282\\-0870 and/or to the FBI via your local FBI field office, the FBI\u2019s 24/7 CyWatch at (855\\) 292\\-3937, or [CyWatch@fbi.gov](mailto:CyWatch@fbi.gov \"Report to FBI\")  . When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.**Disclaimer**-------------- The information in this report is being provided \u201cas is\u201d for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.**MITRE ATT\\&CK \u2013 Historical APT40 Tradecraft of Interest**-----------------------------------------------------------| Reconnaissance (TA0043\\) | || --- | --- || Search Victim\\-Owned Websites \\[T1594] | Gather Victim Identity Information: Credentials \\[T1589\\.001] || Active Scanning: Vulnerability Scanning \\[T1595\\.002] | Gather Victim Host Information \\[T1592] || Search Open Websites/Domains: Search Engines \\[T1593\\.002] | Gather Victim Network Information: Domain Properties \\[T1590\\.001] || Gather Victim Identity Information: Email Addresses \\[T1589\\.002] |  || Resource Development (TA0042\\) | || --- | --- || Acquire Infrastructure: Domains \\[T1583\\.001] | Acquire Infrastructure \\[T1583] || Acquire Infrastructure: DNS Server \\[T1583\\.002] | Compromise Accounts \\[T1586] || Develop Capabilities: Code Signing Certificates \\[T1587\\.002] | Compromise Infrastructure \\[T1584] || Develop Capabilities: Digital Certificates \\[T1587\\.003] | Develop Capabilities: Malware \\[T1587\\.001] || Obtain Capabilities: Code Signing Certificates \\[T1588\\.003] | Establish Accounts: Cloud Accounts \\[T1585\\.003] || Compromise Infrastructure: Network Devices \\[T1584\\.008] | Obtain Capabilities: Digital Certificates \\[T1588\\.004] || Initial Access (TA0001\\) | || --- | --- || Valid Accounts \\[T1078] | Phishing \\[T1566] || Valid Accounts: Default Accounts \\[T1078\\.001] | Phishing: Spearphishing Attachment \\[T1566\\.001] || Valid Accounts: Domain Accounts \\[T1078\\.002] | Phishing: Spearphishing Link \\[T1566\\.002] || External Remote Services \\[T1133] | Exploit Public\\-Facing Application \\[T1190] || Drive\\-by Compromise \\[T1189] |  || Execution (TA0002\\) | || --- | --- || Windows Management Instrumentation \\[T1047] | Command and Scripting Interpreter: Python \\[T1059\\.006] || Scheduled Task/Job: At \\[T1053\\.002] | Command and Scripting Interpreter: JavaScript \\[T1059\\.007] || Scheduled Task/Job: Scheduled Task \\[T1053\\.005] | Native API \\[T1106] || Command and Scripting Interpreter \\[T1059] | Inter\\-Process Communication \\[T1559] || Command and Scripting Interpreter: Windows Command Shell \\[T1059\\.003] | System Services: Service Execution \\[T1569\\.002] || Command and Scripting Interpreter: PowerShell \\[T1059\\.001] | Exploitation for Client Execution \\[T1203] || Command and Scripting Interpreter: Visual Basic \\[T1059\\.005] | User Execution: Malicious File \\[T1204\\.002] || Command and Scripting Interpreter: Unix Shell \\[T1059\\.004] | Command and Scripting Interpreter: Apple Script \\[T1059\\.002] || Scheduled Task/Job: Cron \\[T1053\\.003] | Software Deployment Tools \\[T1072] || Persistence (TA0003\\) | || --- | --- || Valid Accounts \\[T1078] | Server Software Component: Web Shell \\[T1505\\.003] || Office Application Startup: Office Template Macros \\[T1137\\.001] | Create or Modify System Process: Windows Service \\[T1543\\.003] || Scheduled Task/Job: At \\[T1053\\.002] | Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \\[T1547\\.001] || Scheduled Task/Job: Scheduled Task \\[T1053\\.005] | Boot or Logon Autostart Execution: Shortcut Modification \\[T1547\\.009] || External Remote Services \\[T1133] | Hijack Execution Flow: DLL Search Order Hijacking \\[T1574\\.001] || Scheduled Task/Job: Cron \\[T1053\\.003] | Hijack Execution Flow: DLL Side\\-Loading \\[T1574\\.002] || Account Manipulation \\[T1098] | Valid Accounts: Cloud Accounts \\[T1078\\.004] || Valid Accounts: Domain Accounts \\[T1078\\.002] |  || Privilege Escalation (TA0004\\) | || --- | --- || Scheduled Task/Job: At \\[T1053\\.002] | Create or Modify System Process: Windows Service \\[T1543\\.003] || Scheduled Task/Job: Scheduled Task \\[T1053\\.005] | Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \\[T1547\\.001] || Process Injection: Thread Execution Hijacking \\[T1055\\.003] | Boot or Logon Autostart Execution: Shortcut Modification \\[T1547\\.009] || Process Injection: Process Hollowing \\[T1055\\.012] | Hijack Execution Flow: DLL Search Order Hijacking \\[T1574\\.001] || Valid Accounts: Domain Accounts \\[T1078\\.002] | Exploitation for Privilege Escalation \\[T1068] || Access Token Manipulation: Token Impersonation/Theft \\[T1134\\.001] | Event Triggered Execution: Unix Shell Configuration Modification \\[T1546\\.004] || Process Injection: Dynamic\\-link Library Injection \\[T1055\\.001] | Valid Accounts: Domain Accounts \\[T1078\\.002] || Valid Accounts: Local Accounts \\[T1078\\.003] |  || Defense Evasion (TA0005\\) | || --- | --- || Rootkit \\[T1014] | Indirect Command Execution \\[T1202] || Obfuscated Files or Information \\[T1027] | System Binary Proxy Execution: Mshta \\[T1218\\.005] || Obfuscated Files or Information: Software Packing \\[T1027\\.002] | System Binary Proxy Execution: Regsvr32 \\[T1218\\.010] || Obfuscated Files or Information: Steganography \\[T1027\\.003] | Subvert Trust Controls: Code Signing \\[T1553\\.002] || Obfuscated Files or Information: Compile After Delivery \\[T1027\\.004] | File and Directory Permissions Modifications: Linux and Mac File and Directory Permissions Modification \\[T1222\\.002] || Masquerading: Match Legitimate Name or Location \\[T1036\\.005] | Virtualisation/Sandbox Evasion: System Checks \\[T1497\\.001] || Process Injection: Thread Execution Hijacking \\[T1055\\.003] | Masquerading \\[T1036] || Reflective Code Loading \\[T1620] | Impair Defences: Disable or Modify System Firewall \\[T1562\\.004] || Process Injection: Process Hollowing \\[T1055\\.012] | Hide Artifacts: Hidden Files and Directories \\[T1564\\.001] || Indicator Removal: File Deletion \\[T1070\\.004] | Hide Artifacts: Hidden Window \\[T1564\\.003] || Indicator Removal: Timestomp \\[T1070\\.006] | Hijack Execution Flow: DLL Search Order Hijacking \\[T1574\\.001] || Indicator Removal: Clear Windows Event Logs \\[T1070\\.001] | Hijack Execution Flow: DLL Side\\-Loading \\[T1574\\.002] || Modify Registry \\[T1112] | Web Service \\[T1102] || Deobfuscate/Decode Files or Information \\[T1140] | Masquerading: Masquerade Task or Service \\[T1036\\.004] || Impair Defenses \\[T1562] |  || Credential Access (TA0006\\) | || --- | --- || OS Credential Dumping: LSASS Memory \\[T1003\\.001] | Unsecured Credentials: Credentials in Files \\[T1552\\.001] || OS Credential Dumping: NTDS \\[T1003\\.003] | Brute Force: Password Guessing \\[T1110\\.001] || Network Sniffing \\[T1040] | Forced Authentication \\[T1187] || Credentials from Password Stores: Keychain \\[T1555\\.001] | Steal or Forge Kerberos Tickets: Kerberoasting \\[T1558\\.003] || Input Capture: Keylogging \\[T1056\\.001] | Multi\\-Factor Authentication Interception \\[T1111] || Steal Web Session Cookie \\[T1539] | Steal Application Access Token \\[T1528] || Exploitation for Credential Access \\[T1212] | Brute Force: Password Cracking \\[T1110\\.002] || Input Capture: Web Portal Capture \\[T1056\\.003] | OS Credential Dumping: DCSync \\[T1003\\.006] || Credentials from Password Stores \\[T1555] | Credentials from Password Stores: Credentials from Web Browsers \\[T1555\\.003] || Discovery (TA0007\\) | || --- | --- || System Service Discovery \\[T1007] | System Information Discovery \\[T1082] || Application Window Discovery \\[T1010] | Account Discovery: Local Account \\[T1087\\.001] || Query Registry \\[T1012] | System Information Discovery, Technique T1082 \\- Enterprise \\| MITRE ATT\\&CK\u00ae || File and Directory Discovery \\[T1083] | System Time Discovery \\[T1124] || Network Service Discovery \\[T1046] | System Owner/User Discovery \\[T1033] || Remote System Discovery \\[T1018] | Domain Trust Discovery \\[T1482] || Account Discovery: Email Account \\[T1087\\.003] | Account Discovery: Domain Account \\[T1087\\.002] || System Network Connections Discovery \\[T1049] | Virtualisation/Sandbox Evasion: System Checks \\[T1497\\.001] || Process Discovery \\[T1057] | Software Discovery \\[T1518] || Permission Groups Discovery: Domain Groups \\[T1069\\.002] | Network Share Discovery, Technique T1135 \\- Enterprise \\| MITRE ATT\\&CK\u00ae || System Network Configuration Discovery: Internet Connection Discovery \\[T1016\\.001] |  || Lateral Movement (TA0008\\) | || --- | --- || Remote Services: Remote Desktop Protocol \\[T1021\\.001] | Remote Services \\[T1021] || Remote Services: SMB/Windows Admin Shares \\[T1021\\.002] | Use Alternate Authentication Material: Pass the Ticket \\[T1550\\.003] || Remote Services: Windows Remote Management \\[T1021\\.006] | Lateral Tool Transfer \\[T1570] || Collection (TA0009\\) | || --- | --- || Data from Local System \\[T1005] | Archive Collected Data: Archive via Library \\[T1560\\.002] || Data from Network Shared Drive \\[T1039] | Email Collection: Remote Email Collection \\[T1114\\.002] || Input Capture: Keylogging \\[T1056\\.001] | Clipboard Data \\[T1115] || Automated Collection \\[T1119] | Data from Information Repositories \\[T1213] || Input Capture: Web Portal Capture \\[T1056\\.003] | Data Staged: Remote Data Staging \\[T1074\\.002] || Data Staged: Local Data Staging \\[T1074\\.001] | Archive Collected Data \\[T1560] || Email Collection \\[T1114] |  || Exfiltration (TA0010\\) | || --- | --- || Exfiltration Over C2 Channel \\[T1041] | Exfiltration Over Alternative Protocol: Exfiltration Over Asymmetric Encrypted Non\\-C2 Protocol \\[T1048\\.002] || Exfiltration Over Alternative Protocol \\[T1048] | Exfiltration Over Web Service: Exfiltration to Cloud Storage \\[T1567\\.002] || Command and Control (TA0011\\) | || --- | --- || Data Obfuscation: Protocol Impersonation \\[T1001\\.003] | Web Service: Dead Drop Resolver \\[T1102\\.001] || Commonly Used Port \\[T1043] | Web Service: One\\-way Communication \\[T1102\\.003] || Application Layer Protocol: Web Protocols \\[T1071\\.001] | Ingress Tool Transfer \\[T1105] || Application Layer Protocol: File Transfer Protocols \\[T1071\\.002] | Proxy: Internal Proxy \\[T1090\\.001] || Proxy: External Proxy \\[T1090\\.002] | Non\\-Standard Port \\[T1571] || Proxy: Multi\\-hop Proxy \\[T1090\\.003] | Protocol Tunnelling \\[T1572] || Web Service: Bidirectional Communication \\[T1102\\.002] | Encrypted Channel \\[T1573] || Encrypted Channel: Asymmetric Cryptography \\[T1573\\.002] | Ingress Tool Transfer \\[T1105] || Proxy, Technique T1090 \\- Enterprise \\| MITRE ATT\\&CK\u00ae |  || Impact (TA0040\\) | || --- | --- || Service Stop \\[T1489] | Disk Wipe \\[T1561] || System Shutdown/Reboot \\[T1529] | Resource Hijacking \\[T1496] |**Notes**--------- \\[1]\u00a0U.S. Department of Justice. 2021\\. [Four Chinese Nationals Working with the Ministry of State Security Charged with Global Computer Intrusion Campaign Targeting Intellectual Property and Confidential Business Information, Including Infectious Disease Research.](https://www.justice.gov/opa/pr/four-chinese-nationals-working-ministry-state-security-charged-global-computer-intrusion \"Four Chinese Nationals Working with the Ministry of State Security Charged with Global Computer Intrusion Campaign Targeting Intellectual Property and Confidential Business Information, Including Infectious Disease Research\")  \\[2] In this context, an endpoint is a function of the web application. \\[3] Service accounts are not tied to individual users, but rather to services. In a Microsoft corporate domain, there are various kinds of accounts. \\[4] Mounting shares is the process of making files on a file system structure accessible to a user or user group. This product is provided subject to this [Notification](/notification \"Follow link\")  and this [Privacy \\& Use](/privacy-policy \"Follow link\")  policy.### Tags Topics , [Nation\\-State Cyber Actors](/topics/cyber-threats-and-advisories/nation-state-cyber-actors)  , [Organizations and Cyber Safety](/topics/cybersecurity-best-practices/organizations-and-cyber-safety)  , MITRE ATT\\&CK TTP Lateral Movement (TA0008\\), Collection (TA0009\\), Command and Control (TA0011\\), Credential Access (TA0006\\), Defense Evasion (TA0005\\), Discovery (TA0007\\), Execution (TA0002\\), Exfiltration (TA0010\\), Impact (TA0040\\), Initial Access (TA0001\\), Persistence (TA0003\\), Privilege Escalation (TA0004\\), Reconnaissance (TA0043\\), Resource Development (TA0042\\)-------------------------- [product survey](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-190a)  ; Related Advisories------------------ Jul 11, 2024 Cybersecurity Advisory \\| AA24\\-193A### [CISA Red Team\u2019s Operations Against a Federal Civilian Executive Branch Organization Highlights the Necessity of Defense\\-in\\-Depth](/news-events/cybersecurity-advisories/aa24-193a) May 10, 2024 Cybersecurity Advisory \\| AA24\\-131A### [\\#StopRansomware: Black Basta](/news-events/cybersecurity-advisories/aa24-131a) Apr 18, 2024 Cybersecurity Advisory \\| AA24\\-109A### [\\#StopRansomware: Akira Ransomware](/news-events/cybersecurity-advisories/aa24-109a) Feb 29, 2024 Cybersecurity Advisory \\| AA24\\-060A### [\\#StopRansomware: Phobos Ransomware](/news-events/cybersecurity-advisories/aa24-060a)* [Resources \\& Tools](/resources-tools)* [News \\& Events](/news-events)[Cybersecurity \\& Infrastructure Security Agency](/ \"Go to the Cybersecurity & Infrastructure Security Agency homepage\")[1\\-844\\-Say\\-CISA](tel:1-844-Say-CISA) * [Equal Opportunity \\& Accessibility](/oedia \"Equal Opportunity & Accessibility\")",
  "cves": [
    "CVE-2021-26084",
    "CVE-2021-31207",
    "CVE-2021-34523",
    "CVE-2021-44228",
    "CVE-2021-34473"
  ],
  "techniques": [
    "T1078.001",
    "T1059.003",
    "T1546.004",
    "T1036.005",
    "T1021.001",
    "T1560.002",
    "T1555.003",
    "T1074.001",
    "T1078.003",
    "T1137.001",
    "T1087.001",
    "T1048.002",
    "T1059.002",
    "T1102.003",
    "T1505.003",
    "T1003.003",
    "T1543.003",
    "T1090.001",
    "T1110.002",
    "T1027.002",
    "T1027.003",
    "T1053.003",
    "T1078.004",
    "T1055.012",
    "T1588.003",
    "T1547.001",
    "T1056.003",
    "T1059.007",
    "T1583.002",
    "T1110.001",
    "T1550.003",
    "T1562.004",
    "T1218.005",
    "T1016.001",
    "T1021.002",
    "T1102.002",
    "T1552.001",
    "T1074.002",
    "T1059.001",
    "T1070.006",
    "T1036.004",
    "T1584.008",
    "T1595.002",
    "T1070.001",
    "T1558.003",
    "T1053.005",
    "T1547.009",
    "T1003.001",
    "T1087.003",
    "T1589.002",
    "T1003.006",
    "T1589.001",
    "T1071.002",
    "T1587.001",
    "T1027.004",
    "T1218.010",
    "T1585.003",
    "T1055.001",
    "T1569.002",
    "T1555.001",
    "T1564.003",
    "T1566.001",
    "T1564.001",
    "T1566.002",
    "T1078.002",
    "T1134.001",
    "T1059.005",
    "T1001.003",
    "T1021.006",
    "T1090.002",
    "T1553.002",
    "T1583.001",
    "T1204.002",
    "T1102.001",
    "T1587.003",
    "T1563.002",
    "T1567.002",
    "T1059.006",
    "T1087.002",
    "T1114.002",
    "T1574.001",
    "T1070.004",
    "T1056.001",
    "T1071.001",
    "T1505.001",
    "T1059.004",
    "T1587.002",
    "T1055.003",
    "T1069.002",
    "T1574.002",
    "T1593.002",
    "T1090.003",
    "T1588.004",
    "T1222.002",
    "T1573.002",
    "T1053.002",
    "T1497.001",
    "T1590.001"
  ],
  "advisory": "aa24-190a",
  "title": "People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action | CISA",
  "source": "cybersecurity-advisories",
  "id": "6fa5e0e16dc76b6edf04674e4826e270e6e173de489fa5819961c07f12419798"
}