{
  "markdown": "\nOverview\nBackground\nThis advisory, authored by the Australian Signals Directorate\u2019s Australian Cyber Security Centre (ASD\u2019s ACSC), the United States Cybersecurity and Infrastructure Security Agency (CISA), the United States National Security Agency (NSA), the United States Federal Bureau of Investigation (FBI), the United Kingdom National Cyber Security Centre (NCSC-UK), the Canadian Centre for Cyber Security (CCCS), the New Zealand National Cyber Security Centre (NCSC-NZ), the German Federal Intelligence Service (BND) and Federal Office for the Protection of the Constitution (BfV), the Republic of Korea\u2019s National Intelligence Service (NIS) and NIS\u2019 National Cyber Security Center, and Japan\u2019s National Center of Incident Readiness and Strategy for Cybersecurity (NISC) and National Police Agency (NPA)\u2014hereafter referred to as the \u201cauthoring agencies\u201d\u2014outlines a People\u2019s Republic of China (PRC) state-sponsored cyber group and their current threat to Australian networks. The advisory draws on the authoring agencies\u2019 shared understanding of the threat as well as ASD\u2019s ACSC incident response investigations.\nThe PRC state-sponsored cyber group has previously targeted organizations in various countries, including Australia and the United States, and the techniques highlighted below are regularly used by other PRC state-sponsored actors globally. Therefore, the authoring agencies believe the group, and similar techniques remain a threat to their countries\u2019 networks as well.\nThe authoring agencies assess that this group conduct malicious cyber operations for the PRC Ministry of State Security (MSS). The activity and techniques overlap with the groups tracked as Advanced Persistent Threat (APT) 40 (also known as Kryptonite Panda, GINGHAM TYPHOON, Leviathan and Bronze Mohawk in industry reporting). This group has previously been reported as being based in Haikou, Hainan Province, PRC and receiving tasking from the PRC MSS, Hainan State Security Department.[1]\nThe following Advisory provides a sample of significant case studies of this adversary\u2019s techniques in action against two victim networks. The case studies are consequential for cybersecurity practitioners to identify, prevent and remediate APT40 intrusions against their own networks. The selected case studies are those where appropriate remediation has been undertaken reducing the risk of re-exploitation by this threat actor, or others. As such, the case studies are naturally older in nature, to ensure organizations were given the necessary time to remediate.\nTo download the PDF version of this report, visit the following link, APT40 Advisory.\nActivity Summary\nAPT40 has repeatedly targeted Australian networks as well as government and private sector networks in the region, and the threat they pose to our networks is ongoing. The tradecraft described in this advisory is regularly observed against Australian networks.\nNotably, APT40 possesses the capability to rapidly transform and adapt exploit proof-of-concept(s) (POCs) of new vulnerabilities and immediately utilize them against target networks possessing the infrastructure of the associated vulnerability. APT40 regularly conducts reconnaissance against networks of interest, including networks in the authoring agencies\u2019 countries, looking for opportunities to compromise its targets. This regular reconnaissance postures the group to identify vulnerable, end-of-life or no longer maintained devices on networks of interest, and to rapidly deploy exploits. APT40 continues to find success exploiting vulnerabilities from as early as 2017.\nAPT40 rapidly exploits newly public vulnerabilities in widely used software such as Log4J (CVE-2021-44228), Atlassian Confluence (CVE-2021-31207,\u00a0CVE-2021-26084) and Microsoft Exchange (CVE-2021-31207,\u00a0CVE-2021-34523,\u00a0CVE-2021-34473). ASD\u2019s ACSC and the authoring agencies expect the group to continue using POCs for new high-profile vulnerabilities within hours or days of public release.\n\n \n\n\nFigure 1: TTP Flowchart for APT40 activity\nThis group appears to prefer exploiting vulnerable, public-facing infrastructure over techniques that require user interaction, such as phishing campaigns, and places a high priority on obtaining valid credentials to enable a range of follow-on activities. APT40 regularly uses web shells [T1505.003] for persistence, particularly early in the life cycle of an intrusion. Typically, after successful initial access APT40 focuses on establishing persistence to maintain access on the victim\u2019s environment. However, as persistence occurs early in an intrusion, it is more likely to be observed in all intrusions\u2014regardless of the extent of compromise or further actions taken.\nNotable Tradecraft\nAlthough APT40 has previously used compromised Australian websites as command and control (C2) hosts for its operations, the group have evolved this technique [T1594].\nAPT40 has embraced the global trend of using compromised devices, including small-office/home-office (SOHO) devices, as operational infrastructure and last-hop redirectors [T1584.008] for its operations in Australia. This has enabled the authoring agencies to better characterize and track this group\u2019s movements.\nMany of these SOHO devices are end-of-life or unpatched and offer a soft target for N-day exploitation. Once compromised, SOHO devices offer a launching point for attacks that is designed to blend in with legitimate traffic and challenge network defenders [T1001.003].\nThis technique is also regularly used by other PRC state-sponsored actors worldwide, and the authoring agencies consider this to be a shared threat. For additional information, see joint advisories People\u2019s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices and PRC State-Sponsored Actors Compromise and Maintain Persistent Access to U.S. Critical Infrastructure.\nAPT40 does occasionally use procured or leased infrastructure as victim-facing C2 infrastructure in its operations; however, this tradecraft appears to be in relative decline.\nTooling\nASD\u2019s ACSC are sharing some of the malicious files identified during the investigations outlined below. These files have been uploaded to VirusTotal to enable the wider network defense and cyber security communities to better understand the threats they need to defend against.\n\n\n\nMD5\nFilename\nAdditional information\n\n\n\n\n26a5a7e71a601be991073c78d513dee3\nhorizon.jsp\n1 kB | Java Source\n\n\n87c88f06a7464db2534bc78ec2b915de\nIndex_jsp$ProxyEndpoint$Attach.class\n597 B | Java Bytecode\n\n\n6a9bc68c9bc5cefaf1880ae6ffb1d0ca\nIndex_jsp.class\n5 kB | Java Bytecode\n\n\n64454645a9a21510226ab29e01e76d39\nIndex_jsp.java\n5 kB | Java Source\n\n\ne2175f91ce3da2e8d46b0639e941e13f\nIndex_jsp$ProxyEndpoint.class\n4 kB | Java Bytecode\n\n\n9f89f069466b8b5c9bf25c9374a4daf8\nIndex_jsp$ProxyEndpoint$1.class\n3 kB | Java Bytecode\n\n\n187d6f2ed2c80f805461d9119a5878ac\nIndex_jsp$ProxyEndpoint$2.class\n1 kB | Java Bytecode\n\n\ned7178cec90ed21644e669378b3a97ec\nNova_jsp.class\n7 kB | Java Bytecode\n\n\n5bf7560d0a638e34035f85cd3788e258\nNova_jsp$TomcatListenerMemShellFromThread.class\n8 kB | Java Bytecode\n\n\ne02be0dc614523ddd7a28c9e9d500cff\nNova_jsp.java\n15 kB | Java Source\n\n\n\nCase Studies\nASD\u2019s ACSC are sharing two anonymized investigative reports to provide awareness of how the actors employ their tools and tradecraft.\nCase Study 1\nThis report has been anonymized to enable wider dissemination. The impacted organization is hereafter referred to as \u201cthe organization.\u201d Some specific details have been removed to protect the identity of the victim and incident response methods of ASD\u2019s ACSC.\n\nExecutive Summary\nThis report details the findings of the ASD\u2019s ACSC investigation into the successful compromise of the organization\u2019s network between July and September 2022. This investigative report was provided to the organization to summarize observed malicious activity and frame remediation recommendations. The findings indicate the compromise was undertaken by APT40.\nIn mid-August, the ASD\u2019s ACSC notified the organization of malicious interactions with their network from a likely compromised device being used by the group in late August and, with the organization\u2019s consent, the ASD\u2019s ACSC deployed host-based sensors to likely affected hosts on the organization\u2019s network. These sensors allowed ASD\u2019s ACSC incident response analysts to undertake a thorough digital forensics investigation. Using available sensor data, the ASD\u2019s ACSC analysts successfully mapped the group\u2019s activity and created a detailed timeline of observed events.\nFrom July to August, key actor activity observed by the ASD\u2019s ACSC included:\n\nHost enumeration, which enables an actor to build their own map of the network;\nWeb shell use, giving the actor an initial foothold on the network and a capability to execute commands; and\nDeployment of other tooling leveraged by the actor for malicious purposes.\n\nThe investigation uncovered evidence of large amounts of sensitive data being accessed and evidence that the actors moved laterally through the network [T1021.002]. Much of the compromise was facilitated by the group\u2019s establishment of multiple access vectors into the network, the network having a flat structure, and the use of insecure internally developed software that could be used to arbitrarily upload files. Exfiltrated data included privileged authentication credentials that enabled the group to log in, as well as network information that would allow the actors to regain unauthorized access if the original access vector was blocked. No additional malicious tooling was discovered beyond those on the initially exploited machine; however, a group\u2019s access to legitimate and privileged credentials would negate the need for additional tooling. Findings from the investigation indicate the organization was likely deliberately targeted by APT40, as opposed to falling victim opportunistically to a publicly known vulnerability.\nInvestigation Findings\nIn mid-August 2022, the ASD\u2019s ACSC notified the organization that a confirmed malicious IP believed to be affiliated with a state-sponsored cyber group had interacted with the organization\u2019s computer networks between at least July and August. The compromised device probably belonged to a small business or home user.\nIn late August, the ASD\u2019s ACSC deployed a host-based agent to hosts on the organization\u2019s network which showed evidence of having been impacted by the compromise.\nSome artefacts which could have supported investigation efforts were not available due to the configuration of logging or network design. Despite this, the organization\u2019s readiness to provide all available data enabled ASD\u2019s ACSC incident responders to conduct comprehensive analysis and to form an understanding of likely APT40 activity on the network.\nIn September, after consultation with the ASD\u2019s ACSC, the organization decided to denylist the IP identified in the initial notification. In October, the organization commenced remediation.\nDetails\nBeginning in July, actors were able to test and exploit a custom web application [T1190] running on <webapp>2-ext, which enables the group to establish a foothold in the network demilitarized zone (DMZ). This was leveraged to enumerate both the network as well as all visible domains. Compromised credentials [T1078.002] were used to query the Active Directory [T1018] and exfiltrate data by mounting file shares [T1039] from multiple machines within the DMZ. The actor carried out a Kerberoasting attack in order to obtain valid network credentials from a server [T1558.003]. The group were not observed gaining any additional points of presence in either the DMZ or the internal network.\nVisual Timeline\nThe below timeline provides a broad overview of the key phases of malicious actor activity observed on the organization\u2019s network.\n\n \n\n\nDetailed Timeline\nJuly: The actors established an initial connection to the front page of a custom web application [T1190] built for the organization (hereafter referred to as the \u201cweb application\u201d or \u201cwebapp\u201d) via a transport layer security (TLS) connection [T1102]. No other noteworthy activity was observed.\nJuly: The actors begin enumerating the web application\u2019s website looking for endpoints[2] to further investigate.\nJuly: The actors concentrate on attempts to exploit a specific endpoint.\nJuly: The actors are able to successfully\u00a0POST\u00a0to the web server, probably via a web shell placed on another page. A second IP, likely employed by the same actors, also begins posting to the same URL. The actors created and tested a number of likely web shells.\u00a0\nThe exact method of exploitation is unknown, but it is clear that the specific endpoint was targeted to create files on\u00a0<webapp>2-ext.\nASD's ACSC believes that the two IP address connections were part of the same intrusion due to their shared interest and initial connections occurring minutes apart.\nJuly: The group continue to conduct host enumeration, looking for privilege escalation opportunities, and deploying a different web shell. The actors log into the web application using compromised credentials for\u00a0<firstname.surname>@<organisation domain>.\nThe actors\u2019 activity does not appear to have successfully achieved privilege escalation on\u00a0<webapp>2-ext. Instead, the actors pivoted to network-based activity.\nJuly:\u00a0The actor tests the compromised credentials for a service account[3] which it likely found hardcoded in internally accessible binaries.\nJuly: The actors deploy the open-source tool Secure Socket Funnelling, which was used to connect out to the malicious infrastructure. This connection is employed to tunnel traffic from the actor's attack machines into the organization\u2019s internal networks, whose machine names are exposed in event logs as they attempt to use the credentials for the service account.\nAugust: The actors are seen conducting a limited amount of activity, including failing to establish connections involving the service account.\nAugust: The actors perform significant network and Active Directory enumeration. A different compromised account is subsequently employed to mount shares[4] on Windows machines within the DMZ, enabling successful data exfiltration.\nThis seems to be opportunistic usage of a stolen credential on mountable machines in the DMZ. Firewalls blocked the actor from targeting the internal network with similar activity.\nAugust \u2013 September: The SSF tool re-established a connection to a malicious IP. The group are not observed performing any additional activities until their access is blocked.\nSeptember: The organization blocks the malicious IP by denylisting it on their firewalls.\nActor Tactics and Techniques\nThe MITRE ATT&CK framework is a documented collection of tactics and techniques employed by threat actors in cyberspace. The framework was created by U.S. not-for-profit The MITRE Corporation and functions as a common global language around threat actor behavior.\nThe ASD\u2019s ACSC assesses the following techniques and tactics to be relevant to the actor\u2019s malicious activity:\nReconnaissance\nT1594 \u2013 Search Victim-Owned Websites\nThe actor enumerated the custom web application\u2019s website to identify opportunities for accessing the network.\nInitial Access\nT1190 \u2013 Exploit Public-Facing Application (regarding exploiting the custom web application)\nT1078.002 \u2013 Valid Accounts: Domain Accounts (regarding logging on with comprised credentials)\nExploiting internet-exposed custom web applications provided an initial point of access for the actor. The actor was later able to use credentials they had compromised to further their access to the network.\nExecution\nT1059 \u2013 Command and Scripting Interpreter (regarding command execution through the web shell)\nT1072 \u2013 Software Deployment Tools (regarding the actor using open-source tool Secure Socket Funnelling (SSF) to connect to an IP)\nPersistence\nT1505.003 \u2013 Server Software Component: Web Shell (regarding use of a web shell and SSF to establish access)\nCredential Access\nT1552.001 \u2013 Credentials from Password Stores (regarding password files relating to building management system [BMS])\nT1558.003 \u2013 Steal or Forge Kerberos Tickets: Kerberoasting (regarding attack to gain network credentials)\nLateral movement\nT1021.002 \u2013 Remote Services: SMB Shares (regarding the actor mounting SMB shares from multiple devices)\nCollection\nT1213 \u2013 Data from Information Repositories (regarding manuals/documentation found on the BMS server)\nExfiltration\nT1041 \u2013 Exfiltration Over C2 Channel (regarding the actor\u2019s data exfiltration from Active Directory and mounting shares)\nCase Study 2\nThis report has been anonymized to enable wider dissemination. The impacted organization is hereafter referred to as \u201cthe organization.\u201d Some specific details have been removed to protect the identity of the victim and incident response methods of ASD\u2019s ACSC.\nExecutive Summary\nThis report details the findings of ASD\u2019s ACSC investigation into the successful compromise of the organization\u2019s network in April 2022. This investigation report was provided to the organization to summarize observed malicious activity and frame remediation recommendations. The findings indicate the compromise was undertaken by APT40.\nIn May 2022, ASD\u2019s ACSC notified an organization of suspected malicious activity impacting the organization\u2019s network since April 2022. Subsequently, the organization informed ASD's ACSC that they had discovered malicious software on an internet\u2011facing server which provided the login portal for the organization\u2019s corporate remote access solution. This server used a remote access login and identity management product and will be referred to in this report as 'the compromised appliance'. This report details the investigation findings and remediation advice developed for the organization in response to the investigation conducted by the ASD\u2019s ACSC.\nEvidence indicated that part of the organization\u2019s network had been compromised by malicious cyber actor(s) via the organization\u2019s remote access login portal since at least April 2022. This server may have been compromised by multiple actors, and was likely affected by a remote code execution (RCE) vulnerability that was widely publicized around the time of the compromise.\nKey actor activity observed by the ASD\u2019s ACSC included:\n\nHost enumeration, which enables an actor to build their own map of the network;\nExploitation of internet-facing applications and web shell use, giving the actor an initial foothold on the network and a capability to execute commands;\nExploitation of software vulnerabilities to escalate privileges; and\nCredential collection to enable lateral movement.\n\nThe ASD\u2019s ACSC discovered that a malicious actor had exfiltrated several hundred unique username and password pairs on the compromised appliance in April 2022, as well as a number of multi-factor authentication codes and technical artefacts related to remote access sessions. Upon a review by the organization, the passwords were found to be legitimate. The ASD\u2019s ACSC assesses that the actor may have collected these technical artefacts to hijack or create a remote login session as a legitimate user, and access the organization\u2019s internal corporate network using a legitimate user account.\nInvestigation Summary\nThe ASD\u2019s ACSC determined that the actor compromised appliance(s) which provide remote login sessions for organization staff and used this compromise to attempt to conduct further activity. These appliances consist of three load-balanced hosts where the earliest evidence of compromise was detected. The organization shut down two of the three load-balanced hosts shortly after the initial compromise. As a result, all subsequent activity occurred on a single host. The other servers associated with the compromised appliance were also load-balanced in a similar manner. For legibility, all compromised appliances are referred to in most of this report as a \u201csingle appliance.\u201d\nThe actor is believed to have used publicly known vulnerabilities to deploy web shells to the compromised appliance from April 2022 onwards. Threat actors from the group are assessed to have attained escalated privileges on the appliance. The ASD\u2019s ACSC could not determine the full extent of the activity due to lack of logging availability. However, evidence on the device indicates that an actor achieved the following:\n\nThe collection of several hundred genuine username and password pairs; and\nThe collection of technical artefacts which may have allowed a malicious actor to access a virtual desktop infrastructure (VDI) session as a legitimate user.\n\nThe ASD\u2019s ACSC assesses that the actor would have sought to further the compromise of the organisation network. The artefacts exfiltrated by the actor may have allowed them to hijack or initiate virtual desktop sessions as a legitimate user, possibly as a user of their choice, including administrators. The actor may have used this access vector to further compromise organization services to achieve persistence and other goals.\nOther organization appliances within the hosting provider managed environment did not show evidence of compromise.\nAccess\nThe host with the compromised appliance provided authentication via Active Directory and a webserver, for users connecting to VDI sessions [T1021.001].\n\n\n\nLocation\nCompromised appliance hostnames (load-balanced)\n\n\nDatacentre 1\nHOST1, HOST2, HOST3\n\n\n\nThe appliance infrastructure also included access gateway hosts that provide a tunnel to the VDI for the user, once they possess an authentication token generated and downloaded from the appliance.\nThere was no evidence of compromise of any of these hosts. However, the access gateway hosts logs showed evidence of significant interactions with known malicious IP addresses. It is likely that this reflected activity that occurred on this host, or network connections with threat actor infrastructure that reached this host. The nature of this activity could not be determined using available evidence but indicates that the group sought to move laterally in the organization\u2019s network [TA0008].\nInternal Hosts\nThe ASD\u2019s ACSC investigated limited data from the internal organization\u2019s network segment. Attempted or successful malicious activity known to have impacted the internal organization\u2019s network segment includes actor access to VDI-related artefacts, the scraping of an internal SQL server [T1505.001], and unexplained traffic observed going from known malicious IP addresses through the access gateway appliances [TA0011].\nUsing their access to the compromised appliance, the group collected genuine usernames, passwords [T1003], and MFA token values [T1111]. The group also collected JSON Web Tokens (JWTs) [T1528], which is an authentication artefact used to create virtual desktop login sessions. The actor may have been able to use these to create or hijack virtual desktop sessions [T1563.002] and access the internal organization network segment as a legitimate user [T1078].\nThe actor also used access to the compromised appliance to scrape an SQL server [T1505.001], which resided in the organization\u2019s internal network. It is likely that the actor had access to this data.\nEvidence available from the access gateway appliance revealed that network traffic occurred through or to this device from known malicious IP addresses. As described above, this may indicate that malicious cyber actors impacted or utilized this device, potentially to pivot into the internal network.\nInvestigation Timeline\nThe below list provides a timeline of key activities discovered during the investigation.\n\n\n\nTime\nEvent\n\n\n\n\nApril\u00a02022\nKnown\u00a0malicious\u00a0IP\u00a0addresses\u00a0interact\u00a0with\u00a0access\u00a0gateway host\u00a0HOST7.\u00a0The\u00a0nature\u00a0of\u00a0the interactions\u00a0could\u00a0not\u00a0be\u00a0determined.\n\n\nApril\u00a02022\n\nAll\u00a0hosts,\u00a0HOST1, HOST2\u00a0and\u00a0HOST3, were\u00a0compromised\u00a0by\u00a0a\u00a0malicious\u00a0actor\u00a0or\u00a0actors, and\u00a0web\u00a0shells\u00a0were\u00a0placed\u00a0on\u00a0the\u00a0hosts.\nA\u00a0log\u00a0file\u00a0was created\u00a0or\u00a0modified\u00a0on HOST2.\u00a0This\u00a0file contains\u00a0credential\u00a0material\u00a0likely captured\u00a0by\u00a0a\u00a0malicious\u00a0actor.\nThe\u00a0/etc/security/opasswd\u00a0and\u00a0/etc/shadow\u00a0files were\u00a0modified\u00a0on\u00a0HOST1\u00a0and\u00a0HOST3, indicating\u00a0that\u00a0passwords\u00a0were\u00a0changed.\u00a0Evidence\u00a0available\u00a0on\u00a0HOST1 suggests\u00a0that\u00a0the password for user \u2018sshuser\u2019 was changed.\n\n\n\nApril\u00a02022\n\nHOST2\u00a0was\u00a0shut\u00a0down by\u00a0the\u00a0organization.\nAdditional\u00a0web\u00a0shells\u00a0(T1505.003)\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0and\u00a0HOST3.\u00a0HOST1experienced SSH brute force attempts from HOST3.\nA\u00a0log\u00a0file\u00a0was\u00a0modified\u00a0(T1070)\u00a0on\u00a0HOST3.\u00a0This file\u00a0contains\u00a0credential\u00a0material\u00a0(T1078) likely captured by a malicious actor.\nJWTs\u00a0were\u00a0captured\u00a0(T1528)\u00a0and\u00a0output\u00a0to\u00a0a\u00a0file\u00a0on\u00a0HOST3.\nHOST3\u00a0was\u00a0shut\u00a0down\u00a0by\u00a0the\u00a0organization.\u00a0All\u00a0activity\u00a0after\u00a0this\u00a0time\u00a0occurs\u00a0on\u00a0HOST1.\n\n\n\nApril\u00a02022\nAdditional\u00a0web\u00a0shells\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0(T1505.003).\u00a0JWTs\u00a0were\u00a0captured\u00a0and\u00a0output to\u00a0a\u00a0file\u00a0on\u00a0HOST1.\n\n\nApril\u00a02022\n\nAdditional\u00a0web\u00a0shells are\u00a0created\u00a0on\u00a0HOST1\u00a0(T1505.003),\u00a0and a\u00a0known\u00a0malicious\u00a0IP\u00a0address interacts\u00a0with\u00a0the\u00a0host\u00a0(TA0011).\nA\u00a0known\u00a0malicious\u00a0IP\u00a0address\u00a0interacts\u00a0with\u00a0access\u00a0gateway\u00a0host\u00a0HOST7.\n\n\n\nMay\u00a02022\n\nA known\u00a0malicious\u00a0IP\u00a0address\u00a0interacted\u00a0with\u00a0access\u00a0gateway host\u00a0HOST7\u00a0(TA0011).\nAn\u00a0authentication\u00a0event\u00a0for\u00a0a\u00a0user\u00a0is\u00a0linked\u00a0to\u00a0a\u00a0known\u00a0malicious\u00a0IP\u00a0address\u00a0in\u00a0logs on HOST1.\u00a0An\u00a0additional\u00a0web\u00a0shell\u00a0is\u00a0created\u00a0on\u00a0this\u00a0host\u00a0(T1505.003).\n\n\n\nMay\u00a02022\nA\u00a0script on\u00a0HOST1\u00a0was modified\u00a0by\u00a0an\u00a0actor\u00a0(T1543).\u00a0This script\u00a0contains\u00a0functionality which would have scraped data from an internal SQL server.\n\n\nMay\u00a02022\nAn\u00a0additional\u00a0log\u00a0file\u00a0on\u00a0HOST1\u00a0was\u00a0last\u00a0modified\u00a0(T1070).\u00a0This\u00a0file\u00a0contains\u00a0username\u00a0and password\u00a0pairs\u00a0for the\u00a0organization\u00a0network,\u00a0which\u00a0are\u00a0believed\u00a0to\u00a0be\u00a0legitimate\u00a0(T1078).\n\n\nMay\u00a02022\nAn\u00a0additional log\u00a0file\u00a0was\u00a0last\u00a0modified\u00a0(T1070).\u00a0This\u00a0file\u00a0contains\u00a0JWTs\u00a0collected\u00a0from HOST1.\n\n\nMay\u00a02022\nAdditional\u00a0web\u00a0shells\u00a0were\u00a0created\u00a0on\u00a0HOST1\u00a0(T1505.003).\u00a0On\u00a0this\u00a0date, the\u00a0organization reported\u00a0the\u00a0discovery\u00a0of\u00a0a\u00a0web\u00a0shell\u00a0with\u00a0creation\u00a0date\u00a0in\u00a0April 2022\u00a0to\u00a0ASD\u2019s ACSC\n\n\nMay\u00a02022\nA\u00a0number\u00a0of\u00a0scripts were\u00a0created\u00a0on HOST1,\u00a0including\u00a0one named\u00a0Log4jHotPatch.jar.\n\n\nMay\u00a02022\nThe\u00a0iptables-save\u00a0command was\u00a0used\u00a0to\u00a0add\u00a0two\u00a0open\u00a0ports to\u00a0the\u00a0access gateway\u00a0host. The\u00a0ports\u00a0were\u00a09998\u00a0and\u00a09999\u00a0(T1572).\n\n\n\nActor Tactics and Techniques\nHighlighted below are several tactics and techniques identified during the investigation.\nInitial\u00a0access\nT1190\u00a0Exploit\u00a0public\u00a0facing\u00a0application\nThe group likely exploited RCE, privilege escalation, and\u00a0authentication\u00a0bypass\u00a0vulnerabilities\u00a0in\u00a0the\u00a0remote\u00a0access\u00a0login\u00a0and\u00a0identity\u00a0management\u00a0product\u00a0to\u00a0gain initial access to the network.\nThis\u00a0initial\u00a0access\u00a0method\u00a0is considered\u00a0the most\u00a0likely\u00a0due to the following:\n\nThe\u00a0server\u00a0was\u00a0vulnerable\u00a0to\u00a0these\u00a0CVEs\u00a0at\u00a0the time;\nAttempts\u00a0to\u00a0exploit\u00a0these\u00a0vulnerabilities\u00a0from\u00a0known actor infrastructure; and\nThe first known internal malicious activity occurred\u00a0shortly\u00a0after\u00a0attempted\u00a0exploitation attempts were made.\n\nExecution\nT1059.004\u00a0Command\u00a0and Scripting\u00a0Interpreter:\u00a0Unix Shell\nThe group successfully exploited the above vulnerabilities\u00a0may\u00a0have\u00a0been\u00a0able\u00a0to\u00a0run\u00a0commands in a Unix shell available on the affected appliance.\nComplete details of the commands run by actors cannot\u00a0be\u00a0provided\u00a0as\u00a0they\u00a0were\u00a0not\u00a0logged\u00a0by\u00a0the appliance.\nPersistence\nT1505.003\u00a0Server\u00a0Software\u00a0Component:\u00a0Web Shell\nActors deployed several web shells on the affected appliance. It is possible that multiple distinct actors deployed\u00a0web\u00a0shells,\u00a0but\u00a0that\u00a0only\u00a0a\u00a0smaller\u00a0number\u00a0of\u00a0actors conducted activity using these web shells.\nWeb\u00a0shells\u00a0would\u00a0have\u00a0allowed\u00a0for\u00a0arbitrary\u00a0command\u00a0execution by the actor on the compromised appliances.\nPrivilege\u00a0escalation\nT1068\u00a0Exploitation\u00a0for Privilege\u00a0Escalation\nAvailable evidence does not describe the level of privilege attained by actors. However, using web shells, the actors would have achieved a level of privilege\u00a0comparable\u00a0to\u00a0that\u00a0of\u00a0the\u00a0web\u00a0server\u00a0on\u00a0the\u00a0compromised appliance. Vulnerabilities believed to have been present on the compromised appliance\nwould\u00a0have\u00a0allowed\u00a0the\u00a0actors\u00a0to\u00a0attain\u00a0root\u00a0privileges.\nCredential\u00a0access\nT1056.003\u00a0Input\u00a0Capture:\u00a0Web\u00a0Portal\u00a0Capture\nEvidence on the compromised appliance showed that the actor had captured several hundred username-password\u00a0pairs,\u00a0in\u00a0clear\u00a0text,\u00a0which\u00a0are believed\u00a0to\u00a0be\u00a0legitimate.\u00a0It\u00a0is\u00a0likely\u00a0that\u00a0these\u00a0were\u00a0captured\u00a0using\u00a0some\u00a0modification\u00a0to\u00a0the\u00a0genuine authentication\u00a0process\u00a0which\u00a0output\u00a0the credentials\u00a0to a\u00a0file.\nT1111\u00a0Multi-Factor\u00a0Authentication\u00a0Interception The\u00a0actor\u00a0also\u00a0captured\u00a0the\u00a0value\u00a0of\u00a0MFA\u00a0tokens\ncorresponding to legitimate logins. These were likely captured by modifying the genuine authentication process to output these values to a file. There is no evidence of compromise of the \u201csecret server\u2019 which stores\u00a0the\u00a0unique\u00a0values\u00a0that\u00a0provide\u00a0for\u00a0the\u00a0security\u00a0of\u00a0MFA\u00a0tokens.\nT1040\u00a0Network\u00a0Sniffing\nThe actor is believed to have captured JWTs by capturing HTTP traffic on the compromised appliance. There\u00a0is\u00a0evidence\u00a0that\u00a0the\u00a0utility\u00a0tcpdump\u00a0was\u00a0executed on the compromised appliance, which may have been how the actor captured these JWTs.\nT1539\u00a0Steal\u00a0Web Session\u00a0Cookie\nAs\u00a0described\u00a0above,\u00a0the\u00a0actor\u00a0captured\u00a0JWTs,\u00a0which\u00a0are\u00a0analogous to web session cookies. These could have been reused by the actor to establish further access.\nDiscovery\nT1046\u00a0Network Service\u00a0Discovery\nThere\u00a0is\u00a0evidence\u00a0that\u00a0network\u00a0scanning\u00a0utility nmap was executed on the compromised appliance to\u00a0scan other appliances in the same network segment. This was likely used by the actor to discover other reachable network services which might present opportunities for lateral movement.\nCollection\nAvailable evidence does not reveal how actors collected data or exactly what was collected from the\u00a0compromised\u00a0appliance\u00a0or\u00a0from\u00a0other\u00a0systems. However,\u00a0it\u00a0is\u00a0likely\u00a0that\u00a0actors\u00a0had\u00a0access\u00a0to\u00a0all\u00a0files\u00a0on the compromised appliance, including the captured\u00a0credentials\u00a0[T1003],\u00a0MFA\u00a0token\u00a0values\u00a0[T1111],\u00a0and\u00a0JWTs described above.\nCommand\u00a0and\u00a0Control\nT1071.001\u00a0Application\u00a0Layer\u00a0Protocol:\u00a0Web\u00a0Protocols\nActors\u00a0used\u00a0web\u00a0shells\u00a0for\u00a0command\u00a0and\u00a0control.\u00a0Web\u00a0shell commands would have been passed over HTTPS\u00a0using\u00a0the\u00a0existing\u00a0web\u00a0server\u00a0on\u00a0the appliance\u00a0[T1572].\nT1001.003\u00a0Data\u00a0Obfuscation:\u00a0Protocol\u00a0Impersonation\nActors\u00a0used\u00a0compromised\u00a0devices\u00a0as\u00a0a\u00a0launching\u00a0point for\u00a0attacks\u00a0that\u00a0are\u00a0designed\u00a0to\u00a0blend\u00a0in\u00a0with\u00a0legitimate\u00a0traffic.\nDetection\u00a0and\u00a0mitigation recommendations\nThe\u00a0ASD\u2019s\u00a0ACSC\u00a0strongly\u00a0recommends\u00a0implementing\u00a0the\u00a0ASD\u00a0Essential\u00a0Eight\u00a0Controls\u00a0and\u00a0associated\u00a0Strategies\u00a0to\u00a0Mitigate\u00a0Cyber\u00a0Security\u00a0Incidents.\u00a0Below are recommendations for network security actions that\u00a0should\u00a0be\u00a0taken\u00a0to\u00a0detect\u00a0and\u00a0prevent\u00a0intrusions by\u00a0APT40,\u00a0followed\u00a0by\u00a0specific\u00a0mitigations\u00a0for\u00a0four\u00a0key\u00a0TTPs\u00a0summarized\u00a0in\u00a0Table\u00a01.\nDetection\nSome of the files identified above were dropped in locations such as C:\\Users\\Public\\* and C:\\Windows\\ Temp\\*.\u00a0These locations can be convenient spots for writing data as they are usually world writable, that is, all user accounts registered in Windows have access to these directories and their subdirectories. Often, any\u00a0user\u00a0can\u00a0subsequently\u00a0access\u00a0these\u00a0files,\u00a0allowing opportunities for lateral movement, defense evasion, low-privilege execution and staging for exfiltration.\nThe\u00a0following\u00a0Sigma\u00a0rules\u00a0look\u00a0for\u00a0execution\u00a0from suspicious locations as an indicator of anomalous activity.\u00a0In\u00a0all\u00a0instances,\u00a0subsequent\u00a0investigation\u00a0is required\u00a0to\u00a0confirm\u00a0malicious\u00a0activity\u00a0and\u00a0attribution.\n\n\n\n\nTitle:\u00a0World\u00a0Writable\u00a0Execution\u00a0-\u00a0Temp\nID:\u00a0d2fa2d71-fbd0-4778-9449-e13ca7d7505c\nDescription: Detect process execution from C:\\ Windows\\Temp.\nBackground: This\u00a0rule\u00a0looks\u00a0specifically\u00a0for\u00a0execution\u00a0out\u00a0of\u00a0C:\\ Windows\\Temp\\*.\u00a0Temp\u00a0is\u00a0more\u00a0broadly\u00a0used\u00a0by benign applications and thus a lower confidence malicious\u00a0indicator\u00a0than\u00a0execution\u00a0out\u00a0of\u00a0other\u00a0world\u00a0writable subdirectories in C:\\Windows.\nRemoving applications executed by the SYSTEM or NETWORK SERVICE users substantially reduces the quantity of benign activity selected by this rule.\nThis\u00a0means\u00a0that\u00a0the\u00a0rule\u00a0may\u00a0miss\u00a0malicious\u00a0executions\u00a0at\u00a0a\u00a0higher\u00a0privilege\u00a0level\u00a0but\u00a0it\u00a0is\u00a0recommended\u00a0to use\u00a0other\u00a0rules\u00a0to\u00a0determine\u00a0if\u00a0a\u00a0user\u00a0is\u00a0attempting\u00a0to elevate privileges to SYSTEM.\nInvestigation:\n\nExamine information directly associated with this file execution, such\u00a0as\u00a0the user\u00a0context,\u00a0execution integrity level, immediate follow-on activity and images loaded by the file.\nInvestigate\u00a0contextual\u00a0process,\u00a0network,\u00a0file and other supporting data on the host to help\u00a0make\u00a0an\u00a0assessment\u00a0as\u00a0to\u00a0whether\u00a0the\u00a0activity\u00a0is\u00a0malicious.\nIf\u00a0necessary\u00a0attempt\u00a0to\u00a0collect\u00a0a\u00a0copy\u00a0of\u00a0the\u00a0file\u00a0for\u00a0reverse\u00a0engineering\u00a0to\u00a0determine\u00a0whether\u00a0it\u00a0is\u00a0legitimate.\n\nReferences:\nProcess Execution from an Unusual Directory\nAuthor:\u00a0ASD\u2019s ACSC\nDate:\u00a02024/06/19\nStatus:\u00a0experimental\nTags:\n\ntlp.green\nclassification.au.official\nattack.execution\n\nLog\u00a0Source:\ncategory:\u00a0process_creationproduct:\u00a0windows\nDetection:\ntemp:Image|startswith:\u00a0'C:\\\\Windows\\\\Temp\\\\'\ncommon_temp_path:Image|re|ignorecase:\u00a0'C:\\\\Windows\\\\Temp\\\\\\{[a-fA-F0-9]{8}-([a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}\\}\\\\'\nsystem_user:User:\n\n'SYSTEM'\n'NETWORK\u00a0SERVICE'\n\ndismhost:\n\nImage|endswith: 'dismhost.exe'\u00a0\n\nknown_parent:\n\nParentImage|endswith:\n'\\\\esif_uf.exe'\u00a0\n'\\\\vmtoolsd.exe'\u00a0\n'\\\\cwainstaller.exe'\n'\\\\trolleyexpress.exe'\n\ncondition: temp and not (common_temp_path or system_user or dismhost or known_parent)\nFalse positives:\n\nAllowlist auditing applications have been observed running executables from Temp.\nTemp will legitimately contain an array of setup applications and launchers, so it will be worth considering how prevalent this behavior is on a monitored network (and whether or not it can be allowlisted) before deploying this rule.\n\nLevel: low\n\n\n\n\n\n\n\n\nTitle:\u00a0World Writable Execution - Non-Temp System Subdirectory\nID: 5b187157-e892-4fc9-84fc-aa48aff9f997\nDescription: Detect process execution from a world writable location in a subdirectory of the Windows OS install location.\nBackground:\nThis rule looks specifically for execution out of world writable directories within C:\\ and particularly C:\\Windows\\*, with the exception of C:\\Windows\\Temp (which is more broadly used by benign applications and thus a lower confidence malicious indicator).\nAppData folders are excluded if a file is run as SYSTEM - this is a benign way in which many temporary application files are executed.\nAfter completing an initial network baseline and identifying known benign executions from these locations, this rule should rarely fire.\nInvestigation:\n\nExamine information directly associated with this file execution, such as the user context, execution integrity level, immediate follow-on activity and images loaded by the file.\nInvestigate contextual process, network, file and other supporting data on the host to help make an assessment as to whether the activity is malicious.\nIf necessary attempt to collect a copy of the file for reverse engineering to determine whether it is legitimate.\n\nReferences:\nmattifestation / WorldWritableDirs.txtProcess Execution from an Unusual Directory\nAuthor: ASD\u2019s ACSC\nDate: 2024/06/19\nStatus: experimental\nTags:\n\ntlp.green\nclassification.au.official\nattack.execution\n\nLog source:\ncategory: process_creationproduct: windows\nDetection:\nwritable_path:Image|contains:\n\n':\\\\$Recycle.Bin\\\\'\n':\\\\AMD\\\\Temp\\\\'\n':\\\\Intel\\\\'\n':\\\\PerfLogs\\\\'\n':\\\\Windows\\\\addins\\\\'\n':\\\\Windows\\\\appcompat\\\\'\n':\\\\Windows\\\\apppatch\\\\'\n':\\\\Windows\\\\AppReadiness\\\\'\n':\\\\Windows\\\\bcastdvr\\\\'\n':\\\\Windows\\\\Boot\\\\'\n':\\\\Windows\\\\Branding\\\\'\n':\\\\Windows\\\\CbsTemp\\\\'\n':\\\\Windows\\\\Containers\\\\'\n':\\\\Windows\\\\csc\\\\'\n':\\\\Windows\\\\Cursors\\\\'\n':\\\\Windows\\\\debug\\\\'\n':\\\\Windows\\\\diagnostics\\\\'\n':\\\\Windows\\\\DigitalLocker\\\\'\n':\\\\Windows\\\\dot3svc\\\\'\n':\\\\Windows\\\\en-US\\\\'\n':\\\\Windows\\\\Fonts\\\\'\n':\\\\Windows\\\\Globalization\\\\'\n':\\\\Windows\\\\Help\\\\'\n':\\\\Windows\\\\IdentityCRL\\\\'\n':\\\\Windows\\\\IME\\\\'\n':\\\\Windows\\\\ImmersiveControlPanel\\\\'\n':\\\\Windows\\\\INF\\\\'\n':\\\\Windows\\\\intel\\\\'\n':\\\\Windows\\\\L2Schemas\\\\'\n':\\\\Windows\\\\LiveKernelReports\\\\'\n':\\\\Windows\\\\Logs\\\\'\n':\\\\Windows\\\\media\\\\'\n':\\\\Windows\\\\Migration\\\\'\n':\\\\Windows\\\\ModemLogs\\\\'\n':\\\\Windows\\\\ms\\\\'\n':\\\\Windows\\\\OCR\\\\'\n':\\\\Windows\\\\panther\\\\'\n':\\\\Windows\\\\Performance\\\\'\n':\\\\Windows\\\\PLA\\\\'\n':\\\\Windows\\\\PolicyDefinitions\\\\'\n':\\\\Windows\\\\Prefetch\\\\'\n':\\\\Windows\\\\PrintDialog\\\\'\n':\\\\Windows\\\\Provisioning\\\\'\n':\\\\Windows\\\\Registration\\\\CRMLog\\\\'\n':\\\\Windows\\\\RemotePackages\\\\'\n':\\\\Windows\\\\rescache\\\\'\n':\\\\Windows\\\\Resources\\\\'\n':\\\\Windows\\\\SchCache\\\\'\n':\\\\Windows\\\\schemas\\\\'\n':\\\\Windows\\\\security\\\\'\n':\\\\Windows\\\\ServiceState\\\\'\n':\\\\Windows\\\\servicing\\\\'\n':\\\\Windows\\\\Setup\\\\'\n':\\\\Windows\\\\ShellComponents\\\\'\n':\\\\Windows\\\\ShellExperiences\\\\'\n':\\\\Windows\\\\SKB\\\\'\n':\\\\Windows\\\\TAPI\\\\'\n':\\\\Windows\\\\Tasks\\\\'\n':\\\\Windows\\\\TextInput\\\\'\n':\\\\Windows\\\\tracing\\\\'\n':\\\\Windows\\\\Vss\\\\'\n':\\\\Windows\\\\WaaS\\\\'\n':\\\\Windows\\\\Web\\\\'\n':\\\\Windows\\\\wlansvc\\\\'\n':\\\\Windows\\\\System32\\\\Com\\\\dmp\\\\'\n':\\\\Windows\\\\System32\\\\FxsTmp\\\\'\n':\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\RSA\\\\MachineKeys\\\\'\n':\\\\Windows\\\\System32\\\\Speech\\\\'\n':\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\'\n':\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\'\n':\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\'\n':\\\\Windows\\\\System32\\\\Tasks_Migrated\\\\Microsoft\\\\Windows\\\\PLA\\\\System\\\\'\n':\\\\Windows\\\\System32\\\\Tasks\\\\'\n':\\\\Windows\\\\SysWOW64\\\\Com\\\\dmp\\\\'\n':\\\\Windows\\\\SysWOW64\\\\FxsTmp\\\\'\n':\\\\Windows\\\\SysWOW64\\\\Tasks\\\\'\n\nappdata:Image|contains:\u00a0'\\\\AppData\\\\'User:\u00a0'SYSTEM'condition:\u00a0writable_path\u00a0and\u00a0not\u00a0appdata\nFalse positives:\nAllowlist auditing applications have been observed running executables from these directories.\nIt is plausible that scripts and administrative tools used in the monitored environment(s) may be located in one of these directories and should be addressed on a case-by-case basis.\nLevel: high\n\n\n\n\n\n\n\n\nTitle:\u00a0World Writable Execution - Users\nID: 6dda3843-182a-4214-9263-925a80b4c634\nDescription: Detect process execution from C:\\Users\\Public\\* and other world writable folders within Users.\nBackground:\nAppData folders are excluded if a file is run as SYSTEM - this is a benign way in which many temporary application files are executed.\nInvestigation:\n\nExamine information directly associated with this file execution, such as the user context, execution integrity level, immediate follow-on activity and images loaded by the file.\nInvestigate contextual process, network, file and other supporting data on the host to help make an assessment as to whether the activity is malicious.\nIf necessary attempt to collect a copy of the file for reverse engineering to determine whether it is legitimate.\n\nReferences:\nProcess Execution from an Unusual Directory\nAuthor: ASD\u2019s ACSC\nDate: 2024/06/19\nStatus: experimental\nTags:\n\ntlp.green\nclassification.au.official\nattack.execution\n\nLog source:\ncategory: process_creationproduct: windows\nDetection:users:Image|contains:\n\n':\\\\Users\\\\All Users\\\\'\n':\\\\Users\\\\Contacts\\\\'\n':\\\\Users\\\\Default\\\\'\n':\\\\Users\\\\Public\\\\'\n':\\\\Users\\\\Searches\\\\'\n\nappdata:Image|contains: '\\\\AppData\\\\'User: 'SYSTEM'condition: users and not appdata\nFalse positives:\nIt is plausible that scripts and administrative tools used in the monitored environment(s) may be located in Public or a subdirectory and should be addressed on a case-by-case basis.\nLevel: medium\n\n\n\n\nMitigations\nLogging\nDuring ASD\u2019s ACSC investigations, a common issue that\u00a0reduces the effectiveness and speed of investigative efforts\u00a0is\u00a0a\u00a0lack\u00a0of\u00a0comprehensive\u00a0and\u00a0historical\u00a0logging\u00a0information\u00a0across\u00a0a\u00a0number\u00a0of\u00a0areas\u00a0including web server request logs, Windows event logs\u00a0and internet proxy logs.\nASD\u2019s\u00a0ACSC\u00a0recommends\u00a0reviewing\u00a0and\u00a0implementing their\u00a0guidance\u00a0on\u00a0Windows\u00a0Event\u00a0Logging\u00a0and\u00a0Forwarding\u00a0including the configuration files and scripts\u00a0in the\u00a0Windows Event Logging Repository\u00a0and the Information\u00a0Security\u00a0Manual\u2019s\u00a0Guidelines\u00a0for\u00a0System\u00a0Monitoring, to include centralizing logs and retaining\u00a0logs for a suitable period.\nPatch\u00a0Management\nPromptly patch all internet exposed devices and\u00a0services,\u00a0including\u00a0web\u00a0servers,\u00a0web\u00a0applications,\u00a0and\u00a0remote access gateways. Consider implementing a centralized patch management system to automate and expedite the process. ASD\u2019s ACSC recommend implementation\u00a0of\u00a0the\u00a0ISM\u2019s\u00a0Guidelines\u00a0for\u00a0System Management, specifically, the System Patching\u00a0controls where applicable.\nMost exploits utilized by the actor were publicly known and had patches or mitigations available.\nOrganizations should ensure that security patches or mitigations\u00a0are\u00a0applied\u00a0to\u00a0internet\u00a0facing\u00a0infrastructure within 48 hours, and where possible, use the latest\u00a0versions\u00a0of\u00a0software\u00a0and\u00a0operating\u00a0systems.\nNetwork\u00a0Segmentation\nNetwork segmentation can make it significantly more difficult for adversaries to locate and gain access to an organizations sensitive data. Segment networks to limit or block lateral movement by denying traffic between computers unless required. Important servers such as Active Directory and other authentication servers should only be able to be administered from a limited\u00a0number of intermediary servers or \u201cjump servers.\u201d These servers should be closely monitored, be well secured\u00a0and limit which users and devices are able to connect to\u00a0them.\nRegardless of instances identified where lateral movement is prevented, additional network\u00a0segmentation\u00a0could\u00a0have\u00a0further\u00a0limited\u00a0the amount\u00a0of\u00a0data\u00a0the\u00a0actors\u00a0were\u00a0able\u00a0to\u00a0access\u00a0and\u00a0extract.\nAdditional Mitigations\nThe\u00a0authoring\u00a0agencies\u00a0also\u00a0recommend\u00a0the\u00a0following mitigations to combat APT40 and others\u2019 use of the\u00a0TTPs\u00a0below.\n\nDisable\u00a0unused\u00a0or\u00a0unnecessary\u00a0network\u00a0services, ports\u00a0and\u00a0protocols.\nUse\u00a0well-tuned\u00a0Web\u00a0application\u00a0firewalls\u00a0(WAFs) to protect\u00a0webservers\u00a0and applications.\nEnforce\u00a0least privilege\u00a0to limit\u00a0access to\u00a0servers,\u00a0file shares, and other resources.\nUse multi-factor authentication (MFA) and managed service accounts to\u00a0make\u00a0credentials harder to crack and reuse. MFA should be applied to\u00a0all\u00a0internet\u00a0accessible\u00a0remote\u00a0access\u00a0services,\u00a0including:\n\nWeb\u00a0and\u00a0cloud-based\u00a0email;\nCollaboration\u00a0platforms;\nVirtual\u00a0private\u00a0network\u00a0connections; and\nRemote\u00a0desktop\u00a0services.\n\n\nReplace\u00a0end-of-life\u00a0equipment.\n\n\nMitigation Strategies/Techniques\n\n\nTTP\nEssential\u00a0Eight\u00a0Mitigation\u00a0Strategies\nISM\u00a0Controls\n\n\n\n\n\nInitial\u00a0Access\nT1190\nExploitation of Public-Facing Application\n\n\n\nPatch\u00a0applications\nPatch\u00a0operating\u00a0systems\nMulti-factor\u00a0authentication\nApplication\u00a0control\n\n\n\nISM-0140\nISM-1698\nISM-1701\nISM-1921\nISM-1876\nISM-1877\nISM-1905\n\n\n\n\nExecution\nT1059\nCommand\u00a0and\u00a0Scripting Interpreter\n\n\n\nApplication\u00a0control\nRestrict\u00a0Microsoft\u00a0Office\u00a0macros\nRestrict\u00a0administrative\u00a0privileges\n\n\n\nISM-0140\nISM-1490\nISM-1622\nISM-1623\nISM-1657\nISM-1890\n\n\n\n\nPersistence\nT1505.003\nServer\u00a0Software Component:\u00a0Web\u00a0Shell\n\n\n\nApplication\u00a0Control\nRestrict\u00a0administrative\u00a0privileges\n\n\n\nISM-0140\nISM-1246\nISM-1746\nISM-1249\nISM-1250\nISM-1490\nISM-1657\nISM-1871\n\n\n\n\nInitial\u00a0Access /\u00a0Privilege Escalation\u00a0/\u00a0Persistence\nT1078\nValid\u00a0Accounts\n\n\n\nPatch\u00a0operating\u00a0systems\nMulti-factor\u00a0authentication\nRestrict\u00a0administrative\u00a0privileges\nApplication\u00a0control\nUser\u00a0application\u00a0hardening\n\n\n\nISM-0140\nISM-0859\nISM-1546\nISM-1504\nISM-1679\n\n\n\n\nFor additional general detection and mitigation advice, please consult the Mitigations and Detection sections on the MITRE ATT&CK technique web page for each of the techniques identified in the MITRE ATT&CK summary at the end of this advisory.\nReporting\nAustralian organizations: visit cyber.gov.au or call 1300 292 371 (1300 CYBER 1) to report cybersecurity incidents and to access alerts and advisories.\nCanadian organizations: report incidents by emailing CCCS at contact@cyber.gc.ca.\nNew Zealand organizations: report cyber security incidents to incidents@ncsc.govt.nz or call 04 498 7654.\nUnited Kingdom organizations: report a significant cyber security incident at National Cyber Security Centre (monitored 24 hours) or, for urgent assistance, call 03000 200 973.\nU.S. organizations: report incidents and anomalous activity to CISA 24/7 Operations Center at report@cisa.gov or (888) 282-0870 and/or to the FBI via your local FBI field office, the FBI\u2019s 24/7 CyWatch at (855) 292-3937, or CyWatch@fbi.gov. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.\nDisclaimer\nThe information in this report is being provided \u201cas is\u201d for informational purposes only. The authoring agencies do not endorse any commercial entity, product, company, or service, including any entities, products, or services linked within this document. Any reference to specific commercial entities, products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the authoring agencies.\nMITRE ATT&CK \u2013 Historical APT40 Tradecraft of Interest\n\n\n\nReconnaissance (TA0043)\n\n\n\n\nSearch Victim-Owned Websites [T1594] \u00a0\nGather Victim Identity Information: Credentials [T1589.001]\u00a0\n\n\nActive Scanning: Vulnerability Scanning [T1595.002]\u00a0\nGather Victim Host Information [T1592]\n\n\nSearch Open Websites/Domains: Search Engines [T1593.002]\nGather Victim Network Information: Domain Properties [T1590.001]\n\n\nGather Victim Identity Information: Email Addresses [T1589.002]\n\u00a0\n\n\n\n\n\n\nResource Development (TA0042)\n\n\n\n\nAcquire Infrastructure: Domains [T1583.001] \u00a0\nAcquire Infrastructure [T1583]\n\n\nAcquire Infrastructure: DNS Server [T1583.002] \u00a0\nCompromise Accounts [T1586]\n\n\nDevelop Capabilities: Code Signing Certificates [T1587.002]\u00a0\nCompromise Infrastructure [T1584]\n\n\nDevelop Capabilities: Digital Certificates [T1587.003]\u00a0\nDevelop Capabilities: Malware [T1587.001]\n\n\nObtain Capabilities: Code Signing Certificates [T1588.003]\nEstablish Accounts: Cloud Accounts [T1585.003]\n\n\nCompromise Infrastructure: Network Devices [T1584.008]\nObtain Capabilities: Digital Certificates [T1588.004]\n\n\n\n\n\n\nInitial Access (TA0001)\n\n\n\n\nValid Accounts [T1078]\u00a0\nPhishing [T1566]\n\n\nValid Accounts: Default Accounts [T1078.001] \u00a0\nPhishing: Spearphishing Attachment [T1566.001] \u00a0\n\n\nValid Accounts: Domain Accounts [T1078.002] \u00a0\nPhishing: Spearphishing Link [T1566.002]\n\n\nExternal Remote Services [T1133]\nExploit Public-Facing Application [T1190]\n\n\nDrive-by Compromise [T1189]\u00a0\n\u00a0\n\n\n\n\n\n\nExecution (TA0002)\n\n\n\n\nWindows Management Instrumentation [T1047] \u00a0\nCommand and Scripting Interpreter: Python [T1059.006]\u00a0\n\n\nScheduled Task/Job: At [T1053.002]\u00a0\nCommand and Scripting Interpreter: JavaScript [T1059.007]\u00a0\n\n\nScheduled Task/Job: Scheduled Task [T1053.005] \u00a0\nNative API [T1106]\u00a0\n\n\nCommand and Scripting Interpreter [T1059] \u00a0\nInter-Process Communication [T1559]\u00a0\n\n\nCommand and Scripting Interpreter: Windows Command Shell [T1059.003]\u00a0\nSystem Services: Service Execution [T1569.002] \u00a0\n\n\nCommand and Scripting Interpreter: PowerShell [T1059.001]\u00a0\nExploitation for Client Execution [T1203] \u00a0\n\n\nCommand and Scripting Interpreter: Visual Basic [T1059.005]\u00a0\nUser Execution: Malicious File [T1204.002] \u00a0\n\n\nCommand and Scripting Interpreter: Unix Shell [T1059.004]\nCommand and Scripting Interpreter: Apple Script [T1059.002]\n\n\nScheduled Task/Job: Cron [T1053.003]\nSoftware Deployment Tools [T1072]\n\n\n\n\n\n\nPersistence (TA0003)\n\n\n\n\nValid Accounts [T1078]\u00a0\nServer Software Component: Web Shell [T1505.003]\u00a0\n\n\nOffice Application Startup: Office Template Macros [T1137.001]\nCreate or Modify System Process: Windows Service [T1543.003]\u00a0\n\n\nScheduled Task/Job: At [T1053.002]\u00a0\nBoot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]\u00a0\n\n\nScheduled Task/Job: Scheduled Task [T1053.005] \u00a0\nBoot or Logon Autostart Execution: Shortcut Modification [T1547.009]\u00a0\n\n\nExternal Remote Services [T1133]\u00a0\nHijack Execution Flow: DLL Search Order Hijacking [T1574.001]\u00a0\n\n\nScheduled Task/Job: Cron [T1053.003] \u00a0\nHijack Execution Flow: DLL Side-Loading [T1574.002]\u00a0\n\n\nAccount Manipulation [T1098]\nValid Accounts: Cloud Accounts [T1078.004]\n\n\nValid Accounts: Domain Accounts [T1078.002]\n\u00a0\n\n\n\n\n\n\nPrivilege Escalation (TA0004)\n\n\n\n\nScheduled Task/Job: At [T1053.002]\u00a0\nCreate or Modify System Process: Windows Service [T1543.003]\u00a0\n\n\nScheduled Task/Job: Scheduled Task [T1053.005] \u00a0\nBoot or Logon Autostart Execution: Registry Run Keys / Startup Folder [T1547.001]\u00a0\n\n\nProcess Injection: Thread Execution Hijacking [T1055.003]\u00a0\nBoot or Logon Autostart Execution: Shortcut Modification [T1547.009]\u00a0\n\n\nProcess Injection: Process Hollowing [T1055.012]\nHijack Execution Flow: DLL Search Order Hijacking [T1574.001]\n\n\nValid Accounts: Domain Accounts [T1078.002]\nExploitation for Privilege Escalation [T1068]\n\n\nAccess Token Manipulation: Token Impersonation/Theft [T1134.001]\nEvent Triggered Execution: Unix Shell Configuration Modification [T1546.004]\n\n\nProcess Injection: Dynamic-link Library Injection [T1055.001]\nValid Accounts: Domain Accounts [T1078.002]\n\n\nValid Accounts: Local Accounts [T1078.003]\n\u00a0\n\n\n\n\n\n\nDefense Evasion (TA0005)\n\n\n\n\nRootkit [T1014]\u00a0\nIndirect Command Execution [T1202]\u00a0\n\n\nObfuscated Files or Information [T1027] \u00a0\nSystem Binary Proxy Execution: Mshta [T1218.005]\u00a0\n\n\nObfuscated Files or Information: Software Packing [T1027.002]\u00a0\nSystem Binary Proxy Execution: Regsvr32 [T1218.010]\u00a0\n\n\nObfuscated Files or Information: Steganography [T1027.003]\u00a0\nSubvert Trust Controls: Code Signing [T1553.002]\u00a0\n\n\nObfuscated Files or Information: Compile After Delivery [T1027.004]\u00a0\nFile and Directory Permissions Modifications: Linux and Mac File and Directory Permissions Modification [T1222.002] \u00a0\n\n\nMasquerading: Match Legitimate Name or Location [T1036.005]\u00a0\nVirtualisation/Sandbox Evasion: System Checks [T1497.001]\u00a0\n\n\nProcess Injection: Thread Execution Hijacking [T1055.003]\nMasquerading [T1036]\n\n\nReflective Code Loading [T1620]\nImpair Defences: Disable or Modify System Firewall [T1562.004]\u00a0\n\n\nProcess Injection: Process Hollowing [T1055.012]\u00a0\nHide Artifacts: Hidden Files and Directories [T1564.001]\u00a0\n\n\nIndicator Removal: File Deletion [T1070.004] \u00a0\nHide Artifacts: Hidden Window [T1564.003] \u00a0\n\n\nIndicator Removal: Timestomp [T1070.006] \u00a0\nHijack Execution Flow: DLL Search Order Hijacking [T1574.001]\u00a0\n\n\nIndicator Removal: Clear Windows Event Logs [T1070.001]\nHijack Execution Flow: DLL Side-Loading [T1574.002]\u00a0\n\n\nModify Registry [T1112]\u00a0\nWeb Service [T1102]\u00a0\n\n\nDeobfuscate/Decode Files or Information [T1140]\u00a0\nMasquerading: Masquerade Task or Service [T1036.004]\n\n\nImpair Defenses [T1562]\n\u00a0\n\n\n\n\n\n\nCredential Access (TA0006)\n\n\n\n\nOS Credential Dumping: LSASS Memory [T1003.001] \u00a0\nUnsecured Credentials: Credentials in Files [T1552.001]\n\n\nOS Credential Dumping: NTDS [T1003.003] \u00a0\nBrute Force: Password Guessing [T1110.001]\n\n\nNetwork Sniffing [T1040]\u00a0\nForced Authentication [T1187]\n\n\nCredentials from Password Stores: Keychain [T1555.001]\nSteal or Forge Kerberos Tickets: Kerberoasting [T1558.003]\u00a0\n\n\nInput Capture: Keylogging [T1056.001]\u00a0\nMulti-Factor Authentication Interception [T1111]\n\n\nSteal Web Session Cookie [T1539]\u00a0\nSteal Application Access Token [T1528]\n\n\nExploitation for Credential Access [T1212]\nBrute Force: Password Cracking [T1110.002]\n\n\nInput Capture: Web Portal Capture [T1056.003]\nOS Credential Dumping: DCSync [T1003.006]\n\n\nCredentials from Password Stores [T1555]\u00a0\nCredentials from Password Stores: Credentials from Web Browsers [T1555.003]\n\n\n\n\n\n\nDiscovery (TA0007)\n\n\n\n\nSystem Service Discovery [T1007]\u00a0\nSystem Information Discovery [T1082] \u00a0\n\n\nApplication Window Discovery [T1010] \u00a0\nAccount Discovery: Local Account [T1087.001] \u00a0\n\n\nQuery Registry [T1012]\u00a0\nSystem Information Discovery, Technique T1082 - Enterprise | MITRE ATT&CK\u00ae\n\n\nFile and Directory Discovery [T1083]\nSystem Time Discovery [T1124]\u00a0\n\n\nNetwork Service Discovery [T1046]\u00a0\nSystem Owner/User Discovery [T1033]\u00a0\n\n\nRemote System Discovery [T1018]\u00a0\nDomain Trust Discovery [T1482]\u00a0\n\n\nAccount Discovery: Email Account [T1087.003]\nAccount Discovery: Domain Account [T1087.002]\n\n\nSystem Network Connections Discovery [T1049]\u00a0\nVirtualisation/Sandbox Evasion: System Checks [T1497.001]\u00a0\n\n\nProcess Discovery [T1057]\u00a0\nSoftware Discovery [T1518]\u00a0\n\n\nPermission Groups Discovery: Domain Groups [T1069.002]\u00a0\nNetwork Share Discovery, Technique T1135 - Enterprise | MITRE ATT&CK\u00ae\n\n\nSystem Network Configuration Discovery: Internet Connection Discovery [T1016.001]\n\u00a0\n\n\n\n\n\n\nLateral Movement (TA0008)\n\n\n\n\nRemote Services: Remote Desktop Protocol [T1021.001]\u00a0\nRemote Services [T1021]\n\n\nRemote Services: SMB/Windows Admin Shares [T1021.002]\u00a0\nUse Alternate Authentication Material: Pass the Ticket [T1550.003]\n\n\nRemote Services: Windows Remote Management [T1021.006]\u00a0\nLateral Tool Transfer [T1570]\u00a0\n\n\n\n\n\n\nCollection (TA0009)\n\n\n\n\nData from Local System [T1005]\u00a0\nArchive Collected Data: Archive via Library [T1560.002]\n\n\nData from Network Shared Drive [T1039] \u00a0\nEmail Collection: Remote Email Collection [T1114.002]\u00a0\n\n\nInput Capture: Keylogging [T1056.001]\u00a0\nClipboard Data [T1115]\u00a0\n\n\nAutomated Collection [T1119]\nData from Information Repositories [T1213]\n\n\nInput Capture: Web Portal Capture [T1056.003]\nData Staged: Remote Data Staging [T1074.002]\u00a0\n\n\nData Staged: Local Data Staging [T1074.001]\u00a0\nArchive Collected Data [T1560]\n\n\nEmail Collection [T1114]\n\u00a0\n\n\n\n\n\n\nExfiltration (TA0010)\n\n\n\n\nExfiltration Over C2 Channel [T1041] \u00a0\nExfiltration Over Alternative Protocol: Exfiltration Over Asymmetric Encrypted Non-C2 Protocol [T1048.002]\n\n\nExfiltration Over Alternative Protocol [T1048]\u00a0\nExfiltration Over Web Service: Exfiltration to Cloud Storage [T1567.002]\n\n\n\n\n\n\nCommand and Control (TA0011)\n\n\n\n\nData Obfuscation: Protocol Impersonation [T1001.003]\u00a0\nWeb Service: Dead Drop Resolver [T1102.001] \u00a0\n\n\nCommonly Used Port [T1043]\u00a0\nWeb Service: One-way Communication [T1102.003]\n\n\nApplication Layer Protocol: Web Protocols [T1071.001]\u00a0\nIngress Tool Transfer [T1105]\u00a0\n\n\nApplication Layer Protocol: File Transfer Protocols [T1071.002]\nProxy: Internal Proxy [T1090.001]\n\n\nProxy: External Proxy [T1090.002]\u00a0\nNon-Standard Port [T1571]\u00a0\n\n\nProxy: Multi-hop Proxy [T1090.003]\u00a0\nProtocol Tunnelling [T1572]\u00a0\n\n\nWeb Service: Bidirectional Communication [T1102.002]\u00a0\nEncrypted Channel [T1573]\u00a0\n\n\nEncrypted Channel: Asymmetric Cryptography [T1573.002]\nIngress Tool Transfer [T1105]\n\n\nProxy, Technique T1090 - Enterprise | MITRE ATT&CK\u00ae\n\u00a0\n\n\n\n\n\n\nImpact (TA0040)\n\n\n\n\nService Stop [T1489]\u00a0\nDisk Wipe [T1561]\n\n\nSystem Shutdown/Reboot [T1529]\u00a0\nResource Hijacking [T1496]\u00a0\n\n\n\nNotes\n\n[1]\u00a0U.S. Department of Justice. 2021.\u00a0Four Chinese Nationals Working with the Ministry of State Security Charged with Global Computer Intrusion Campaign Targeting Intellectual Property and Confidential Business Information, Including Infectious Disease Research.[2] In this context, an endpoint is a function of the web application.[3] Service accounts are not tied to individual users, but rather to services. In a Microsoft corporate domain, there are various kinds of accounts.[4] Mounting shares is the process of making files on a file system structure accessible to a user or user group.\n\n\n\u00a0\n",
  "cves": [
    "CVE-2021-34473",
    "CVE-2021-34523",
    "CVE-2021-31207",
    "CVE-2021-44228",
    "CVE-2021-26084"
  ],
  "techniques": [
    "T1497.001",
    "T1505.003",
    "T1134.001",
    "T1070.004",
    "T1560.002",
    "T1048.002",
    "T1003.006",
    "T1053.005",
    "T1059.004",
    "T1574.002",
    "T1566.001",
    "T1218.010",
    "T1016.001",
    "T1090.001",
    "T1003.003",
    "T1558.003",
    "T1587.003",
    "T1059.001",
    "T1555.001",
    "T1071.001",
    "T1110.001",
    "T1087.003",
    "T1027.003",
    "T1593.002",
    "T1090.003",
    "T1589.002",
    "T1059.003",
    "T1562.004",
    "T1071.002",
    "T1204.002",
    "T1137.001",
    "T1059.005",
    "T1110.002",
    "T1552.001",
    "T1546.004",
    "T1036.004",
    "T1505.001",
    "T1074.002",
    "T1563.002",
    "T1070.006",
    "T1078.001",
    "T1573.002",
    "T1027.002",
    "T1590.001",
    "T1569.002",
    "T1087.002",
    "T1555.003",
    "T1056.003",
    "T1583.001",
    "T1078.003",
    "T1567.002",
    "T1588.004",
    "T1574.001",
    "T1102.001",
    "T1114.002",
    "T1218.005",
    "T1059.002",
    "T1587.002",
    "T1583.002",
    "T1547.001",
    "T1587.001",
    "T1222.002",
    "T1564.003",
    "T1021.001",
    "T1547.009",
    "T1074.001",
    "T1053.002",
    "T1078.004",
    "T1087.001",
    "T1003.001",
    "T1036.005",
    "T1543.003",
    "T1553.002",
    "T1021.006",
    "T1589.001",
    "T1550.003",
    "T1102.002",
    "T1056.001",
    "T1070.001",
    "T1027.004",
    "T1090.002",
    "T1584.008",
    "T1566.002",
    "T1055.012",
    "T1078.002",
    "T1069.002",
    "T1053.003",
    "T1055.003",
    "T1102.003",
    "T1059.006",
    "T1059.007",
    "T1001.003",
    "T1588.003",
    "T1021.002",
    "T1585.003",
    "T1595.002",
    "T1564.001",
    "T1055.001"
  ],
  "advisory": "aa24-190a",
  "title": "People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action | CISA",
  "source": "cybersecurity-advisories",
  "id": "1c96e2cc9169ee6b189b9a7b68fed66d2cd72f387cdd1c3e46480f93506d681e"
}