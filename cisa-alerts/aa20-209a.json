{"markdown": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Potential Legacy Risk from Malware Targeting QNAP NAS Devices \\| CISA\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Skip to main content](#main) \n\n\n\n\n\n\n\n\n\n\n\n\n![U.S. flag](/profiles/cisad8_gov/themes/custom/gesso/dist/images/us_flag_small.png)\n\n\n\n An official website of the United States government\n \n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n Here\u2019s how you know\n \n\n\n\n\n\n\n![Dot gov](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-dot-gov.svg)\n\n\n**Official websites use .gov** \n  \n\n A\n **.gov** \n website belongs to an official government organization in the United States.\n \n\n\n\n\n\n![HTTPS](/profiles/cisad8_gov/themes/custom/gesso/dist/images/icon-https.svg)\n\n\n**Secure .gov websites use HTTPS** \n  \n\n A\n **lock** \n (\n \n\n\n Lock\n \n\n A locked padlock\n \n\n\n\n\n ) or\n **https://** \n means you\u2019ve safely connected to the .gov website. Share sensitive information only on official, secure websites.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo Americas Cyber Defense Agency](/sites/default/files/images/SVG/header_logo_tagline_update.svg)](/)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[![CISA Logo](/sites/default/files/images/SVG/mobile_logo_wordmark.svg)](/)\n\n\n\n\n\n\n\n\n\n\n Search\n \n\n\n\n\n\n\n\n\n\n Menu\n \n\n\n\n\n\n\n\n\n\n\n\n\n![America's Cyber Defense Agency](/sites/default/files/images/SVG/header_tagline_mobile_update.svg)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Close\n \n\n\n\n\n* Topics\n \n\n\n\n[Topics](/topics) \n\n\n\n\n[Cybersecurity Best Practices](/topics/cybersecurity-best-practices)\n\n\n\n\n[Cyber Threats and Advisories](/topics/cyber-threats-and-advisories)\n\n\n\n\n[Critical Infrastructure Security and Resilience](/topics/critical-infrastructure-security-and-resilience)\n\n\n\n\n[Election Security](/topics/election-security)\n\n\n\n\n[Emergency Communications](/topics/emergency-communications)\n\n\n\n\n[Industrial Control Systems](/topics/industrial-control-systems)\n\n\n\n\n[Information and Communications Technology Supply Chain Security](/topics/information-communications-technology-supply-chain-security)\n\n\n\n\n[Partnerships and Collaboration](/topics/partnerships-and-collaboration)\n\n\n\n\n[Physical Security](/topics/physical-security)\n\n\n\n\n[Risk Management](/topics/risk-management)\n\n\n\n\n\n[How can we help?](/audiences) \n\n\n[Government](/topics/government) \n[Educational Institutions](/topics/educational-institutions) \n[Industry](/topics/industry) \n[State, Local, Tribal, and Territorial](/topics/state-local-tribal-and-territorial) \n[Individuals and Families](/topics/individuals-and-families) \n[Small and Medium Businesses](/topics/small-and-medium-businesses) \n[Find Help Locally](/audiences/find-help-locally) \n[Faith\\-Based Community](/audiences/faith-based-community) \n[Executives](/audiences/executives) \n[High\\-Risk Communities](/audiences/high-risk-communities)\n* [Spotlight](/spotlight)\n* Resources \\& Tools\n \n\n\n\n[Resources \\& Tools](/resources-tools) \n\n\n\n\n[All Resources \\& Tools](/resources-tools/all-resources-tools)\n\n\n\n\n[Services](/resources-tools/services)\n\n\n\n\n[Programs](/resources-tools/programs)\n\n\n\n\n[Resources](/resources-tools/resources)\n\n\n\n\n[Training](/resources-tools/training)\n\n\n\n\n[Groups](/resources-tools/groups)\n* News \\& Events\n \n\n\n\n[News \\& Events](/news-events) \n\n\n\n\n[News](/news-events/news)\n\n\n\n\n[Events](/news-events/events)\n\n\n\n\n[Cybersecurity Alerts \\& Advisories](/news-events/cybersecurity-advisories)\n\n\n\n\n[Directives](/news-events/directives)\n\n\n\n\n[Request a CISA Speaker](/news-events/request-speaker)\n\n\n\n\n[Congressional Testimony](/news-events/congressional-testimony)\n\n\n\n\n[CISA Conferences](/cisa-conferences)\n\n\n\n\n[CISA Live!](/cisa-live)\n* Careers\n \n\n\n\n[Careers](/careers) \n\n\n\n\n[Benefits \\& Perks](/careers/benefits-perks)\n\n\n\n\n[HireVue Applicant Reasonable Accommodations Process](/careers/hirevue-applicant-reasonable-accommodations-process)\n\n\n\n\n[Hiring](/general-recruitment-and-hiring-faqs)\n\n\n\n\n[Resume \\& Application Tips](/careers/resume-application-tips)\n\n\n\n\n[Students \\& Recent Graduates](/students-recent-graduates-employment-opportunities)\n\n\n\n\n[Veteran and Military Spouses](/careers/veteran-and-military-spouse-employment-opportunities)\n\n\n\n\n[Work @ CISA](/careers/work-cisa)\n* About\n \n\n\n\n[About](/about) \n\n\n\n\n[Culture](/about/culture)\n\n\n\n\n[Divisions \\& Offices](/about/divisions-offices)\n\n\n\n\n[Regions](/about/regions)\n\n\n\n\n[Leadership](/about/leadership)\n\n\n\n\n[Doing Business with CISA](/doing-business-cisa)\n\n\n\n\n[Site Links](/site-links)\n\n\n\n\n[Reporting Employee and Contractor Misconduct](/reporting-employee-and-contractor-misconduct)\n\n\n\n\n[CISA GitHub](/cisa-github)\n\n\n\n\n[CISA Central](/cisa-central)\n\n\n\n\n[2023 Year In Review](/about/2023YIR)\n\n\n\n\n[Contact Us](/about/contact-us)\n\n\n\n\n\n\n\n\n\n[Free Cyber Services](/resources-tools/resources/free-cybersecurity-services-and-tools \"Free Cyber Services\") \n[\\#protect2024](/protect2024) \n[Secure Our World](/node/18883) \n[Shields Up](/node/8056) \n[Report A Cyber Issue](/node/16591) \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Breadcrumb\n \n1. [Home](/)\n2. [News \\& Events](/news-events)\n3. [Cybersecurity Advisories](/news-events/cybersecurity-advisories)\n4. [Cybersecurity Advisory](/news-events/cybersecurity-advisories?f%5B0%5D=advisory_type%3A94)\n\n\n\n\n\n\n\n\n Share:\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n Cybersecurity Advisory\n \nPotential Legacy Risk from Malware Targeting QNAP NAS Devices\n=============================================================\n\n\n\n\n\n Last Revised\n \n\n\n August 06, 2020\n \n\n\n\n\n Alert Code\n \n\n AA20\\-209A\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Summary\n\n\n\n\n*This is a joint alert from the United States Cybersecurity and Infrastructure Security Agency (CISA) and the United Kingdom\u2019s National Cyber Security Centre (NCSC).* \n\n\n\n\n CISA and NCSC are investigating a strain of malware known as QSnatch, which attackers used in late 2019 to target Network Attached Storage (NAS) devices manufactured by the firm QNAP.\n \n\n\n\n All QNAP NAS devices are potentially vulnerable to QSnatch malware if not updated with the latest security fixes. The malware, documented in open\\-source reports, has infected thousands of devices worldwide with a particularly high number of infections in North America and Europe. Further, once a device has been infected, attackers can prevent administrators from successfully running firmware updates.\n \n\n\n\n This alert summarizes the findings of CISA and NCSC analysis and provides mitigation advice.\n \n\n\n\n[Click here](https://www.ncsc.gov.uk/files/NCSC%20CISA%20Alert%20-QNAP%20NAS%20Devices.pdf) \n for a PDF version of this report from NCSC.\n \n\n\n\n For a downloadable copy of IOCs, see\n [STIX file](/sites/default/files/publications/AA20-209A.stix.xml) \n .\n \n\n\n\n\n\n\n\n### Technical Details\n\n\n\n### Campaigns\n\n\n\n CISA and NCSC have identified two campaigns of activity for QSnatch malware. The first campaign likely began in early 2014 and continued until mid\\-2017, while the second started in late 2018 and was still active in late 2019\\. The two campaigns are distinguished by the initial payload used as well as some differences in capabilities. This alert focuses on the second campaign as it is the most recent threat.\n \n\n\n\n It is important to note that infrastructure used by the malicious cyber actors in both campaigns is not currently active, but the threat remains to unpatched devices.\n \n\n\n\n Although the identities and objectives of the malicious cyber actors using QSnatch are currently unknown, the malware is relatively sophisticated, and the cyber actors demonstrate an awareness of operational security.\n \n\n\n### Global distribution of infections\n\n\n\n Analysis shows a significant number of infected devices. In mid\\-June 2020, there were approximately 62,000 infected devices worldwide; of these, approximately 7,600 were in the United States and 3,900 were in the United Kingdom. Figure 1 below shows the location of these devices in broad geographic terms.\n \n\n\n\n![]()\n\n\n\n\n*Figure 1: Locations of\u00a0QNAP NAS devices infected by QSnatch* \n\n\n\n### Delivery and exploitation\n\n\n\n The infection vector has not been identified, but QSnatch appears to be injected into the device firmware during the infection stage, with the malicious code subsequently run within the device, compromising it. The attacker then uses a domain generation algorithm (DGA)\u2014to establish a command and control (C2\\) channel that periodically generates multiple domain names for use in C2 communications\u2014using the following HTTP GET request:\n \n\n\n\n`HTTP GET https://[generated-address]/qnap_firmware.xml?=t[timestamp]` \n[\\[1]](https://www.kyberturvallisuuskeskus.fi/en/news/qsnatch-malware-designed-qnap-nas-devices) \n\n\n\n### Malware functionalities\n\n\n\n Analysis shows that QSnatch malware contains multiple functionalities, such as:\n \n\n\n* **CGI password logger** \n\t+ This installs a fake version of the device admin login page, logging successful authentications and passing them to the legitimate login page.\n* **Credential scraper**\n* **SSH backdoor** \n\t+ This allows the cyber actor to execute arbitrary code on a device.\n* **Exfiltration** \n\t+ When run, QSnatch steals a predetermined list of files, which includes system configurations and log files. These are encrypted with the actor\u2019s public key and sent to their infrastructure over HTTPS.\n* **Webshell functionality for remote access**\n\n\n### Persistence\n\n\n\n The malware appears to gain persistence by preventing updates from installing on the infected QNAP device. The attacker modifies the system host\u2019s file, redirecting core domain names used by the NAS to local out\\-of\\-date versions so updates can never be installed.\n \n\n\n### Samples\n\n\n\n The following tables provide hashes of related QSnatch samples found in open\\-source malware repositories. File types fall into two buckets: (1\\) shell scripts (see table 1\\) and (2\\) shell script compiler (SHC)\\-compiled executable and linking format (ELF) shell scripts (see table 2\\). One notable point is that some samples intentionally patch the infected QNAP for Samba remote code execution vulnerability CVE\\-2017\\-7494\\.\n \n\n\n\n*Table 1: QSnatch samples \u2013 shell scripts* \n\n\n\n\n\n| **SH Samples (SHA256\\)** |\n| --- |\n| 09ab3031796bea1b8b79fcfd2b86dac8f38b1f95f0fce6bd2590361f6dcd6764 |\n| 3c38e7bb004b000bd90ad94446437096f46140292a138bfc9f7e44dc136bac8d |\n| 8fd16e639f99cdaa7a2b730fc9af34a203c41fb353eaa250a536a09caf78253b |\n| 473c5df2617cee5a1f73880c2d66ad9668eeb2e6c0c86a2e9e33757976391d1a |\n| 55b5671876f463f2f75db423b188a1d478a466c5e68e6f9d4f340396f6558b9f |\n| 9526ccdeb9bf7cfd9b34d290bdb49ab6a6acefc17bff0e85d9ebb46cca8b9dc2 |\n| 4b514278a3ad03f5efb9488f41585458c7d42d0028e48f6e45c944047f3a15e9 |\n| fa3c2f8e3309ee67e7684abc6602eea0d1d18d5d799a266209ce594947269346 |\n| 18a4f2e7847a2c4e3c9a949cc610044bde319184ef1f4d23a8053e5087ab641b |\n| 9791c5f567838f1705bd46e880e38e21e9f3400c353c2bf55a9fa9f130f3f077 |\n| a569332b52d484f40b910f2f0763b13c085c7d93dcdc7fea0aeb3a3e3366ba5d |\n| a9364f3faffa71acb51b7035738cbd5e7438721b9d2be120e46b5fd3b23c6c18 |\n| 62426146b8fcaeaf6abb24d42543c6374b5f51e06c32206ccb9042350b832ea8 |\n| 5cb5dce0a1e03fc4d3ffc831e4a356bce80e928423b374fc80ee997e7c62d3f8 |\n| 5130282cdb4e371b5b9257e6c992fb7c11243b2511a6d4185eafc0faa0e0a3a6 |\n| 15892206207fdef1a60af17684ea18bcaa5434a1c7bdca55f460bb69abec0bdc |\n| 3cb052a7da6cda9609c32b5bafa11b76c2bb0f74b61277fecf464d3c0baeac0e |\n| 13f3ea4783a6c8d5ec0b0d342dcdd0de668694b9c1b533ce640ae4571fdbf63c |\n\n\n\n\n\n\n\n*Table 2: QSnatch samples \u2013 SHC\\-compiled ELF shell scripts* \n\n\n\n\n\n| **SH Samples (SHA256\\)** |\n| --- |\n| 18a4f2e7847a2c4e3c9a949cc610044bde319184ef1f4d23a8053e5087ab641b |\n| 3615f0019e9a64a78ccb57faa99380db0b36146ec62df768361bca2d9a5c27f2 |\n| 845759bb54b992a6abcbca4af9662e94794b8d7c87063387b05034ce779f7d52 |\n| 6e0f793025537edf285c5749b3fcd83a689db0f1c697abe70561399938380f89 |\n|\n\n\n\n### Mitigations\n\n\n\n\n As stated above, once a device has been infected, attackers have been known to make it impossible for administrators to successfully run the needed firmware updates. This makes it extremely important for organizations to ensure their devices have not been previously compromised.\n **Organizations that are still running a vulnerable version should take the following steps to ensure the device is not left vulnerable:** \n\n\n\n* **Scan the device with the latest version of Malware Remover,** \n available in\n [QNAP App Center](https://www.qnap.com/en-us/app_releasenotes/?type_choose=Utilities) \n , to detect and remove QSnatch or other malware.\n\t+ If the installation via App Center fails, manually install Malware Remover following\n\t [this QNAP tutorial](https://urldefense.us/v3/__https:/www.qnap.com/en/how-to/knowledge-base/article/how-to-install-qnap-applications-qpkg-files-manually__;!!BClRuOV5cvtbuNI!XPCHTsigleobUvh1bSzLCLG8cPaxt-RD2ixM8js9QWU3e6ZcTEq1kesRf6q8Ypt4gOLyg-Yr3U8%24) \n\t , or contact\n\t [QNAP Technical Support](https://urldefense.us/v3/__https:/service.qnap.com/en__;!!BClRuOV5cvtbuNI!XPCHTsigleobUvh1bSzLCLG8cPaxt-RD2ixM8js9QWU3e6ZcTEq1kesRf6q8Ypt4gOLyhKUvzyM%24) \n\t for further assistance.\n* **Run a full factory reset on the device.**\n* **Update the firmware to the latest version.**\n\n\n\n The usual checks to ensure that the latest updates are installed still apply.\n **To prevent reinfection, this recommendation also applies to devices previously infected with QSnatch but from which the malware has been removed.** \n\n\n\n\n To prevent QSnatch malware infections, CISA and NCSC strongly recommend that organizations take the recommended measures in QNAP\u2019s November 2019 advisory.\n [\\[2]](https://www.qnap.com/en/security-advisory/nas-201911-01) \n\n\n\n\n CISA and NCSC also recommend organizations consider the following mitigations:\n \n\n\n* Verify that you purchased QNAP devices from reputable sources.\n\t+ If sources are in question then, in accordance with the instructions above,\n\t **scan the device with the latest version of the Malware Remover and run a full factory reset on the device prior to completing the firmware upgrade.** \n\t For additional supply chain recommendations, see CISA\u2019s tip on\n\t [Securing Network Infrastructure Devices](https://us-cert.cisa.gov/ncas/tips/ST18-001) \n\t .\n* Block external connections when the device is intended to be used strictly for internal storage.\n\n\n\n### References\n\n\n\n\n[\\[1] QSnatch \\- Malware designed for QNAP NAS devices](https://www.kyberturvallisuuskeskus.fi/en/news/qsnatch-malware-designed-qnap-nas-devices) \n\n\n[\\[2] QNAP: Security Advisory for Malware QSnatch](https://www.qnap.com/en/security-advisory/nas-201911-01) \n\n\n### Revisions\n\n\n\n\n July 27, 2020: Initial Version\\|August 4, 2020: Updated Mitigations section\\|August 6, 2020: Updated Mitigations section\n \n\n\n\n\n\n\n\n\n\n\n This product is provided subject to this\n [Notification](/notification \"Follow link\") \n and this\n [Privacy \\& Use](/privacy-policy \"Follow link\") \n policy.\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlease share your thoughts\n--------------------------\n\n\n\n We recently updated our anonymous\n [product survey](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-209a) \n ; we\u2019d welcome your feedback.\n \n\n\n\n\n\n\n\n\n\n\n\n\nRelated Advisories\n------------------\n\n\n\n\n\n\n\n\n\n\n Jul 11, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-193A\n \n\n### [CISA Red Team\u2019s Operations Against a Federal Civilian Executive Branch Organization Highlights the Necessity of Defense\\-in\\-Depth](/news-events/cybersecurity-advisories/aa24-193a)\n\n\n\n\n\n\n\n\n\n\n\n Jul 08, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-190A\n \n\n### [People\u2019s Republic of China (PRC) Ministry of State Security APT40 Tradecraft in Action](/news-events/cybersecurity-advisories/aa24-190a)\n\n\n\n\n\n\n\n\n\n\n\n May 10, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-131A\n \n\n### [\\#StopRansomware: Black Basta](/news-events/cybersecurity-advisories/aa24-131a)\n\n\n\n\n\n\n\n\n\n\n\n Apr 18, 2024\n \n\n\n Cybersecurity Advisory \\| AA24\\-109A\n \n\n### [\\#StopRansomware: Akira Ransomware](/news-events/cybersecurity-advisories/aa24-109a)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[Return to top](#) \n\n\n\n\n* [Topics](/topics)\n* [Spotlight](/spotlight)\n* [Resources \\& Tools](/resources-tools)\n* [News \\& Events](/news-events)\n* [Careers](/careers)\n* [About](/about)\n\n\n\n\n\n\n\n\n[Cybersecurity \\& Infrastructure Security Agency](/ \"Go to the Cybersecurity & Infrastructure Security Agency homepage\")\n\n\n* [Facebook](https://www.facebook.com/CISA)\n* [Twitter](https://twitter.com/CISAgov)\n* [LinkedIn](https://www.linkedin.com/company/cybersecurity-and-infrastructure-security-agency)\n* [YouTube](https://www.youtube.com/@cisagov)\n* [Instagram](https://www.instagram.com/cisagov)\n* [RSS](/subscribe-updates-cisa)\n\n\n\n\n CISA Central\n \n[1\\-844\\-Say\\-CISA](tel:1-844-Say-CISA) \n[SayCISA@cisa.gov](mailto:SayCISA@cisa.gov) \n\n\n\n\n\n\n\n\n\n\n\n DHS Seal\n \n\n\n CISA.gov\n \n\n An official website of the U.S. Department of Homeland Security\n \n\n\n* [About CISA](/about \"About CISA\")\n* [Budget and Performance](https://www.dhs.gov/performance-financial-reports \"Budget and Performance\")\n* [DHS.gov](https://www.dhs.gov \"Department of Homeland Security\")\n* [Equal Opportunity \\& Accessibility](/oedia \"Equal Opportunity & Accessibility\")\n* [FOIA Requests](https://www.dhs.gov/foia \"FOIA Requests\")\n* [No FEAR Act](/no-fear-act \"No FEAR Act Reporting\")\n* [Office of Inspector General](https://www.oig.dhs.gov/ \"Office of Inspector General\")\n* [Privacy Policy](/privacy-policy \"Privacy Policy\")\n* [Subscribe](https://public.govdelivery.com/accounts/USDHSCISA/subscriber/new?topic_id=USDHSCISA_138 \"Subscribe to Email Updates\")\n* [The White House](https://www.whitehouse.gov/ \"The White House\")\n* [USA.gov](https://www.usa.gov/ \"USA.gov\")\n* [Website Feedback](/forms/feedback \"Website Feedback\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "cves": ["CVE-2017-7494"], "techniques": [], "advisory": "aa20-209a", "title": "Potential Legacy Risk from Malware Targeting QNAP NAS Devices | CISA", "source": "cybersecurity-advisories", "id": "d9a7b0f98fe55b0bed9a310b47e6d3bef00eb132e1400e54698e9692cb91ce78"}