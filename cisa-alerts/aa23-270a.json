{
  "markdown": "\nExecutive Summary\nThe United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the Japan National Police Agency (NPA), and the Japan National Center of Incident Readiness and Strategy for Cybersecurity (NISC) (hereafter referred to as the \u201cauthoring agencies\u201d) are releasing this joint cybersecurity advisory (CSA) to detail activity of the People\u2019s Republic of China (PRC)-linked cyber actors known as BlackTech. BlackTech has demonstrated capabilities in modifying router firmware without detection and exploiting routers\u2019 domain-trust relationships for pivoting from international subsidiaries to headquarters in Japan and the U.S. \u2014 the primary targets. The authoring agencies recommend implementing the mitigations described to detect this activity and protect devices from the backdoors the BlackTech actors are leaving behind.\nBlackTech (a.k.a. Palmerworm, Temp.Overboard, Circuit Panda, and Radio Panda) actors have targeted government, industrial, technology, media, electronics, and telecommunication sectors, including entities that support the militaries of the U.S. and Japan. BlackTech actors use custom malware, dual-use tools, and living off the land tactics, such as disabling logging on routers, to conceal their operations. This CSA details BlackTech\u2019s tactics, techniques, and procedures (TTPs), which highlights the need for multinational corporations to review all subsidiary connections, verify access, and consider implementing Zero Trust models to limit the extent of a potential BlackTech compromise.\nFor more information on the risks posed by this deep level of unauthorized access, see the CSA People\u2019s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices.[1]\nDownload the PDF version of this report: PDF, 808 KB\nTechnical Details\nThis advisory uses the MITRE\u00ae ATT&CK\u00ae for Enterprise framework, version 13.1. See the Appendix: MITRE ATT&CK Techniques for all referenced TTPs.\nBackground\nActive since 2010, BlackTech actors have historically targeted a wide range of U.S. and East Asia public organizations and private industries. BlackTech actors\u2019 TTPs include developing customized malware and tailored persistence mechanisms for compromising routers. These TTPs allow the actors to disable logging [T1562] and abuse trusted domain relationships [T1199] to pivot between international subsidiaries and domestic headquarters\u2019 networks.\nObservable TTPs\nBlackTech cyber actors use custom malware payloads and remote access tools (RATs) to target victims\u2019 operating systems. The actors have used a range of custom malware families targeting Windows\u00ae, Linux\u00ae, and FreeBSD\u00ae operating systems. Custom malware families employed by BlackTech include:\n\nBendyBear [S0574]\nBifrose\nBTSDoor\nFakeDead (a.k.a. TSCookie) [S0436]\nFlagpro [S0696]\nFrontShell (FakeDead\u2019s downloader module)\nIconDown\nPLEAD [S0435]\nSpiderPig\nSpiderSpring\nSpiderStack\nWaterBear [S0579]\n\nBlackTech actors continuously update these tools to evade detection [TA0005] by security software. The actors also use stolen code-signing certificates [T1588.003] to sign the malicious payloads, which make them appear legitimate and therefore more difficult for security software to detect [T1553.002].\nBlackTech actors use living off the land TTPs to blend in with normal operating system and network activities, allowing them to evade detection by endpoint detection and response (EDR) products. Common methods of persistence on a host include NetCat shells, modifying the victim registry [T1112] to enable the remote desktop protocol (RDP) [T1021.001], and secure shell (SSH) [T1021.004]. The actors have also used SNScan for enumeration [TA0007], and a local file transfer protocol (FTP) server [T1071.002] to move data through the victim network. For additional examples of malicious cyber actors living off the land, see People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection.[2]\nPivoting from international subsidiaries\nThe PRC-linked BlackTech actors target international subsidiaries of U.S. and Japanese companies. After gaining access [TA0001] to the subsidiaries\u2019 internal networks, BlackTech actors are able to pivot from the trusted internal routers to other subsidiaries of the companies and the headquarters\u2019 networks. BlackTech actors exploit trusted network relationships between an established victim and other entities to expand their access in target networks.\nSpecifically, upon gaining an initial foothold into a target network and gaining administrator access to network edge devices, BlackTech cyber actors often modify the firmware to hide their activity across the edge devices to further maintain persistence in the network. To extend their foothold across an organization, BlackTech actors target branch routers\u2014typically smaller appliances used at remote branch offices to connect to a corporate headquarters\u2014and then abuse the trusted relationship [T1199] of the branch routers within the corporate network being targeted. BlackTech actors then use the compromised public-facing branch routers as part of their infrastructure for proxying traffic [TA0011], blending in with corporate network traffic, and pivoting to other victims on the same corporate network [T1090.002].\nMaintaining access via stealthy router backdoors\nBlackTech has targeted and exploited various brands and versions of router devices. TTPs against routers enable the actors to conceal configuration changes, hide commands, and disable logging while BlackTech actors conduct operations. BlackTech actors have compromised several Cisco\u00ae routers using variations of a customized firmware backdoor [T1542.004]. The backdoor functionality is enabled and disabled through specially crafted TCP or UDP packets [T1205]. This TTP is not solely limited to Cisco routers, and similar techniques could be used to enable backdoors in other network equipment.\nIn some cases, BlackTech actors replace the firmware for certain Cisco IOS\u00ae-based routers with malicious firmware. Although BlackTech actors already had elevated privileges [TA0004] on the router to replace the firmware via command-line execution, the malicious firmware is used to establish persistent backdoor access [TA0003] and obfuscate future malicious activity. The modified firmware uses a built-in SSH backdoor [T1556.004], allowing BlackTech actors to maintain access to the compromised router without BlackTech connections being logged [T1562.003]. BlackTech actors bypass the router's built-in security features by first installing older legitimate firmware [T1601.002] that they then modify in memory to allow the installation of a modified, unsigned bootloader and modified, unsigned firmware [T1601.001]. The modified bootloader enables the modified firmware to continue evading detection [T1553.006], however, it is not always necessary.\nBlackTech actors may also hide their presence and obfuscate changes made to compromised Cisco routers by hiding Embedded Event Manager (EEM) policies\u2014a feature usually used in Cisco IOS to automate tasks that execute upon specified events\u2014that manipulate Cisco IOS Command-Line Interface (CLI) command results. On a compromised router, the BlackTech-created EEM policy waits for specific commands to execute obfuscation measures or deny execution of specified legitimate commands. This policy has two functions: (1) to remove lines containing certain strings in the output of specified, legitimate Cisco IOS CLI commands [T1562.006], and (2) prevent the execution of other legitimate CLI commands, such as hindering forensic analysis by blocking copy, rename, and move commands for the associated EEM policy [T1562.001].\nFirmware replacement process\nBlackTech actors utilize the following file types to compromise the router. These files are downloaded to the router via FTP or SSH.\n\nTable 1: File types to compromise the router\n\n\nFile Type\nDescription\n\n\n\n\nOld Legitimate Firmware\nThe IOS image firmware is modified in memory to allow installation of the Modified Firmware and Modified Bootloader.\n\n\nModified Firmware\nThe firmware has a built-in SSH backdoor, allowing operators to have unlogged interaction with the router.\n\n\nModified Bootloader\nThe bootloader allows Modified Firmware to continue evading the router's security features for persistence across reboots. In some cases, only modified firmware is used.\n\n\n\nBlackTech actors use the Cisco router's CLI to replace the router\u2019s IOS image firmware. The process begins with the firmware being modified in memory\u2014also called hot patching\u2014to allow the installation of a modified bootloader and modified firmware capable of bypassing the router\u2019s security features. Then, a specifically constructed packet triggers the router to enable the backdoor that bypasses logging and the access control list (ACL). The steps are as follows:\n\nDownload old legitimate firmware.\n\nSet the router to load the old legitimate firmware and reboot with the following command(s):\n\n\n\n\n\nconfig tno boot system usbflash0 [filename]boot system usbflash0 [filename]endwritereload\n\n\n\n\n\n\nDownload the modified bootloader and modified firmware.\n\nSet the router to load the modified firmware with the following command(s):\n\n\n\nconf tno boot system usbflash0 [filename]boot system usbflash0 [filename]endwrite\n\n\n\n\n\nLoad the modified bootloader (the router reboots automatically) with the following command:\n\n\n\nupgrade rom file bootloader\n\n\n\n\nEnable access by sending a trigger packet that has specific values within the UDP data or TCP Sequence Number field and the Maximum Segment Size (MSS) parameter within the TCP Options field.\n\nModified bootloader\nTo allow the modified bootloader and firmware to be installed on Cisco IOS without detection, the cyber actors install an old, legitimate firmware and then modify that running firmware in memory to bypass firmware signature checks in the Cisco ROM Monitor (ROMMON) signature validation functions. The modified version\u2019s instructions allow the actors to bypass functions of the IOS Image Load test and the Field Upgradeable ROMMON Integrity test.\nModified firmware\nBlackTech actors install modified IOS image firmware that allows backdoor access via SSH to bypass the router\u2019s normal logging functions. The firmware consists of a Cisco IOS loader that will load an embedded IOS image.\nBlackTech actors hook several functions in the embedded Cisco IOS image to jump to their own code. They overwrite existing code to handle magic packet checking, implement an SSH backdoor, and bypass logging functionality on the compromised router. The modified instructions bypass command logging, IP address ACLs, and error logging.\nTo enable the backdoor functions, the firmware checks for incoming trigger packets and enables or disables the backdoor functionality. When the backdoor is enabled, associated logging functions on the router are bypassed. The source IP address is stored and used to bypass ACL handling for matching packets. The SSH backdoor includes a special username that does not require additional authentication.\nDetection and Mitigation Techniques\nIn order to detect and mitigate this BlackTech malicious activity, the authoring agencies strongly recommend the following detection and mitigation techniques. It would be trivial for the BlackTech actors to modify values in their backdoors that would render specific signatures of this router backdoor obsolete. For more robust detection, network defenders should monitor network devices for unauthorized downloads of bootloaders and firmware images and reboots. Network defenders should also monitor for unusual traffic destined to the router, including SSH.\nThe following are the best mitigation practices to defend against this type of malicious activity:\n\nDisable outbound connections by applying the \"transport output none\" configuration command to the virtual teletype (VTY) lines. This command will prevent some copy commands from successfully connecting to external systems.Note: An adversary with unauthorized privileged level access to a network device could revert this configuration change.[3]\nMonitor both inbound and outbound connections from network devices to both external and internal systems. In general, network devices should only be connecting to nearby devices for exchanging routing or network topology information or with administrative systems for time synchronization, logging, authentication, monitoring, etc. If feasible, block unauthorized outbound connections from network devices by applying access lists or rule sets to other nearby network devices. Additionally, place administrative systems in separate virtual local area networks (VLANs) and block all unauthorized traffic from network devices destined for non-administrative VLANs.[4]\nLimit access to administration services and only permit IP addresses used by network administrators by applying access lists to the VTY lines or specific services. Monitor logs for successful and unsuccessful login attempts with the \"login on-failure log\" and \"login on-success log\" configuration commands, or by reviewing centralized Authentication, Authorization, and Accounting (AAA) events.[3]\nUpgrade devices to ones that have secure boot capabilities with better integrity and authenticity checks for bootloaders and firmware. In particular, highly prioritize replacing all end-of-life and unsupported equipment as soon as possible.[3],[5]\nWhen there is a concern that a single password has been compromised, change all passwords and keys.[3]\nReview logs generated by network devices and monitor for unauthorized reboots, operating system version changes, changes to the configuration, or attempts to update the firmware. Compare against expected configuration changes and patching plans to verify that the changes are authorized.[3]\nPeriodically perform both file and memory verification described in the Network Device Integrity (NDI) Methodology documents to detect unauthorized changes to the software stored and running on network devices.[3]\nMonitor for changes to firmware. Periodically take snapshots of boot records and firmware and compare against known good images.[3]\n\nWorks Cited\n[1]\u00a0\u00a0 \u00a0Joint CSA, People\u2019s Republic of China State-Sponsored Cyber Actors Exploit Network Providers and Devices, https://media.defense.gov/2022/Jun/07/2003013376/-1/-1/0/CSA_PRC_SPONSORED_CYBER_ACTORS_EXPLOIT_NETWORK_PROVIDERS_DEVICES_TLPWHITE.PDF[2]\u00a0\u00a0 \u00a0Joint CSA, People's Republic of China State-Sponsored Cyber Actor Living off the Land to Evade Detection, https://media.defense.gov/2023/May/24/2003229517/-1/-1/0/CSA_PRC_State_Sponsored_Cyber_Living_off_the_Land_v1.1.PDF[3]\u00a0\u00a0 \u00a0NSA, Network Infrastructure Security Guide, https://media.defense.gov/2022/Jun/15/2003018261/-1/-1/0/CTR_NSA_NETWORK_INFRASTRUCTURE_SECURITY_GUIDE_20220615.PDF[4]\u00a0\u00a0 \u00a0NSA, Performing Out-of-Band Network Management, https://media.defense.gov/2020/Sep/17/2002499616/-1/-1/0/PERFORMING_OUT_OF_BAND_NETWORK_MANAGEMENT20200911.PDF\u00a0[5]\u00a0\u00a0 \u00a0Cisco, Attackers Continue to Target Legacy Devices, https://community.cisco.com/t5/security-blogs/attackers-continue-to-target-legacy-devices/ba-p/4169954\nDisclaimer of endorsement\nThe information and opinions contained in this document are provided \"as is\" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government or Japan, and this guidance shall not be used for advertising or product endorsement purposes.\nTrademark recognition\nCisco and Cisco IOS are registered trademarks of Cisco Technology, Inc.FreeBSD is a registered trademark of The FreeBSD Foundation.Linux is a registered trademark of Linus Torvalds.MITRE and MITRE ATT&CK are registered trademarks of The MITRE Corporation.Windows is a registered trademark of Microsoft Corporation.\nPurpose\nThis document was developed in furtherance of the authoring agencies\u2019 cybersecurity missions, including their responsibilities to identify and disseminate cyber threats, and to develop and issue cybersecurity specifications and mitigations.\nContact\nNSA Cybersecurity Report Questions and Feedback: CybersecurityReports@nsa.gov\u00a0NSA\u2019s Defense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov\u00a0NSA Media Inquiries / Press Desk: 443-634-0721, MediaRelations@nsa.gov\nU.S. organizations: Organizations can also report anomalous cyber activity and/or cyber incidents 24/7 to\u00a0report@cisa.gov\u00a0or by calling 1-844-Say-CISA (1-844-729-2472) and/or to the FBI via your local FBI field office.\nAppendix: MITRE ATT&CK Techniques\nSee Tables 2-9 for all referenced BlackTech tactics and techniques in this advisory.\n\nTable 2: BlackTech ATT&CK Techniques for Enterprise \u2013 Resource Development\n\n\nTechnique Title\nID\nUse\n\n\n\n\nObtain Capabilities: Code Signing Certificates\nT1588.003\nBlackTech actors use stolen code-signing certificates to sign payloads and evade defenses.\n\n\n\n\nTable 3: BlackTech ATT&CK Techniques for Enterprise \u2013 Initial Access\n\n\nTechnique Title\nID\nUse\n\n\n\n\nInitial Access\nTA0001\nBlackTech actors gain access to victim networks by exploiting routers.\n\n\nTrusted Relationship\nT1199\nBlackTech actors exploit trusted domain relationships of routers to gain access to victim networks.\n\n\n\n\nTable 4: BlackTech ATT&CK Techniques for Enterprise \u2013 Persistence\n\n\nTechnique Title\nID\nUse\n\n\n\n\nPersistence\nTA0003\nBlackTech actors gain persistent access to victims\u2019 networks.\n\n\nTraffic Signaling\nT1205\nBlackTech actors send specially crafted packets to enable or disable backdoor functionality on a compromised router.\n\n\nPre-OS Boot: ROMMONkit\nT1542.004\nBlackTech actors modify router firmware to maintain persistence.\n\n\n\n\nTable 5: BlackTech ATT&CK Techniques for Enterprise \u2013 Privilege Escalation\n\n\nTechnique Title\nID\nUse\n\n\n\n\nPrivilege Escalation\nTA0004\nBlackTech actors gain elevated privileges on a victim\u2019s network.\n\n\n\n\nTable 6: BlackTech ATT&CK Techniques for Enterprise \u2013 Defense Evasion\n\n\nTechnique Title\nID\nUse\n\n\n\n\nDefense Evasion\nTA0005\nBlackTech actors configure their tools to evade detection by security software and EDR.\n\n\nModify Registry\nT1112\nBlackTech actors modify the victim\u2019s registry.\n\n\nImpair Defenses\nT1562\nBlackTech actors disable logging on compromised routers to avoid detection and evade defenses.\n\n\nImpair Defenses: Impair Command History Logging\nT1562.003\nBlackTech actors disable logging on the compromised routers to prevent logging of any commands issued.\n\n\nModify System Image: Patch System Image\nT1601.001\nBlackTech actors modify router firmware to evade detection.\n\n\n\n\nTable 7: BlackTech ATT&CK Techniques for Enterprise \u2013 Discovery\n\n\nTechnique Title\nID\nUse\n\n\n\n\nDiscovery\nTA0007\nBlackTech actors use SNScan to enumerate victims\u2019 networks and obtain further network information.\n\n\n\n\nTable 8: BlackTech ATT&CK Techniques for Enterprise \u2013 Lateral Movement\n\n\nTechnique Title\nID\nUse\n\n\n\n\nRemote Services: Remote Desktop Protocol\nT1021.001\nBlackTech actors use RDP to move laterally across a victim\u2019s network.\n\n\nRemote Services: SSH\nT1021.004\nBlackTech actors use SSH to move laterally across a victim\u2019s network.\n\n\n\n\nTable 9: BlackTech ATT&CK Techniques for Enterprise \u2013 Command and Control\n\n\nTechnique Title\nID\nUse\n\n\n\n\nCommand and Control\nTA0011\nBlackTech actors compromise and control a victim\u2019s network infrastructure.\n\n\nApplication Layer Protocol: File Transfer Protocols\nT1071.002\nBlackTech actors use FTP to move data through a victim\u2019s network or to deliver scripts for compromising routers.\n\n\nProxy\nT1090\nBlackTech actors use compromised routers to proxy traffic.\n\n\n\n",
  "cves": [],
  "techniques": [
    "T1553.002",
    "T1601.002",
    "T1562.001",
    "T1542.004",
    "T1562.003",
    "T1021.001",
    "T1601.001",
    "T1021.004",
    "T1090.002",
    "T1553.006",
    "T1556.004",
    "T1588.003",
    "T1071.002",
    "T1562.006"
  ],
  "advisory": "aa23-270a",
  "title": "People's Republic of China-Linked Cyber Actors Hide in Router Firmware | CISA",
  "source": "cybersecurity-advisories",
  "id": "1ba7920cec9fb048554efd5d3c541b8243372d613899b055252ea15395c4ab04"
}