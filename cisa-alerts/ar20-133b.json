{
  "markdown": "\n\n\n\n\n\n\nNotification\n\nThis report is provided \"as is\" for informational purposes only. The Department of Homeland Security (DHS) does not provide any warranties of any kind regarding any information contained herein. The DHS does not endorse any commercial product or service referenced in this bulletin or otherwise.\nThis document is marked TLP:WHITE--Disclosure is not limited. Sources may use TLP:WHITE when information carries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol (TLP), see http://www.us-cert.gov/tlp.\n\nSummary\n\nDescription\nThis Malware Analysis Report (MAR) is the result of analytic efforts between the Department of Homeland Security (DHS), the Federal Bureau of Investigation (FBI), and the Department of Defense (DoD). Working with U.S. Government partners, DHS, FBI, and DoD identified Trojan malware variants used by the North Korean government. This malware variant has been identified as TAINTEDSCRIBE. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit https[:]//www[.]us-cert.gov/hiddencobra.\n\n\t\t\tFBI has high confidence that HIDDEN COBRA actors are using malware variants in conjunction with proxy servers to maintain a presence on victim networks and to further network exploitation. DHS, FBI, and DoD are distributing this MAR to enable network defense and reduce exposure to North Korean government malicious cyber activity.\n\n\t\t\tThis MAR includes malware descriptions related to HIDDEN COBRA, suggested response actions and recommended mitigation techniques. Users or administrators should flag activity associated with the malware and report the activity to the Cybersecurity and Infrastructure Security Agency (CISA) or the FBI Cyber Watch (CyWatch), and give the activity the highest priority for enhanced mitigation.\n\n\t\t\tThis report looks at a full-featured beaconing implant and its command modules. These samples uses FakeTLS for session authentication and for network encryption utilizing a Linear Feedback Shift Register (LFSR) algorithm. The main executable disguises itself as Microsoft\u2019s Narrator. It downloads its command execution module from a command and control (C2) server and then has the capability to download, upload, delete, and execute files; enable Windows CLI access; create and terminate processes; and perform target system enumeration.\nFor a downloadable copy of IOCs, see MAR-10288834-2.v1.stix.\nSubmitted Files (3)\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438 (Narrator.exe)\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35 (EngineDll.dll)\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf (EngineDll.dll)\nIPs (1)\n211.192.239.232\n\nFindings\n\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\nTags\ntrojan\nDetails\n\n\n\nName\nNarrator.exe\n\n\nSize\n286720 bytes\n\n\nType\nPE32 executable (GUI) Intel 80386, for MS Windows\n\n\nMD5\n24906e88a757cb535eb17e6c190f371f\n\n\nSHA1\nbda6c036fe34dda6aea7797551c7853a9891de96\n\n\nSHA256\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\nSHA512\nb02f86d8261875c9eaf2ee9d491bc7a5ed3227c90854060078598a7425b58d096398315144517a9daec6cb3542fe901af434b597692963dec0b8f43615bea58f\n\n\nssdeep\n3072:qKhnf91e3YGs53EeY9eDUSGPGrdj+MieMUgUo2n6/rZDS35bb3tiWh6f9FKi4Z+J:xWvsN/Y9eDpjnieMB2BFtQFgZKUV\n\n\nEntropy\n6.553050\n\n\n\nAntivirus\n\n\n\nAegisLab\nTrojan.Win32.Generic.mmcn\n\n\nAhnlab\nTrojan/Win32.Agent\n\n\nAntiy\nTrojan/Win32.Wacatac\n\n\nAvira\nTR/RedCap.ihekz\n\n\nBitDefender\nTrojan.GenericKD.32212178\n\n\nCyren\nW32/Agent.XH.gen!Eldorado\n\n\nESET\na variant of Win32/NukeSped.CO trojan\n\n\nEmsisoft\nTrojan.GenericKD.32212178 (B)\n\n\nNANOAV\nTrojan.Win32.NukeSped.fuwevb\n\n\nVirusBlokAda\nBScope.Trojan.Win64.AllStars\n\n\nZillya!\nTrojan.Generic.Win32.918308\n\n\n\nYARA Rules\n\nrule CISA_3P_10135536_36 : lfsrPolynomials_handshakeBytes\n\t\t\t\t{\n\t\t\t\t\u00a0\u00a0\u00a0meta:\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Author = \"CISA Trusted Third Party\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Incident = \"10135536\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Date = \"2019-12-20\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Actor = \"Hidden Cobra\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Category = \"n/a\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Family = \"n/a\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0Description = \"Detects LFSR polynomials used for FakeTLS comms and the bytes exchanged after the FakeTLS handshake\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0MD5_1 = \"24906e88a757cb535eb17e6c190f371f\"\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0SHA256_1 = \"106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\"\n\t\t\t\t\u00a0\u00a0\u00a0strings:\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$p1 = { 01 23 45 67 }\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$p2 = { 89 AB CD EF }\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$p3 = { FE DC BA 98 }\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$p4 = { 76 54 32 10 }\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$h1 = { 44 33 22 11 }\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0$h2 = { 45 33 22 11 }\n\t\t\t\t\u00a0\u00a0\u00a0condition:\n\t\t\t\t\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0(uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and all of them\n\t\t\t\t}\n\nssdeep Matches\nNo matches found.\nPE Metadata\n\n\n\nCompile Date\n2018-07-31 21:47:58-04:00\n\n\nImport Hash\n8222381c21809ba71801ba1e0290adcc\n\n\nCompany Name\nMicrosoft Corporation\n\n\nFile Description\nScreen Reader\n\n\nInternal Name\nSR.exe\n\n\nLegal Copyright\n\u00a9 Microsoft Corporation. All rights reserved.\n\n\nOriginal Filename\nSR.exe\n\n\nProduct Name\nMicrosoft\u00ae Windows\u00ae Operating System\n\n\nProduct Version\n6.3.9600.17415\n\n\n\nPE Sections\n\n\n\nMD5\nName\nRaw Size\nEntropy\n\n\n05cafd41e93a7bd6aa578e957e7c0b4f\nheader\n1024\n2.508565\n\n\na6c7082567c2424071bfda7ab3bd8095\n.text\n144384\n6.231730\n\n\nedd9ce426d2be22871091e1c979b8f94\n.rdata\n37376\n4.515794\n\n\n3a129f29c07cc0ec4bb30fc7b4fb51e5\n.data\n4608\n2.451992\n\n\n0674e93d57aa4e7727acc7bdbc37bb36\n.rsrc\n86016\n7.119585\n\n\n978e1e848b291daef77e403a94cf8497\n.reloc\n13312\n4.524800\n\n\n\nRelationships\n\n\n\n106d915db6...\nDownloaded\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\n\n\n106d915db6...\nDownloaded\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\n\n\n106d915db6...\nConnected_To\n211.192.239.232\n\n\n\nDescription\nThis file is the main implant executable. For persistence, when executed the malware copies itself into the current user\u2019s Startup folder as \u201cNarrator.exe\u201d. The malware can have 5 hard-corded callback IP addresses/Ports. However, only 2 IP addresses are set, both to 211.192.239.232:8443. It will randomly pick one of the 5 IP addresses and attempt to connect to it. If it fails, it will wait 60 seconds and then try another IP address.\n\n\t\t\tIt performs the connection and authentication, then it attempts to download an additional module (3005f1308e4519477ac25d7bbf054899 or 68fa29a40f64c9594cc3dbe8649f9ebc) from the C2, which it loads and uses for command processing.\n\n\t\t\tThe modules export a function, CreateFileProcEx or CreateFileEx. The function is called by this sample with a number of arguments, including a handle to the active connection socket.\n\n\t\t\tThe malware utilizes a \u201cFakeTLS\u201d scheme in an attempt to obfuscate its network communications. It picks a random URL from a list (Figure 1) to use in the TLS certificate. The sample and the C2 externally appear to perform a standard TLS authentication, however, most of the fields used are filled with random data sourced from rand().\n\n\t\t\tOnce the FakeTLS handshake is complete, all further packets use a FakeTLS header, followed by LFSR encrypted data.\n\n\t\t\t--Begin packet structure--\n\t\t\t17 03 01 <2 Byte data length> <LFSR encrypted data>\n\t\t\t--End packet structure--\n\n\t\t\tAfter the TLS authentication, the sample performs a handshake with the C2 (outlined in Figure 2). After this exchange, the implant sends the Victim Info (outlined in Figure 3), and then waits for tasking from the C2.\nScreenshots\n \n\nFigure 1 - List of certificate URLs used in the TLS certificate.\n\n \n\nFigure 2 - Table of the session structure.\n\n \n\nFigure 3 - Table of the victim information structure.\n\n \n\nFigure 4 - The implant contains the commands displayed in the table.\n\n\n\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\nTags\ntrojan\nDetails\n\n\n\nName\nEngineDll.dll\n\n\nSize\n166400 bytes\n\n\nType\nPE32 executable (DLL) (GUI) Intel 80386, for MS Windows\n\n\nMD5\n3005f1308e4519477ac25d7bbf054899\n\n\nSHA1\n0cf64de7a635f5760c4684c18a6ad2983a2c0f73\n\n\nSHA256\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\n\n\nSHA512\n77b0b20002ab4a175941a81e309ac6771295abee45497ae507d43fcef237dc7f614bac1e9f97086ef22892db5ef895075c63e467347b08d7e5a76dbe226a190f\n\n\nssdeep\n3072:jdouAxXKBsOmN7OslJyOmg/wMFOpYop4vdxZdXYGeJavqL:jd3kCsOM5/YY3d9z\n\n\nEntropy\n6.511161\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nPE Metadata\n\n\n\nCompile Date\n2018-02-19 08:23:40-05:00\n\n\nImport Hash\nf56b60ba203f4772b5f87e061b59670a\n\n\n\nPE Sections\n\n\n\nMD5\nName\nRaw Size\nEntropy\n\n\n9ba90552855e9e8b3cfbcec483e4b036\nheader\n1024\n2.654189\n\n\n8244acedace09a0d354fd56aaf0c0f40\n.text\n123904\n6.641205\n\n\n84e6930849c4126353e3367f2431b941\n.rdata\n25600\n5.215729\n\n\n7403e6dd1ea8fd928cb704a43a82d773\n.data\n6144\n3.443058\n\n\n9a33838895830247744985365b8b2948\n.rsrc\n512\n5.115767\n\n\n7c956dfb879b86c9d57c3e783f4ab241\n.reloc\n9216\n5.177068\n\n\n\nPackers/Compilers/Cryptors\n\n\n\nMicrosoft Visual C++ DLL *sign by CodeRipper\n\n\n\nRelationships\n\n\n\n2057c0cf46...\nDownloaded_By\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n2057c0cf46...\nDownloaded_By\n211.192.239.232\n\n\n\nDescription\nThis file and 68FA29A40F64C9594CC3DBE8649F9EBC appear identical in functionality, except for the exported function name. Narrator.exe (24906E88A757CB535EB17E6C190F371F) looks for the exported function name CreateFileEx.\n\n\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\nTags\ntrojan\nDetails\n\n\n\nName\nEngineDll.dll\n\n\nSize\n166400 bytes\n\n\nType\nPE32 executable (DLL) (GUI) Intel 80386, for MS Windows\n\n\nMD5\n68fa29a40f64c9594cc3dbe8649f9ebc\n\n\nSHA1\nb24f6c60fa4ac76ffc11c2fcee961694aeb2141b\n\n\nSHA256\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\n\n\nSHA512\nffca587964d68e3bea67b4add649b06d768457bf49e2db0708996835f0d9da95cc79bcb6640220053632e993fe545e8ca4cd50309bf0d769c515112404b26e6c\n\n\nssdeep\n3072:VovrXpvEgEOtXOssvdAeL7Mz81dYFQbEPWgtXJtLNh1jUV46mG:VUDpNyD77YF/+gtHLRj7G\n\n\nEntropy\n6.512934\n\n\n\nAntivirus\nNo matches found.\nYARA Rules\nNo matches found.\nssdeep Matches\nNo matches found.\nPE Metadata\n\n\n\nCompile Date\n2018-02-05 21:20:52-05:00\n\n\nImport Hash\nb100cffd23b28dfc257c5feeb1e89eb9\n\n\n\nPE Sections\n\n\n\nMD5\nName\nRaw Size\nEntropy\n\n\n35b77733290c275ff61e476e1491ed7a\nheader\n1024\n2.620308\n\n\n6a8fcc80d3b556c366b9915ca084df91\n.text\n123904\n6.638987\n\n\n52890df518ebf2eeba3c08102c595dc1\n.rdata\n25600\n5.207715\n\n\nf73aec76a9c7a7f6bc0e0dbce1dd57b0\n.data\n6144\n3.442575\n\n\n9a33838895830247744985365b8b2948\n.rsrc\n512\n5.115767\n\n\n6f67f8a4390a007724e02090e947d315\n.reloc\n9216\n5.186683\n\n\n\nPackers/Compilers/Cryptors\n\n\n\nMicrosoft Visual C++ DLL *sign by CodeRipper\n\n\n\nRelationships\n\n\n\n19f9a9f7a0...\nDownloaded_By\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n19f9a9f7a0...\nDownloaded_By\n211.192.239.232\n\n\n\nDescription\nThis file and 3005F1308E4519477AC25D7BBF054899 appear identical in functionality, except for the exported function name. Narrator.exe (24906E88A757CB535EB17E6C190F371F) looks for the exported function name CreateFileProcEx.\n\n\n211.192.239.232\nTags\ncommand-and-control\nPorts\n\n8443 TCP\n\nRelationships\n\n\n\n211.192.239.232\nConnected_From\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n211.192.239.232\nDownloaded\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\n\n\n211.192.239.232\nDownloaded\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\n\n\n\nDescription\nNarrator.exe (24906E88A757CB535EB17E6C190F371F) attempts to download payload from the IP address.\n\nRelationship Summary\n\n\n\n\n106d915db6...\nDownloaded\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\n\n\n106d915db6...\nDownloaded\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\n\n\n106d915db6...\nConnected_To\n211.192.239.232\n\n\n2057c0cf46...\nDownloaded_By\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n2057c0cf46...\nDownloaded_By\n211.192.239.232\n\n\n19f9a9f7a0...\nDownloaded_By\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n19f9a9f7a0...\nDownloaded_By\n211.192.239.232\n\n\n211.192.239.232\nConnected_From\n106d915db61436b1a686b86980d4af16227776fc2048f2888995326db0541438\n\n\n211.192.239.232\nDownloaded\n2057c0cf4617eab7c91b99975dfb1e259609c4fa512e9e08a311a9a2eb65a6cf\n\n\n211.192.239.232\nDownloaded\n19f9a9f7a0c3e6ca72ea88c655b6500f7da203d46f38076e6e8de0d644a86e35\n\n\n\n\nMitigation\n\nThe following Snort rule can be used to detect the FakeTLS LFSR encrypted handshake packets:\n\n\t\t\t// Detects the FakeTLS LFSR encrypted handshake packets\n\t\t\t// 17 03 01 00 18 + lfsr_encoded([44-45] 33 22 11 00 00 00 00)\n\n\t\t\talert tcp any any -> any any (msg:\"Malware Detected\"; pcre:\" /\\x17\\x03\\x01\\x00\\x18.\\x26\\xa5\\xbb\\xf1\\x4f\\x33\\xcb/\"; rev:1; sid:99999999;)\n\nRecommendations\n\nCISA recommends that users and administrators consider using the following best practices to strengthen the security posture of their organization's systems. Any configuration changes should be reviewed by system owners and administrators prior to implementation to avoid unwanted impacts.\n\nMaintain up-to-date antivirus signatures and engines.\nKeep operating system patches up-to-date.\nDisable File and Printer sharing services. If these services are required, use strong passwords or Active Directory authentication.\nRestrict users' ability (permissions) to install and run unwanted software applications. Do not add users to the local administrators group unless required.\nEnforce a strong password policy and implement regular password changes.\nExercise caution when opening e-mail attachments even if the attachment is expected and the sender appears to be known.\nEnable a personal firewall on agency workstations, configured to deny unsolicited connection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for and remove suspicious e-mail attachments; ensure the scanned attachment is its \"true file type\" (i.e., the extension matches the file header).\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external drives, CDs, etc.).\nScan all software downloaded from the Internet prior to executing.\nMaintain situational awareness of the latest threats and implement appropriate Access Control Lists (ACLs).\n\nAdditional information on malware incident prevention and handling can be found in National Institute of Standards and Technology (NIST) Special Publication 800-83, \"Guide to Malware Incident Prevention & Handling for Desktops and Laptops\".\n\nContact Information\n\n\n1-888-282-0870\nNCCICCustomerService@us-cert.gov (UNCLASS)\nus-cert@dhs.sgov.gov (SIPRNET)\nus-cert@dhs.ic.gov (JWICS)\n\nCISA continuously strives to improve its products and services. You can help by answering a very short series of questions about this product at the following URL: https://us-cert.gov/forms/feedback/\n\nDocument FAQ\n\nWhat is a MIFR? A Malware Initial Findings Report (MIFR) is intended to provide organizations with malware analysis in a timely manner. In most instances this report will provide initial indicators for computer and network defense. To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.\nWhat is a MAR? A Malware Analysis Report (MAR) is intended to provide organizations with more detailed malware analysis acquired via manual reverse engineering. To request additional analysis, please contact CISA and provide information regarding the level of desired analysis.\nCan I edit this document? This document is not to be edited in any way by recipients. All comments or questions related to this document should be directed to the CISA at 1-888-282-0870 or soc@us-cert.gov.\nCan I submit malware to CISA? Malware samples can be submitted via three methods:\n\nWeb: https://malware.us-cert.gov\nE-Mail: submit@malware.us-cert.gov\nFTP: ftp.malware.us-cert.gov (anonymous)\n\nCISA encourages you to report any suspicious activity, including cybersecurity incidents, possible malicious code, software vulnerabilities, and phishing-related scams. Reporting forms can be found on CISA's homepage at www.us-cert.gov.\n\n\n\n\n\n\n\n\nRevisions\n\nMay 12, 2020: Initial Version\n",
  "cves": [
    "CVE-2022-42475",
    "CVE-2022-47966"
  ],
  "techniques": [],
  "advisory": "ar20-133b",
  "title": "MAR-10288834-2.v1 \u2013 North Korean Trojan: TAINTEDSCRIBE | CISA",
  "source": "analysis-reports",
  "id": "006af7348730a9447983d257ca3c0dd0fbab0c68204e27c68a2a6dcd0367d4f2"
}