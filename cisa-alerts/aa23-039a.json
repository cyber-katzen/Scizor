{
  "markdown": "\nSummary\n\nThe Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) in response to the ongoing ransomware campaign, known as \u201cESXiArgs.\u201d Malicious actors may be exploiting known vulnerabilities in VMware ESXi servers that are likely running unpatched and out-of-service or out-of-date versions of VMware ESXi software to gain access and deploy ransomware. The ESXiArgs ransomware encrypts configuration files on ESXi servers, potentially rendering virtual machines (VMs) unusable.\u00a0\nCISA has released an ESXiArgs recovery script at\u00a0github.com/cisagov/ESXiArgs-Recover. Organizations that have fallen victim to ESXiArgs ransomware can use this script to attempt to recover their files. This CSA provides guidance on how to use the script.ESXiArgs actors have compromised over 3,800 servers globally. CISA and FBI encourage all organizations managing VMware ESXi servers to:\u00a0\n\nUpdate servers to the latest version of VMware ESXi software,\u00a0\nHarden ESXi hypervisors by disabling the Service Location Protocol (SLP) service, and\u00a0\nEnsure the ESXi hypervisor is not exposed to the public internet.\u00a0\n\nIf malicious actors have compromised your organization with ESXiArgs ransomware, CISA and FBI recommend following the script and guidance provided in this CSA to attempt to recover access to your files. \u00a0\nDownload the PDF version of this report:\u00a0\n\n\nESXiArgs Ransomware Virtual Machine Recovery Guidance\n(PDF,       711.08 KB\n  )\n\n\nNote:\u00a0CISA and FBI will update this CSA as more information becomes available.\n\n\u00a0\nTechnical Details\n\nOpen-source reporting indicates that malicious actors are exploiting known vulnerabilities in VMware ESXi software to gain access to servers and deploy ESXiArgs ransomware. The actors are likely targeting end-of-life ESXi servers or ESXi servers that do not have the available ESXi software patches applied.[1]\u00a0\nESXiArgs ransomware encrypts certain configuration files on ESXi servers, potentially rendering VMs unusable. Specifically, the ransomware encrypts configuration files associated with the VMs; it does not encrypt flat files. As a result, it is possible, in some cases, for victims to reconstruct the encrypted configuration files based on the unencrypted flat file. The recovery script documented below automates the process of recreating configuration files.\u00a0The full list of file extensions encrypted by the malware is:\u00a0vmdk,\u00a0vmx,\u00a0vmxf,\u00a0vmsd,\u00a0vmsn,\u00a0vswp,\u00a0vmss,\u00a0nvram,\u00a0vmem.\nRecovery Guidance\nCISA and FBI do not encourage paying the ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, CISA and FBI urge you to promptly report ransomware incidents to a\u00a0local FBI Field Office, or to CISA at\u00a0cisa.gov/report.\u00a0\nCISA is providing these steps to enable organizations to attempt recovery of their VMs. CISA\u2019s GitHub ESXiArgs recovery script, which also outlines these steps, is available at\u00a0github.com/cisagov/ESXiArgs-Recover. CISA is aware that some organizations have reported success in recovering files without paying ransoms. CISA\u2019s script is based on findings published by third-party researchers.[2]\u00a0\nAny organization seeking to use CISA\u2019s ESXiArgs recovery script should carefully review the script to determine if it is appropriate for their environment before deploying it. This script does not seek to delete the encrypted configuration files, but instead seeks to create new configuration files that enable access to the VMs. While CISA works to ensure that scripts like this one are safe and effective, this script is delivered without warranty, either implicit or explicit. Do not use this script without understanding how it may affect your system. CISA does not assume liability for damage caused by this script.\u00a0Note:\u00a0Organizations that run into problems with the script can create a GitHub issue at\u00a0https://github.com/cisagov/ESXiArgs-Recover/issues; CISA will do our best to resolve concerns.\n\nQuarantine or take affected hosts offline\u00a0to ensure that repeat infection does not occur.\nDownload CISA\u2019s recovery script\u00a0and save it as\u00a0/tmp/recover.sh.For example, with\u00a0wget:\u00a0wget -O /tmp/recover.sh\u00a0https://raw.githubusercontent.com/cisagov/ESXiArgs-Recover/main/recover.sh.\nGive the script execute permissions:\u00a0chmod +x /tmp/recover.sh\nNavigate to the folder of a VM you would like to recover and run\u00a0ls\u00a0to view the files.\n\nNote:\u00a0You may browse these folders by running\u00a0ls /vmfs/volumes/datastore1. For instance, if the folder is called\u00a0example, run\u00a0cd /vmfs/volumes/datastore1/example.\n\n\nView files by running\u00a0ls. Note the name of the VM (via naming convention:\u00a0[name].vmdk).\nRun the recovery script\u00a0with\u00a0/tmp/recover.sh [name], where\u00a0[name]\u00a0is the name of the VM determined previously.\u00a0\n\nIf the VM is a thin format, run\u00a0/tmp/recover.sh [name] thin.\nIf successful, the recovery script will output that it has successfully run. If unsuccessful, it may not be possible for the recovery script to recover your VMs; consider engaging external incident response help.\n\n\nIf the script succeeded,\u00a0re-register the VM.\n\nIf the ESXi web interface is inaccessible,\u00a0remove the ransom note and restore\u00a0access via the following steps. (Note:\u00a0Taking the steps below moves the ransom note to the file ransom.html. Consider archiving this file for future incident review.)\n\nRun\u00a0cd /usr/lib/vmware/hostd/docroot/ui/ && mv index.html ransom.html && mv index1.html index.html.\nRun\u00a0cd /usr/lib/vmware/hostd/docroot && mv index.html ransom.html && rm index.html && mv index1.html index.html.\nReboot the ESXi server\u00a0(e.g., with the\u00a0reboot\u00a0command). After a few minutes, you should be able to navigate to the web interface.\nIn the ESXi web interface,\u00a0navigate to the Virtual Machines page.\nIf the VM you restored already exists, right click on the VM and select\u00a0Unregister\u00a0(see figure 1).\n\n\n\n\n\n\n \n\n\nFigure 1: Unregistering the virtual machine.\n\nSelect\u00a0Create / Register VM\u00a0(see figure 2).\nSelect\u00a0Register an existing virtual machine\u00a0(see figure 2).\n\n\n \n\n\nFigure 2: Registering the virtual machine, selecting machine to register.\nClick\u00a0Select one or more virtual machines, a datastore or a directory\u00a0to navigate to the folder of the VM you restored. Select the\u00a0vmx\u00a0file in the folder (see figure 3).\n\n \n\n\nFigure 3: Registering the virtual machine, finalizing registration.\nSelect\u00a0Next\u00a0and\u00a0Finish. You should now be able to use the VM as normal.\nFigure 3: Registering the virtual machine, finalizing registration.\nSelect\u00a0Next\u00a0and\u00a0Finish. You should now be able to use the VM as normal.\n\nUpdate servers to the latest software version, disable the Service Location Protocol (SLP) service, and ensure the ESXi hypervisor is not configured to be exposed to the public internet\u00a0before putting systems back online.\u00a0\n\nAdditional Incident Response\nThe above script only serves as a method to recover essential services. Although CISA and FBI have not seen any evidence that the actors have established persistence, we recommend organizations take the following additional incident response actions after applying the script:\n\nReview network logging to and from ESXi hosts and the guest VMs for unusual scanning activity.\nReview traffic from network segments occupied by the ESXi hosts and guests. Consider restricting non-essential traffic to and from these segments.\n\nIf you detect activity from the above, implement your incident response plan. CISA and FBI urge you to promptly report ransomware incidents to\u00a0a local FBI Field Office, or to CISA at\u00a0cisa.gov/report.\nOrganizations should also collect and review artifacts, such as running processes/services, unusual authentications, and recent network connections.\nSee the joint CSA from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States on\u00a0Technical Approaches to Uncovering and Remediating Malicious Activity\u00a0for additional guidance on hunting or investigating a network, and for common mistakes in incident handling. CISA also encourages government network administrators to see CISA\u2019s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to federal civilian branch agencies, these playbooks provide operational procedures for planning and conducting cybersecurity incident and vulnerability response activities and detail steps for both incident and vulnerability response. \u00a0\nAdditional resources for recovering\u00a0.vmdk\u00a0files can be found on a third-party researcher\u2019s website.[2]\n\n\u00a0\nMitigations\n\nNote:\u00a0These mitigations align with the cross-sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. For more information on the CPGs, including additional recommended baseline protections, see\u00a0cisa.gov/cpg.\nCISA and FBI recommend all organizations:\u00a0\n\nTemporarily remove connectivity for the associated ESXi server(s).\n\nUpgrade your ESXi servers to the latest version of VMware ESXi software\u00a0[CPG 5.1]. ESXi releases are cumulative, and the latest builds are documented in VMware\u2019s article, Build numbers and versions of VMware ESXi/ESX.\nHarden ESXi hypervisors by disabling the Service Location Protocol (SLP) service, which ESXiArgs may leverage. For more information on executing workarounds, see VMware\u2019s guidance\u00a0How to Disable/Enable the SLP Service on VMware ESXi.\u00a0\nEnsure your ESXi hypervisor is not configured to be exposed to the public internet.\n\n\n\nIn addition, CISA and FBI recommend organizations apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.\nPreparing for Ransomware\n\nMaintain offline backups of data, and regularly test backup and restoration\u00a0[CPG 7.3]. These practices safeguard an organization\u2019s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.\nEnsure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization\u2019s data infrastructure.\nCreate, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident\u00a0[CPG 7.1, 7.2].\n\n\u00a0Mitigating and Preventing Ransomware\n\nRestrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.\nRequire phishing-resistant MFA\u00a0for as many services as possible\u00a0[CPG 1.3]\u2014particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.\nReview the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.\nImplement allow-listing policies for applications and remote access that only allow systems to execute known and permitted programs.\nOpen document readers in protected viewing modes to help prevent active content from running.\nImplement user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails.\nUse strong passwords\u00a0[CPG 1.4]\u00a0and avoid reusing passwords for multiple accounts. See CISA Tip\u00a0Choosing and Protecting Passwords\u00a0and the NIST\u2019s\u00a0Special Publication 800-63B: Digital Identity Guidelines\u00a0for more information.\nRequire administrator credentials to install software\u00a0[CPG 1.5].\nAudit user accounts with administrative or elevated privileges and configure access controls with least privilege in mind\u00a0[CPG 1.5].\nInstall and regularly update antivirus and antimalware software on all hosts.\nConsider adding an email banner to messages coming from outside your organizations.\nDisable hyperlinks in received emails.\nConsider participating in CISA\u2019s no-cost\u00a0Automated Indicator Sharing (AIS) program\u00a0to receive real-time exchange of machine-readable cyber threat indicators and defensive measures.\u00a0\n\nResponding to Ransomware Incidents\nIf a ransomware incident occurs at your organization:\n\nFollow your organization\u2019s Ransomware Response Checklist (see Preparing for Ransomware section).\nScan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.\nFollow the notification requirements as outlined in your cyber incident response plan.\nReport incidents to CISA at\u00a0cisa.gov/report, FBI at a\u00a0local FBI Field Office, or the U.S. Secret Service (USSS) at a\u00a0USSS Field Office.\nApply incident response best practices found in the joint Cybersecurity Advisory,\u00a0Technical Approaches to Uncovering and Remediating Malicious Activity, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.\n\nNote:\u00a0CISA and FBI strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities.\nResources\u00a0\nSee\u00a0Stopransomware.gov, a whole-of-government approach, for ransomware resources and alerts.\nAcknowledgements\nCISA and FBI would like to thank VMware for their contributions to this CSA.\n\n\u00a0\nReferences\n\nVMware Security Response Center (vSRC) Response to 'ESXiArgs' Ransomware Attack\u2026\nEnes Sonmez and Ahmet Aykac, YoreGroup Tech Team: decrypt your crypted files in\u2026\n\n\u00a0\nRevisions\n\nFebruary, 2023: Initial Version\n\n",
  "cves": [],
  "techniques": [],
  "advisory": "aa23-039a",
  "title": "ESXiArgs Ransomware Virtual Machine Recovery Guidance | CISA",
  "source": "cybersecurity-advisories",
  "id": "6252f251bd0f07bbd6465ccee457d3673458f234259a7f79ce811a75aa49374f"
}