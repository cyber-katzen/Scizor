{
  "markdown": " \n \n \nNational Security Agency  \nCybersecurity  Technical Report  \n \n \n \n \n \nCisco Firepower Hardening Guide  \n \n \n \n \n \n \n \n [August 2023 ] \nU/OO/ 183115 -23 \nPP-23-2153  \n \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   i \nNSA  | Cisco  Firepower Hardening Guide  \nNotices and history  \nDocument change history  \nDate  Version  Description  \nAugust 2023  1.0 Initial Publication  \n   \nDisclaimer of warranties and endorsement  \nThe information and opinions containe d in this document are provided \"as is\" and without any warranties \nor guarantees. Reference herein to any specific commercial products, process, or service by trade name, \ntrademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or \nfavoring by the Unite d States Government, and this guidance shall not be used for advertising or product \nendorsement purposes.  \nTrademark recognition  \nCisco Firepower is a registered trademark  of Cisco  Technology, Inc . \nPublication information  \nAuthor(s)  \nNational Security Agency  \nCybersecurity Directorate  \nNetwork Infrastructure Security  \nContact information  \nCybersecurity Report Feedback: CybersecurityReports@nsa.gov   \nGeneral Cybersecurity Inquiries: Cybersecurity_Requests@nsa.gov   \nDefense Industrial Base Inquiries and Cybersecurity Services: DIB_Defense@cyber.nsa.gov   \nMedia Inquiries / Press Desk:  443-634-0721, MediaRelations@nsa.gov   \nPurpose  \nThis document was developed in furtherance of NSAs cybersecurity missions . This  includ es its \nresponsibilities to identify and disseminate  threats to National Sec urity Systems,  Department  of Defense \ninformation systems,  and the Defense Industrial Base , and to develop and issue cybersecurity \nspecifications and mitigations.  This information may be shared broadly to reach all appropriate \nstakeholders . \n  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   ii \nNSA  | Cisco  Firepower Hardening Guide  \nExecutive summary  \nThe Cisco Firepower device , now known as Cisco Secure Firewall  [1], is a Next -Generation Firewall \n(NGFW) that blocks updated threats, malware, and application layer exploitation technique s. This \ncybersecurity technical report (CTR ) is a guide of best practices for network and system administrators \nwho are  using Cisco Firepower Threat Defense (FTD). This report provides  configurations that will assist  \nnetwork and system administrators  in tailoring and inspecting network traffic , as well as hardening the \ndevice along with its  provided  default policies and rulesets . \nAs network administrators start to deploy  Cisco Firepower devices, proper configuration is essential in \nmitigating vulnerabilities and ensuring the security of the network.  Access control rules manage network \ntraffic flow and minimize unauthorized access to infrastructure devices. When network administrators \nconfigure the Cisco Firepower device to prevent unauthorized traffic, they must  know that securing user \naccess to the device is just as important in preventing unauthorized access through traffic.  \nAt minimum, network administrators should configure user accounts that contain restricted privileges, a \nstrong password policy , and passive authentication . Linux shell and command line interface ( CLI) access \nmust be restricted to prevent users from implementing configurations that could lead to a compromised \nnetwork. Undesirable traffic can be  detected as early as possible by correctly configuring acces s control \npolicies, cr eating  appropriate URL filtering rules, and utilizing file and intrusion policies, which minimize s \nthe risk of network security compromise . \nNetwork administrators should implement configurations for encrypted traffic to create more streamlined \nand desired traffic. As SSL /TLS  policies and separate HTTP and HTTPS access control policies are \nproperly configured, the policies pass  through authorized traffic and filter out malicious traffic that may be \nobscured by encryption. As network administrators configure virtual private networks (VPN) with secure \nhashing and encryption algorithms, traffic is routed privately and securely to prevent unauthorized users \nand access to sensitive data.  \nCreating malware and file policies allow s the device to capture and detect f iles that are harmful to the \nnetwork. Resetting session connections prevent harmful sessions from remaining open and leading to a \ncompromise in the network.  \nNetwork administrators need to harden the underlying operating system, FXOS,  on Firepower compatibl e \ndevices [2] to minimize attack surfaces. Strong SSH algorithms, HTTPS options, and TLS versions should \nbe configured in order to enable secure sessions between authorized users and the device. This \nconfiguration not only limi ts the number of users that can access the FXOS but prevents unsecured \naccess into the device.  \n  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   iii \nNSA  | Cisco  Firepower Hardening Guide  \nContents   \nNotices and history  ................................ ................................ ................................ ................................ ...... i \nDocument change history  ................................ ................................ ................................ ..........................  i \nDiscla imer of warranties and endorsement  ................................ ................................ ................................  i \nTrademark recognition  ................................ ................................ ................................ ...............................  i \nPublication information  ................................ ................................ ................................ ...............................  i \nAuthor(s)  ................................ ................................ ................................ ................................ .....................  i \nContact information  ................................ ................................ ................................ ................................ .... i \nPurpose  ................................ ................................ ................................ ................................ ......................  i \nExecutive summary  ................................ ................................ ................................ ................................ .... ii \nContents  ................................ ................................ ................................ ................................ ......................  iii \nTable of Figures  ................................ ................................ ................................ ................................ .........  iv \n1. Overview  ................................ ................................ ................................ ................................ ..............  1 \n2. Implementing access control  ................................ ................................ ................................ ............  1 \n2.1. Configure default action to Block  ................................ ................................ ................................  1 \n2.2. Ensure rule priority placement  ................................ ................................ ................................ ...... 2 \n2.3. Secure user access  ................................ ................................ ................................ .......................  4 \n2.4. Restrict configuration privileges  ................................ ................................ ................................ .... 6 \n2.5. Restrict Linux shell access  ................................ ................................ ................................ ............  6 \n2.6. Change the password policy for each user  ................................ ................................ ...................  7 \n2.7. Enable logging and configure a Syslog server ................................ ................................ ..............  7 \n2.8. Create identity policies with passive authentication  ................................ ................................ .... 10 \n2.9. Disable fragment reassembly  ................................ ................................ ................................ ...... 12 \n2.10. Enable SNMPv3 access  ................................ ................................ ................................ ..............  13 \n2.11. Create application filter objects for efficient policy creation  ................................ ........................  15 \n2.12. Configure URL category reputation  ................................ ................................ ............................  18 \n2.13. Enable reputation enforcement on DNS t raffic  ................................ ................................ ...........  19 \n2.14. Create separate URL filtering mechanism rules for HTTP and HTTPS traffic  ............................  20 \n2.15. Create separate access control policy rules for URL and application filtering  ............................  21 \n2.16. Configure the URL time to live  ................................ ................................ ................................ .... 21 \n3. Implementing intrusion prevention policies  ................................ ................................ ..................  22 \n3.1. Implement Balanced Security and Connectivity as a base policy  ................................ ............  23 \n4. Implementing SSL policies  ................................ ................................ ................................ ..............  23 \n4.1. Enable TLS server identity discovery  ................................ ................................ ..........................  24 \n4.2. Decrypt specific traffic instead of all traffic  ................................ ................................ ..................  24 \n5. Implementing malware and file policies  ................................ ................................ .........................  25 \n5.1. Enable reset connection  ................................ ................................ ................................ ..............  25 \n5.2. Do not store all files within local storage  ................................ ................................ .....................  25 \n6. Enabling secure VPN settings  ................................ ................................ ................................ .........  26 \n6.1. Use secure VPN tunneling protocols  ................................ ................................ ..........................  26 \n7. Hardening FXOS  ................................ ................................ ................................ ................................  26 \n7.1. Configure strong SSH algorithms ................................ ................................ ................................  26 \n7.2. Configure key ring  ................................ ................................ ................................ .......................  28 \n7.3. Configure HTTPS options for secure communication  ................................ ................................ . 29 \n7.4. Configure TLS to the latest versions  ................................ ................................ ...........................  29 \n8. Works cited  ................................ ................................ ................................ ................................ ........  30 \n \n  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   iv \nNSA  | Cisco  Firepower Hardening Guide  \nTable of Figures  \nFigure 1: Default access control option (FDM)  ................................ ................................ .............................  2 \nFigure 2: Add Allow access rule  ................................ ................................ ................................ ....................  2 \nFigure 3: Incorrectly configured access rules  ................................ ................................ ...............................  3 \nFigure 4: Edit access rule  ................................ ................................ ................................ ..............................  3 \nFigure 5: Change access rule order  ................................ ................................ ................................ ..............  3 \nFigure 6: Correctly configured access rules  ................................ ................................ ................................ .. 4 \nFigure 7: Add local user  ................................ ................................ ................................ ................................  4 \nFigure 8: Local user login to FDM  ................................ ................................ ................................ .................  5 \nFigure 9: Log action At Beginning and End of Connection  ................................ ................................ ...........  7 \nFigure 10: Data logging settings  ................................ ................................ ................................ ...................  8 \nFigure 11: Configure file policy ................................ ................................ ................................ ......................  9 \nFigure 12: Enable logging  ................................ ................................ ................................ .............................  9 \nFigure 13: Enable file/malware logging  ................................ ................................ ................................ .........  9 \nFigure 14: Select Syslog server  ................................ ................................ ................................ ..................  10 \nFigure 15: Passive authentication  ................................ ................................ ................................ ...............  11 \nFigure 16: ISE integration  ................................ ................................ ................................ ...........................  12 \nFigure 17: Fragment settings (FMC)  ................................ ................................ ................................ ...........  13 \nFigure 18: Configure SNMP  ................................ ................................ ................................ ........................  14 \nFigure 19: Add SNMP management hosts  ................................ ................................ ................................ . 14 \nFigure 20: Filter applications (FDM)  ................................ ................................ ................................ ............  16 \nFigure 21: Filter list of applications  ................................ ................................ ................................ .............  16 \nFigure 22: Selected applications  ................................ ................................ ................................ .................  16 \nFigure 23: Create application filter  ................................ ................................ ................................ ..............  17 \nFigure 24: Application filter ................................ ................................ ................................ ..........................  17 \nFigure 25: Application filter objects  ................................ ................................ ................................ .............  17 \nFigure 26: Web reputation levels (Cisco Talos)  ................................ ................................ ..........................  18 \nFigure 27: Defau lt reputation risk (FDM)  ................................ ................................ ................................ ..... 19 \nFigure 28: Recommended reputation risk settings  ................................ ................................ .....................  19 \nFigure 29: Enable reputation enforcement on DNS traffic setting  ................................ ..............................  20 \nFigure 30: Select ports for block access rule  ................................ ................................ ..............................  20 \nFigure 31: Create Allow access rule  ................................ ................................ ................................ ...........  21 \nFigure 32: Select application for block access rule  ................................ ................................ .....................  21 \nFigure 33: Enable Query Cisco CSI for Unknown URLs option  ................................ ................................ .. 22 \nFigure 34: Time to Live (TTL) setting  ................................ ................................ ................................ ..........  22 \nFigure 35: Intrusion Prevention base template options  ................................ ................................ ..............  23 \nFigure 36: Enable TLS Server Identity Discovery setting  ................................ ................................ ...........  24 \nFigure 37: Create SSL Decryption Rule  ................................ ................................ ................................ ...... 24 \nFigure 38: Configure Store Files options (FMC)  ................................ ................................ .........................  25 \nFigure 39: Enable SSH  ................................ ................................ ................................ ...............................  26 \nFigure 40: Configure AES -CTR-256 encryption ................................ ................................ ..........................  26 \nFigure 41: Configure Diffie -Hellman key exchange algorithm  ................................ ................................ .... 27 \nFigure 42: Configure HMAC algorithm  ................................ ................................ ................................ ........  27 \nFigure 43: Configure RSA host key  ................................ ................................ ................................ ............  27 \nFigure 44: Configure rekey limit  ................................ ................................ ................................ ..................  27 \nFigure 45: Configure rekey time limit  ................................ ................................ ................................ ..........  27 \nFigure 46: Configure strict host keycheck  ................................ ................................ ................................ ... 27 \nFigure 47: Configure trusted hosts or subnets within the FXOS SSH known host file  ...............................  28 \nFigure 48: Configure key rings  ................................ ................................ ................................ ....................  28 \nFigure 49: Configure key ring regeneration  ................................ ................................ ................................  28 \nFigure 50: Create certificate request for key ring  ................................ ................................ ........................  29 \nFigure 51: Configure trusted hosts or subnets within the FXOS HTTPS known host file  ...........................  29 \nFigure 52: Configure TLS to the latest version  ................................ ................................ ...........................  30 \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   1 \nNSA  | Cisco  Firepower Hardening Guide  \n1. Overview  \nCisco Firepower is a Next-Generation Firewall (NGFW) with a combined operating system that has \napplication -layer Firepower features and network -layer  Cisco Adaptive Security Appliance (ASA) features . \nIt runs  the Firepower Threat Defense (FTD) operating system. Along with the stateful firewall features of \nthe ASA, FTD implements  application visibility and control (AVC), URL filtering, user identity and \nauthentication, malware protection, and intrusion preventi on. \nThe Firepower Management Center (FMC) is designed to centralize management functions for  multiple \nFTD devices. The FMC contains similar configuration features as the standalone Firepower device as well \nas other configurations that are unique to FMC. Th is document establishes  a best practice guide for \nessential configurations of the FTD system. The purpose of these configurations is to enhance network \ntraffic security and visibility along with other network -specific configurations that were created based  on \nthe needs of the organization.  At the time this document  was written , the Cisco suggested release version \nof FTD was 7.0.5 and of FMC was 7.0.5 [3]. \n2. Implementing access control  \nAccess control rules are created to refine and  control desired traffic flow, minimize unauthorized access, \nand prevent undesirable traffic from accessing and compromising the network, while also allowing users \nto access intended and authorized sites. Access control policies protect the network by rest ricting users \nfrom accessing specifically configured external or internal network resources , while also providing the \nappropriate connectivity to users within defined security zones of the network. A best practice for access \ncontrol configuration is to cre ate rules that are as specific and succinct as possible  and in the proper \norder . Following this practice will minimize the processing power required, the amount of rules the device \nneeds to evaluate, and the increased risk of rule redundancy.  \nIn FTD, acces s control rules  can indicate the type  of traffic  as well as  how it is blocked, allowed, logged, \nor inspected.  Configured rules can restrict specific ports, URLs,  file types , network ranges , and parts of or \nentire applications  to regulate the flow of traffi c within a network. An access control policy can be applied \nto one or more FTD device s when multiple FTD devices are managed with the FMC.  \n2.1. Configure  default action  to Block  \nThe default  action  handles all of the traffic that does not match any of the rules ets created by network \nadministrators. A  Block  default configuration ensures only permitted and desired traffic passes through \nthe network, minimiz ing unauthorized access  and prevent ing potent ially malicious traffic from accessing \nand compromising the network . \nNSA recommends setting the default action  to Block  with Connection Events Logging : At Beginning and \nEnd of Connection  selected  with additional rules created in an allow -listing method , as shown in  the \nfollowing figure . Enabling detailed logging in a firewall can potentially impact the performance of the \nfirewall, especially during high traffic periods. However , these devices can significantly scale in high -traffic \nenvironments. Intensive  logging can introduce additional latency into network communications. Each \nlogged event requires processing and storage, which can add a delay in the packet forwarding process.  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   2 \nNSA  | Cisco  Firepower Hardening Guide  \nThe default action  of Block  is configured as follows: Policies  > Access Contro l > in the Default Action  \ndropdown at the bottom, select Block  > select the At Beginning and End of Connection  radio button > OK. \n \nFigure 1: Default access control option (FDM)  \nSince the default access control option is set to Block , an Allow access rule set is required to  access the \npublic Internet. This can be configured  as follows : Policies  > Access Control  > Add Rule  (the  + button) > \nSource Networks: [Desired Source Network]  > Destination Networks: [Desired Destination Net work] , as \nshown in the following figure : \n \nFigure 2: Add Allow access rule  \n2.2. Ensure rule priority p lacement  \nProper configuration of access control rules ensures only explicitly allowed traffic can reach  the network.  \nAccess control rules are processed against the defined rules in a top -down , sequential order  evaluation \nmethod.  As packets flow through the system, they are compared against the rules in the specific order \nthat they are defined. Once a packet matches a rul e, the evaluation process is concluded, even if \nsubsequent, more specific rules are later defined . \nSince packets are processed according to the first matched rule, NSA recommends placing specific \naccess control policies before generalized rules, to ensure critical, undesirable traffic is detected as early \nas possible.  If access control rules are improperly configured or placed in an incorrect order, a rule that is \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   3 \nNSA  | Cisco  Firepower Hardening Guide  \nhigher up could block subsequent rules from allowing desirable traffic through , potentially je opardizing the \navailability  of the network.  \nThe following figure shows incorrectly  configured access control rules.  Rule #1 , a general  rule, allows  \naccess to the entirety of the Facebook Application.  Rule #2 , a specific  rule, blocks  Facebook Apps and \nFaceb ook Games.  Since Rule #1 allows  all of Facebook,  Rule #2 would not be evaluated  when a user \nattempts to  visit Facebook Apps and Facebook Games, therefore improperly allowing  the User access . \n \nFigure 3: Incorrectly configured access rules  \nThe specific rule of NO FB Games  should  be set as Rule #1 and the general rule of Allow FB  should  be \nset to Rule #2 , to correctly configure these access control rules . This change results in  block ing access to \nFacebook  Apps and Facebook Games but allow ing users access to the rest of Facebook.  The evaluation \norder of the rules can be changed by either dragging a rule to the desired position within the rule list, or \nby selecting Edit (pencil icon) and then changing the Order  number in the dropdown in the upper -left \ncorner, as shown in  the following figures :  \n \nFigure 4: Edit access rule  \n \nFigure 5: Change access rule order  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   4 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 6: Correctly configured access rules  \nWhile this specific example is an illustration of how to configure access control rules in a NGFW with rule \npriority placement in mind, this product does still offer the traditional access control functionality options \nthat specifically address IPv4 or IPv 6 traffic, as well as rules that specify protocols or ports. The user can \nrefer to the NIST recommendations for further guidelines on traditional firewall policies  [4]. \n2.3. Secure user access  \nWhen signing in for the first time, the  local user admin  is created by default and contains all privileges \navailable to configure the Firepower  device . NSA recommends adding local user objects, which creates \nseparate, non -administrative accounts with unique usernames for each user. This can be configured  as \nfollows: Objects  > Users  > Add Local User  (the + button) > Service Types: RA-VPN > input new User's \nName and Password > OK, as shown in the following figure . Notice that the only available Service Type  \noption is RA-VPN for local users added  through this workflow.  \n \nFigure 7: Add local user  \n \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   5 \nNSA  | Cisco  Firepower Hardening Guide  \nThe new accounts will limit the users privileges , preventing them from logging in and accessing the \nadministrative FDM portal, as shown in the following figure : \n \nFigure 8: Local user login to FDM  \nOnce the Service Types is configured to RA-VPN, configuring  a RADIUS  server serves as access \nprotection for the FTD remote access VPN. On the RADIUS server, the different levels of access rights \ncan be  provided from a single authentication source as opposed to separate local user accounts.  \nNSA recommends enabling a RADIUS server for authentication and authorization as well as creating user \naccounts with appropriate access rights to prevent needing multi ple users to log  in via the admin account. \nWhether a user is gaining access through HTTPS or SSH, role-based  access control (RBAC) attributes \nshould be updated for the appropriate accounts.  \nA RADIUS server such as Cisco Identity Services Engine (ISE), allo ws network administrators to approve \naccess by implementing attributes  with authorization policies . Within ISE, go to Policy  > Policy Elements  > \nAuthorization  > Authorization Profiles . Within the authorization profile, scroll to Advanced Attributes \nSetting s and click on the appropriate attribute with its value . \nTo provide HTTPS access, NSA recommends defining the cisco -av-pair attribute within a user account. \nThe following are supported values for this attribute:  \n fdm.userrole.authority.ro : This value only p rovides read-only access. The users can view \nconfigurations and dashboards but are unable to make changes.  \n fdm.userrole.authority.rw : This value provides read-write  access. These users are able to \nexecute all the actions a read-only user can do, but can and also edit and deploy the \nconfiguration. These users are restricted to upgrades, viewing the audit logs, creating and \nrestoring backups, and ending user sessions on the device.  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   6 \nNSA  | Cisco  Firepower Hardening Guide  \n fdm.userrole.authority.admin : This value provides full administrator  access. These users are \nable to implement all actions that the local admin  user is able to do.  \nTo provide RBAC for SSH access, NSA recommends  defining the user account attribute as  Service -Type  \non the RADIUS server . If a user account does not have this attribute defined on the RADIUS server, SSH \naccess will be denied. The following are values for this attribute:  \n Administrative (6) : This value provides config  access to the CLI. Users with this value are able \nto use al l commands in the CLI.  \n NAS Prompt (7) or any value other than (6): Users with this value have basic authorization to \nthe CLI. These users will only be able to use read-only commands such as the show  command.  \nThe password for the admin  account should be cha nged to a complex password and stored in a secure \nstorage location. The account should only be used in case  of an emergency when  no other means of \naccessing the device are available.  \n2.4. Restrict config uration p rivileges  \nBy default , there is one admin user wit h full administrator rights to the FTD CLI command line. This admin \nuser can create multiple accounts and grant them either basic , which is read -only,  or config , which is \nread-write,  access levels . \nNSA recommends restricting the  number of users  who will obtain  config  access to the FTD system.  \nAppropriate access levels should be administered depending on the users role. Decreas ing the number  \nof users with config  access instead of granting  all users config  access, significantly reduc es the chance s \nof a compromised system.  \n2.5. Restrict Li nux shell access  \nCLI access is obtained  through the management interface from a n SSH connection. Users with config  \nlevel access can use the CLI command expert  to access the Linux  shell. This is available to the admin  \naccount, local users, and external users with config  level access.  \nNSA recommends  not add ing new user accounts directly in the Linux  shell, but to instead create new \naccounts using the configure user add  command  on the FTD CLI . To block access to the Linu x shell, \nadministrators can use the system lockdown -sensor  command. Once this command is used , any non -\nadministrator user who logs in will only have access to the FTD CLI command.  \nHowever, once this command is applied , the results cannot be reversed withou t a hotfix from the Cisc o \ntechnical assistance center. Use the command configure ssh -access-list  in the FTD CLI to limit the \nnumber of IP addresses from which the device will accept SSH connections on the management \ninterface.  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   7 \nNSA  | Cisco  Firepower Hardening Guide  \n2.6. Change the password policy fo r each user  \nEvery user account should contain  enforced password and login policies. The configure user  \ncommand, within the FTD CLI, enforces  the users  password and login  configurations.  NSA recommends  \nhardening each user account  using the  following  configure user  commands . Properly implement ing \nthese settings can  prevent the system from being compromis ed through web interface login mechanisms  \nand SSH sessions : \n configure user maxfailedlogins : maximum number of failed logins before a user is locked \nout. \n configure user minpasswdlen : enforce s a minimum password length.  \n configure user strengthcheck : enforce s strong passwords . \n configure user access : assign s user access privileges based on the user s require ments . \n configure user forcereset : force s the user to reset the password on the next login . \n2.7. Enable logging and c onfigure a Syslog server  \nNSA recommends enabling connection  logging  and configuring an external syslog server to record traffic \nand events that may be of interest as traffic passes thro ugh the device. The logging configuration for an \nindividual access rule determine s whether connection events are created for traffic that matches a \nspecific rule. Logging must be enabled to see events related to the rule in the Event Viewer . Logging \nmust a lso be enabled to match traffic that will be reflected in the dashboards used to monitor the system.  \nNSA recommends logging events that are critical for analysis , at the discretion of network administrators,  \nbut not to log debug and informational traffic t hat would affect system performance with numerous similar \nevents.  For example, logging events of blocked TCP connections for a Denial of Service (DoS) attempt  \nmay overwhelm the database with multiple similar events.  \nFor different types of policies, there are additional logging options to log At Beginning and  End of \nConnection  or At End of Connection , as shown  in the following figure : \n \nFigure 9: Log action At Beginning and End of Connection  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   8 \nNSA  | Cisco  Firepower Hardening Guide  \nNSA recommends selecting the log action At Beginning and End of Connection , which will log blocked \ntraffic at the beginning of a connection and log allowed traffic both at the  beginning and  end of a \nconnection. Blocked traffic is typically logged at the beginning, since it is denied immediately with no \nfurther inspection of the packets.  Logging should be set to End of Connection  when connection logging is \nenabled in an SSL policy, because the system is unable to determine if the connection is encrypted, u sing \nthe first packet in the session.  \nNSA recommends streaming logs to an external source rather  than logging on the device itself . Sending \nevents to an external syslog server yields  more available  disk space on the device and helps maintain the \nintegrity of security logs . This external source  creates  an extra layer of redundancy , which mitigates the \nrisk of  adversaries accessing and  manipulating the security logs , covering their tracks.  The syslog server \nmust be configured in the intrusion policy settings to send intrusion events to the syslog server.  This can \nbe configured as follows: Device  > System Settings : Logging Settings  > toggle the Data Logging  switch, \nas shown in the following figure : \n \nFigure 10: Data logging settings  \nFile and malware events can also be sent to the external syslog server by configuring logging settings ; \nhowever, the network administrator must first configure file policies on one or more access control rules \nbefore file logging can be enabled.  This can b e configured as follows: Policies  > Edit (pencil icon) > File \nPolicy  > select either the Block Malware All  or Malware Cloud Lookup - No Block  option from the \ndropdown, as shown in the following figure : \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   9 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 11: Configure file policy  \nStill within the Edit Access Rule  workflow, logging is then enabled as follows: Logging  (the tab next to File \nPolicy ) > File Events  > Log Files  > OK, as shown in the following figure:  \n \nFigure 12: Enable  logging  \nOnce the applicable access control rules have been configured, file and malware logging can then be \nconfigured as follows:  Device  > System Settings: Logging Settings  > toggle the File/Malware Logging  \nswitch > select the applicable Syslog Server  from the dropdown > Save , as shown in the following figures : \n \nFigure 13: Enable file/malware logging  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   10 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 14: Select Syslog server  \n2.8. Create identity policies with passive authent ication  \nAn identity policy authenticates users by associating an IP address with a username within the system. \nWhen a service is permitted or denied for a particular user, that service is applied to the IP address of the \nassociated user.  \nNSA recommends creating identity policies with passive auth entication to link abnormal network behavior \ndirectly with individual users. Obtaining user information can be done through either passive or active \nauthentication. Passive authentication is recommended due to the identity source being separate  from the \nFTD device , and allows user identification to be obtained from another authentication service such as an \nIdentity Services Engine (ISE).  The system obtains identity mappings based upon the identity sources \nthat were specified. Active authentication is for HT TPS connections only. A username and password is \nprompted and authenticated against the specified identity source.  \nTo create a passive authentication identity source, the policy would need to be enable d. Once the policy \nis enabled, passive authentication  should be specified  and ISE should be integrated with the appropriate \nserver , as shown in the following figures : \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   11 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 15: Passive authentication  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   12 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 16: ISE integration  \n2.9. Disable fragment  reassembly  \nIn Fragment Settings , the default setting allows up to 24 fragments for each packet and up to 200 \nfragments aw aiting reassembly . Limiting how the device fragme nts packets can prevent  exploitation , such \nas in a  DoS attempt,  and prevent extended downtime of critical infrastructure and services.  For normal \ntraffic that is fragmented, the system will attempt to reassemble the packets. If the system is able to \nreassemble the fragmented packets, this traffic will not be dropped. If the packets cannot be \nreassembled, then the  packets will be dropped.  \nNSA recommends disabling the packet fragment  reassembly  in FMC and setting the Chain (fragment)  \noption to 1 to not fragment s. This can be configured as follows: Devices  > Platform Settings  > create an \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   13 \nNSA  | Cisco  Firepower Hardening Guide  \nFTD policy  > Fragment Settings > set Chain (Packet)  to 1 > Save and Deploy , as shown in the following \nfigure : \n \nFigure 17: Fragment settings (FMC)  \n2.10.  Enable SNMPv3 access  \nNSA recommends administrators enable SNMPv3 when using SNMP to monitor the health of FTD . While  \nFTD supports version s 1, 2c, and 3, SNMP version 3 should be the only version used. Only SNMPv 3 \nsupports read-only users and encryption with AES -256. This means that users can only  poll or  send \nSNMP traps for alerts.  In FMC , go to Devices , then Platform Settings  and select SNMP . Once in the \nSNMP setting, enable the SNMP  checkbox, Enable SNMP Servers , then configure the below  options . \nAs shown in the following figure , the password for the community string is used by the SNMP \nmanagement station when sending requests to the FTD device. This password should be  unique ; contain \nupper case  and lower case letters, numbers, and symbols ; kept secret ; and changed at regular intervals.  \nThe security level should be configured to Priv when creating SNMP users , which  enables authentication \nand privacy so that SNMP messages are encrypted and authenticated. The type of password encryption \nshould be set to encrypted  because passwords should not be transmitted  without encryption .  \nThe Auth Algori thm Type  should be set to SHA-256, since MD5 was deprecated in 2008 due to both the \nrisk of collisions and it no longer being considered reliable or recommended for use . The Encryption Type  \nfor the password  should be set to AES-256. 3DES is a weak encryp tion algorithm  that should not be \nused,  and increa ses the chance  of an adversary decrypting the data . \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   14 \nNSA  | Cisco  Firepower Hardening Guide  \n \n \nFigure 18: Configure SNMP  \nThe SNMP host entries represent the SNMP management stations that can access the FTD device.  As \npolls and traps are enabled , select  Device Management Interface  when choosing an option on how to \nreach the device from the SNMP Management Station , as shown  in the following figure . This confines \naccess from the management station by the interface instead of by a subnet or security zone.  \n \nFigure 19: Add SNMP management hosts  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   15 \nNSA  | Cisco  Firepower Hardening Guide  \n2.11.  Create application filter objects for efficient policy creation  \nApplication filters can be used to control the flow for multiple applicatio ns at a time. An application filter \nobject defines the applications that are used in a connection or a filter -defining application by category , \ntype, tag, business relevance , or risk.  \nNSA recommends creating application filter objects if multiple policies must include the same group of \napplications. Applications and filters can be specified directly in each policy, but using objects helps to \nsimplify complex rule creation and helps the system stay within the 50 items per criteria limit.  \nApplication Filters can be configured as follows: Policies  > Access Control  > Edit (pencil icon) > \nApplications  > Add Application  (the  + button)  > Advanced Filter . The user will see pre-defined filter \ncriteria which help filter out specific applications that will be added t o the application object , as shown  in \nthe following figure : \n Risks (1) : The likelihood of the specific application undermining an organizations security \npolicies. This criteria ranges from Very Low to Very High. \n Business Relevance (2) : The likelihood of th e specific application aligning with the business \nneeds and operations of the organization. This criteria ranges from Very Low to Very High. \n Types (3) : Defines the type of application which consists of either Application Protocol , Client \nProtocol , or Web Application . \n Application Protocol : The communication between hosts  (e.g., HTTP, SSH).  \n Client Protocol : Communication from the software , running on the host  (e.g., web \nbrowsers, email clients) . \n Web Application : Content or  HTTP  / HTTPS traffic from a requeste d URL.  \n Categories (4) : General application classification, describing its most essential functions . \n Tags  (5): Information that describes the application  (e.g., for encrypted traffic, only applications \ntagged with SSL Protocol can be identified and filtered; without the tag, only unencrypted / \ndecrypted traffic can be detected.)  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   16 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 20: Filter applications (FDM)  \nFTD provides a search option that helps users identity predefined , available application s. This can be \nconfigured from within the Filter Applications  submenu as shown in the following figures : In the Filter the \nlist of applications  text box, input  the name of the application to be filtered and added to the object  > \nselect the desired application s > Add > click on Save as Filter  > input the desired filter name > OK. \n \nFigure 21: Filter list of applications  \n \n \nFigure 22: Selected applications  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   17 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 23: Create application filter  \nOnce the filter name has been saved, it can be applied to other access control rules.  In the selected list of \nApplications , the 'A' icon change s to a filter icon  and the list of application names is replaced with the filter \nname , as shown in the following figure : \n \nFigure 24: Application filter   \nThis filter can also be edited by accessing Objects  > Application Filters  > Edit (pencil icon) , as shown in \nthe following figure : \n \nFigure 25: Application filter objects  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   18 \nNSA  | Cisco  Firepower Hardening Guide  \nApplication filters can also be applied to access control rules, configured as follows: Policies  > Access \nControl  > Edit (pencil icon) > Applications  > Add Application  (the  + button)  > Application Filters  > select \nthe applicable filter(s) > OK > OK. \nTraffic can also be filtered by the URL within a n HTTPS or HTTP connection. URL filtering can occur \nusing  categories and reputations, which outline a URLs general classification and risk level, respecti vely. \nA category classification is a general identification for a URL. For example, Facebook.com  belongs in the \nSocial Networking  category and indeed.com  belongs in the Job Search  category, but URLs can belong to \nmore than one category.  \n2.12.  Configure URL category reputation  \nThe Cisco Talos Web Reputation Threat Level refers to the risk of visiting a website or an IP address and \ncan range from Trusted  (exceptional safety) to Untrusted  (exceptionally bad, malicious, or undesirable) or \nhave an Unknown  threat level, as shown in the following figure : \n \nFigure 26: Web reputation levels (Cisco Talos)  \nWhen a category is selected, the default reputation risk is set to  Any and Unknown , as shown in the \nfollowing figure : \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   19 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 27: Default reputation risk (FDM)  \nNSA recommends unchecking  the ANY box (which will automatically uncheck the Include Sites with \nUnknown Reputation  box) and selecting the Trusted  reputation level, as shown in the following figure : \n \nFigure 28: Recommended reputation risk settings  \n2.13.  Enable reputation enforcement on DNS traffic  \nIn DNS request filtering, the system looks up the category and reputation of specific websites when the \nsystem sees the DNS lookup request for the fully qualified domain name. If the DNS/URL filtering rule for \nthe returned category/reputation is a Block rule within the access control policy, then the system blocks \nthe DNS reply leading to a failed connection attempt.  \nNSA recommends enabling the Reputation Enforcement on DNS traffic  option within the access policy \nsettings , as shown in the following figure , to stop connections at the DNS phase . Go to Access Control \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   20 \nNSA  | Cisco  Firepower Hardening Guide  \nPolicy Settings , and enable the setting by clicking on the button until it turns blue.  Enabling this option \nimproves HTTPS traffic filtering which is encrypted.  As the control rules match  HTTPS tr affic, the DNS \nreply is blocked before the HTTPS connection is started.  \n \nFigure 29: Enable reputation enforcement on DNS traffic s etting  \n2.14.  Create separate URL filtering mechanism rules for HTTP and HTTPS traffic  \nAs HTTPS traffic i s filtered, subdomains within URL s are disregarded when the system determines the \nsubject common name. For example, the URL yoururlhere.com  should be used instead of the URL \nwww.yoururlhere.com . Network administrators should e xamine the contents of the certificates used by \nsites to verify that the correct subdomain is used.  \nWhen the system is performing URL filtering, the HTTP and HTTPS traffic from the same website are \nboth filtered  when access control rules allow or block a specific URL . To distinguish between HTTP and \nHTTPS traffic from the same website, separate rules must be configured to match the HTTP or HTTPS \ntraffic separately.  \nNSA recommends creating separate rules to block inbound and outbound HTTP traffic, and to allow  \nauthorized  HTTPS traffic.  This provides greater control and restrictions over the network accessing \nunencrypted protocols.  \nCreating a Block  HTTP  traffic rule can be configured  as follows : Policies  > Access Control  > Add Rule \n(the + button) > Action : Block  > add the applicable Zones and Networks for the Source and Destination \ntraffic  > add HTTP  as the destination port to be blocked  > OK, as shown in the following figure : \n \nFigure 30: Select ports for b lock access rule  \nSimilarly, a n Allow HTTPS  rule can be configured as shown  in the following figure : Policies  > Access \nControl  > Add Rule (the + button) > Action: Allow  > add the applicable Zones and Networks for the \nSource and Destination traffic > add HTTPS  as the destination port to be permitted > OK. \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   21 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 31: Create Allow access rule  \nAn alternate method of configuring a Block HTTP  rule is to select HTTP  as an Application.  This can be \nconfigured as shown  in the following figur e: Policies  > Access Control  > Add Rule  (the  + button) > \nAction: Block  > add the applicable Zones and Networks for the Source and Destination traffic > click on \nthe Applications  tab > Add application  (the  + button) > select HTTP  from the dropdown > OK > OK. \n \nFigure 32: Select application for b lock access rule  \n2.15.  Create separate access control policy rules for URL and application filtering  \nNSA recommends creat ing separate application and URL access control policy rules.  Combining both \nURL and applicatio n criteria in the same rule can cause  the unintended result  of the rule not function ing, \npermitting undesirable traffic to pass through the network . URL filtering rules block  specific  web servers , \nwhereas application filtering rules target  specific applications regardless of the web server . \n2.16.  Configure  the URL time to live  \nThe URL Time to Live  (TTL) duration determines how long to cache URL category and lookup values \nbefore a new category and reputation looku p is executed.  This option is enabled when the Query Cisco \nCSI for Unknown URLs  option is selected, which can be  configured by navigating to: Device  > System \nSettings: See more  > URL Filtering Preferences  > Click on Query Cisco CSI for Unknown URLs , as \nshown in the following figure .  \nThe option Query Cisco CSI for Unknown URLs  is used for URLs with neither a reputation nor a category \nclassification in the URL filtering database. If lookup results return reputation or category  results , they will \nbe used when  URL conditions are processed within their respective access rules . This option should  be \nenabled  to label URLs with a category and reputation, and use the URL TTL.  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   22 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 33: Enable Query Cisco CSI for Unknown URLs option  \nA shorter  TTL duration produces more accurate URL filtering  results and a l onger duration yields better \nperformance for Unknown  URLs.  NSA recommends changing the  TTL from the  default setting  Never , to \nan option  that provide s a balance between accurate filtering and better performance , as shown in the \nfollowing figure . If accurate filtering is a priority, administrators should increase  the TTL to a longer time \nwhich extends  up to a week . If performance is not a concern then ad ministrators are encouraged to \nshorten this TTL according to their network requirements.  \n \nFigure 34: Time to Live (TTL) setting  \n3. Implementing intrusion prevention policies  \nIDS or IPS inspection on traffic is controlled by intrusion policies.  These policies inherit settings from one \nof the four Cisco Talos base polic y templates : Balanced Security and Connectivity , Connectivity over \nSecurity , Maximum Detection , and Security over Connectivity , as shown in the following figure : \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   23 \nNSA  | Cisco  Firepower Hardening Guide  \n \nFigure 35: Intrusion Prevention base template options  \nIndividual rules within policies can be configured to generate events, drop traffic and generate events, or \nbe disabled. Rules can also be grouped for easier configuration and management , and d eep packet \ninspection is performed by the engine from pattern matching . Snort is the main inspection engine for the \nsystem  and t he rules within the policies are a collection of Snort rules evaluated against traffic flows.  \n3.1. Implement  Balanced Security and C onnectivity  as a base policy  \nThe Firepower contains combined intrusion  and network analysis -based  policies that enable  the system \nto preprocess and handle traffic. NSA recommends the network analysis base policy to be Balanced  \nSecuri ty and Connectivity , which attempts to keep users secure while not being too aggressive and \npossibly dropping  normal traffic. The other base policies contain an emphasis on network infrastructure \nover security a nd connectivity . \nOnce the base policy is chosen, administrators are able to modify rules within the intrusion policy. The \naction for each rule can be changed to alert, drop, or disable depending on network requirements. \nCustom rules can also be uploaded and applied to an i ntrusion policy based on traffic analysis. The \nsecurity level for each subgroup can be modified within each intrusion policy to enforce rule processing so \nconnectivity or security is emphasized in the network. Rules are organized into various signature gro ups \nwith respect to intrusion type. Each group has subgroups that contain the signatures and an action of \nalert, drop, or disable. The security level for each subgroup can also be modified to enforce the rule \ngroups . \n4. Implementing SSL policies  \nSecure Socket  Layer ( SSL) policies control inspection and decryption of encrypted traffic . SSL decryption \nwithin the device mostly targets  Transport Layer Security  (TLS). The three components of SSL decryption \nare a TLS proxy, the session setup , and the application dat a. The session setup involves the asymmetric \nkey while the application data involves the symmetric key for encryption/decryption.  The actions related to \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   24 \nNSA  | Cisco  Firepower Hardening Guide  \nthis policy include decrypt  - resign, decrypt - known key, do not decrypt, block, block with reset, and  \nmonitor. The encryption/decryption is only available on hardware for ASA 5525 -X, 5555 -X, 5545 -X, \nFirepower 2100, 4100, and 9300 series versions 6.2.3 and up.  \n4.1. Enable TLS server identity discovery  \nDecrypting traffic from the I nternet presents a number of is sues as this traffic is coming inbound to the \ninternal network . Within network traffic, even when not decrypting traffic, the certificate is required to \nmatch application and URL filtering criteria in the access control rule.  \nNSA recommends enabling the TL S Server Identity D iscovery option to enable policy enforcement \nwithout affecting  performance or risking compliance , as with full decryption  [5]. Go to access policy \nSettings and click on the TLS Server Identity Discovery button. Once this option is enabled,  as shown  in \nthe following figure , the device will identify  the servers certificate without decrypting the entire session . \nThis allow s encrypted connections to match the correct access control  rules . \n \nFigure 36: Enable TLS Server Identity Discovery setting  \n4.2. Decrypt specific traffic instead of all traffic  \nIt is easier to process traffic when there is no encryption or obfuscation.  Unlike plaintext traffic, encrypted \nconnections , such as HTTPS , cannot  be examined fully by network administrators. Since most  legitimate \nconnections are encrypted, adversaries can hide harmful traffic within encrypted traffic.  \nNSA recommends using the Decrypt - Resign  action to in spect encrypted traffic when  decryptin g. The \nsystem re -signs the certificate of the website once traffic matches the rule.  Separate sessions for \ndecryption and re -encryption are created with respective cryptographic connections. Certificate objects \nand cip hers added to the policy must also match the CA certificate and encryption algorithm. If objects \nand ciphers do not match, encryption and decryption will be unsuccessful. Decrypting all traffic will hinder \nperformance on the device. Depending on the flow o f traffic within the network , only decrypt abnormal \ntraffic outgoing from the internal network or other traffic that may be of interest. Select Decrypt Re -Sign \nfrom the action list when creating  an SSL rule, as shown in the following figure : \n \nFigure 37: Create SSL Decryption Rule  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   25 \nNSA  | Cisco  Firepower Hardening Guide  \n5. Implementing malware and file policies  \nFile and malware policies indicate the type of files that are allowed, blocked , or inspected  from all types of \ntraffic that pass through the device.  Differen t actions available for  incoming files are detect files, block \nfiles, malware cloud lookup, and block malware. When files and malware are to be inspected, this \nincludes static, dynamic, and local analysis. Below are a few guidelines when configuring these pol icies.  \n5.1. Enable reset connection  \nFile or malware policies contain r ules that involve  blocking harmful files and malware . In FMC,  under the \naction  criteria,  there are other options as to what sh ould be done after those harmf ul files or malware are \nblocked as  seen below.  \nNSA recommends enabling the reset connection  option under the action , which will prevent a blocked \napplication session from remaining open , as shown  in Figure 15 . If the connection is not reset, the \nsession can remain open and connected. This setting resets the TCP connection and preve nts malicious \nactions from an unauthorized host.  \n5.2. Do not store all files within local storage  \nHigh volume within a network increases the chances of encountering malicious files or executables. The \nsystem stores fil es or malware for further analysis that match criteria within a rule . NSA recommends not \nto store all of the files for analysis on the device. Storing all files on  the system will not only affect storage  \nspace , but system performance can be affected as wel l. \nAs shown  in the following figure , enabling the  Store F iles options allows the system to allocate space on \nthe devices hard drive to store those files. Once the space on the hard drive is at capacity,  the system \nbegins to delete the oldest set of  files first. This will continue until the threshold for adequate hard drive \nspace is reached.  An alternative to  permanently storing captured files on the devices hard drive  is to \ndownload  the files from the devices  file storage to another protected  system for  further manual analysis. \nAnother option is to submit captured files to the AMP cloud lookup service for dynamic analysis.  \n \nFigure 38: Configure Store Files options (FMC)  \n\n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   26 \nNSA  | Cisco  Firepower Hardening Guide  \n6. Enabling  secure VPN settings  \n6.1. Use secure VPN tunneling protocols  \nThe most secure protocol and strong encryption algorithms should be chosen when creating a  VPN with \nthis device. NSA recommends using the  Internet Key Exchange (IKE) version 2 (IKEv2) key management \nprotocol due to the IPsec and Security Associat ion (SA) standard s that allow a more secure connection \nby encrypting data between clients  [6]. IKEv1  should be disabled due to implementation of insecure \nhashing and encryption algorithms  [7]. The IKEv2 policy should include AES -256 or AES-GCM -256 for \nencryption, a Diffie -Hellman group of 20,  a SHA-384 or SHA-512 integrity hash, and a Pseudo Ran dom \nFunction (PRF) hash of SHA -384 or SHA -512 [8]. The IPsec proposal should include AES-256 or AES-\nGCM -256 encryption , SHA -384 or SHA -512 integrity hash , and an authentication type of Certificate  [9]. \n7. Hardening FXOS  \nThe Firepower device runs an underlying operating system called the Secure Firewall eXtensible \nOperating System (FXOS), on top of which is the FTD image installed as a container.  To prevent possible \nexploitation of known vulnerabilities, FXOS should be updated to the most recent version and configured \nso that only authorized users have ma nagement access.  The following configurations show the NSA \nrecommended  baseline for SSH, HTTPS, and TLS access encryption and hashing algorithms.  \n7.1. Configure strong SSH algorithms  \nSSHv2 should be configured to the strongest algorithms for autho rized users co nnecting to FXOS, as \nshown in the following figures. The commands are executed in the FXOS CLI, which puts the device in \nthe system services mode and enables SSH.  \nOnce the SSH server is enabled and the working directory has been placed  in system services m ode, \nNSA recommends configuring the SSHv2 encryption algorithm AES -CTR-256, following NSA and NIST \nguidance to retire the use of the deprecated 3DES -CBC algorithm. This configuration should be enabled \non both the server and client to ensure a strong SSH en cryption algorithm , as shown in the following \nfigures : \n> connect  fxos \nFirepower -module#  \nFirepower -module# scope system  \nFirepower -module /system# scope services  \nFirepower -module /system/services# enable ssh -server \nFirepower -module /system/services#  \nFigure 39: Enable SSH  \n \n \nFirepower -module /system/services# set ssh-server encrypt -algorithm aes256 -ctr \nFirepower -module /system/services# set ssh-client encrypt -algorithm aes256 -ctr \nFigure 40: Configure AES-CTR-256 encryption  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   27 \nNSA  | Cisco  Firepower Hardening Guide  \nAt a minimum, NSA recommends using  the diffie -hellman -group14 -sha1  key exchange algorith m. This \nalgorithm may be implemented to exchange a secure session  with most devices [10]. The configuration in \nthe following figure shows the commands to execute for both server and client.  \nFirepower -module /system/services# set ssh-server kex -algorithm diffie -hellman-group14-sha1 \nFirepower -module /system/services# set ssh-client kex -algorithm diffie-hellman-group14-sha1 \nFigure 41: Configure  Diffie -Hellman key exchange algorithm  \nIn order to verify data integrity within SSH , a Hash -based Message Authentication Code (HMAC)  method \nmust be specified  to ensure  both sender identity and that the message was not modified during transit. \nNSA recommends configuring the HMAC -SHA2-512 algorithm for both server and client, a s shown in the \nfollowing figure:  \nFirepower -module /system/services# set ssh-server mac -algorithm hmac -sha2-512 \nFirepower -module /system/services# set ssh-server mac -algorithm hmac -sha2-512 \nFigure 42: Configure  HMAC algorithm  \nNSA recommends configuring an RSA host key of 3072  bits and a key ring  maximum volume limit of \n500,000, as showing in the following figures. A larger  key modulus size makes it harder for adversaries  to \nbe able to derive the key , and e ach encryption key is used to protect no more than half a  gigabyte of data. \nRekeyi ng occurs once this threshold is  reached.  \nFirepower-module /system/services# set ssh-server host -key rsa 3072 \nFirepower -module /system/services# set ssh-client host -key rsa 3072 \nFigure 43: Configure RSA host key  \n \nFirepower -module /system/services# set ssh-server rekey -limit volume 500000  \nFirepower -module /system/services# set ssh-client rekey -limit volume 500000  \nFigure 44: Configure rekey limit  \nNSA recommen ds configuring a time limit of 60 minutes  to prevent having an idle SSH session for long \nperiods of time, as shown in the following figure . Once the time limit has been reached, FXOS \ndisconnects the SSH session , and a reke y of session keys are generated  \nFirepower -module /system/services# set ssh-server rekey -limit time 60  \nFirepower -module /system/services# set ssh-client rekey -limit time 60  \nFigure 45: Configure rekey time limit  \nNSA recommends enabling a strict host key  check to control SSH host key checking , as shown in the \nfollowing figure.  Enabling this option allows the system to reject a connection if the host key is not in the \nFXOS known host file.  \nFirepower -module /system/services# set ssh-client stricthostkeycheck enable  \nFigure 46: Configu re strict host keycheck  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   28 \nNSA  | Cisco  Firepower Hardening Guide  \nNSA recommends configuring trusted subnets or hosts for SSH access with FXOS , as shown in the \nfollowing figure . Known hosts or subnets should be configured to maintain strict limits on hosts that will \nhave SSH access to FXOS.  \nFirepower -module /system/services# enter ip -block {ip_address} {prefix_length} ssh  \nFigure 47: Configure trusted hosts or subnet s within the FXOS SSH known host file  \n7.2. Configure key ring  \nNSA recommends creating key rings of a minimum of 3072  bits. Including the default key ring , FXOS \nsupports up to eight key rings. To create the HTTPS key rings, navigate to security mode  and key in the \ncommands as shown in the following figure : \nFirepower -module# scope security  \nFirepower -module /security# create keyring {key_ring_name}  \nFirepower -module /security/keyring# set modulus mod3072  \nFirepower -module /security/keyring# commit-buffer  \nFigure 48: Configure key rings  \nWhile FXOS comes with a default key ring, NSA recommends regenerating the key ring if the certificate \nexpires or  the cluster name changes , as shown in the following figure : \nFirepower -module /security # scope keyring default  \nFirepower -module /security/keyring# set regenerate yes  \nFirepower -module # commit-buffer  \nFigure 49: Configure key ring regeneration  \nNSA recommends creating a certificate request for a key ring to prepare for secure communications.  In \ncase the  keys become  compromised, a certificate authority (CA) and certificate revocation list (CRL) is \nalso recommended , as t his would allow the keys to be revoked , prevent ing them from being used.  Usually \ndevices contain a self -signed certificate whi ch is not automatically trusted by other devices. A users \nbrowser may display an authentication warning due to this self -signed certificate. Creating a new \ncertificate from a CA allows devices to trust appropriate certificates and allow for secure  and tru sted \ncommunications . \nOnce the certificate has been generated, copy the text, including the BEGIN and END lines, and save this \nto a file. The file should be sent to a trust ed certificate authority to obtain a certificate for the key ring. \nThen, create a tru sted point containing the certificate chain for the key ring certificate , as shown in the \nfollowing figure : \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   29 \nNSA  | Cisco  Firepower Hardening Guide  \nFirepower -module /security # scope keyring {keyring_name}  \nFirepower -module /security/keyring# create certreq ip {ipv4 or ipv6 address} subject -name {name} \nCertificate request password:  \nConfirm certificate request password:  \nFirepower -module /security/keyring# commit-buffer \nCertificate request subject name: {name}  \n \n-----BEGIN CERTIFICATE REQUEST ----- \n.. \n-----END CERTIFICATE REQUEST ----- \n \nFirepower -module /security # create trustpoint {name_of_trustpoint]  \nFirepower -module /security /trustpoint# set certchain  \nEnter lines one at a time. Enter ENDOBUF to finish. Press ^C to abort  \nTrustpoint Certificate Chain:  \n> -----BEGIN CERTIFICATE ----- \n> MIISDFNUSSDFIUN ISUDNFKIBSEUIFBOSUEFHOSEHFOISEFSOEIJFOISEJ  \n> \n> -----END CERTIFICATE ----- \n> ENDOBUF  \nFirepower -module /security /trustpoint# commit-buffer  \nFigure 50: Create certificate request for key ring  \n7.3. Configure HTTPS options for secure communication  \nHTTPS uses Public Key Infrastructure (PKI) to create secure communication between  the Firepower \nchassis and  a users browser. Before secure communication can take  place, key rings and certificates \nmust be created  for devices on both ends to c reate trusted points and a secure channel. Once the \ncertificates and trusted points are created, HTTPS is enabled and the previously created key ring  is used.  \nNSA recommends configuring trusted subnets or hosts for HTTPS access with FXOS. Known hosts or \nsubnets should be configured to maintain a strict limits on  hosts that will have HTTPS access to FXOS.  \nFirepower -module /system/services# enter ip -block {ip_address} {prefix_length} https  \nFirepower -module /system/services# commit-buffer  \nFigure 51: Configure trusted hosts or subnet s within the FXOS HTTPS known host file  \n7.4. Configure TLS to the latest version s \nThe Transport Layer Security (TLS) protocol provides data integrity and privacy between two \ncommunicating applications. The minimum TLS version configured in FXOS ensures external devices \nmust also be configured with the same TLS version to open an HTTPS c onnection with FXOS. The \ndevice will also communicate with higher version levels, if both parties in the communication support the \nconfigured level . \nAlthough the FXOS minimum default TLS version is 1.1, NSA recommends setting the minimum \nconfigur ation to TLS 1.2 , which allows the use of more secure hash algorithms and advanced cipher \nsuites . TLS version 1.3 is also available and does not support many of the vulnerable cryptographic \nalgorithms that TLS 1.2 can be configured to allow and often allows by defau lt, thus making it more \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   30 \nNSA  | Cisco  Firepower Hardening Guide  \nsecure by default.  To configure the TLS version within FXOS, navigate to system mode  as shown in the \nfollowing figure :  \nFirepower -module /system# set services tls -ver v1_2  \nFigure 52: Configure TLS to the latest version  \n8. Works cited  \n[1]  Cisco, \"Introducing new Cisco Secure product names,\" 2023. [Online]. Available: \nhttps://www.cisco.com/c/en/us/products/security/secure -names.html#~products. [Accessed 25 May 2023].  \n[2]  Cisco, \"Cisco Firepower 4100/9300 FXOS Compatibility,\" 1 December 2015. [Online]. Available: \nhttps://www.cisco.com/c/en/us/td/docs/security/firepower/fxos/compatibility/fxos -compatibility.html. \n[Accessed 25 May 2023].  \n[3]  Cisco, \"Cisco Secure - Products,  Solutions, and Platform,\" 2023. [Online]. Available: \nhttps://www.cisco.com/c/en/us/products/security/secure -names.html#~products. [Accessed 25 May 2023].  \n[4]  NIST, \"Guidelines on Firewalls and Firewall Policy,\" September 2009. [Online]. Available: \nhttps ://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800 -41r1.pdf. [Accessed 25 May 2023].  \n[5]  National Security Agency, \"Managing Risk from Transport Layer Security Inspection,\" 16 December 2019. \n[Online]. Available: https://media.defense.gov/20 19/Dec/16/2002225460/ -1/-\n1/0/info%20sheet%20%20managing%20risk%20from%20transport%20layer%20security%20inspection.pdf. \n[Accessed 7 March 2023].  \n[6]  National Security Agency, \"Securing IPsec Virtual Private Networks,\" October 2020. [Online]. Available: \nhttps://media.defense.gov/2021/Sep/16/2002855930/ -1/-\n1/0/securing_ipsec_virtual_private_networks_executive_summary_2020_07_01_final_release.pdf. \n[Accessed 7 March 2023].  \n[7]  E. P. Wouters, \"RFC 9395 Deprecation of the Internet Key Exchange Version (IKEv1) Protocol and \nObselete Algorithms,\" April 2023. [Online]. Available: https://www.ietf.org/rfc/rfc9395.html. [Accessed June \n2023].  \n[8]  National Security Agency, \"Commercial National Security Algorithm Suite 2.0,\" Spetember 2022. [Online]. \nAvailable: Avalil able: http s://media.defense.gov/2022/Sep/07/20 03071834/ -1/-\n1/0/CSA_CNSA_2.0_ALGORITHMS_.pdf. [Accessed June 2023].  \n\n \n \nU/OO/ 183115 -23 | PP-23-2153 | AUG  2023 Ver. 1.0   31 \nNSA  | Cisco  Firepower Hardening Guide  \n[9]  National Security Agency, \"RFC 9206 Commercial National Security Algorithm (CNSA) Suite Cryptography \nfor Internet Protocol Security (IP sec),\" February 2022. [Online]. Available: https://www.rfc -\neditor.org/rfc/rfc9206.pdf. [Accessed June 2023].  \n[10]  M. Baushke, \" Key Exchange (KEX) Method Updates and Recommendations for Secure Shell (SSH) ,\" \nJanuary  2022. [Online]. Available: https://datatracker.ietf.org/doc/html/rfc9142 . [Accessed July  2023].  \n \n \n\n",
  "cves": [],
  "techniques": [],
  "advisory": "cybersecurity-alerts",
  "title": "ctr_cisco_firepower_hardening_guide",
  "source": "nsa",
  "id": "c71d63e71c85168757581ea09d34b73228d7f00af37cb3e2c06dbc191afee663"
}