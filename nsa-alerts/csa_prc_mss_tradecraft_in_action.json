{
  "markdown": "APT40 Advisory\nPRC MSS tradecraft in action\n\n\n\n\nTable of contents\nOverview   5\nBackground   5\nActivity summary   5\nNotable tradecraft   6\nT ooling   7\nCase studies   7\nCase study 1   8\nExecutive summary   8\nInvestigation findings   9\nDetails   9\nVisual timeline   9\nDetailed timeline   10\nActor tactics and techniques   11\nReconnaissance   11\nInitial access   11\nExecution   11\nPersistence   11\nCredential access   11\nLateral movement   11\nCollection   11\nExfiltration   11\nCase study 2   12\nExecutive summary   12\n3\n\nInvestigation findings   13\nInvestigation summary   13\nAccess   13\nInternal hosts   13\nInvestigation timeline   14\nActor tactics and techniques   15\nInitial access   15\nExecution   15\nPersistence   15\nPrivilege escalation   15\nCredential access   15\nDiscovery   16\nCollection   16\nCommand and control   16\nDetection and mitigation recommendations   17\nDetection   17\nMitigations   20\nLogging   20\nPatch management   20\nNetwork segmentation   20\nAdditional mitigations   20\nMITRE ATT&CK  Historical APT40 tradecraft of interest   22\n\nOverview\n1  U.S. Department of Justice. 2021. Four Chinese Nationals Working with the Ministry of State Security Charged with Global \nComputerIntrusionCampaignTargetingIntellectualPropertyandConfidentialBusinessInformation,IncludingInfectiousDisease\nResearch .Background\nThisadvisory,authoredbytheAustralianSignals\nDirectorates Australian Cyber Security Centre \n(ASDsACSC),theUnitedStatesCybersecurityand\nInfrastructureSecurityAgency(CISA),theUnited\nStatesNationalSecurityAgency(NSA),theUnited\nStatesFederalBureauofInvestigation(FBI),theUnited\nKingdomNationalCyberSecurityCentre(NCSC-UK),\ntheCanadianCentreforCyberSecurity(CCCS),the\nNew Zealand National Cyber Security Centre (NCSC-\nNZ),theGermanFederalIntelligenceService(BND)and\nFederalOfficefortheProtectionoftheConstitution\n(BfV),theRepublicofKoreasNationalIntelligence\nService(NIS)andNISNationalCyberSecurityCenter,\nand Japans National Center of Incident Readiness and \nStrategy for Cybersecurity (NISC) and National Police \nAgency (NPA)  hereafter referred to as the authoring \nagencies  outlines a Peoples Republic of China \n(PRC) state-sponsored cyber group and their current \nthreat to Australian networks. The advisory draws \non the authoring agencies shared understanding of \nthe threat as well as ASDs ACSC incident response \ninvestigations.\nThe PRC state-sponsored cyber group has previously \ntargetedorganisationsinvariouscountries,including\nAustraliaandtheUnitedStates,andthetechniques\nhighlighted below are regularly used by other PRC \nstate-sponsoredactorsglobally.Therefore,the\nauthoringagenciesbelievethegroup,andsimilar\ntechniquesremainathreattotheircountriesnetworks\nas well.\nThe authoring agencies assess that this group conduct \nmalicious cyber operations for the PRC Ministry of State \nSecurity(MSS).Theactivityandtechniquesoverlap\nwith the groups tracked as Advanced Persistent Threat \n(APT)40(alsoknownasKryptonitePanda,GINGHAM\nTYPHOON,LeviathanandBronzeMohawkinindustry\nreporting). This group has previously been reported \nasbeingbasedinHaikou,HainanProvince,PRCand\nreceivingtaskingfromthePRCMSS,HainanState\nSecurity Department.1 ThefollowingAdvisoryprovidesasampleofsignificant\ncasestudiesofthisadversarystechniquesinaction\nagainst two victim networks. The case studies are \nconsequential forcybersecurity practitioners toidentify,\npreventandremediateAPT40intrusionsagainsttheir\nown networks. The selected case studies are those \nwhere appropriate remediation has been undertaken \nreducingtheriskofre-exploitationbythisthreatactor,\norothers.Assuch,thecasestudiesarenaturallyolder\ninnature,toensureorganisationsweregiventhe\nnecessary time to remediate.\nActivity summary\nAPT40hasrepeatedlytargetedAustraliannetworks\nas well as government and private sector networks in \ntheregion,andthethreattheyposetoournetworks\nis ongoing. The tradecraft described in this advisory is \nregularly observed against Australian networks.\nNotably,APT40possessesthecapabilitytorapidly\ntransform and adapt exploit proof-of-concept(s) \n(POCs) of new vulnerabilities and immediately \nutilise them against target networks possessing the \ninfrastructureoftheassociatedvulnerability.APT40\nregularly conducts reconnaissance against networks of \ninterest,includingnetworksintheauthoringagencies\ncountries,lookingforopportunitiestocompromise\nits targets. This regular reconnaissance postures the \ngrouptoidentifyvulnerable,end-of-lifeornolonger\nmaintaineddevicesonnetworksofinterest,andto\nrapidlydeployexploits.APT40continuestofindsuccess\nexploitingvulnerabilitiesfromasearlyas2017.\nAPT40rapidlyexploitsnewlypublicvulnerabilitiesin\nwidelyusedsoftwaresuchasLog4J( CVE202144228 ),\nAtlassianConfluence( CVE-2021-31207 ,CVE-2021-\n26084 ) and Microsoft Exchange ( CVE-2021-31207 ; \nCVE-2021-34523 ; CVE-2021-34473 ). ASD's ACSC and \nthe authoring agencies expect the group to continue \nusingPOCsfornewhigh-profilevulnerabilitieswithin\nhours or days of public release.\nAPT40 Advisory   PRC MSS tradecraft in action 5\n\nMalicious ActorCommand and Control\nApplication layer web \nand mail protocols\nWeb services also used to \ninteract with Web Shells\nInitial Access\nExploitation of \ninternet-facing applicationsExecution & Persistence\nDeployment of Web Shells \nto access compromised \ninfrastructureLateral Movement \n& Collection\nUse of Remote Services including \nRemote Desktop Protocol (RDP) \nand SMB/Windows SharesCredential Access & Discovery\nSystem commands used to discover \nsystem information, accounts, \ndomains, network, and connectivity\nVariety of methods used to \ncompromise credentials\nDefence Evasion\nRemoving indicators, \nobfuscating les, masquerading, \nand impairing defencesExltration\nExltration via existing \nCommand and Control \ninfrastructureFigure 1. TTP flowchart for APT40 activity\nThisgroupappearstopreferexploitingvulnerable,\npublic-facinginfrastructureovertechniquesthat\nrequireuserinteraction,suchasphishingcampaigns,\nand places a high priority on obtaining valid \ncredentials to enable a range of follow-on activities. \nAPT40regularlyuseswebshells( T1505.003 ) for \npersistence,particularlyearlyinthelifecycleofan\nintrusion.Typically,aftersuccessfulinitialaccessAPT40\nfocuses on establishing persistence to maintain access \nonthevictimsenvironment.However,aspersistence\noccursearlyinanintrusion,itismorelikelytobe\nobserved in all intrusions   regardless of the extent of \ncompromise or further actions taken.\nNotable tradecraft\nAlthoughAPT40haspreviouslyusedcompromised\nAustralianwebsitesascommandandcontrol(C2)\nhostsforitsoperations,thegrouphaveevolvedthis\ntechnique( T1594 ).\nAPT40hasembracedtheglobaltrendofusing\ncompromiseddevices,includingsmall-office/home-\noffice(SOHO)devices,asoperationalinfrastructureand last-hop redirectors ( T1584.008 ) for its operations \nin Australia. This has enabled the authoring agencies \nto better characterise and track this group's \nmovements.\nManyoftheseSOHOdevicesareend-of-lifeor\nunpatched and offer a soft target for N-day \nexploitation.Oncecompromised,SOHOdevicesoffera\nlaunching point for attacks that is designed to blend in \nwithlegitimatetrafficandchallengenetworkdefenders\n(T1001.003 ).\nThistechniqueisalsoregularlyusedbyotherPRC\nstate-sponsoredactorsworldwide,andtheauthoring\nagencies consider this to be a shared threat. For \nadditionalinformation,seejointadvisories Peoples \nRepublic of China State-Sponsored Cyber Actors \nExploit Network Providers and Devices  and PRC State-\nSponsored Actors Compromise and Maintain Persistent \nAccess to U.S. Critical Infrastructure .\nAPT40doesoccasionallyuseprocuredorleased\ninfrastructureasvictim-facingC2infrastructureinits\noperations;however,thistradecraftappearstobein\nrelative decline.\nAPT40 Advisory   PRC MSS tradecraft in action 6\n\nTooling\nASDsACSCaresharingsomeofthemaliciousfiles\nidentifiedduringtheinvestigationsoutlinedbelow.\nThesefileshavebeenuploadedtoVirusTotalto\nenable the wider network defence and cyber security \ncommunities to better understand the threats they \nneed to defend against. Case studies\nASDs ACSC are sharing two anonymised investigative \nreports to provide awareness of how the actors employ \ntheir tools and tradecraft. \nMD5 Filename Additional information\n26a5a7e71a601be991073c78d513dee3 horizon.jsp 1kB|JavaSource\n87c88f06a7464db2534bc78ec2b915de Index_jsp$ProxyEndpoint$Attach.class 597B|JavaBytecode\n6a9bc68c9bc5cefaf1880ae6ffb1d0ca Index_jsp.class 5kB|JavaBytecode\n64454645a9a21510226ab29e01e76d39 Index_jsp.java 5kB|JavaSource\ne2175f91ce3da2e8d46b0639e941e13f Index_jsp$ProxyEndpoint.class 4kB|JavaBytecode\n9f89f069466b8b5c9bf25c9374a4daf8 Index_jsp$ProxyEndpoint$1.class 3kB|JavaBytecode\n187d6f2ed2c80f805461d9119a5878ac Index_jsp$ProxyEndpoint$2.class 1kB|JavaBytecode\ned7178cec90ed21644e669378b3a97ec Nova_jsp.class 7kB|JavaBytecode\n5bf7560d0a638e34035f85cd3788e258Nova_jsp$TomcatListenerMemShellFromThread.\nclass8kB|JavaBytecode\ne02be0dc614523ddd7a28c9e9d500cff Nova_jsp.java 15kB|JavaSource\nAPT40 Advisory   PRC MSS tradecraft in action 7\n\nCase study 1\nThis report has been anonymised to enable wider \ndissemination. The impacted organisation is hereafter \nreferredtoastheorganisation.Somespecificdetails\nhave been removed to protect the identity of the \nvictim and incident response methods of ASDs ACSC.\nExecutive summary\nThisreportdetailsthefindingsoftheASDsACSC\ninvestigation into the successful compromise of the \norganisations network between July and September \n2022.Thisinvestigativereportwasprovidedtothe\norganisation to summarise observed malicious activity \nand frame remediation recommendations. The \nfindingsindicatethecompromisewasundertakenby\nAPT40.\nInmid-August, theASDsACSCnotifiedtheorganisation\nof malicious interactions with their network from a \nlikely compromised device being used by the group \ninlateAugustand,withtheorganisation'sconsent,\nthe ASDs ACSC deployed host-based sensors to likely \naffected hosts on the organisation's network. These \nsensors allowed ASDs ACSC incident response analysts \nto undertake a thorough digital forensics investigation. \nUsingavailablesensordata,theASDsACSCanalysts\nsuccessfully mapped the groups activity and created a \ndetailed timeline of observed events.\nFromJulytoAugust,keyactoractivityobservedbythe\nASDs ACSC included:\n hostenumeration,whichenablesanactorto\nbuild their own map of the network;\n webshelluse,givingtheactoraninitialfoothold\non the network and a capability to execute \ncommands; and\n deployment of other tooling leveraged by the \nactor for malicious purposes.The investigation uncovered evidence of large amounts \nof sensitive data being accessed and evidence that \nthe actors moved laterally through the network \n(T1021.002 ). Much of the compromise was facilitated \nby the groups establishment of multiple access \nvectorsintothenetwork,thenetworkhavingaflat\nstructure,andtheuseofinsecureinternallydeveloped\nsoftwarethatcouldbeusedtoarbitrarilyuploadfiles.\nExfiltrateddataincludedprivilegedauthentication\ncredentialsthatenabledthegrouptologin,aswell\nas network information that would allow the actors \nto regain unauthorised access if the original access \nvector was blocked. No additional malicious tooling \nwas discovered beyond those on the initially exploited \nmachine;however,agroupsaccesstolegitimate\nand privileged credentials would negate the need for \nadditional tooling. Findings from the investigation \nindicate the organisation was likely deliberately \ntargetedbyAPT40,asopposedtofallingvictim\nopportunistically to a publicly known vulnerability.\nAPT40 Advisory   PRC MSS tradecraft in action 8\n\nInvestigation findings\nInmid-August2022,theASDsACSCnotifiedthe\norganisationthataconfirmedmaliciousIPbelievedto\nbeaffiliatedwithastate-sponsoredcybergrouphad\ninteracted with the organisation's computer networks \nbetween at least July and August. The compromised \ndevice probably belonged to a small business or home \nuser.\nInlateAugust,theASDsACSCdeployedahost-based\nagent to hosts on the organisations network which \nshowed evidence of having been impacted by the \ncompromise. \nSome artefacts which could have supported \ninvestigation efforts were not available due to \ntheconfigurationofloggingornetworkdesign.\nDespitethis,theorganisation'sreadinesstoprovide\nall available data enabled ASDs ACSC incident \nresponders to conduct comprehensive analysis and to \nformanunderstandingoflikelyAPT40activityonthe\nnetwork. \nInSeptember,afterconsultationwiththeASDsACSC,\ntheorganisationdecidedtodenylisttheIPidentified\nintheinitialnotification.InOctober,theorganisation\ncommenced remediation.Details\nBeginninginJuly,actorswereabletotestandexploit\na custom web application ( T1190 ) running on \n<webapp>2 -ext,whichenablesthegrouptoestablish\nafootholdinthenetworkdemilitarizedzone(DMZ).\nThis was leveraged to enumerate both the network as \nwell as all visible domains. Compromised credentials \n(T1078.002 )wereusedtoquerytheActiveDirectory\n(T1018)andexfiltratedatabymountingfileshares\n(T1039 ) from multiple machines within the DMZ. The \nactor carried out a Kerberoasting attack in order \nto obtain valid network credentials from a server \n(T1558.003 ). The group were not observed gaining any \nadditional points of presence in either the DMZ or the \ninternal network.\nVisual timeline\nThe below timeline provides a broad overview of the \nkey phases of malicious actor activity observed on the \norganisations network. \nInitial Discovery\nActor testing of \na custom web \napplication built for \nthe organisation\nExploitation\nT1190 Exploit Public-Facing \nApplication\nWeb application exploitation \nand web shell creationHost Enumeration\nT1082 System Information Discovery \nHost enumeration and establishing \npersistence\nFirst observed logon with use of \nlegitimate credentials\nMalicious \nInteraction\nFirst observed interaction of \norganisation machine with \nknown state-sponsored \ninfrastructureNetwork Reconnaissance\nT1021.002RemoteServices:SMB/Windows\nAdmin Shares\nT1135 Network Share Discovery\nNetwork-based reconnaissance and actor activity \nincluding: mounting of SMB shares, network-based \nscanning and enumeration of domains\nRe-establishment of \nConnection\nT1090 Proxy \nActor re-established connection \nof ssf tool (similar to activity on 28 \nJuly among other dates)\nAPT40 Advisory   PRC MSS tradecraft in action 9\n\nDetailed timeline\nJuly: The actors established an initial connection to the \nfront page of a custom web application ( T1190 ) built \nfor the organisation (hereafter referred to as the web \napplication or  webapp ) via a transport layer security \n(TLS) connection ( T1102 ). No other noteworthy activity \nwas observed.\nJuly:  The actors begin enumerating the web \napplications website looking for endpoints2 to further \ninvestigate. \nJuly:  The actors concentrate on attempts to exploit a \nspecificendpoint.\nJuly: The actors are able to successfully POST  to the \nwebserver,probablyviaawebshellplacedonanother\npage.AsecondIP,likelyemployedbythesameactors,\nalso begins posting to the same URL. The actors \ncreated and tested a number of likely web shells. \nTheexactmethodofexploitationisunknown,butitis\nclearthatthespecificendpointwastargetedtocreate\nfileson <webapp>2 -ext .\nASD's ACSC believes that the two IP address \nconnections were part of the same intrusion due to \ntheir shared interest and initial connections occurring \nminutes apart.\nJuly: Thegroupcontinuetoconducthostenumeration,\nlookingforprivilegeescalationopportunities,and\ndeploying a different web shell. The actors log into the \nweb application using compromised credentials for \n<firstname.surname> @<organisation domain> .\nThe actors activity does not appear to have \nsuccessfully achieved privilege escalation on \n<webapp>2 -ext.Instead,theactorspivotedto\nnetwork-based activity.\nJuly: The actor tests the compromised credentials for \na service account3 which it likely found hardcoded in \ninternally accessible binaries.\n2 Inthiscontext,anendpointisafunctionofthewebapplication\n3 Serviceaccountsarenottiedtoindividualusers,butrathertoservices.InaMicrosoftcorporatedomain,therearevariouskinds\nof accounts.\n4 Mountingsharesistheprocessofmakingfilesonafilesystemstructureaccessibletoauserorusergroup.July: The actors deploy the open-source tool Secure \nSocketFunnelling,whichwasusedtoconnectout\nto the malicious infrastructure. This connection is \nemployedtotunneltrafficfromtheactor'sattack\nmachinesintotheorganisation'sinternalnetworks,\nwhose machine names are exposed in event logs as \nthey attempt to use the credentials for the service \naccount.\nAugust: The actors are seen conducting a limited \namountofactivity,includingfailingtoestablish\nconnections involving the service account. \nAugust: Theactorsperformsignificantnetworkand\nActive Directory enumeration. A different compromised \naccountissubsequentlyemployedtomountshares4 \nonWindowsmachineswithintheDMZ,enabling\nsuccessfuldataexfiltration.\nThis seems to be opportunistic usage of a stolen \ncredential on mountable machines in the DMZ. \nFirewalls blocked the actor from targeting the internal \nnetwork with similar activity. \nAugust  September: The SSF tool re-established \na connection to a malicious IP. The group are not \nobserved performing any additional activities until their \naccess is blocked.\nSeptember: The organisation blocks the malicious IP \nbydenylistingitontheirfirewalls.\nAPT40 Advisory   PRC MSS tradecraft in action 10\n\nActor tactics  \nand techniques\nThe MITRE ATT&CK framework is a documented \ncollectionoftacticsandtechniquesemployedbythreat\nactors in cyberspace. The framework was created by \nUSnot-for-profitTheMITRECorporationandfunctions\nas a common global language around threat actor \nbehaviour. \nTheASDsACSCassessesthefollowingtechniquesand\ntactics to be relevant to the actors malicious activity:\nReconnaissance\nT1594   Search Victim-Owned Websites \nThe actor enumerated the custom web applications \nwebsite to identify opportunities for accessing the \nnetwork.\nInitial access\nT1190   Exploit Public-Facing Application (regarding \nexploiting the custom web application)\nT1078.002   Valid Accounts: Domain Accounts \n(regarding logging on with comprised credentials)\nExploiting internet-exposed custom web applications \nprovided an initial point of access for the actor. The \nactor was later able to use credentials they had \ncompromised to further their access to the network.\nExecution\nT1059   Command and Scripting Interpreter (regarding \ncommand execution through the web shell) \nT1072   Software Deployment T ools (regarding the \nactor using open-source tool Secure Socket Funnelling \n(SSF) to connect to an IP)Persistence\nT1505.003   Server Software Component: Web Shell \n(regarding use of a web shell and SSF to establish \naccess)\nCredential access\nT1552.001   Credentials from Password Stores \n(regardingpasswordfilesrelatingtobuilding\nmanagement system (BMS))\nT1558.003   Steal or Forge Kerberos Tickets: \nKerberoasting (regarding attack to gain network \ncredentials)\nLateral movement\nT1021.002   Remote Services: SMB Shares (regarding \nthe actor mounting SMB shares from multiple devices)\nCollection\nT1213   Data from Information Repositories (regarding \nmanuals/documentationfoundontheBMSserver)\nExfiltration\nT1041ExfiltrationOverC2Channel(regardingthe\nactorsdataexfiltrationfromActiveDirectoryand\nmounting shares)\nAPT40 Advisory   PRC MSS tradecraft in action 11\n\nCase study 2\nThis report has been anonymised to enable wider \ndissemination. The impacted organisation is hereafter \nreferredtoastheorganisation.Somespecificdetails\nhave been removed to protect the identity of the \nvictim and incident response methods of ASDs ACSC.\nExecutive summary\nThisreportdetailsthefindingsofASDsACSC\ninvestigation into the successful compromise of the \norganisationsnetworkinApril2022.Thisinvestigation\nreport was provided to the organisation to summarise \nobserved malicious activity and frame remediation \nrecommendations.Thefindingsindicatethe\ncompromisewasundertakenbyAPT40.\nInMay2022,ASDsACSCnotifiedanorganisation\nof suspected malicious activity impacting the \norganisationsnetworksinceApril2022.Subsequently,\nthe organisation informed ASD's ACSC that they had \ndiscovered malicious software on an internet-facing \nserver which provided the login portal for the \norganisation's corporate remote access solution. \nThis server used a remote access login and identity \nmanagement product and will be referred to in this \nreport as 'the compromised appliance'. This report \ndetailstheinvestigationfindingsandremediation\nadvice developed for the organisation in response to \nthe investigation conducted by the ASDs ACSC. \nEvidence indicated that part of the organisations \nnetwork had been compromised by malicious cyber \nactor(s) via the organisations remote access login \nportalsinceatleastApril2022.Thisservermayhave\nbeencompromisedbymultipleactors,andwaslikely\naffected by a remote code execution (RCE) vulnerability \nthat was widely publicised around the time of the \ncompromise.Key actor activity observed by the ASDs ACSC included:\n hostenumeration,whichenablesanactorto\nbuild their own map of the network;\n exploitation of internet-facing applications and \nwebshelluse,givingtheactoraninitialfoothold\non the network and a capability to execute \ncommands; \n exploitation of software vulnerabilities to \nescalate privileges; and\n credential collection to enable lateral movement\nThe ASDs ACSC discovered that a malicious actor \nhadexfiltratedseveralhundreduniqueusername\nand password pairs on the compromised appliance \ninApril2022,aswellasanumberofmulti-factor\nauthentication codes and technical artefacts related \nto remote access sessions. Upon a review by the \norganisation,thepasswordswerefoundtobe\nlegitimate. The ASDs ACSC assesses that the actor may \nhavecollectedthesetechnicalartefactstohijackor\ncreatearemoteloginsessionasalegitimateuser,and\naccess the organisation's internal corporate network \nusing a legitimate user account. \nAPT40 Advisory   PRC MSS tradecraft in action 12\n\nInvestigation findings\nInvestigation summary\nThe ASDs ACSC determined that the actor \ncompromised appliance(s) which provide remote \nlogin sessions for organisation staff and used this \ncompromise to attempt to conduct further activity. \nThese appliances consist of three load-balanced \nhosts where the earliest evidence of compromise \nwas detected. The organisation shut down two \nof the three load-balanced hosts shortly after the \ninitialcompromise.Asaresult,allsubsequent\nactivity occurred on a single host. The other servers \nassociated with the compromised appliance were also \nload-balancedinasimilarmanner.Forlegibility,all\ncompromised appliances are referred to in most of this \nreport as a single appliance.\nThe actor is believed to have used publicly known \nvulnerabilities to deploy web shells to the compromised \nappliancefromApril2022onwards.Threatactorsfrom\nthe group are assessed to have attained escalated \nprivileges on the appliance. The ASDs ACSC could not \ndetermine the full extent of the activity due to lack of \nloggingavailability.However,evidenceonthedevice\nindicates that an actor achieved the following:\n The collection of several hundred genuine \nusername and password pairs; and \n The collection of technical artefacts which may \nhave allowed a malicious actor to access a \nvirtual desktop infrastructure (VDI) session as a \nlegitimate user.\nThe ASDs ACSC assesses that the actor would have \nsought to further the compromise of the organisation \nnetwork.Theartefactsexfiltratedbytheactormay\nhaveallowedthemtohijackorinitiatevirtualdesktop\nsessionsasalegitimateuser,possiblyasauserof\ntheirchoice,includingadministrators.Theactormay\nhave used this access vector to further compromise \norganisation services to achieve persistence and other \ngoals.\nOther organisation appliances within the hosting \nprovider managed environment did not show evidence \nof compromise. Access\nThe host with the compromised appliance provided \nauthenticationviaActiveDirectoryandawebserver,\nfor users connecting to VDI sessions ( T1021.001 ). \nLocationCompromised appliance \nhostnames (load-balanced)\nDatacentre 1 HOST1,HOST2,HOST3\nThe appliance infrastructure also included access \ngateway hosts that provide a tunnel to the VDI for \ntheuser,oncetheypossessanauthenticationtoken\ngenerated and downloaded from the appliance. \nThere was no evidence of compromise of any of \nthesehosts.However,theaccessgatewayhosts\nlogsshowedevidenceofsignificantinteractions\nwith known malicious IP addresses. It is likely that \nthisreflectedactivitythatoccurredonthishost,or\nnetwork connections with threat actor infrastructure \nthat reached this host. The nature of this activity \ncould not be determined using available evidence but \nindicates that the group sought to move laterally in the \norganisations network ( TA0008 ).\nInternal hosts\nThe ASDs ACSC investigated limited data from the \ninternal organisations network segment. Attempted or \nsuccessful malicious activity known to have impacted \nthe internal organisations network segment includes \nactoraccesstoVDI-relatedartefacts,thescrapingof\nan internal SQL server ( T1505.001 ),andunexplained\ntrafficobservedgoingfromknownmaliciousIP\naddresses through the access gateway appliances \n(TA0011 ).\nUsingtheiraccesstothecompromisedappliance,\nthegroupcollectedgenuineusernames,passwords\n(T1003),andMFAtokenvalues( T1111 ). The group \nalso collected JSON Web T okens (JWTs) ( T1528),which\nis an authentication artefact used to create virtual \ndesktop login sessions. The actor may have been able \ntousethesetocreateorhijackvirtualdesktopsessions\n(T1563.002 ) and access the internal organisation \nnetwork segment as a legitimate user ( T1078 ). \nAPT40 Advisory   PRC MSS tradecraft in action 13\n\nThe actor also used access to the compromised \nappliance to scrape an SQL server ( T1505.001 ),which\nresided in the organisations internal network. It is likely \nthat the actor had access to this data.\nEvidence available from the access gateway appliance \nrevealedthatnetworktrafficoccurredthroughorto\nthis device from known malicious IP addresses. As describedabove,thismayindicatethatmalicious\ncyberactorsimpactedorutilisedthisdevice,potentially\nto pivot into the internal network.\nInvestigation timeline\nThe below list provides a timeline of key activities \ndiscovered during the investigation. \nTime Event\nApril 2022KnownmaliciousIPaddressesinteractwithaccessgatewayhostHOST7.Thenatureofthe\ninteractions could not be determined.\nApril 2022Allhosts,HOST1,HOST2andHOST3,werecompromisedbyamaliciousactororactors,\nand web shells were placed on the hosts.\nAlogfilewascreatedormodifiedonHOST2.Thisfilecontainscredentialmateriallikely\ncaptured by a malicious actor.\nThe/etc/security/opasswdand/etc/shadowfilesweremodifiedonHOST1andHOST3,\nindicatingthatpasswordswerechanged.EvidenceavailableonHOST1suggeststhatthe\npassword for user sshuser was changed.\nApril 2022HOST2wasshutdownbytheorganisation.\nAdditional web shells ( T1505.003 )werecreatedonHOST1andHOST3.HOST1experienced\nSSHbruteforceattemptsfromHOST3.\nAlogfilewasmodified( T1070)onHOST3.Thisfilecontainscredentialmaterial( T1078 ) \nlikely captured by a malicious actor.\nJWTs were captured ( T1528)andoutputtoafileonHOST3.\nHOST3wasshutdownbytheorganisation.AllactivityafterthistimeoccursonHOST1.\nApril 2022AdditionalwebshellswerecreatedonHOST1( T1505.003 ). JWTs were captured and output \ntoafileonHOST1.\nApril 2022AdditionalwebshellsarecreatedonHOST1( T1505.003 ),andaknownmaliciousIPaddress\ninteracts with the host ( TA0011 ).\nAknownmaliciousIPaddressinteractswithaccessgatewayhostHOST7.\nMay 2022 AknownmaliciousIPaddressinteractedwithaccessgatewayhostHOST7( TA0011 ).\nAn authentication event for a user is linked to a known malicious IP address in logs on \nHOST1.Anadditionalwebshelliscreatedonthishost( T1505.003 ).\nMay 2022AscriptonHOST1wasmodifiedbyanactor( T1543 ). This script contains functionality \nwhich would have scraped data from an internal SQL server.\nMay 2022AnadditionallogfileonHOST1waslastmodified( T1070).Thisfilecontainsusernameand\npasswordpairsfortheorganisationnetwork,whicharebelievedtobelegitimate( T1078 ).\nMay 2022Anadditionallogfilewaslastmodified( T1070).ThisfilecontainsJWTscollectedfrom\nHOST1.\nMay 2022AdditionalwebshellswerecreatedonHOST1( T1505.003 ).Onthisdate,theorganisation\nreportedthediscoveryofawebshellwithcreationdateinApril2022toASD'sACSC\nMay 2022 AnumberofscriptswerecreatedonHOST1,includingonenamedLog4jHotPatch.jar.\nMay 2022The iptables-save command was used to add two open ports to the access gateway host. \nTheportswere9998and9999( T1572 ).\nAPT40 Advisory   PRC MSS tradecraft in action 14\n\nActor tactics  \nand techniques\nHighlightedbelowareseveraltacticsandtechniques\nidentifiedduringtheinvestigation.\nInitial access\nT1190  Exploit public facing application\nThegrouplikelyexploitedRCE,privilegeescalation,\nand authentication bypass vulnerabilities in the remote \naccess login and identity management product to gain \ninitial access to the network.\nThis initial access method is considered the most likely \ndue to the following:\n The server was vulnerable to these CVEs at the \ntime;\n Attempts to exploit these vulnerabilities from \nknown actor infrastructure; and\n Thefirstknowninternalmaliciousactivity\noccurred shortly after attempted exploitation \nattempts were made.\nExecution\nT1059.004  Command and Scripting Interpreter: Unix \nShell\nThe group successfully exploited the above \nvulnerabilities may have been able to run commands \nin a Unix shell available on the affected appliance. \nComplete details of the commands run by actors \ncannot be provided as they were not logged by the \nappliance.\nPersistence\nT1505.003  Server Software Component: Web Shell\nActors deployed several web shells on the affected \nappliance. It is possible that multiple distinct actors \ndeployedwebshells,butthatonlyasmallernumberof\nactors conducted activity using these web shells.  \nWeb shells would have allowed for arbitrary command \nexecution by the actor on the compromised \nappliances. Privilege escalation\nT1068  Exploitation for Privilege Escalation\nAvailable evidence does not describe the level of \nprivilegeattainedbyactors.However,usingweb\nshells,theactorswouldhaveachievedalevelof\nprivilege comparable to that of the web server on the \ncompromised appliance. Vulnerabilities believed to \nhave been present on the compromised appliance \nwould have allowed the actors to attain root privileges. \nCredential access\nT1056.003  Input Capture: Web Portal Capture\nEvidence on the compromised appliance showed \nthat the actor had captured several hundred \nusername-passwordpairs,incleartext,whichare\nbelieved to be legitimate. It is likely that these were \ncapturedusingsomemodificationtothegenuine\nauthentication process which output the credentials to \nafile.\nT1111  Multi-Factor Authentication Interception\nThe actor also captured the value of MFA tokens \ncorresponding to legitimate logins. These were likely \ncaptured by modifying the genuine authentication \nprocesstooutputthesevaluestoafile.Thereisno\nevidence of compromise of the secret server which \nstorestheuniquevaluesthatprovideforthesecurityof\nMFA tokens.\nT1040NetworkSniffing\nThe actor is believed to have captured JWTs by \ncapturingHTTPtrafficonthecompromisedappliance.\nThere is evidence that the utility tcpdump was executed \nonthecompromisedappliance,whichmayhavebeen\nhow the actor captured these JWTs.\nT1539  Steal Web Session Cookie\nAsdescribedabove,theactorcapturedJWTs, whichare\nanalogous to web session cookies. These could have \nbeen reused by the actor to establish further access. \nAPT40 Advisory   PRC MSS tradecraft in action 15\n\nDiscovery\nT1046  Network Service Discovery\nThere is evidence that network scanning utility \nnmapwasexecutedonthecompromisedapplianceto\nscan other appliances in the same network segment. \nThis was likely used by the actor to discover other \nreachable network services which might present \nopportunities for lateral movement.\nCollection\nAvailable evidence does not reveal how actors \ncollected data or exactly what was collected from \nthe compromised appliance or from other systems. \nHowever,itislikelythatactorshadaccesstoallfileson\nthecompromisedappliance,includingthecaptured\ncredentials ( T1003),MFAtokenvalues( T1111),and\nJWTs described above.\nCommand and control\nT1071.001  Application Layer Protocol: Web Protocols\nActors used web shells for command and control. Web \nshellcommandswouldhavebeenpassedoverHTTPS\nusing the existing web server on the appliance ( T1572 ).\nT1001.003  Data Obfuscation: Protocol Impersonation\nActors used compromised devices as a launching point \nfor attacks that are designed to blend in with legitimate \ntraffic.\nAPT40 Advisory   PRC MSS tradecraft in action 16\n\nDetection and mitigation \nrecommendations\nThe ASDs ACSC strongly recommends implementing \nthe ASD Essential Eight  Controls and associated \nStrategies to Mitigate Cyber Security Incidents . Below \nare recommendations for network security actions \nthat should be taken to detect and prevent intrusions \nbyAPT40,followedbyspecificmitigationsforfourkey\nTTPssummarisedinTable1.\nDetection\nSomeofthefilesidentifiedaboveweredroppedin\nlocations such as C:\\Users\\Public\\* and C:\\Windows\\\nT emp\\*.  These locations can be convenient spots for \nwritingdataastheyareusuallyworldwritable,thatis,\nall user accounts registered in Windows have access \ntothesedirectoriesandtheirsubdirectories.Often,\nanyusercansubsequentlyaccessthesefiles,allowing\nopportunitiesforlateralmovement,defenceevasion,\nlow-privilegeexecutionandstagingforexfiltration.\nThe following Sigma rules look for execution from \nsuspicious locations as an indicator of anomalous \nactivity.Inallinstances,subsequentinvestigationis\nrequiredtoconfirmmaliciousactivityandattribution.\nTitle: World Writable Execution - Temp\nID: d2fa2d71-fbd0-4778-9449-e13ca7d7505c\nDescription: Detect process execution from C:\\\nWindows\\T emp.\nBackground:\nThisrulelooksspecificallyforexecutionoutofC:\\\nWindows\\T emp\\*. T emp is more broadly used by \nbenignapplicationsandthusalowerconfidence\nmalicious indicator than execution out of other world \nwritable subdirectories in C:\\Windows.\nRemoving applications executed by the SYSTEM or \nNETWORK SERVICE users substantially reduces the \nquantityofbenignactivityselectedbythisrule.\nThis means that the rule may miss malicious executions \nat a higher privilege level but it is recommended to \nuse other rules to determine if a user is attempting to \nelevate privileges to SYSTEM.Investigation:\n1. Examine information directly associated with this \nfileexecution,suchastheusercontext,execution\nintegritylevel,immediatefollow-onactivityand\nimagesloadedbythefile.\n2.Investigatecontextualprocess,network,file\nand other supporting data on the host to help \nmake an assessment as to whether the activity is \nmalicious.\n3.Ifnecessaryattempttocollectacopyofthefile\nfor reverse engineering to determine whether it is \nlegitimate.\nReferences:\nhttps://www.elastic.co/guide/en/security/current/\nprocess-execution-from-an-unusual-directory.html\nAuthor:  ASD's ACSC\nDate:2024/06/19\nStatus: experimental\nTags:\n -tlp.green\n -classification.au.official\n -attack.execution\nLog Source:\n \u0001 category: process_creation\n \u0001 product: windows\nDetection:\n \u0001 temp:\n \u0001Image|startswith:'C:\\\\Windows\\\\Temp\\\\'\n \u0001 common_temp_path:\n \u0001Image|re|ignorecase:'C:\\\\Windows\\\\Temp\\\\\\\n{[a-fA-F0-9]{8}-([a-fA-F0-9]{4}-){3}[a-fA-F0-9]\n{12}\\}\\\\'\n \u0001 system_user:\n \u0001 User:\n -'SYSTEM'\n -'NETWORK SERVICE'\n \u0001\nAPT40 Advisory   PRC MSS tradecraft in action 17\n\n \u0001dismhost:\n \u0001Image|endswith:'dismhost.exe'\n \u0001known_parent:\n \u0001ParentImage|endswith:\n -'\\\\esif_uf.exe'\n -'\\\\vmtoolsd.exe'\n -'\\\\cwainstaller.exe'\n -'\\\\trolleyexpress.exe'\n \u0001condition: temp and not (common_temp_path or \nsystem_user or dismhost or known_parent)\nFalse positives:\n -Allowlist auditing applications have been \nobserved running executables from T emp.\n -T emp will legitimately contain an array of setup \napplicationsandlaunchers,soitwillbeworth\nconsidering how prevalent this behaviour is on a \nmonitored network (and whether or not it can be \nallowlisted) before deploying this rule.\nLevel: low\nTitle: World Writable Execution - Non-Temp System \nSubdirectory\nID: 5b187157-e892-4fc9-84fc-aa48aff9f997\nDescription: Detect process execution from a world \nwritable location in a subdirectory of the Windows OS \ninstall location.\nBackground:\nThisrulelooksspecificallyforexecutionoutofworld\nwritable directories within C:\\ and particularly C:\\\nWindows\\*,withtheexceptionofC:\\Windows\\Temp\n(which is more broadly used by benign applications \nandthusalowerconfidencemaliciousindicator).\nAppDatafoldersareexcludedifafileisrunasSYSTEM\n- this is a benign way in which many temporary \napplicationfilesareexecuted.\nAfter completing an initial network baseline and \nidentifying known benign executions from these \nlocations,thisruleshouldrarelyfire.\nInvestigation:\n1. Examine information directly associated with this \nfileexecution,suchastheusercontext,execution\nintegritylevel,immediatefollow-onactivityand\nimagesloadedbythefile.\n2.Investigatecontextualprocess,network,file\nand other supporting data on the host to help \nmake an assessment as to whether the activity is \nmalicious.3.Ifnecessaryattempttocollectacopyofthefile\nfor reverse engineering to determine whether it is \nlegitimate.\nReferences:\nhttps://gist.github.com/\nmattifestation/5f9de750470c9e0e1f9c9c33f0ec3e56\nhttps://www.elastic.co/guide/en/security/current/\nprocess-execution-from-an-unusual-directory.html\nAuthor: ASD's ACSC\nDate: 2024/06/19\nStatus: experimental\nTags:\n -tlp.green\n -classification.au.official\n -attack.execution\nLog source:\n \u0001category: process_creation\n \u0001product: windows\nDetection:\n \u0001writable_path:\n \u0001Image|contains:\n -':\\\\$Recycle.Bin\\\\'\n -':\\\\AMD\\\\T emp\\\\'\n -':\\\\Intel\\\\'\n -':\\\\PerfLogs\\\\'\n -':\\\\Windows\\\\addins\\\\'\n -':\\\\Windows\\\\appcompat\\\\'\n -':\\\\Windows\\\\apppatch\\\\'\n -':\\\\Windows\\\\AppReadiness\\\\'\n -':\\\\Windows\\\\bcastdvr\\\\'\n -':\\\\Windows\\\\Boot\\\\'\n -':\\\\Windows\\\\Branding\\\\'\n -':\\\\Windows\\\\CbsT emp\\\\'\n -':\\\\Windows\\\\Containers\\\\'\n -':\\\\Windows\\\\csc\\\\'\n -':\\\\Windows\\\\Cursors\\\\'\n -':\\\\Windows\\\\debug\\\\'\n -':\\\\Windows\\\\diagnostics\\\\'\n -':\\\\Windows\\\\DigitalLocker\\\\'\n -':\\\\Windows\\\\dot3svc\\\\'\n -':\\\\Windows\\\\en-US\\\\'\n -':\\\\Windows\\\\Fonts\\\\'\n -':\\\\Windows\\\\Globalization\\\\'\n -':\\\\Windows\\\\Help\\\\'\n -':\\\\Windows\\\\IdentityCRL\\\\'\n -':\\\\Windows\\\\IME\\\\'\n -':\\\\Windows\\\\ImmersiveControlPanel\\\\'\n -':\\\\Windows\\\\INF\\\\'\nAPT40 Advisory   PRC MSS tradecraft in action 18\n\n -':\\\\Windows\\\\intel\\\\'\n -':\\\\Windows\\\\L2Schemas\\\\'\n -':\\\\Windows\\\\LiveKernelReports\\\\'\n -':\\\\Windows\\\\Logs\\\\'\n -':\\\\Windows\\\\media\\\\'\n -':\\\\Windows\\\\Migration\\\\'\n -':\\\\Windows\\\\ModemLogs\\\\'\n -':\\\\Windows\\\\ms\\\\'\n -':\\\\Windows\\\\OCR\\\\'\n -':\\\\Windows\\\\panther\\\\'\n -':\\\\Windows\\\\Performance\\\\'\n -':\\\\Windows\\\\PLA\\\\'\n -':\\\\Windows\\\\PolicyDefinitions\\\\'\n -':\\\\Windows\\\\Prefetch\\\\'\n -':\\\\Windows\\\\PrintDialog\\\\'\n -':\\\\Windows\\\\Provisioning\\\\'\n -':\\\\Windows\\\\Registration\\\\CRMLog\\\\'\n -':\\\\Windows\\\\RemotePackages\\\\'\n -':\\\\Windows\\\\rescache\\\\'\n -':\\\\Windows\\\\Resources\\\\'\n -':\\\\Windows\\\\SchCache\\\\'\n -':\\\\Windows\\\\schemas\\\\'\n -':\\\\Windows\\\\security\\\\'\n -':\\\\Windows\\\\ServiceState\\\\'\n -':\\\\Windows\\\\servicing\\\\'\n -':\\\\Windows\\\\Setup\\\\'\n -':\\\\Windows\\\\ShellComponents\\\\'\n -':\\\\Windows\\\\ShellExperiences\\\\'\n -':\\\\Windows\\\\SKB\\\\'\n -':\\\\Windows\\\\TAPI\\\\'\n -':\\\\Windows\\\\T asks\\\\'\n -':\\\\Windows\\\\T extInput\\\\'\n -':\\\\Windows\\\\tracing\\\\'\n -':\\\\Windows\\\\Vss\\\\'\n -':\\\\Windows\\\\WaaS\\\\'\n -':\\\\Windows\\\\Web\\\\'\n -':\\\\Windows\\\\wlansvc\\\\'\n -':\\\\Windows\\\\System32\\\\Com\\\\dmp\\\\'\n -':\\\\Windows\\\\System32\\\\FxsTmp\\\\'\n -':\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\\nRSA\\\\MachineKeys\\\\'\n -':\\\\Windows\\\\System32\\\\Speech\\\\'\n -':\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\\ncolor\\\\'\n -':\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\'\n -':\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\'\n -':\\\\Windows\\\\System32\\\\Tasks_Migrated\\\\\nMicrosoft\\\\Windows\\\\PLA\\\\System\\\\'\n -':\\\\Windows\\\\System32\\\\Tasks\\\\'\n -':\\\\Windows\\\\SysWOW64\\\\Com\\\\dmp\\\\'\n -':\\\\Windows\\\\SysWOW64\\\\FxsTmp\\\\'\n -':\\\\Windows\\\\SysWOW64\\\\Tasks\\\\'\n \u0001 \u0001appdata:\n \u0001Image|contains:'\\\\AppData\\\\'\n \u0001User: 'SYSTEM'\n \u0001condition: writable_path and not appdata\nFalse positives:\nAllowlist auditing applications have been observed \nrunning executables from these directories.\nIt is plausible that scripts and administrative tools used \nin the monitored environment(s) may be located in \none of these directories and should be addressed on a \ncase-by-case basis.\nLevel:  high\nTitle: World Writable Execution - Users\nID: 6dda3843-182a-4214-9263-925a80b4c634\nDescription: Detect process execution from C:\\Users\\\nPublic\\* and other world writable folders within Users.\nBackground:\nAppDatafoldersareexcludedifafileisrunasSYSTEM\n- this is a benign way in which many temporary \napplicationfilesareexecuted.\nInvestigation:\n1. Examine information directly associated with this \nfileexecution,suchastheusercontext,execution\nintegritylevel,immediatefollow-onactivityand\nimagesloadedbythefile.\n2.Investigatecontextualprocess,network,file\nand other supporting data on the host to help \nmake an assessment as to whether the activity is \nmalicious.\n3.Ifnecessaryattempttocollectacopyofthefile\nfor reverse engineering to determine whether it is \nlegitimate.\nReferences:\nhttps://www.elastic.co/guide/en/security/current/\nprocess-execution-from-an-unusual-directory.html\nAuthor: ASD's ACSC\nDate: 2024/06/19\nStatus: experimental\nTags:\n -tlp.green\n -classification.au.official\n -attack.execution\nLog source:\n \u0001category: process_creation\n \u0001product: windows\nAPT40 Advisory   PRC MSS tradecraft in action 19\n\nDetection:\n \u0001users:\n \u0001Image|contains:\n -':\\\\Users\\\\All Users\\\\'\n -':\\\\Users\\\\Contacts\\\\'\n -':\\\\Users\\\\Default\\\\'\n -':\\\\Users\\\\Public\\\\'\n -':\\\\Users\\\\Searches\\\\'\n \u0001appdata:\n \u0001Image|contains:'\\\\AppData\\\\'\n \u0001User: 'SYSTEM'\n \u0001condition: users and not appdata\nFalse positives:\n -It is plausible that scripts and administrative tools \nused in the monitored environment(s) may be \nlocated in Public or a subdirectory and should be \naddressed on a case-by-case basis.\nLevel: medium\nMitigations\nLogging\nDuringASDsACSCinvestigations,acommonissuethat\nreduces the effectiveness and speed of investigative \nefforts is a lack of comprehensive and historical \nlogging information across a number of areas \nincludingwebserverrequestlogs,Windowseventlogs\nand internet proxy logs. \nASDs ACSC recommends reviewing and implementing \ntheir guidance on Windows Event Logging and \nForwarding includingtheconfigurationfilesandscripts\nin the Windows Event Logging Repository  and the \nInformation Security Manuals Guidelines for System \nMonitoring ,toincludecentralizinglogsandretaining\nlogs for a suitable period.\nPatch management\nPromptly patch all internet exposed devices and \nservices,includingwebservers,webapplications,and\nremote access gateways. Consider implementing a \ncentralised patch management system to automate \nand expedite the process. ASDs ACSC recommend \nimplementation of the ISMs Guidelines for System \nManagement ,specifically,theSystemPatching\ncontrols where applicable.Most exploits utilised by the actor were publicly \nknown and had patches or mitigations available. \nOrganisations should ensure that security patches or \nmitigations are applied to internet facing infrastructure \nwithin48hours,andwherepossible,usethelatest\nversions of software and operating systems. \nNetwork segmentation\nNetworksegmentationcanmakeitsignificantlymore\ndifficultforadversariestolocateandgainaccesstoan\norganisations sensitive data. Segment networks to limit \norblocklateralmovementbydenyingtrafficbetween\ncomputersunlessrequired.Importantserverssuch\nas Active Directory and other authentication servers \nshould only be able to be administered from a limited \nnumberofintermediaryserversorjumpservers.These\nserversshouldbecloselymonitored,bewellsecured\nand limit which users and devices are able to connect \nto them.\nRegardlessofinstancesidentifiedwherelateral\nmovementisprevented,additionalnetwork\nsegmentation could have further limited the amount of \ndata the actors was able to access and extract. \nAdditional mitigations\nThe authoring agencies also recommend the following \nmitigationstocombatAPT40andothersuseofthe\nTTPs below.\n Disableunusedorunnecessarynetworkservices,\nports and protocols.\n Usewell-tunedWebapplicationfirewalls(WAFs)\nto protect web servers and applications.\n Enforceleastprivilegetolimitaccesstoservers,\nfileshares,andotherresources.\n Use multi-factor authentication (MFA) and \nmanaged service accounts to make credentials \nharder to crack and reuse. MFA should be \napplied to all internet accessible remote access \nservices,including:\n  Web and cloud-based email\n  Collaboration platforms\n  Virtual private network connections\n  Remote desktop services\n Replaceend-of-lifeequipment.\nAPT40 Advisory   PRC MSS tradecraft in action 20\n\nTable 1. Mitigation Strategies/Techniques\nTTP Essential Eight Mitigation Strategies ISM Controls\nInitial Access\nT1190\nExploitation of Public-Facing \nApplication Patch applications\n Patch operating systems\n Multi-factor authentication\n Application controlISM-0140\nISM-1698\nISM-1701\nISM-1921\nISM-1876\nISM-1877\nISM-1905\nExecution\nT1059\nCommand and Scripting \nInterpreter Application control\n RestrictMicrosoftOfficemacros\n Restrict administrative privilegesISM-0140\nISM-1490\nISM-1622\nISM-1623\nISM-1657\nISM-1890\nPersistence\nT1505.003\nServer Software Component: \nWeb Shell Application Control\n Restrict administrative privilegesISM-0140\nISM-1246\nISM-1746\nISM-1249\nISM-1250\nISM-1490\nISM-1657\nISM-1871\nInitialAccess/Privilege\nEscalation/Persistence\nT1078\nValid Accounts  Patch operating systems\n Multi-factor authentication\n Restrict administrative privileges\n Application control \n User application hardeningISM-0140\nISM-0859\nISM-1546\nISM-1504\nISM-1679\nForadditionalgeneraldetectionandmitigationadvice,pleaseconsultthe Mitigations and Detection  sections on \ntheMITREATT&CKtechniquewebpageforeachofthetechniquesidentifiedintheMITREATT&CKsummaryatthe\nend of this advisory.\nDisclaimer\nThe information in this report is being provided as is for informational purposes only. The authoring agencies \ndonotendorseanycommercialentity,product,company,orservice,includinganyentities,products,orservices\nlinkedwithinthisdocument.Anyreferencetospecificcommercialentities,products,processes,orservicesby\nservicemark,trademark,manufacturer,orotherwise,doesnotconstituteorimplyendorsement,recommendation,\nor favoring by the authoring agencies.\nThis document is marked TLP:CLEAR. Disclosure is not limited. Sources may use TLP:CLEAR when information \ncarriesminimalornoforeseeableriskofmisuse,inaccordancewithapplicablerulesandproceduresforpublic\nrelease.Subjecttostandardcopyrightrules,TLP:CLEARinformationmaybedistributedwithoutrestriction.For\nmoreinformationontheTrafficLightProtocol,see cisa.gov/tlp\nAPT40 Advisory   PRC MSS tradecraft in action 21\n\nMITRE ATT&CK  \nHistorical APT40 \ntradecraft of interest\nReconnaissance (TA0043)\nSearchVictim-OwnedWebsites(T1594)Gather Victim Identity Information: Credentials \n(T1589.001)\nActiveScanning:VulnerabilityScanning(T1595.002) GatherVictimHostInformation(T1592)\nSearchOpenWebsites/Domains:SearchEngines\n(T1593.002)Gather Victim Network Information: Domain Properties \n(T1590.001)\nGather Victim Identity Information: Email Addresses \n(T1589.002)\nResource Development (TA0042)\nAcquireInfrastructure:Domains(T1583.001) AcquireInfrastructure(T1583)\nAcquireInfrastructure:DNSServer(T1583.002) CompromiseAccounts(T1586)\nDevelopCapabilities:CodeSigningCertificates\n(T1587.002)CompromiseInfrastructure(T1584)\nDevelopCapabilities:DigitalCertificates(T1587.003) DevelopCapabilities:Malware(T1587.001)\nObtainCapabilities:CodeSigningCertificates\n(T1588.003)EstablishAccounts:CloudAccounts(T1585.003)\nCompromiseInfrastructure:NetworkDevices(T1584.008) ObtainCapabilities:DigitalCertificates(T1588.004)\nInitial Access (TA0001)\nValidAccounts(T1078) Phishing(T1566)\nValidAccounts:DefaultAccounts(T1078.001) Phishing:SpearphishingAttachment(T1566.001)\nValidAccounts:DomainAccounts(T1078.002) Phishing:SpearphishingLink(T1566.002)\nExternalRemoteServices(T1133) ExploitPublic-FacingApplication(T1190)\nDrive-byCompromise(T1189)\nAPT40 Advisory   PRC MSS tradecraft in action 22\n\nExecution (TA0002)\nWindowsManagementInstrumentation(T1047) CommandandScriptingInterpreter:Python(T1059.006)\nScheduledTask/Job:At(T1053.002)Command and Scripting Interpreter: JavaScript \n(T1059.007)\nScheduledTask/Job:ScheduledTask(T1053.005) NativeAPI(T1106)\nCommandandScriptingInterpreter(T1059) Inter-ProcessCommunication(T1559)\nCommand and Scripting Interpreter: Windows Command \nShell(T1059.003)SystemServices:ServiceExecution(T1569.002)\nCommand and Scripting Interpreter: PowerShell \n(T1059.001)ExploitationforClientExecution(T1203)\nCommand and Scripting Interpreter: Visual Basic \n(T1059.005)UserExecution:MaliciousFile(T1204.002)\nCommand and Scripting Interpreter: Unix Shell \n(T1059.004)Command and Scripting Interpreter: Apple Script \n(T1059.002)\nScheduledTask/Job:Cron(T1053.003) SoftwareDeploymentTools(T1072)\nPersistence (TA0003)\nValidAccounts(T1078) ServerSoftwareComponent:WebShell(T1505.003)\nOfficeApplicationStartup:OfficeTemplateMacros\n(T1137.001)Create or Modify System Process: Windows Service \n(T1543.003)\nScheduledTask/Job:At(T1053.002)BootorLogonAutostartExecution:RegistryRunKeys/\nStartupFolder(T1547.001)\nScheduledTask/Job:ScheduledTask(T1053.005)BootorLogonAutostartExecution:ShortcutModification\n(T1547.009)\nExternalRemoteServices(T1133)HijackExecutionFlow:DLLSearchOrderHijacking\n(T1574.001)\nScheduledTask/Job:Cron(T1053.003) HijackExecutionFlow:DLLSide-Loading(T1574.002)\nAccountManipulation(T1098) ValidAccounts:CloudAccounts(T1078.004)\nValidAccounts:DomainAccounts(T1078.002)\nPrivilege Escalation (TA0004)\nScheduledTask/Job:At(T1053.002)Create or Modify System Process: Windows Service \n(T1543.003)\nScheduledTask/Job:ScheduledTask(T1053.005)BootorLogonAutostartExecution:RegistryRunKeys/\nStartupFolder(T1547.001)\nProcessInjection:ThreadExecutionHijacking\n(T1055.003)BootorLogonAutostartExecution:ShortcutModification\n(T1547.009)\nProcessInjection:ProcessHollowing(T1055.012)HijackExecutionFlow:DLLSearchOrderHijacking\n(T1574.001)\nAPT40 Advisory   PRC MSS tradecraft in action 23\n\nPrivilege Escalation (TA0004)\nValidAccounts:DomainAccounts(T1078.002) ExploitationforPrivilegeEscalation(T1068)\nAccessTokenManipulation:TokenImpersonation/Theft\n(T1134.001)EventTriggeredExecution:UnixShellConfiguration\nModification(T1546.004)\nProcessInjection:Dynamic-linkLibraryInjection\n(T1055.001)ValidAccounts:DomainAccounts(T1078.002)\nValidAccounts:LocalAccounts(T1078.003)\nDefence Evasion (TA0005)\nRootkit(T1014) IndirectCommandExecution(T1202)\nObfuscatedFilesorInformation(T1027) SystemBinaryProxyExecution:Mshta(T1218.005)\nObfuscated Files or Information: Software Packing \n(T1027.002)SystemBinaryProxyExecution:Regsvr32(T1218.010)\nObfuscated Files or Information: Steganography \n(T1027.003)SubvertTrustControls:CodeSigning(T1553.002)\nObfuscated Files or Information: Compile After Delivery \n(T1027.004)FileandDirectoryPermissionsModifications:Linux\nandMacFileandDirectoryPermissionsModification\n(T1222.002)\nMasquerading:MatchLegitimateNameorLocation\n(T1036.005)Virtualisation/SandboxEvasion:SystemChecks\n(T1497.001)\nProcessInjection:ThreadExecutionHijacking\n(T1055.003)Masquerading(T1036)\nReflectiveCodeLoading(T1620)Impair Defences: Disable or Modify System Firewall \n(T1562.004)\nProcessInjection:ProcessHollowing(T1055.012) HideArtifacts:HiddenFilesandDirectories(T1564.001)\nIndicatorRemoval:FileDeletion(T1070.004) HideArtifacts:HiddenWindow(T1564.003)\nIndicatorRemoval:Timestomp(T1070.006)HijackExecutionFlow:DLLSearchOrderHijacking\n(T1574.001)\nIndicator Removal: Clear Windows Event Logs \n(T1070.001)HijackExecutionFlow:DLLSide-Loading(T1574.002)\nModifyRegistry(T1112) WebService(T1102)\nDeobfuscate/DecodeFilesorInformation(T1140) Masquerading:MasqueradeTaskorService(T1036.004)\nImpairDefenses(T1562)\nCredential Access (TA0006)\nOSCredentialDumping:LSASSMemory(T1003.001) UnsecuredCredentials:CredentialsinFiles(T1552.001)\nOSCredentialDumping:NTDS(T1003.003) BruteForce:PasswordGuessing(T1110.001)\nNetworkSniffing(T1040) ForcedAuthentication(T1187)\nCredentialsfromPasswordStores:Keychain(T1555.001)Steal or Forge Kerberos Tickets: Kerberoasting \n(T1558.003)\nAPT40 Advisory   PRC MSS tradecraft in action 24\n\nCredential Access (TA0006)\nInputCapture:Keylogging(T1056.001) Multi-FactorAuthenticationInterception(T1111)\nStealWebSessionCookie(T1539) StealApplicationAccessToken(T1528)\nExploitationforCredentialAccess(T1212) BruteForce:PasswordCracking(T1110.002)\nInputCapture:WebPortalCapture(T1056.003) OSCredentialDumping:DCSync(T1003.006)\nCredentialsfromPasswordStores(T1555)Credentials from Password Stores: Credentials from Web \nBrowsers(T1555.003)\nDiscovery (TA0007)\nSystemServiceDiscovery(T1007) SystemInformationDiscovery(T1082)\nApplicationWindowDiscovery(T1010) AccountDiscovery:LocalAccount(T1087.001)\nQueryRegistry(T1012)SystemInformationDiscovery,TechniqueT1082-\nEnterprise|MITREATT&CK\nFileandDirectoryDiscovery(T1083) SystemTimeDiscovery(T1124)\nNetworkServiceDiscovery(T1046) SystemOwner/UserDiscovery(T1033)\nRemoteSystemDiscovery(T1018) DomainTrustDiscovery(T1482)\nAccountDiscovery:EmailAccount(T1087.003) AccountDiscovery:DomainAccount(T1087.002)\nSystemNetworkConnectionsDiscovery(T1049)Virtualisation/SandboxEvasion:SystemChecks\n(T1497.001)\nProcessDiscovery(T1057) SoftwareDiscovery(T1518)\nPermission Groups Discovery: Domain Groups \n(T1069.002)NetworkShareDiscovery,TechniqueT1135-Enterprise|\nMITREATT&CK\nSystemNetworkConfigurationDiscovery:Internet\nConnectionDiscovery(T1016.001)\nLateral Movement (TA0008)\nRemoteServices:RemoteDesktopProtocol(T1021.001) RemoteServices(T1021)\nRemoteServices:SMB/WindowsAdminShares\n(T1021.002)Use Alternate Authentication Material: Pass the Ticket \n(T1550.003)\nRemote Services: Windows Remote Management \n(T1021.006)LateralToolTransfer(T1570)\nCollection (TA0009)\nDatafromLocalSystem(T1005) ArchiveCollectedData:ArchiveviaLibrary(T1560.002)\nDatafromNetworkSharedDrive(T1039) EmailCollection:RemoteEmailCollection(T1114.002)\nAPT40 Advisory   PRC MSS tradecraft in action 25\n\nCollection (TA0009)\nInputCapture:Keylogging(T1056.001) ClipboardData(T1115)\nAutomatedCollection(T1119) DatafromInformationRepositories(T1213)\nInputCapture:WebPortalCapture(T1056.003) DataStaged:RemoteDataStaging(T1074.002)\nDataStaged:LocalDataStaging(T1074.001) ArchiveCollectedData(T1560)\nEmailCollection(T1114)\nExfiltration (TA0010)\nExfiltrationOverC2Channel(T1041)ExfiltrationOverAlternativeProtocol:ExfiltrationOver\nAsymmetricEncryptedNon-C2Protocol(T1048.002)\nExfiltrationOverAlternativeProtocol(T1048)ExfiltrationOverWebService:ExfiltrationtoCloud\nStorage(T1567.002)\nCommand and Control (TA0011)\nDataObfuscation:ProtocolImpersonation(T1001.003) WebService:DeadDropResolver(T1102.001)\nCommonlyUsedPort(T1043) WebService:One-wayCommunication(T1102.003)\nApplicationLayerProtocol:WebProtocols(T1071.001) IngressToolTransfer(T1105)\nApplication Layer Protocol: File Transfer Protocols \n(T1071.002)Proxy:InternalProxy(T1090.001)\nProxy:ExternalProxy(T1090.002) Non-StandardPort(T1571)\nProxy:Multi-hopProxy(T1090.003) ProtocolTunnelling(T1572)\nWebService:BidirectionalCommunication(T1102.002) EncryptedChannel(T1573)\nEncrypted Channel: Asymmetric Cryptography \n(T1573.002)IngressToolTransfer(T1105)\nProxy,TechniqueT1090-Enterprise|MITREATT&CK\nImpact (TA0040)\nServiceStop(T1489) DiskWipe(T1561)\nSystemShutdown/Reboot(T1529) ResourceHijacking(T1496)\nAPT40 Advisory   PRC MSS tradecraft in action 26\n\nNotes\nAPT40 Advisory   PRC MSS tradecraft in action 27\n\nDisclaimer\nThe material in this guide is of a general nature and should not be regarded as \nlegal advice or relied on for assistance in any particular circumstance or emergency \nsituation.Inanyimportantmatter,youshouldseekappropriateindependent\nprofessional advice in relation to your own circumstances.\nTheCommonwealthacceptsnoresponsibilityorliabilityforanydamage,lossor\nexpense incurred as a result of the reliance on information contained in this guide.\nCopyright\n Commonwealth of Australia 2023.\nWiththeexceptionoftheCoatofArmsandwhereotherwisestated,allmaterial\npresented in this publication is provided under a Creative Commons Attribution  \n4.0 International licence ( www.creativecommons.org/licenses ).\nFortheavoidanceofdoubt,thismeansthislicenceonlyappliestomaterial  \nas set out in this document.\nThe details of the relevant licence conditions are available on the Creative Commons \nwebsite as is the full legal code for the CC BY 4.0 licence \n(www.creativecommons.org/licenses ).\nUse of the Coat of Arms\nThe terms under which the Coat of Arms can be used are detailed  \non the Department of the Prime Minister and Cabinet website  \n(www.pmc.gov.au/government/commonwealth-coat-arms ).\nFor more information, or to report a cyber security incident, contact us:\ncyber.gov.au |1300CYBER1(1300292371) .\n\n\n",
  "cves": [
    "CVE-2021-34523",
    "CVE-2021-31207",
    "CVE-2021-34473"
  ],
  "techniques": [
    "T1106",
    "T1589.002",
    "T1555.003",
    "T1069.002",
    "T1036.004",
    "T1114.002",
    "T1102.003",
    "T1190",
    "T1489",
    "T1049",
    "T1590.001",
    "T1546.004",
    "T1021",
    "T1135",
    "T1074.002",
    "T1059.003",
    "T1059.001",
    "T1543",
    "T1078",
    "T1036",
    "T1012",
    "T1583",
    "T1071.002",
    "T1078.004",
    "T1057",
    "T1203",
    "T1014",
    "T1592",
    "T1562.004",
    "T1007",
    "T1593.002",
    "T1587.001",
    "T1110.002",
    "T1048",
    "T1001.003",
    "T1547.009",
    "T1033",
    "T1573",
    "T1005",
    "T1059.007",
    "T1555",
    "T1558.003",
    "T1218.010",
    "T1046",
    "T1564.001",
    "T1074.001",
    "T1090.003",
    "T1102.002",
    "T1055.001",
    "T1087.001",
    "T1584.008",
    "T1003.006",
    "T1027.003",
    "T1559",
    "T1018",
    "T1505.003",
    "T1027",
    "T1021.001",
    "T1070.001",
    "T1543.003",
    "T1134.001",
    "T1078.002",
    "T1055.012",
    "T1070.006",
    "T1102.001",
    "T1041",
    "T1583.001",
    "T1594",
    "T1564.003",
    "T1584",
    "T1047",
    "T1114",
    "T1496",
    "T1053.005",
    "T1059.002",
    "T1505.001",
    "T1016.001",
    "T1021.006",
    "T1102",
    "T1070",
    "T1561",
    "T1110.001",
    "T1048.002",
    "T1003",
    "T1087.002",
    "T1056.003",
    "T1204.002",
    "T1218.005",
    "T1574.001",
    "T1595.002",
    "T1547.001",
    "T1119",
    "T1189",
    "T1550.003",
    "T1071.001",
    "T1039",
    "T1087.003",
    "T1090.001",
    "T1583.002",
    "T1528",
    "T1587.003",
    "T1043",
    "T1068",
    "T1021.002",
    "T1036.005",
    "T1027.004",
    "T1620",
    "T1562",
    "T1588.004",
    "T1566.001",
    "T1059.004",
    "T1003.001",
    "T1010",
    "T1090.002",
    "T1053.003",
    "T1202",
    "T1539",
    "T1569.002",
    "T1572",
    "T1124",
    "T1027.002",
    "T1083",
    "T1587.002",
    "T1574.002",
    "T1212",
    "T1078.001",
    "T1560",
    "T1573.002",
    "T1040",
    "T1571",
    "T1566.002",
    "T1133",
    "T1098",
    "T1137.001",
    "T1585.003",
    "T1078.003",
    "T1555.001",
    "T1105",
    "T1090",
    "T1552.001",
    "T1055.003",
    "T1529",
    "T1482",
    "T1553.002",
    "T1082",
    "T1567.002",
    "T1003.003",
    "T1570",
    "T1053.002",
    "T1560.002",
    "T1518",
    "T1586",
    "T1187",
    "T1563.002",
    "T1589.001",
    "T1111",
    "T1059",
    "T1497.001",
    "T1072",
    "T1056.001",
    "T1112",
    "T1213",
    "T1222.002",
    "T1588.003",
    "T1566",
    "T1059.006",
    "T1059.005",
    "T1070.004",
    "T1140",
    "T1115"
  ],
  "advisory": "cybersecurity-alerts",
  "title": "csa_prc_mss_tradecraft_in_action",
  "source": "nsa",
  "id": "835054e52f1fbd3dfa002d61bd0e405e1a8b2cb859d1c21d5d0768f32a737ec0"
}